(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();function hm(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ih={exports:{}},go={};var Ib;function eS(){if(Ib)return go;Ib=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(l,a,i){var d=null;if(i!==void 0&&(d=""+i),a.key!==void 0&&(d=""+a.key),"key"in a){i={};for(var u in a)u!=="key"&&(i[u]=a[u])}else i=a;return a=i.ref,{$$typeof:n,type:l,key:d,ref:a!==void 0?a:null,props:i}}return go.Fragment=e,go.jsx=t,go.jsxs=t,go}var zb;function tS(){return zb||(zb=1,Ih.exports=eS()),Ih.exports}var o=tS(),zh={exports:{}},Nt={};var Lb;function nS(){if(Lb)return Nt;Lb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),d=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),y=Symbol.iterator;function v(O){return O===null||typeof O!="object"?null:(O=y&&O[y]||O["@@iterator"],typeof O=="function"?O:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,j={};function E(O,te,ke){this.props=O,this.context=te,this.refs=j,this.updater=ke||N}E.prototype.isReactComponent={},E.prototype.setState=function(O,te){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,te,"setState")},E.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function D(){}D.prototype=E.prototype;function _(O,te,ke){this.props=O,this.context=te,this.refs=j,this.updater=ke||N}var H=_.prototype=new D;H.constructor=_,S(H,E.prototype),H.isPureReactComponent=!0;var L=Array.isArray;function V(){}var G={H:null,A:null,T:null,S:null},X=Object.prototype.hasOwnProperty;function $(O,te,ke){var U=ke.ref;return{$$typeof:n,type:O,key:te,ref:U!==void 0?U:null,props:ke}}function R(O,te){return $(O.type,te,O.props)}function A(O){return typeof O=="object"&&O!==null&&O.$$typeof===n}function B(O){var te={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(ke){return te[ke]})}var Y=/\/+/g;function J(O,te){return typeof O=="object"&&O!==null&&O.key!=null?B(""+O.key):te.toString(36)}function de(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(V,V):(O.status="pending",O.then(function(te){O.status==="pending"&&(O.status="fulfilled",O.value=te)},function(te){O.status==="pending"&&(O.status="rejected",O.reason=te)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function w(O,te,ke,U,ge){var Ee=typeof O;(Ee==="undefined"||Ee==="boolean")&&(O=null);var ie=!1;if(O===null)ie=!0;else switch(Ee){case"bigint":case"string":case"number":ie=!0;break;case"object":switch(O.$$typeof){case n:case e:ie=!0;break;case g:return ie=O._init,w(ie(O._payload),te,ke,U,ge)}}if(ie)return ge=ge(O),ie=U===""?"."+J(O,0):U,L(ge)?(ke="",ie!=null&&(ke=ie.replace(Y,"$&/")+"/"),w(ge,te,ke,"",function(we){return we})):ge!=null&&(A(ge)&&(ge=R(ge,ke+(ge.key==null||O&&O.key===ge.key?"":(""+ge.key).replace(Y,"$&/")+"/")+ie)),te.push(ge)),1;ie=0;var Ie=U===""?".":U+":";if(L(O))for(var P=0;P<O.length;P++)U=O[P],Ee=Ie+J(U,P),ie+=w(U,te,ke,Ee,ge);else if(P=v(O),typeof P=="function")for(O=P.call(O),P=0;!(U=O.next()).done;)U=U.value,Ee=Ie+J(U,P++),ie+=w(U,te,ke,Ee,ge);else if(Ee==="object"){if(typeof O.then=="function")return w(de(O),te,ke,U,ge);throw te=String(O),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return ie}function T(O,te,ke){if(O==null)return O;var U=[],ge=0;return w(O,U,"","",function(Ee){return te.call(ke,Ee,ge++)}),U}function I(O){if(O._status===-1){var te=O._result;te=te(),te.then(function(ke){(O._status===0||O._status===-1)&&(O._status=1,O._result=ke)},function(ke){(O._status===0||O._status===-1)&&(O._status=2,O._result=ke)}),O._status===-1&&(O._status=0,O._result=te)}if(O._status===1)return O._result.default;throw O._result}var Z=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},pe={map:T,forEach:function(O,te,ke){T(O,function(){te.apply(this,arguments)},ke)},count:function(O){var te=0;return T(O,function(){te++}),te},toArray:function(O){return T(O,function(te){return te})||[]},only:function(O){if(!A(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Nt.Activity=b,Nt.Children=pe,Nt.Component=E,Nt.Fragment=t,Nt.Profiler=a,Nt.PureComponent=_,Nt.StrictMode=l,Nt.Suspense=h,Nt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=G,Nt.__COMPILER_RUNTIME={__proto__:null,c:function(O){return G.H.useMemoCache(O)}},Nt.cache=function(O){return function(){return O.apply(null,arguments)}},Nt.cacheSignal=function(){return null},Nt.cloneElement=function(O,te,ke){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var U=S({},O.props),ge=O.key;if(te!=null)for(Ee in te.key!==void 0&&(ge=""+te.key),te)!X.call(te,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&te.ref===void 0||(U[Ee]=te[Ee]);var Ee=arguments.length-2;if(Ee===1)U.children=ke;else if(1<Ee){for(var ie=Array(Ee),Ie=0;Ie<Ee;Ie++)ie[Ie]=arguments[Ie+2];U.children=ie}return $(O.type,ge,U)},Nt.createContext=function(O){return O={$$typeof:d,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:i,_context:O},O},Nt.createElement=function(O,te,ke){var U,ge={},Ee=null;if(te!=null)for(U in te.key!==void 0&&(Ee=""+te.key),te)X.call(te,U)&&U!=="key"&&U!=="__self"&&U!=="__source"&&(ge[U]=te[U]);var ie=arguments.length-2;if(ie===1)ge.children=ke;else if(1<ie){for(var Ie=Array(ie),P=0;P<ie;P++)Ie[P]=arguments[P+2];ge.children=Ie}if(O&&O.defaultProps)for(U in ie=O.defaultProps,ie)ge[U]===void 0&&(ge[U]=ie[U]);return $(O,Ee,ge)},Nt.createRef=function(){return{current:null}},Nt.forwardRef=function(O){return{$$typeof:u,render:O}},Nt.isValidElement=A,Nt.lazy=function(O){return{$$typeof:g,_payload:{_status:-1,_result:O},_init:I}},Nt.memo=function(O,te){return{$$typeof:p,type:O,compare:te===void 0?null:te}},Nt.startTransition=function(O){var te=G.T,ke={};G.T=ke;try{var U=O(),ge=G.S;ge!==null&&ge(ke,U),typeof U=="object"&&U!==null&&typeof U.then=="function"&&U.then(V,Z)}catch(Ee){Z(Ee)}finally{te!==null&&ke.types!==null&&(te.types=ke.types),G.T=te}},Nt.unstable_useCacheRefresh=function(){return G.H.useCacheRefresh()},Nt.use=function(O){return G.H.use(O)},Nt.useActionState=function(O,te,ke){return G.H.useActionState(O,te,ke)},Nt.useCallback=function(O,te){return G.H.useCallback(O,te)},Nt.useContext=function(O){return G.H.useContext(O)},Nt.useDebugValue=function(){},Nt.useDeferredValue=function(O,te){return G.H.useDeferredValue(O,te)},Nt.useEffect=function(O,te){return G.H.useEffect(O,te)},Nt.useEffectEvent=function(O){return G.H.useEffectEvent(O)},Nt.useId=function(){return G.H.useId()},Nt.useImperativeHandle=function(O,te,ke){return G.H.useImperativeHandle(O,te,ke)},Nt.useInsertionEffect=function(O,te){return G.H.useInsertionEffect(O,te)},Nt.useLayoutEffect=function(O,te){return G.H.useLayoutEffect(O,te)},Nt.useMemo=function(O,te){return G.H.useMemo(O,te)},Nt.useOptimistic=function(O,te){return G.H.useOptimistic(O,te)},Nt.useReducer=function(O,te,ke){return G.H.useReducer(O,te,ke)},Nt.useRef=function(O){return G.H.useRef(O)},Nt.useState=function(O){return G.H.useState(O)},Nt.useSyncExternalStore=function(O,te,ke){return G.H.useSyncExternalStore(O,te,ke)},Nt.useTransition=function(){return G.H.useTransition()},Nt.version="19.2.1",Nt}var _b;function Jo(){return _b||(_b=1,zh.exports=nS()),zh.exports}var C=Jo();const ps=hm(C);var Lh={exports:{}},xo={},_h={exports:{}},Bh={};var Bb;function sS(){return Bb||(Bb=1,(function(n){function e(w,T){var I=w.length;w.push(T);e:for(;0<I;){var Z=I-1>>>1,pe=w[Z];if(0<a(pe,T))w[Z]=T,w[I]=pe,I=Z;else break e}}function t(w){return w.length===0?null:w[0]}function l(w){if(w.length===0)return null;var T=w[0],I=w.pop();if(I!==T){w[0]=I;e:for(var Z=0,pe=w.length,O=pe>>>1;Z<O;){var te=2*(Z+1)-1,ke=w[te],U=te+1,ge=w[U];if(0>a(ke,I))U<pe&&0>a(ge,ke)?(w[Z]=ge,w[U]=I,Z=U):(w[Z]=ke,w[te]=I,Z=te);else if(U<pe&&0>a(ge,I))w[Z]=ge,w[U]=I,Z=U;else break e}}return T}function a(w,T){var I=w.sortIndex-T.sortIndex;return I!==0?I:w.id-T.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var d=Date,u=d.now();n.unstable_now=function(){return d.now()-u}}var h=[],p=[],g=1,b=null,y=3,v=!1,N=!1,S=!1,j=!1,E=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function H(w){for(var T=t(p);T!==null;){if(T.callback===null)l(p);else if(T.startTime<=w)l(p),T.sortIndex=T.expirationTime,e(h,T);else break;T=t(p)}}function L(w){if(S=!1,H(w),!N)if(t(h)!==null)N=!0,V||(V=!0,B());else{var T=t(p);T!==null&&de(L,T.startTime-w)}}var V=!1,G=-1,X=5,$=-1;function R(){return j?!0:!(n.unstable_now()-$<X)}function A(){if(j=!1,V){var w=n.unstable_now();$=w;var T=!0;try{e:{N=!1,S&&(S=!1,D(G),G=-1),v=!0;var I=y;try{t:{for(H(w),b=t(h);b!==null&&!(b.expirationTime>w&&R());){var Z=b.callback;if(typeof Z=="function"){b.callback=null,y=b.priorityLevel;var pe=Z(b.expirationTime<=w);if(w=n.unstable_now(),typeof pe=="function"){b.callback=pe,H(w),T=!0;break t}b===t(h)&&l(h),H(w)}else l(h);b=t(h)}if(b!==null)T=!0;else{var O=t(p);O!==null&&de(L,O.startTime-w),T=!1}}break e}finally{b=null,y=I,v=!1}T=void 0}}finally{T?B():V=!1}}}var B;if(typeof _=="function")B=function(){_(A)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,J=Y.port2;Y.port1.onmessage=A,B=function(){J.postMessage(null)}}else B=function(){E(A,0)};function de(w,T){G=E(function(){w(n.unstable_now())},T)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(w){w.callback=null},n.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<w?Math.floor(1e3/w):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(w){switch(y){case 1:case 2:case 3:var T=3;break;default:T=y}var I=y;y=T;try{return w()}finally{y=I}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(w,T){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var I=y;y=w;try{return T()}finally{y=I}},n.unstable_scheduleCallback=function(w,T,I){var Z=n.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?Z+I:Z):I=Z,w){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=I+pe,w={id:g++,callback:T,priorityLevel:w,startTime:I,expirationTime:pe,sortIndex:-1},I>Z?(w.sortIndex=I,e(p,w),t(h)===null&&w===t(p)&&(S?(D(G),G=-1):S=!0,de(L,I-Z))):(w.sortIndex=pe,e(h,w),N||v||(N=!0,V||(V=!0,B()))),w},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(w){var T=y;return function(){var I=y;y=T;try{return w.apply(this,arguments)}finally{y=I}}}})(Bh)),Bh}var Pb;function lS(){return Pb||(Pb=1,_h.exports=sS()),_h.exports}var Ph={exports:{}},fs={};var Hb;function rS(){if(Hb)return fs;Hb=1;var n=Jo();function e(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var l={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function i(h,p,g){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:b==null?null:""+b,children:h,containerInfo:p,implementation:g}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return fs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,fs.createPortal=function(h,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return i(h,p,null,g)},fs.flushSync=function(h){var p=d.T,g=l.p;try{if(d.T=null,l.p=2,h)return h()}finally{d.T=p,l.p=g,l.d.f()}},fs.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,l.d.C(h,p))},fs.prefetchDNS=function(h){typeof h=="string"&&l.d.D(h)},fs.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var g=p.as,b=u(g,p.crossOrigin),y=typeof p.integrity=="string"?p.integrity:void 0,v=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?l.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:y,fetchPriority:v}):g==="script"&&l.d.X(h,{crossOrigin:b,integrity:y,fetchPriority:v,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},fs.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=u(p.as,p.crossOrigin);l.d.M(h,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&l.d.M(h)},fs.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,b=u(g,p.crossOrigin);l.d.L(h,g,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},fs.preloadModule=function(h,p){if(typeof h=="string")if(p){var g=u(p.as,p.crossOrigin);l.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else l.d.m(h)},fs.requestFormReset=function(h){l.d.r(h)},fs.unstable_batchedUpdates=function(h,p){return h(p)},fs.useFormState=function(h,p,g){return d.H.useFormState(h,p,g)},fs.useFormStatus=function(){return d.H.useHostTransitionStatus()},fs.version="19.2.1",fs}var $b;function Yv(){if($b)return Ph.exports;$b=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Ph.exports=rS(),Ph.exports}var Ub;function aS(){if(Ub)return xo;Ub=1;var n=lS(),e=Jo(),t=Yv();function l(s){var r="https://react.dev/errors/"+s;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function i(s){var r=s,c=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,(r.flags&4098)!==0&&(c=r.return),s=r.return;while(s)}return r.tag===3?c:null}function d(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function u(s){if(s.tag===31){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function h(s){if(i(s)!==s)throw Error(l(188))}function p(s){var r=s.alternate;if(!r){if(r=i(s),r===null)throw Error(l(188));return r!==s?null:s}for(var c=s,f=r;;){var m=c.return;if(m===null)break;var x=m.alternate;if(x===null){if(f=m.return,f!==null){c=f;continue}break}if(m.child===x.child){for(x=m.child;x;){if(x===c)return h(m),s;if(x===f)return h(m),r;x=x.sibling}throw Error(l(188))}if(c.return!==f.return)c=m,f=x;else{for(var k=!1,M=m.child;M;){if(M===c){k=!0,c=m,f=x;break}if(M===f){k=!0,f=m,c=x;break}M=M.sibling}if(!k){for(M=x.child;M;){if(M===c){k=!0,c=x,f=m;break}if(M===f){k=!0,f=x,c=m;break}M=M.sibling}if(!k)throw Error(l(189))}}if(c.alternate!==f)throw Error(l(190))}if(c.tag!==3)throw Error(l(188));return c.stateNode.current===c?s:r}function g(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s;for(s=s.child;s!==null;){if(r=g(s),r!==null)return r;s=s.sibling}return null}var b=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),_=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),R=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function B(s){return s===null||typeof s!="object"?null:(s=A&&s[A]||s["@@iterator"],typeof s=="function"?s:null)}var Y=Symbol.for("react.client.reference");function J(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Y?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case S:return"Fragment";case E:return"Profiler";case j:return"StrictMode";case L:return"Suspense";case V:return"SuspenseList";case $:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case N:return"Portal";case _:return s.displayName||"Context";case D:return(s._context.displayName||"Context")+".Consumer";case H:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case G:return r=s.displayName||null,r!==null?r:J(s.type)||"Memo";case X:r=s._payload,s=s._init;try{return J(s(r))}catch{}}return null}var de=Array.isArray,w=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,T=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I={pending:!1,data:null,method:null,action:null},Z=[],pe=-1;function O(s){return{current:s}}function te(s){0>pe||(s.current=Z[pe],Z[pe]=null,pe--)}function ke(s,r){pe++,Z[pe]=s.current,s.current=r}var U=O(null),ge=O(null),Ee=O(null),ie=O(null);function Ie(s,r){switch(ke(Ee,r),ke(ge,s),ke(U,null),r.nodeType){case 9:case 11:s=(s=r.documentElement)&&(s=s.namespaceURI)?sb(s):0;break;default:if(s=r.tagName,r=r.namespaceURI)r=sb(r),s=lb(r,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}te(U),ke(U,s)}function P(){te(U),te(ge),te(Ee)}function we(s){s.memoizedState!==null&&ke(ie,s);var r=U.current,c=lb(r,s.type);r!==c&&(ke(ge,s),ke(U,c))}function ue(s){ge.current===s&&(te(U),te(ge)),ie.current===s&&(te(ie),fo._currentValue=I)}var Ue,Q;function re(s){if(Ue===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);Ue=r&&r[1]||"",Q=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ue+s+Q}var Ce=!1;function Ye(s,r){if(!s||Ce)return"";Ce=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(r){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(Ne){var he=Ne}Reflect.construct(s,[],De)}else{try{De.call()}catch(Ne){he=Ne}s.call(De.prototype)}}else{try{throw Error()}catch(Ne){he=Ne}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(Ne){if(Ne&&he&&typeof Ne.stack=="string")return[Ne.stack,he.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=f.DetermineComponentFrameRoot(),k=x[0],M=x[1];if(k&&M){var K=k.split(`
`),ce=M.split(`
`);for(m=f=0;f<K.length&&!K[f].includes("DetermineComponentFrameRoot");)f++;for(;m<ce.length&&!ce[m].includes("DetermineComponentFrameRoot");)m++;if(f===K.length||m===ce.length)for(f=K.length-1,m=ce.length-1;1<=f&&0<=m&&K[f]!==ce[m];)m--;for(;1<=f&&0<=m;f--,m--)if(K[f]!==ce[m]){if(f!==1||m!==1)do if(f--,m--,0>m||K[f]!==ce[m]){var je=`
`+K[f].replace(" at new "," at ");return s.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",s.displayName)),je}while(1<=f&&0<=m);break}}}finally{Ce=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?re(c):""}function Ve(s,r){switch(s.tag){case 26:case 27:case 5:return re(s.type);case 16:return re("Lazy");case 13:return s.child!==r&&r!==null?re("Suspense Fallback"):re("Suspense");case 19:return re("SuspenseList");case 0:case 15:return Ye(s.type,!1);case 11:return Ye(s.type.render,!1);case 1:return Ye(s.type,!0);case 31:return re("Activity");default:return""}}function ft(s){try{var r="",c=null;do r+=Ve(s,c),c=s,s=s.return;while(s);return r}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var dt=Object.prototype.hasOwnProperty,xt=n.unstable_scheduleCallback,lt=n.unstable_cancelCallback,bt=n.unstable_shouldYield,ot=n.unstable_requestPaint,fe=n.unstable_now,ze=n.unstable_getCurrentPriorityLevel,Me=n.unstable_ImmediatePriority,He=n.unstable_UserBlockingPriority,et=n.unstable_NormalPriority,st=n.unstable_LowPriority,rt=n.unstable_IdlePriority,ht=n.log,St=n.unstable_setDisableYieldValue,ee=null,oe=null;function xe(s){if(typeof ht=="function"&&St(s),oe&&typeof oe.setStrictMode=="function")try{oe.setStrictMode(ee,s)}catch{}}var $e=Math.clz32?Math.clz32:_t,Xt=Math.log,Ot=Math.LN2;function _t(s){return s>>>=0,s===0?32:31-(Xt(s)/Ot|0)|0}var xn=256,bn=262144,Cn=4194304;function ss(s){var r=s&42;if(r!==0)return r;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Gs(s,r,c){var f=s.pendingLanes;if(f===0)return 0;var m=0,x=s.suspendedLanes,k=s.pingedLanes;s=s.warmLanes;var M=f&134217727;return M!==0?(f=M&~x,f!==0?m=ss(f):(k&=M,k!==0?m=ss(k):c||(c=M&~s,c!==0&&(m=ss(c))))):(M=f&~x,M!==0?m=ss(M):k!==0?m=ss(k):c||(c=f&~s,c!==0&&(m=ss(c)))),m===0?0:r!==0&&r!==m&&(r&x)===0&&(x=m&-m,c=r&-r,x>=c||x===32&&(c&4194048)!==0)?r:m}function Re(s,r){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&r)===0}function Le(s,r){switch(s){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jt(){var s=Cn;return Cn<<=1,(Cn&62914560)===0&&(Cn=4194304),s}function Gt(s){for(var r=[],c=0;31>c;c++)r.push(s);return r}function Yt(s,r){s.pendingLanes|=r,r!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function yn(s,r,c,f,m,x){var k=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var M=s.entanglements,K=s.expirationTimes,ce=s.hiddenUpdates;for(c=k&~c;0<c;){var je=31-$e(c),De=1<<je;M[je]=0,K[je]=-1;var he=ce[je];if(he!==null)for(ce[je]=null,je=0;je<he.length;je++){var Ne=he[je];Ne!==null&&(Ne.lane&=-536870913)}c&=~De}f!==0&&$n(s,f,0),x!==0&&m===0&&s.tag!==0&&(s.suspendedLanes|=x&~(k&~r))}function $n(s,r,c){s.pendingLanes|=r,s.suspendedLanes&=~r;var f=31-$e(r);s.entangledLanes|=r,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function Qt(s,r){var c=s.entangledLanes|=r;for(s=s.entanglements;c;){var f=31-$e(c),m=1<<f;m&r|s[f]&r&&(s[f]|=r),c&=~m}}function ws(s,r){var c=r&-r;return c=(c&42)!==0?1:En(c),(c&(s.suspendedLanes|r))!==0?0:c}function En(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ys(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function ls(){var s=T.p;return s!==0?s:(s=window.event,s===void 0?32:Eb(s.type))}function zt(s,r){var c=T.p;try{return T.p=s,r()}finally{T.p=c}}var F=Math.random().toString(36).slice(2),ye="__reactFiber$"+F,be="__reactProps$"+F,qe="__reactContainer$"+F,jt="__reactEvents$"+F,Bt="__reactListeners$"+F,fl="__reactHandles$"+F,Rs="__reactResources$"+F,Ss="__reactMarker$"+F;function rs(s){delete s[ye],delete s[be],delete s[jt],delete s[Bt],delete s[fl]}function qn(s){var r=s[ye];if(r)return r;for(var c=s.parentNode;c;){if(r=c[qe]||c[ye]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(s=ub(s);s!==null;){if(c=s[ye])return c;s=ub(s)}return r}s=c,c=s.parentNode}return null}function Xe(s){if(s=s[ye]||s[qe]){var r=s.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return s}return null}function as(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s.stateNode;throw Error(l(33))}function pn(s){var r=s[Rs];return r||(r=s[Rs]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Mt(s){s[Ss]=!0}var On=new Set,is={};function vn(s,r){Xs(s,r),Xs(s+"Capture",r)}function Xs(s,r){for(is[s]=r,s=0;s<r.length;s++)On.add(r[s])}var rr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dl={},Zr={};function za(s){return dt.call(Zr,s)?!0:dt.call(Dl,s)?!1:rr.test(s)?Zr[s]=!0:(Dl[s]=!0,!1)}function Js(s,r,c){if(za(r))if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(r);return;case"boolean":var f=r.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(r);return}}s.setAttribute(r,""+c)}}function vl(s,r,c){if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(r);return}s.setAttribute(r,""+c)}}function cs(s,r,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(r,c,""+f)}}function ds(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ol(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function xs(s,r,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,r);if(!s.hasOwnProperty(r)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var m=f.get,x=f.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return m.call(this)},set:function(k){c=""+k,x.call(this,k)}}),Object.defineProperty(s,r,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Wr(s){if(!s._valueTracker){var r=Ol(s)?"checked":"value";s._valueTracker=xs(s,r,""+s[r])}}function ar(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var c=r.getValue(),f="";return s&&(f=Ol(s)?s.checked?"true":"false":s.value),s=f,s!==c?(r.setValue(s),!0):!1}function Rl(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var tc=/[\n"\\]/g;function us(s){return s.replace(tc,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function z(s,r,c,f,m,x,k,M){s.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?s.type=k:s.removeAttribute("type"),r!=null?k==="number"?(r===0&&s.value===""||s.value!=r)&&(s.value=""+ds(r)):s.value!==""+ds(r)&&(s.value=""+ds(r)):k!=="submit"&&k!=="reset"||s.removeAttribute("value"),r!=null?ne(s,k,ds(r)):c!=null?ne(s,k,ds(c)):f!=null&&s.removeAttribute("value"),m==null&&x!=null&&(s.defaultChecked=!!x),m!=null&&(s.checked=m&&typeof m!="function"&&typeof m!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?s.name=""+ds(M):s.removeAttribute("name")}function q(s,r,c,f,m,x,k,M){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.type=x),r!=null||c!=null){if(!(x!=="submit"&&x!=="reset"||r!=null)){Wr(s);return}c=c!=null?""+ds(c):"",r=r!=null?""+ds(r):c,M||r===s.value||(s.value=r),s.defaultValue=r}f=f??m,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=M?s.checked:!!f,s.defaultChecked=!!f,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(s.name=k),Wr(s)}function ne(s,r,c){r==="number"&&Rl(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function se(s,r,c,f){if(s=s.options,r){r={};for(var m=0;m<c.length;m++)r["$"+c[m]]=!0;for(c=0;c<s.length;c++)m=r.hasOwnProperty("$"+s[c].value),s[c].selected!==m&&(s[c].selected=m),m&&f&&(s[c].defaultSelected=!0)}else{for(c=""+ds(c),r=null,m=0;m<s.length;m++){if(s[m].value===c){s[m].selected=!0,f&&(s[m].defaultSelected=!0);return}r!==null||s[m].disabled||(r=s[m])}r!==null&&(r.selected=!0)}}function me(s,r,c){if(r!=null&&(r=""+ds(r),r!==s.value&&(s.value=r),c==null)){s.defaultValue!==r&&(s.defaultValue=r);return}s.defaultValue=c!=null?""+ds(c):""}function Se(s,r,c,f){if(r==null){if(f!=null){if(c!=null)throw Error(l(92));if(de(f)){if(1<f.length)throw Error(l(93));f=f[0]}c=f}c==null&&(c=""),r=c}c=ds(r),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),Wr(s)}function Oe(s,r){if(r){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=r;return}}s.textContent=r}var Je=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qe(s,r,c){var f=r.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(r,""):r==="float"?s.cssFloat="":s[r]="":f?s.setProperty(r,c):typeof c!="number"||c===0||Je.has(r)?r==="float"?s.cssFloat=c:s[r]=(""+c).trim():s[r]=c+"px"}function Te(s,r,c){if(r!=null&&typeof r!="object")throw Error(l(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||r!=null&&r.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var m in r)f=r[m],r.hasOwnProperty(m)&&c[m]!==f&&Qe(s,m,f)}else for(var x in r)r.hasOwnProperty(x)&&Qe(s,x,r[x])}function yt(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pt(s){return pt.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function rn(){}var ir=null;function Nl(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ht=null,Rn=null;function nc(s){var r=Xe(s);if(r&&(s=r.stateNode)){var c=s[be]||null;e:switch(s=r.stateNode,r.type){case"input":if(z(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),r=c.name,c.type==="radio"&&r!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+us(""+r)+'"][type="radio"]'),r=0;r<c.length;r++){var f=c[r];if(f!==s&&f.form===s.form){var m=f[be]||null;if(!m)throw Error(l(90));z(f,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(r=0;r<c.length;r++)f=c[r],f.form===s.form&&ar(f)}break e;case"textarea":me(s,c.value,c.defaultValue);break e;case"select":r=c.value,r!=null&&se(s,!!c.multiple,r,!1)}}}var Ti=!1;function sc(s,r,c){if(Ti)return s(r,c);Ti=!0;try{var f=s(r);return f}finally{if(Ti=!1,(Ht!==null||Rn!==null)&&(Hc(),Ht&&(r=Ht,s=Rn,Rn=Ht=null,nc(r),s)))for(r=0;r<s.length;r++)nc(s[r])}}function ea(s,r){var c=s.stateNode;if(c===null)return null;var f=c[be]||null;if(f===null)return null;c=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(l(231,r,typeof c));return c}var ve=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Be=!1;if(ve)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){Be=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch{Be=!1}var Ke=null,vt=null,$t=null;function Ge(){if($t)return $t;var s,r=vt,c=r.length,f,m="value"in Ke?Ke.value:Ke.textContent,x=m.length;for(s=0;s<c&&r[s]===m[s];s++);var k=c-s;for(f=1;f<=k&&r[c-f]===m[x-f];f++);return $t=m.slice(s,1<f?1-f:void 0)}function At(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function tn(){return!0}function Nn(){return!1}function Mn(s){function r(c,f,m,x,k){this._reactName=c,this._targetInst=m,this.type=f,this.nativeEvent=x,this.target=k,this.currentTarget=null;for(var M in s)s.hasOwnProperty(M)&&(c=s[M],this[M]=c?c(x):x[M]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?tn:Nn,this.isPropagationStopped=Nn,this}return b(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=tn)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=tn)},persist:function(){},isPersistent:tn}),r}var Ft={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=Mn(Ft),js=b({},Ft,{view:0,detail:0}),Iu=Mn(js),zu,Lu,Di,lc=b({},js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Di&&(Di&&s.type==="mousemove"?(zu=s.screenX-Di.screenX,Lu=s.screenY-Di.screenY):Lu=zu=0,Di=s),zu)},movementY:function(s){return"movementY"in s?s.movementY:Lu}}),a0=Mn(lc),W2=b({},lc,{dataTransfer:0}),ek=Mn(W2),tk=b({},js,{relatedTarget:0}),_u=Mn(tk),nk=b({},Ft,{animationName:0,elapsedTime:0,pseudoElement:0}),sk=Mn(nk),lk=b({},Ft,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),rk=Mn(lk),ak=b({},Ft,{data:0}),i0=Mn(ak),ik={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ok={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ck={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dk(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=ck[s])?!!r[s]:!1}function Bu(){return dk}var uk=b({},js,{key:function(s){if(s.key){var r=ik[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=At(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ok[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bu,charCode:function(s){return s.type==="keypress"?At(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?At(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),fk=Mn(uk),hk=b({},lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),o0=Mn(hk),pk=b({},js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bu}),mk=Mn(pk),gk=b({},Ft,{propertyName:0,elapsedTime:0,pseudoElement:0}),xk=Mn(gk),bk=b({},lc,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),yk=Mn(bk),vk=b({},Ft,{newState:0,oldState:0}),Nk=Mn(vk),kk=[9,13,27,32],Pu=ve&&"CompositionEvent"in window,Oi=null;ve&&"documentMode"in document&&(Oi=document.documentMode);var wk=ve&&"TextEvent"in window&&!Oi,c0=ve&&(!Pu||Oi&&8<Oi&&11>=Oi),d0=" ",u0=!1;function f0(s,r){switch(s){case"keyup":return kk.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function h0(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var La=!1;function Sk(s,r){switch(s){case"compositionend":return h0(r);case"keypress":return r.which!==32?null:(u0=!0,d0);case"textInput":return s=r.data,s===d0&&u0?null:s;default:return null}}function jk(s,r){if(La)return s==="compositionend"||!Pu&&f0(s,r)?(s=Ge(),$t=vt=Ke=null,La=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return c0&&r.locale!=="ko"?null:r.data;default:return null}}var Ck={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function p0(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!Ck[s.type]:r==="textarea"}function m0(s,r,c,f){Ht?Rn?Rn.push(f):Rn=[f]:Ht=f,r=Gc(r,"onChange"),0<r.length&&(c=new fn("onChange","change",null,c,f),s.push({event:c,listeners:r}))}var Ri=null,Ii=null;function Ek(s){Qx(s,0)}function rc(s){var r=as(s);if(ar(r))return s}function g0(s,r){if(s==="change")return r}var x0=!1;if(ve){var Hu;if(ve){var $u="oninput"in document;if(!$u){var b0=document.createElement("div");b0.setAttribute("oninput","return;"),$u=typeof b0.oninput=="function"}Hu=$u}else Hu=!1;x0=Hu&&(!document.documentMode||9<document.documentMode)}function y0(){Ri&&(Ri.detachEvent("onpropertychange",v0),Ii=Ri=null)}function v0(s){if(s.propertyName==="value"&&rc(Ii)){var r=[];m0(r,Ii,s,Nl(s)),sc(Ek,r)}}function Mk(s,r,c){s==="focusin"?(y0(),Ri=r,Ii=c,Ri.attachEvent("onpropertychange",v0)):s==="focusout"&&y0()}function Ak(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return rc(Ii)}function Tk(s,r){if(s==="click")return rc(r)}function Dk(s,r){if(s==="input"||s==="change")return rc(r)}function Ok(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var Is=typeof Object.is=="function"?Object.is:Ok;function zi(s,r){if(Is(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var c=Object.keys(s),f=Object.keys(r);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var m=c[f];if(!dt.call(r,m)||!Is(s[m],r[m]))return!1}return!0}function N0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function k0(s,r){var c=N0(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=r&&f>=r)return{node:c,offset:r-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=N0(c)}}function w0(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?w0(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function S0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var r=Rl(s.document);r instanceof s.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)s=r.contentWindow;else break;r=Rl(s.document)}return r}function Uu(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}var Rk=ve&&"documentMode"in document&&11>=document.documentMode,_a=null,Vu=null,Li=null,qu=!1;function j0(s,r,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;qu||_a==null||_a!==Rl(f)||(f=_a,"selectionStart"in f&&Uu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Li&&zi(Li,f)||(Li=f,f=Gc(Vu,"onSelect"),0<f.length&&(r=new fn("onSelect","select",null,r,c),s.push({event:r,listeners:f}),r.target=_a)))}function ta(s,r){var c={};return c[s.toLowerCase()]=r.toLowerCase(),c["Webkit"+s]="webkit"+r,c["Moz"+s]="moz"+r,c}var Ba={animationend:ta("Animation","AnimationEnd"),animationiteration:ta("Animation","AnimationIteration"),animationstart:ta("Animation","AnimationStart"),transitionrun:ta("Transition","TransitionRun"),transitionstart:ta("Transition","TransitionStart"),transitioncancel:ta("Transition","TransitionCancel"),transitionend:ta("Transition","TransitionEnd")},Fu={},C0={};ve&&(C0=document.createElement("div").style,"AnimationEvent"in window||(delete Ba.animationend.animation,delete Ba.animationiteration.animation,delete Ba.animationstart.animation),"TransitionEvent"in window||delete Ba.transitionend.transition);function na(s){if(Fu[s])return Fu[s];if(!Ba[s])return s;var r=Ba[s],c;for(c in r)if(r.hasOwnProperty(c)&&c in C0)return Fu[s]=r[c];return s}var E0=na("animationend"),M0=na("animationiteration"),A0=na("animationstart"),Ik=na("transitionrun"),zk=na("transitionstart"),Lk=na("transitioncancel"),T0=na("transitionend"),D0=new Map,Ku="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ku.push("scrollEnd");function hl(s,r){D0.set(s,r),vn(r,[s])}var ac=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Qs=[],Pa=0,Gu=0;function ic(){for(var s=Pa,r=Gu=Pa=0;r<s;){var c=Qs[r];Qs[r++]=null;var f=Qs[r];Qs[r++]=null;var m=Qs[r];Qs[r++]=null;var x=Qs[r];if(Qs[r++]=null,f!==null&&m!==null){var k=f.pending;k===null?m.next=m:(m.next=k.next,k.next=m),f.pending=m}x!==0&&O0(c,m,x)}}function oc(s,r,c,f){Qs[Pa++]=s,Qs[Pa++]=r,Qs[Pa++]=c,Qs[Pa++]=f,Gu|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Yu(s,r,c,f){return oc(s,r,c,f),cc(s)}function sa(s,r){return oc(s,null,null,r),cc(s)}function O0(s,r,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var m=!1,x=s.return;x!==null;)x.childLanes|=c,f=x.alternate,f!==null&&(f.childLanes|=c),x.tag===22&&(s=x.stateNode,s===null||s._visibility&1||(m=!0)),s=x,x=x.return;return s.tag===3?(x=s.stateNode,m&&r!==null&&(m=31-$e(c),s=x.hiddenUpdates,f=s[m],f===null?s[m]=[r]:f.push(r),r.lane=c|536870912),x):null}function cc(s){if(50<lo)throw lo=0,lh=null,Error(l(185));for(var r=s.return;r!==null;)s=r,r=s.return;return s.tag===3?s.stateNode:null}var Ha={};function _k(s,r,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(s,r,c,f){return new _k(s,r,c,f)}function Xu(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Il(s,r){var c=s.alternate;return c===null?(c=zs(s.tag,r,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=r,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,r=s.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function R0(s,r){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,r=c.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),s}function dc(s,r,c,f,m,x){var k=0;if(f=s,typeof s=="function")Xu(s)&&(k=1);else if(typeof s=="string")k=Uw(s,c,U.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case $:return s=zs(31,c,r,m),s.elementType=$,s.lanes=x,s;case S:return la(c.children,m,x,r);case j:k=8,m|=24;break;case E:return s=zs(12,c,r,m|2),s.elementType=E,s.lanes=x,s;case L:return s=zs(13,c,r,m),s.elementType=L,s.lanes=x,s;case V:return s=zs(19,c,r,m),s.elementType=V,s.lanes=x,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case _:k=10;break e;case D:k=9;break e;case H:k=11;break e;case G:k=14;break e;case X:k=16,f=null;break e}k=29,c=Error(l(130,s===null?"null":typeof s,"")),f=null}return r=zs(k,c,r,m),r.elementType=s,r.type=f,r.lanes=x,r}function la(s,r,c,f){return s=zs(7,s,f,r),s.lanes=c,s}function Ju(s,r,c){return s=zs(6,s,null,r),s.lanes=c,s}function I0(s){var r=zs(18,null,null,0);return r.stateNode=s,r}function Qu(s,r,c){return r=zs(4,s.children!==null?s.children:[],s.key,r),r.lanes=c,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}var z0=new WeakMap;function Zs(s,r){if(typeof s=="object"&&s!==null){var c=z0.get(s);return c!==void 0?c:(r={value:s,source:r,stack:ft(r)},z0.set(s,r),r)}return{value:s,source:r,stack:ft(r)}}var $a=[],Ua=0,uc=null,_i=0,Ws=[],el=0,or=null,kl=1,wl="";function zl(s,r){$a[Ua++]=_i,$a[Ua++]=uc,uc=s,_i=r}function L0(s,r,c){Ws[el++]=kl,Ws[el++]=wl,Ws[el++]=or,or=s;var f=kl;s=wl;var m=32-$e(f)-1;f&=~(1<<m),c+=1;var x=32-$e(r)+m;if(30<x){var k=m-m%5;x=(f&(1<<k)-1).toString(32),f>>=k,m-=k,kl=1<<32-$e(r)+m|c<<m|f,wl=x+s}else kl=1<<x|c<<m|f,wl=s}function Zu(s){s.return!==null&&(zl(s,1),L0(s,1,0))}function Wu(s){for(;s===uc;)uc=$a[--Ua],$a[Ua]=null,_i=$a[--Ua],$a[Ua]=null;for(;s===or;)or=Ws[--el],Ws[el]=null,wl=Ws[--el],Ws[el]=null,kl=Ws[--el],Ws[el]=null}function _0(s,r){Ws[el++]=kl,Ws[el++]=wl,Ws[el++]=or,kl=r.id,wl=r.overflow,or=s}var Jn=null,cn=null,Lt=!1,cr=null,tl=!1,ef=Error(l(519));function dr(s){var r=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Bi(Zs(r,s)),ef}function B0(s){var r=s.stateNode,c=s.type,f=s.memoizedProps;switch(r[ye]=s,r[be]=f,c){case"dialog":Dt("cancel",r),Dt("close",r);break;case"iframe":case"object":case"embed":Dt("load",r);break;case"video":case"audio":for(c=0;c<ao.length;c++)Dt(ao[c],r);break;case"source":Dt("error",r);break;case"img":case"image":case"link":Dt("error",r),Dt("load",r);break;case"details":Dt("toggle",r);break;case"input":Dt("invalid",r),q(r,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Dt("invalid",r);break;case"textarea":Dt("invalid",r),Se(r,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||r.textContent===""+c||f.suppressHydrationWarning===!0||tb(r.textContent,c)?(f.popover!=null&&(Dt("beforetoggle",r),Dt("toggle",r)),f.onScroll!=null&&Dt("scroll",r),f.onScrollEnd!=null&&Dt("scrollend",r),f.onClick!=null&&(r.onclick=rn),r=!0):r=!1,r||dr(s,!0)}function P0(s){for(Jn=s.return;Jn;)switch(Jn.tag){case 5:case 31:case 13:tl=!1;return;case 27:case 3:tl=!0;return;default:Jn=Jn.return}}function Va(s){if(s!==Jn)return!1;if(!Lt)return P0(s),Lt=!0,!1;var r=s.tag,c;if((c=r!==3&&r!==27)&&((c=r===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||yh(s.type,s.memoizedProps)),c=!c),c&&cn&&dr(s),P0(s),r===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(l(317));cn=db(s)}else if(r===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(l(317));cn=db(s)}else r===27?(r=cn,Sr(s.type)?(s=Sh,Sh=null,cn=s):cn=r):cn=Jn?sl(s.stateNode.nextSibling):null;return!0}function ra(){cn=Jn=null,Lt=!1}function tf(){var s=cr;return s!==null&&(As===null?As=s:As.push.apply(As,s),cr=null),s}function Bi(s){cr===null?cr=[s]:cr.push(s)}var nf=O(null),aa=null,Ll=null;function ur(s,r,c){ke(nf,r._currentValue),r._currentValue=c}function _l(s){s._currentValue=nf.current,te(nf)}function sf(s,r,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),s===c)break;s=s.return}}function lf(s,r,c,f){var m=s.child;for(m!==null&&(m.return=s);m!==null;){var x=m.dependencies;if(x!==null){var k=m.child;x=x.firstContext;e:for(;x!==null;){var M=x;x=m;for(var K=0;K<r.length;K++)if(M.context===r[K]){x.lanes|=c,M=x.alternate,M!==null&&(M.lanes|=c),sf(x.return,c,s),f||(k=null);break e}x=M.next}}else if(m.tag===18){if(k=m.return,k===null)throw Error(l(341));k.lanes|=c,x=k.alternate,x!==null&&(x.lanes|=c),sf(k,c,s),k=null}else k=m.child;if(k!==null)k.return=m;else for(k=m;k!==null;){if(k===s){k=null;break}if(m=k.sibling,m!==null){m.return=k.return,k=m;break}k=k.return}m=k}}function qa(s,r,c,f){s=null;for(var m=r,x=!1;m!==null;){if(!x){if((m.flags&524288)!==0)x=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var k=m.alternate;if(k===null)throw Error(l(387));if(k=k.memoizedProps,k!==null){var M=m.type;Is(m.pendingProps.value,k.value)||(s!==null?s.push(M):s=[M])}}else if(m===ie.current){if(k=m.alternate,k===null)throw Error(l(387));k.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(s!==null?s.push(fo):s=[fo])}m=m.return}s!==null&&lf(r,s,c,f),r.flags|=262144}function fc(s){for(s=s.firstContext;s!==null;){if(!Is(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ia(s){aa=s,Ll=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Qn(s){return H0(aa,s)}function hc(s,r){return aa===null&&ia(s),H0(s,r)}function H0(s,r){var c=r._currentValue;if(r={context:r,memoizedValue:c,next:null},Ll===null){if(s===null)throw Error(l(308));Ll=r,s.dependencies={lanes:0,firstContext:r},s.flags|=524288}else Ll=Ll.next=r;return c}var Bk=typeof AbortController<"u"?AbortController:function(){var s=[],r=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){r.aborted=!0,s.forEach(function(c){return c()})}},Pk=n.unstable_scheduleCallback,Hk=n.unstable_NormalPriority,In={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rf(){return{controller:new Bk,data:new Map,refCount:0}}function Pi(s){s.refCount--,s.refCount===0&&Pk(Hk,function(){s.controller.abort()})}var Hi=null,af=0,Fa=0,Ka=null;function $k(s,r){if(Hi===null){var c=Hi=[];af=0,Fa=dh(),Ka={status:"pending",value:void 0,then:function(f){c.push(f)}}}return af++,r.then($0,$0),r}function $0(){if(--af===0&&Hi!==null){Ka!==null&&(Ka.status="fulfilled");var s=Hi;Hi=null,Fa=0,Ka=null;for(var r=0;r<s.length;r++)(0,s[r])()}}function Uk(s,r){var c=[],f={status:"pending",value:null,reason:null,then:function(m){c.push(m)}};return s.then(function(){f.status="fulfilled",f.value=r;for(var m=0;m<c.length;m++)(0,c[m])(r)},function(m){for(f.status="rejected",f.reason=m,m=0;m<c.length;m++)(0,c[m])(void 0)}),f}var U0=w.S;w.S=function(s,r){jx=fe(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&$k(s,r),U0!==null&&U0(s,r)};var oa=O(null);function of(){var s=oa.current;return s!==null?s:an.pooledCache}function pc(s,r){r===null?ke(oa,oa.current):ke(oa,r.pool)}function V0(){var s=of();return s===null?null:{parent:In._currentValue,pool:s}}var Ga=Error(l(460)),cf=Error(l(474)),mc=Error(l(542)),gc={then:function(){}};function q0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function F0(s,r,c){switch(c=s[c],c===void 0?s.push(r):c!==r&&(r.then(rn,rn),r=c),r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,G0(s),s;default:if(typeof r.status=="string")r.then(rn,rn);else{if(s=an,s!==null&&100<s.shellSuspendCounter)throw Error(l(482));s=r,s.status="pending",s.then(function(f){if(r.status==="pending"){var m=r;m.status="fulfilled",m.value=f}},function(f){if(r.status==="pending"){var m=r;m.status="rejected",m.reason=f}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,G0(s),s}throw da=r,Ga}}function ca(s){try{var r=s._init;return r(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(da=c,Ga):c}}var da=null;function K0(){if(da===null)throw Error(l(459));var s=da;return da=null,s}function G0(s){if(s===Ga||s===mc)throw Error(l(483))}var Ya=null,$i=0;function xc(s){var r=$i;return $i+=1,Ya===null&&(Ya=[]),F0(Ya,s,r)}function Ui(s,r){r=r.props.ref,s.ref=r!==void 0?r:null}function bc(s,r){throw r.$$typeof===y?Error(l(525)):(s=Object.prototype.toString.call(r),Error(l(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)))}function Y0(s){function r(le,W){if(s){var ae=le.deletions;ae===null?(le.deletions=[W],le.flags|=16):ae.push(W)}}function c(le,W){if(!s)return null;for(;W!==null;)r(le,W),W=W.sibling;return null}function f(le){for(var W=new Map;le!==null;)le.key!==null?W.set(le.key,le):W.set(le.index,le),le=le.sibling;return W}function m(le,W){return le=Il(le,W),le.index=0,le.sibling=null,le}function x(le,W,ae){return le.index=ae,s?(ae=le.alternate,ae!==null?(ae=ae.index,ae<W?(le.flags|=67108866,W):ae):(le.flags|=67108866,W)):(le.flags|=1048576,W)}function k(le){return s&&le.alternate===null&&(le.flags|=67108866),le}function M(le,W,ae,Ae){return W===null||W.tag!==6?(W=Ju(ae,le.mode,Ae),W.return=le,W):(W=m(W,ae),W.return=le,W)}function K(le,W,ae,Ae){var at=ae.type;return at===S?je(le,W,ae.props.children,Ae,ae.key):W!==null&&(W.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===X&&ca(at)===W.type)?(W=m(W,ae.props),Ui(W,ae),W.return=le,W):(W=dc(ae.type,ae.key,ae.props,null,le.mode,Ae),Ui(W,ae),W.return=le,W)}function ce(le,W,ae,Ae){return W===null||W.tag!==4||W.stateNode.containerInfo!==ae.containerInfo||W.stateNode.implementation!==ae.implementation?(W=Qu(ae,le.mode,Ae),W.return=le,W):(W=m(W,ae.children||[]),W.return=le,W)}function je(le,W,ae,Ae,at){return W===null||W.tag!==7?(W=la(ae,le.mode,Ae,at),W.return=le,W):(W=m(W,ae),W.return=le,W)}function De(le,W,ae){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return W=Ju(""+W,le.mode,ae),W.return=le,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case v:return ae=dc(W.type,W.key,W.props,null,le.mode,ae),Ui(ae,W),ae.return=le,ae;case N:return W=Qu(W,le.mode,ae),W.return=le,W;case X:return W=ca(W),De(le,W,ae)}if(de(W)||B(W))return W=la(W,le.mode,ae,null),W.return=le,W;if(typeof W.then=="function")return De(le,xc(W),ae);if(W.$$typeof===_)return De(le,hc(le,W),ae);bc(le,W)}return null}function he(le,W,ae,Ae){var at=W!==null?W.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return at!==null?null:M(le,W,""+ae,Ae);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:return ae.key===at?K(le,W,ae,Ae):null;case N:return ae.key===at?ce(le,W,ae,Ae):null;case X:return ae=ca(ae),he(le,W,ae,Ae)}if(de(ae)||B(ae))return at!==null?null:je(le,W,ae,Ae,null);if(typeof ae.then=="function")return he(le,W,xc(ae),Ae);if(ae.$$typeof===_)return he(le,W,hc(le,ae),Ae);bc(le,ae)}return null}function Ne(le,W,ae,Ae,at){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return le=le.get(ae)||null,M(W,le,""+Ae,at);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case v:return le=le.get(Ae.key===null?ae:Ae.key)||null,K(W,le,Ae,at);case N:return le=le.get(Ae.key===null?ae:Ae.key)||null,ce(W,le,Ae,at);case X:return Ae=ca(Ae),Ne(le,W,ae,Ae,at)}if(de(Ae)||B(Ae))return le=le.get(ae)||null,je(W,le,Ae,at,null);if(typeof Ae.then=="function")return Ne(le,W,ae,xc(Ae),at);if(Ae.$$typeof===_)return Ne(le,W,ae,hc(W,Ae),at);bc(W,Ae)}return null}function We(le,W,ae,Ae){for(var at=null,Ut=null,tt=W,wt=W=0,It=null;tt!==null&&wt<ae.length;wt++){tt.index>wt?(It=tt,tt=null):It=tt.sibling;var Vt=he(le,tt,ae[wt],Ae);if(Vt===null){tt===null&&(tt=It);break}s&&tt&&Vt.alternate===null&&r(le,tt),W=x(Vt,W,wt),Ut===null?at=Vt:Ut.sibling=Vt,Ut=Vt,tt=It}if(wt===ae.length)return c(le,tt),Lt&&zl(le,wt),at;if(tt===null){for(;wt<ae.length;wt++)tt=De(le,ae[wt],Ae),tt!==null&&(W=x(tt,W,wt),Ut===null?at=tt:Ut.sibling=tt,Ut=tt);return Lt&&zl(le,wt),at}for(tt=f(tt);wt<ae.length;wt++)It=Ne(tt,le,wt,ae[wt],Ae),It!==null&&(s&&It.alternate!==null&&tt.delete(It.key===null?wt:It.key),W=x(It,W,wt),Ut===null?at=It:Ut.sibling=It,Ut=It);return s&&tt.forEach(function(Ar){return r(le,Ar)}),Lt&&zl(le,wt),at}function ut(le,W,ae,Ae){if(ae==null)throw Error(l(151));for(var at=null,Ut=null,tt=W,wt=W=0,It=null,Vt=ae.next();tt!==null&&!Vt.done;wt++,Vt=ae.next()){tt.index>wt?(It=tt,tt=null):It=tt.sibling;var Ar=he(le,tt,Vt.value,Ae);if(Ar===null){tt===null&&(tt=It);break}s&&tt&&Ar.alternate===null&&r(le,tt),W=x(Ar,W,wt),Ut===null?at=Ar:Ut.sibling=Ar,Ut=Ar,tt=It}if(Vt.done)return c(le,tt),Lt&&zl(le,wt),at;if(tt===null){for(;!Vt.done;wt++,Vt=ae.next())Vt=De(le,Vt.value,Ae),Vt!==null&&(W=x(Vt,W,wt),Ut===null?at=Vt:Ut.sibling=Vt,Ut=Vt);return Lt&&zl(le,wt),at}for(tt=f(tt);!Vt.done;wt++,Vt=ae.next())Vt=Ne(tt,le,wt,Vt.value,Ae),Vt!==null&&(s&&Vt.alternate!==null&&tt.delete(Vt.key===null?wt:Vt.key),W=x(Vt,W,wt),Ut===null?at=Vt:Ut.sibling=Vt,Ut=Vt);return s&&tt.forEach(function(Ww){return r(le,Ww)}),Lt&&zl(le,wt),at}function ln(le,W,ae,Ae){if(typeof ae=="object"&&ae!==null&&ae.type===S&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:e:{for(var at=ae.key;W!==null;){if(W.key===at){if(at=ae.type,at===S){if(W.tag===7){c(le,W.sibling),Ae=m(W,ae.props.children),Ae.return=le,le=Ae;break e}}else if(W.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===X&&ca(at)===W.type){c(le,W.sibling),Ae=m(W,ae.props),Ui(Ae,ae),Ae.return=le,le=Ae;break e}c(le,W);break}else r(le,W);W=W.sibling}ae.type===S?(Ae=la(ae.props.children,le.mode,Ae,ae.key),Ae.return=le,le=Ae):(Ae=dc(ae.type,ae.key,ae.props,null,le.mode,Ae),Ui(Ae,ae),Ae.return=le,le=Ae)}return k(le);case N:e:{for(at=ae.key;W!==null;){if(W.key===at)if(W.tag===4&&W.stateNode.containerInfo===ae.containerInfo&&W.stateNode.implementation===ae.implementation){c(le,W.sibling),Ae=m(W,ae.children||[]),Ae.return=le,le=Ae;break e}else{c(le,W);break}else r(le,W);W=W.sibling}Ae=Qu(ae,le.mode,Ae),Ae.return=le,le=Ae}return k(le);case X:return ae=ca(ae),ln(le,W,ae,Ae)}if(de(ae))return We(le,W,ae,Ae);if(B(ae)){if(at=B(ae),typeof at!="function")throw Error(l(150));return ae=at.call(ae),ut(le,W,ae,Ae)}if(typeof ae.then=="function")return ln(le,W,xc(ae),Ae);if(ae.$$typeof===_)return ln(le,W,hc(le,ae),Ae);bc(le,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint"?(ae=""+ae,W!==null&&W.tag===6?(c(le,W.sibling),Ae=m(W,ae),Ae.return=le,le=Ae):(c(le,W),Ae=Ju(ae,le.mode,Ae),Ae.return=le,le=Ae),k(le)):c(le,W)}return function(le,W,ae,Ae){try{$i=0;var at=ln(le,W,ae,Ae);return Ya=null,at}catch(tt){if(tt===Ga||tt===mc)throw tt;var Ut=zs(29,tt,null,le.mode);return Ut.lanes=Ae,Ut.return=le,Ut}finally{}}}var ua=Y0(!0),X0=Y0(!1),fr=!1;function df(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uf(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function hr(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function pr(s,r,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Kt&2)!==0){var m=f.pending;return m===null?r.next=r:(r.next=m.next,m.next=r),f.pending=r,r=cc(s),O0(s,null,c),r}return oc(s,f,r,c),cc(s)}function Vi(s,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194048)!==0)){var f=r.lanes;f&=s.pendingLanes,c|=f,r.lanes=c,Qt(s,c)}}function ff(s,r){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var m=null,x=null;if(c=c.firstBaseUpdate,c!==null){do{var k={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};x===null?m=x=k:x=x.next=k,c=c.next}while(c!==null);x===null?m=x=r:x=x.next=r}else m=x=r;c={baseState:f.baseState,firstBaseUpdate:m,lastBaseUpdate:x,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=r:s.next=r,c.lastBaseUpdate=r}var hf=!1;function qi(){if(hf){var s=Ka;if(s!==null)throw s}}function Fi(s,r,c,f){hf=!1;var m=s.updateQueue;fr=!1;var x=m.firstBaseUpdate,k=m.lastBaseUpdate,M=m.shared.pending;if(M!==null){m.shared.pending=null;var K=M,ce=K.next;K.next=null,k===null?x=ce:k.next=ce,k=K;var je=s.alternate;je!==null&&(je=je.updateQueue,M=je.lastBaseUpdate,M!==k&&(M===null?je.firstBaseUpdate=ce:M.next=ce,je.lastBaseUpdate=K))}if(x!==null){var De=m.baseState;k=0,je=ce=K=null,M=x;do{var he=M.lane&-536870913,Ne=he!==M.lane;if(Ne?(Rt&he)===he:(f&he)===he){he!==0&&he===Fa&&(hf=!0),je!==null&&(je=je.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var We=s,ut=M;he=r;var ln=c;switch(ut.tag){case 1:if(We=ut.payload,typeof We=="function"){De=We.call(ln,De,he);break e}De=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=ut.payload,he=typeof We=="function"?We.call(ln,De,he):We,he==null)break e;De=b({},De,he);break e;case 2:fr=!0}}he=M.callback,he!==null&&(s.flags|=64,Ne&&(s.flags|=8192),Ne=m.callbacks,Ne===null?m.callbacks=[he]:Ne.push(he))}else Ne={lane:he,tag:M.tag,payload:M.payload,callback:M.callback,next:null},je===null?(ce=je=Ne,K=De):je=je.next=Ne,k|=he;if(M=M.next,M===null){if(M=m.shared.pending,M===null)break;Ne=M,M=Ne.next,Ne.next=null,m.lastBaseUpdate=Ne,m.shared.pending=null}}while(!0);je===null&&(K=De),m.baseState=K,m.firstBaseUpdate=ce,m.lastBaseUpdate=je,x===null&&(m.shared.lanes=0),yr|=k,s.lanes=k,s.memoizedState=De}}function J0(s,r){if(typeof s!="function")throw Error(l(191,s));s.call(r)}function Q0(s,r){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)J0(c[s],r)}var Xa=O(null),yc=O(0);function Z0(s,r){s=Kl,ke(yc,s),ke(Xa,r),Kl=s|r.baseLanes}function pf(){ke(yc,Kl),ke(Xa,Xa.current)}function mf(){Kl=yc.current,te(Xa),te(yc)}var Ls=O(null),nl=null;function mr(s){var r=s.alternate;ke(An,An.current&1),ke(Ls,s),nl===null&&(r===null||Xa.current!==null||r.memoizedState!==null)&&(nl=s)}function gf(s){ke(An,An.current),ke(Ls,s),nl===null&&(nl=s)}function W0(s){s.tag===22?(ke(An,An.current),ke(Ls,s),nl===null&&(nl=s)):gr()}function gr(){ke(An,An.current),ke(Ls,Ls.current)}function _s(s){te(Ls),nl===s&&(nl=null),te(An)}var An=O(0);function vc(s){for(var r=s;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||kh(c)||wh(c)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Bl=0,kt=null,nn=null,zn=null,Nc=!1,Ja=!1,fa=!1,kc=0,Ki=0,Qa=null,Vk=0;function kn(){throw Error(l(321))}function xf(s,r){if(r===null)return!1;for(var c=0;c<r.length&&c<s.length;c++)if(!Is(s[c],r[c]))return!1;return!0}function bf(s,r,c,f,m,x){return Bl=x,kt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,w.H=s===null||s.memoizedState===null?Lg:Rf,fa=!1,x=c(f,m),fa=!1,Ja&&(x=tg(r,c,f,m)),eg(s),x}function eg(s){w.H=Xi;var r=nn!==null&&nn.next!==null;if(Bl=0,zn=nn=kt=null,Nc=!1,Ki=0,Qa=null,r)throw Error(l(300));s===null||Ln||(s=s.dependencies,s!==null&&fc(s)&&(Ln=!0))}function tg(s,r,c,f){kt=s;var m=0;do{if(Ja&&(Qa=null),Ki=0,Ja=!1,25<=m)throw Error(l(301));if(m+=1,zn=nn=null,s.updateQueue!=null){var x=s.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}w.H=_g,x=r(c,f)}while(Ja);return x}function qk(){var s=w.H,r=s.useState()[0];return r=typeof r.then=="function"?Gi(r):r,s=s.useState()[0],(nn!==null?nn.memoizedState:null)!==s&&(kt.flags|=1024),r}function yf(){var s=kc!==0;return kc=0,s}function vf(s,r,c){r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~c}function Nf(s){if(Nc){for(s=s.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Nc=!1}Bl=0,zn=nn=kt=null,Ja=!1,Ki=kc=0,Qa=null}function bs(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zn===null?kt.memoizedState=zn=s:zn=zn.next=s,zn}function Tn(){if(nn===null){var s=kt.alternate;s=s!==null?s.memoizedState:null}else s=nn.next;var r=zn===null?kt.memoizedState:zn.next;if(r!==null)zn=r,nn=s;else{if(s===null)throw kt.alternate===null?Error(l(467)):Error(l(310));nn=s,s={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},zn===null?kt.memoizedState=zn=s:zn=zn.next=s}return zn}function wc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gi(s){var r=Ki;return Ki+=1,Qa===null&&(Qa=[]),s=F0(Qa,s,r),r=kt,(zn===null?r.memoizedState:zn.next)===null&&(r=r.alternate,w.H=r===null||r.memoizedState===null?Lg:Rf),s}function Sc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Gi(s);if(s.$$typeof===_)return Qn(s)}throw Error(l(438,String(s)))}function kf(s){var r=null,c=kt.updateQueue;if(c!==null&&(r=c.memoCache),r==null){var f=kt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(r={data:f.data.map(function(m){return m.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),c===null&&(c=wc(),kt.updateQueue=c),c.memoCache=r,c=r.data[r.index],c===void 0)for(c=r.data[r.index]=Array(s),f=0;f<s;f++)c[f]=R;return r.index++,c}function Pl(s,r){return typeof r=="function"?r(s):r}function jc(s){var r=Tn();return wf(r,nn,s)}function wf(s,r,c){var f=s.queue;if(f===null)throw Error(l(311));f.lastRenderedReducer=c;var m=s.baseQueue,x=f.pending;if(x!==null){if(m!==null){var k=m.next;m.next=x.next,x.next=k}r.baseQueue=m=x,f.pending=null}if(x=s.baseState,m===null)s.memoizedState=x;else{r=m.next;var M=k=null,K=null,ce=r,je=!1;do{var De=ce.lane&-536870913;if(De!==ce.lane?(Rt&De)===De:(Bl&De)===De){var he=ce.revertLane;if(he===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),De===Fa&&(je=!0);else if((Bl&he)===he){ce=ce.next,he===Fa&&(je=!0);continue}else De={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},K===null?(M=K=De,k=x):K=K.next=De,kt.lanes|=he,yr|=he;De=ce.action,fa&&c(x,De),x=ce.hasEagerState?ce.eagerState:c(x,De)}else he={lane:De,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},K===null?(M=K=he,k=x):K=K.next=he,kt.lanes|=De,yr|=De;ce=ce.next}while(ce!==null&&ce!==r);if(K===null?k=x:K.next=M,!Is(x,s.memoizedState)&&(Ln=!0,je&&(c=Ka,c!==null)))throw c;s.memoizedState=x,s.baseState=k,s.baseQueue=K,f.lastRenderedState=x}return m===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function Sf(s){var r=Tn(),c=r.queue;if(c===null)throw Error(l(311));c.lastRenderedReducer=s;var f=c.dispatch,m=c.pending,x=r.memoizedState;if(m!==null){c.pending=null;var k=m=m.next;do x=s(x,k.action),k=k.next;while(k!==m);Is(x,r.memoizedState)||(Ln=!0),r.memoizedState=x,r.baseQueue===null&&(r.baseState=x),c.lastRenderedState=x}return[x,f]}function ng(s,r,c){var f=kt,m=Tn(),x=Lt;if(x){if(c===void 0)throw Error(l(407));c=c()}else c=r();var k=!Is((nn||m).memoizedState,c);if(k&&(m.memoizedState=c,Ln=!0),m=m.queue,Ef(rg.bind(null,f,m,s),[s]),m.getSnapshot!==r||k||zn!==null&&zn.memoizedState.tag&1){if(f.flags|=2048,Za(9,{destroy:void 0},lg.bind(null,f,m,c,r),null),an===null)throw Error(l(349));x||(Bl&127)!==0||sg(f,r,c)}return c}function sg(s,r,c){s.flags|=16384,s={getSnapshot:r,value:c},r=kt.updateQueue,r===null?(r=wc(),kt.updateQueue=r,r.stores=[s]):(c=r.stores,c===null?r.stores=[s]:c.push(s))}function lg(s,r,c,f){r.value=c,r.getSnapshot=f,ag(r)&&ig(s)}function rg(s,r,c){return c(function(){ag(r)&&ig(s)})}function ag(s){var r=s.getSnapshot;s=s.value;try{var c=r();return!Is(s,c)}catch{return!0}}function ig(s){var r=sa(s,2);r!==null&&Ts(r,s,2)}function jf(s){var r=bs();if(typeof s=="function"){var c=s;if(s=c(),fa){xe(!0);try{c()}finally{xe(!1)}}}return r.memoizedState=r.baseState=s,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pl,lastRenderedState:s},r}function og(s,r,c,f){return s.baseState=c,wf(s,nn,typeof f=="function"?f:Pl)}function Fk(s,r,c,f,m){if(Mc(s))throw Error(l(485));if(s=r.action,s!==null){var x={payload:m,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){x.listeners.push(k)}};w.T!==null?c(!0):x.isTransition=!1,f(x),c=r.pending,c===null?(x.next=r.pending=x,cg(r,x)):(x.next=c.next,r.pending=c.next=x)}}function cg(s,r){var c=r.action,f=r.payload,m=s.state;if(r.isTransition){var x=w.T,k={};w.T=k;try{var M=c(m,f),K=w.S;K!==null&&K(k,M),dg(s,r,M)}catch(ce){Cf(s,r,ce)}finally{x!==null&&k.types!==null&&(x.types=k.types),w.T=x}}else try{x=c(m,f),dg(s,r,x)}catch(ce){Cf(s,r,ce)}}function dg(s,r,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){ug(s,r,f)},function(f){return Cf(s,r,f)}):ug(s,r,c)}function ug(s,r,c){r.status="fulfilled",r.value=c,fg(r),s.state=c,r=s.pending,r!==null&&(c=r.next,c===r?s.pending=null:(c=c.next,r.next=c,cg(s,c)))}function Cf(s,r,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do r.status="rejected",r.reason=c,fg(r),r=r.next;while(r!==f)}s.action=null}function fg(s){s=s.listeners;for(var r=0;r<s.length;r++)(0,s[r])()}function hg(s,r){return r}function pg(s,r){if(Lt){var c=an.formState;if(c!==null){e:{var f=kt;if(Lt){if(cn){t:{for(var m=cn,x=tl;m.nodeType!==8;){if(!x){m=null;break t}if(m=sl(m.nextSibling),m===null){m=null;break t}}x=m.data,m=x==="F!"||x==="F"?m:null}if(m){cn=sl(m.nextSibling),f=m.data==="F!";break e}}dr(f)}f=!1}f&&(r=c[0])}}return c=bs(),c.memoizedState=c.baseState=r,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hg,lastRenderedState:r},c.queue=f,c=Rg.bind(null,kt,f),f.dispatch=c,f=jf(!1),x=Of.bind(null,kt,!1,f.queue),f=bs(),m={state:r,dispatch:null,action:s,pending:null},f.queue=m,c=Fk.bind(null,kt,m,x,c),m.dispatch=c,f.memoizedState=s,[r,c,!1]}function mg(s){var r=Tn();return gg(r,nn,s)}function gg(s,r,c){if(r=wf(s,r,hg)[0],s=jc(Pl)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var f=Gi(r)}catch(k){throw k===Ga?mc:k}else f=r;r=Tn();var m=r.queue,x=m.dispatch;return c!==r.memoizedState&&(kt.flags|=2048,Za(9,{destroy:void 0},Kk.bind(null,m,c),null)),[f,x,s]}function Kk(s,r){s.action=r}function xg(s){var r=Tn(),c=nn;if(c!==null)return gg(r,c,s);Tn(),r=r.memoizedState,c=Tn();var f=c.queue.dispatch;return c.memoizedState=s,[r,f,!1]}function Za(s,r,c,f){return s={tag:s,create:c,deps:f,inst:r,next:null},r=kt.updateQueue,r===null&&(r=wc(),kt.updateQueue=r),c=r.lastEffect,c===null?r.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,r.lastEffect=s),s}function bg(){return Tn().memoizedState}function Cc(s,r,c,f){var m=bs();kt.flags|=s,m.memoizedState=Za(1|r,{destroy:void 0},c,f===void 0?null:f)}function Ec(s,r,c,f){var m=Tn();f=f===void 0?null:f;var x=m.memoizedState.inst;nn!==null&&f!==null&&xf(f,nn.memoizedState.deps)?m.memoizedState=Za(r,x,c,f):(kt.flags|=s,m.memoizedState=Za(1|r,x,c,f))}function yg(s,r){Cc(8390656,8,s,r)}function Ef(s,r){Ec(2048,8,s,r)}function Gk(s){kt.flags|=4;var r=kt.updateQueue;if(r===null)r=wc(),kt.updateQueue=r,r.events=[s];else{var c=r.events;c===null?r.events=[s]:c.push(s)}}function vg(s){var r=Tn().memoizedState;return Gk({ref:r,nextImpl:s}),function(){if((Kt&2)!==0)throw Error(l(440));return r.impl.apply(void 0,arguments)}}function Ng(s,r){return Ec(4,2,s,r)}function kg(s,r){return Ec(4,4,s,r)}function wg(s,r){if(typeof r=="function"){s=s();var c=r(s);return function(){typeof c=="function"?c():r(null)}}if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function Sg(s,r,c){c=c!=null?c.concat([s]):null,Ec(4,4,wg.bind(null,r,s),c)}function Mf(){}function jg(s,r){var c=Tn();r=r===void 0?null:r;var f=c.memoizedState;return r!==null&&xf(r,f[1])?f[0]:(c.memoizedState=[s,r],s)}function Cg(s,r){var c=Tn();r=r===void 0?null:r;var f=c.memoizedState;if(r!==null&&xf(r,f[1]))return f[0];if(f=s(),fa){xe(!0);try{s()}finally{xe(!1)}}return c.memoizedState=[f,r],f}function Af(s,r,c){return c===void 0||(Bl&1073741824)!==0&&(Rt&261930)===0?s.memoizedState=r:(s.memoizedState=c,s=Ex(),kt.lanes|=s,yr|=s,c)}function Eg(s,r,c,f){return Is(c,r)?c:Xa.current!==null?(s=Af(s,c,f),Is(s,r)||(Ln=!0),s):(Bl&42)===0||(Bl&1073741824)!==0&&(Rt&261930)===0?(Ln=!0,s.memoizedState=c):(s=Ex(),kt.lanes|=s,yr|=s,r)}function Mg(s,r,c,f,m){var x=T.p;T.p=x!==0&&8>x?x:8;var k=w.T,M={};w.T=M,Of(s,!1,r,c);try{var K=m(),ce=w.S;if(ce!==null&&ce(M,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var je=Uk(K,f);Yi(s,r,je,Hs(s))}else Yi(s,r,f,Hs(s))}catch(De){Yi(s,r,{then:function(){},status:"rejected",reason:De},Hs())}finally{T.p=x,k!==null&&M.types!==null&&(k.types=M.types),w.T=k}}function Yk(){}function Tf(s,r,c,f){if(s.tag!==5)throw Error(l(476));var m=Ag(s).queue;Mg(s,m,r,I,c===null?Yk:function(){return Tg(s),c(f)})}function Ag(s){var r=s.memoizedState;if(r!==null)return r;r={memoizedState:I,baseState:I,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pl,lastRenderedState:I},next:null};var c={};return r.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pl,lastRenderedState:c},next:null},s.memoizedState=r,s=s.alternate,s!==null&&(s.memoizedState=r),r}function Tg(s){var r=Ag(s);r.next===null&&(r=s.alternate.memoizedState),Yi(s,r.next.queue,{},Hs())}function Df(){return Qn(fo)}function Dg(){return Tn().memoizedState}function Og(){return Tn().memoizedState}function Xk(s){for(var r=s.return;r!==null;){switch(r.tag){case 24:case 3:var c=Hs();s=hr(c);var f=pr(r,s,c);f!==null&&(Ts(f,r,c),Vi(f,r,c)),r={cache:rf()},s.payload=r;return}r=r.return}}function Jk(s,r,c){var f=Hs();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Mc(s)?Ig(r,c):(c=Yu(s,r,c,f),c!==null&&(Ts(c,s,f),zg(c,r,f)))}function Rg(s,r,c){var f=Hs();Yi(s,r,c,f)}function Yi(s,r,c,f){var m={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Mc(s))Ig(r,m);else{var x=s.alternate;if(s.lanes===0&&(x===null||x.lanes===0)&&(x=r.lastRenderedReducer,x!==null))try{var k=r.lastRenderedState,M=x(k,c);if(m.hasEagerState=!0,m.eagerState=M,Is(M,k))return oc(s,r,m,0),an===null&&ic(),!1}catch{}finally{}if(c=Yu(s,r,m,f),c!==null)return Ts(c,s,f),zg(c,r,f),!0}return!1}function Of(s,r,c,f){if(f={lane:2,revertLane:dh(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Mc(s)){if(r)throw Error(l(479))}else r=Yu(s,c,f,2),r!==null&&Ts(r,s,2)}function Mc(s){var r=s.alternate;return s===kt||r!==null&&r===kt}function Ig(s,r){Ja=Nc=!0;var c=s.pending;c===null?r.next=r:(r.next=c.next,c.next=r),s.pending=r}function zg(s,r,c){if((c&4194048)!==0){var f=r.lanes;f&=s.pendingLanes,c|=f,r.lanes=c,Qt(s,c)}}var Xi={readContext:Qn,use:Sc,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useLayoutEffect:kn,useInsertionEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useSyncExternalStore:kn,useId:kn,useHostTransitionStatus:kn,useFormState:kn,useActionState:kn,useOptimistic:kn,useMemoCache:kn,useCacheRefresh:kn};Xi.useEffectEvent=kn;var Lg={readContext:Qn,use:Sc,useCallback:function(s,r){return bs().memoizedState=[s,r===void 0?null:r],s},useContext:Qn,useEffect:yg,useImperativeHandle:function(s,r,c){c=c!=null?c.concat([s]):null,Cc(4194308,4,wg.bind(null,r,s),c)},useLayoutEffect:function(s,r){return Cc(4194308,4,s,r)},useInsertionEffect:function(s,r){Cc(4,2,s,r)},useMemo:function(s,r){var c=bs();r=r===void 0?null:r;var f=s();if(fa){xe(!0);try{s()}finally{xe(!1)}}return c.memoizedState=[f,r],f},useReducer:function(s,r,c){var f=bs();if(c!==void 0){var m=c(r);if(fa){xe(!0);try{c(r)}finally{xe(!1)}}}else m=r;return f.memoizedState=f.baseState=m,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:m},f.queue=s,s=s.dispatch=Jk.bind(null,kt,s),[f.memoizedState,s]},useRef:function(s){var r=bs();return s={current:s},r.memoizedState=s},useState:function(s){s=jf(s);var r=s.queue,c=Rg.bind(null,kt,r);return r.dispatch=c,[s.memoizedState,c]},useDebugValue:Mf,useDeferredValue:function(s,r){var c=bs();return Af(c,s,r)},useTransition:function(){var s=jf(!1);return s=Mg.bind(null,kt,s.queue,!0,!1),bs().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,r,c){var f=kt,m=bs();if(Lt){if(c===void 0)throw Error(l(407));c=c()}else{if(c=r(),an===null)throw Error(l(349));(Rt&127)!==0||sg(f,r,c)}m.memoizedState=c;var x={value:c,getSnapshot:r};return m.queue=x,yg(rg.bind(null,f,x,s),[s]),f.flags|=2048,Za(9,{destroy:void 0},lg.bind(null,f,x,c,r),null),c},useId:function(){var s=bs(),r=an.identifierPrefix;if(Lt){var c=wl,f=kl;c=(f&~(1<<32-$e(f)-1)).toString(32)+c,r="_"+r+"R_"+c,c=kc++,0<c&&(r+="H"+c.toString(32)),r+="_"}else c=Vk++,r="_"+r+"r_"+c.toString(32)+"_";return s.memoizedState=r},useHostTransitionStatus:Df,useFormState:pg,useActionState:pg,useOptimistic:function(s){var r=bs();r.memoizedState=r.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=c,r=Of.bind(null,kt,!0,c),c.dispatch=r,[s,r]},useMemoCache:kf,useCacheRefresh:function(){return bs().memoizedState=Xk.bind(null,kt)},useEffectEvent:function(s){var r=bs(),c={impl:s};return r.memoizedState=c,function(){if((Kt&2)!==0)throw Error(l(440));return c.impl.apply(void 0,arguments)}}},Rf={readContext:Qn,use:Sc,useCallback:jg,useContext:Qn,useEffect:Ef,useImperativeHandle:Sg,useInsertionEffect:Ng,useLayoutEffect:kg,useMemo:Cg,useReducer:jc,useRef:bg,useState:function(){return jc(Pl)},useDebugValue:Mf,useDeferredValue:function(s,r){var c=Tn();return Eg(c,nn.memoizedState,s,r)},useTransition:function(){var s=jc(Pl)[0],r=Tn().memoizedState;return[typeof s=="boolean"?s:Gi(s),r]},useSyncExternalStore:ng,useId:Dg,useHostTransitionStatus:Df,useFormState:mg,useActionState:mg,useOptimistic:function(s,r){var c=Tn();return og(c,nn,s,r)},useMemoCache:kf,useCacheRefresh:Og};Rf.useEffectEvent=vg;var _g={readContext:Qn,use:Sc,useCallback:jg,useContext:Qn,useEffect:Ef,useImperativeHandle:Sg,useInsertionEffect:Ng,useLayoutEffect:kg,useMemo:Cg,useReducer:Sf,useRef:bg,useState:function(){return Sf(Pl)},useDebugValue:Mf,useDeferredValue:function(s,r){var c=Tn();return nn===null?Af(c,s,r):Eg(c,nn.memoizedState,s,r)},useTransition:function(){var s=Sf(Pl)[0],r=Tn().memoizedState;return[typeof s=="boolean"?s:Gi(s),r]},useSyncExternalStore:ng,useId:Dg,useHostTransitionStatus:Df,useFormState:xg,useActionState:xg,useOptimistic:function(s,r){var c=Tn();return nn!==null?og(c,nn,s,r):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:kf,useCacheRefresh:Og};_g.useEffectEvent=vg;function If(s,r,c,f){r=s.memoizedState,c=c(f,r),c=c==null?r:b({},r,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var zf={enqueueSetState:function(s,r,c){s=s._reactInternals;var f=Hs(),m=hr(f);m.payload=r,c!=null&&(m.callback=c),r=pr(s,m,f),r!==null&&(Ts(r,s,f),Vi(r,s,f))},enqueueReplaceState:function(s,r,c){s=s._reactInternals;var f=Hs(),m=hr(f);m.tag=1,m.payload=r,c!=null&&(m.callback=c),r=pr(s,m,f),r!==null&&(Ts(r,s,f),Vi(r,s,f))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var c=Hs(),f=hr(c);f.tag=2,r!=null&&(f.callback=r),r=pr(s,f,c),r!==null&&(Ts(r,s,c),Vi(r,s,c))}};function Bg(s,r,c,f,m,x,k){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,x,k):r.prototype&&r.prototype.isPureReactComponent?!zi(c,f)||!zi(m,x):!0}function Pg(s,r,c,f){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,f),r.state!==s&&zf.enqueueReplaceState(r,r.state,null)}function ha(s,r){var c=r;if("ref"in r){c={};for(var f in r)f!=="ref"&&(c[f]=r[f])}if(s=s.defaultProps){c===r&&(c=b({},c));for(var m in s)c[m]===void 0&&(c[m]=s[m])}return c}function Hg(s){ac(s)}function $g(s){console.error(s)}function Ug(s){ac(s)}function Ac(s,r){try{var c=s.onUncaughtError;c(r.value,{componentStack:r.stack})}catch(f){setTimeout(function(){throw f})}}function Vg(s,r,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Lf(s,r,c){return c=hr(c),c.tag=3,c.payload={element:null},c.callback=function(){Ac(s,r)},c}function qg(s){return s=hr(s),s.tag=3,s}function Fg(s,r,c,f){var m=c.type.getDerivedStateFromError;if(typeof m=="function"){var x=f.value;s.payload=function(){return m(x)},s.callback=function(){Vg(r,c,f)}}var k=c.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(s.callback=function(){Vg(r,c,f),typeof m!="function"&&(vr===null?vr=new Set([this]):vr.add(this));var M=f.stack;this.componentDidCatch(f.value,{componentStack:M!==null?M:""})})}function Qk(s,r,c,f,m){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(r=c.alternate,r!==null&&qa(r,c,m,!0),c=Ls.current,c!==null){switch(c.tag){case 31:case 13:return nl===null?$c():c.alternate===null&&wn===0&&(wn=3),c.flags&=-257,c.flags|=65536,c.lanes=m,f===gc?c.flags|=16384:(r=c.updateQueue,r===null?c.updateQueue=new Set([f]):r.add(f),ih(s,f,m)),!1;case 22:return c.flags|=65536,f===gc?c.flags|=16384:(r=c.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=r):(c=r.retryQueue,c===null?r.retryQueue=new Set([f]):c.add(f)),ih(s,f,m)),!1}throw Error(l(435,c.tag))}return ih(s,f,m),$c(),!1}if(Lt)return r=Ls.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=m,f!==ef&&(s=Error(l(422),{cause:f}),Bi(Zs(s,c)))):(f!==ef&&(r=Error(l(423),{cause:f}),Bi(Zs(r,c))),s=s.current.alternate,s.flags|=65536,m&=-m,s.lanes|=m,f=Zs(f,c),m=Lf(s.stateNode,f,m),ff(s,m),wn!==4&&(wn=2)),!1;var x=Error(l(520),{cause:f});if(x=Zs(x,c),so===null?so=[x]:so.push(x),wn!==4&&(wn=2),r===null)return!0;f=Zs(f,c),c=r;do{switch(c.tag){case 3:return c.flags|=65536,s=m&-m,c.lanes|=s,s=Lf(c.stateNode,f,s),ff(c,s),!1;case 1:if(r=c.type,x=c.stateNode,(c.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(vr===null||!vr.has(x))))return c.flags|=65536,m&=-m,c.lanes|=m,m=qg(m),Fg(m,s,c,f),ff(c,m),!1}c=c.return}while(c!==null);return!1}var _f=Error(l(461)),Ln=!1;function Zn(s,r,c,f){r.child=s===null?X0(r,null,c,f):ua(r,s.child,c,f)}function Kg(s,r,c,f,m){c=c.render;var x=r.ref;if("ref"in f){var k={};for(var M in f)M!=="ref"&&(k[M]=f[M])}else k=f;return ia(r),f=bf(s,r,c,k,x,m),M=yf(),s!==null&&!Ln?(vf(s,r,m),Hl(s,r,m)):(Lt&&M&&Zu(r),r.flags|=1,Zn(s,r,f,m),r.child)}function Gg(s,r,c,f,m){if(s===null){var x=c.type;return typeof x=="function"&&!Xu(x)&&x.defaultProps===void 0&&c.compare===null?(r.tag=15,r.type=x,Yg(s,r,x,f,m)):(s=dc(c.type,null,f,r,r.mode,m),s.ref=r.ref,s.return=r,r.child=s)}if(x=s.child,!Ff(s,m)){var k=x.memoizedProps;if(c=c.compare,c=c!==null?c:zi,c(k,f)&&s.ref===r.ref)return Hl(s,r,m)}return r.flags|=1,s=Il(x,f),s.ref=r.ref,s.return=r,r.child=s}function Yg(s,r,c,f,m){if(s!==null){var x=s.memoizedProps;if(zi(x,f)&&s.ref===r.ref)if(Ln=!1,r.pendingProps=f=x,Ff(s,m))(s.flags&131072)!==0&&(Ln=!0);else return r.lanes=s.lanes,Hl(s,r,m)}return Bf(s,r,c,f,m)}function Xg(s,r,c,f){var m=f.children,x=s!==null?s.memoizedState:null;if(s===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((r.flags&128)!==0){if(x=x!==null?x.baseLanes|c:c,s!==null){for(f=r.child=s.child,m=0;f!==null;)m=m|f.lanes|f.childLanes,f=f.sibling;f=m&~x}else f=0,r.child=null;return Jg(s,r,x,c,f)}if((c&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},s!==null&&pc(r,x!==null?x.cachePool:null),x!==null?Z0(r,x):pf(),W0(r);else return f=r.lanes=536870912,Jg(s,r,x!==null?x.baseLanes|c:c,c,f)}else x!==null?(pc(r,x.cachePool),Z0(r,x),gr(),r.memoizedState=null):(s!==null&&pc(r,null),pf(),gr());return Zn(s,r,m,c),r.child}function Ji(s,r){return s!==null&&s.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Jg(s,r,c,f,m){var x=of();return x=x===null?null:{parent:In._currentValue,pool:x},r.memoizedState={baseLanes:c,cachePool:x},s!==null&&pc(r,null),pf(),W0(r),s!==null&&qa(s,r,f,!0),r.childLanes=m,null}function Tc(s,r){return r=Oc({mode:r.mode,children:r.children},s.mode),r.ref=s.ref,s.child=r,r.return=s,r}function Qg(s,r,c){return ua(r,s.child,null,c),s=Tc(r,r.pendingProps),s.flags|=2,_s(r),r.memoizedState=null,s}function Zk(s,r,c){var f=r.pendingProps,m=(r.flags&128)!==0;if(r.flags&=-129,s===null){if(Lt){if(f.mode==="hidden")return s=Tc(r,f),r.lanes=536870912,Ji(null,s);if(gf(r),(s=cn)?(s=cb(s,tl),s=s!==null&&s.data==="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:or!==null?{id:kl,overflow:wl}:null,retryLane:536870912,hydrationErrors:null},c=I0(s),c.return=r,r.child=c,Jn=r,cn=null)):s=null,s===null)throw dr(r);return r.lanes=536870912,null}return Tc(r,f)}var x=s.memoizedState;if(x!==null){var k=x.dehydrated;if(gf(r),m)if(r.flags&256)r.flags&=-257,r=Qg(s,r,c);else if(r.memoizedState!==null)r.child=s.child,r.flags|=128,r=null;else throw Error(l(558));else if(Ln||qa(s,r,c,!1),m=(c&s.childLanes)!==0,Ln||m){if(f=an,f!==null&&(k=ws(f,c),k!==0&&k!==x.retryLane))throw x.retryLane=k,sa(s,k),Ts(f,s,k),_f;$c(),r=Qg(s,r,c)}else s=x.treeContext,cn=sl(k.nextSibling),Jn=r,Lt=!0,cr=null,tl=!1,s!==null&&_0(r,s),r=Tc(r,f),r.flags|=4096;return r}return s=Il(s.child,{mode:f.mode,children:f.children}),s.ref=r.ref,r.child=s,s.return=r,s}function Dc(s,r){var c=r.ref;if(c===null)s!==null&&s.ref!==null&&(r.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(l(284));(s===null||s.ref!==c)&&(r.flags|=4194816)}}function Bf(s,r,c,f,m){return ia(r),c=bf(s,r,c,f,void 0,m),f=yf(),s!==null&&!Ln?(vf(s,r,m),Hl(s,r,m)):(Lt&&f&&Zu(r),r.flags|=1,Zn(s,r,c,m),r.child)}function Zg(s,r,c,f,m,x){return ia(r),r.updateQueue=null,c=tg(r,f,c,m),eg(s),f=yf(),s!==null&&!Ln?(vf(s,r,x),Hl(s,r,x)):(Lt&&f&&Zu(r),r.flags|=1,Zn(s,r,c,x),r.child)}function Wg(s,r,c,f,m){if(ia(r),r.stateNode===null){var x=Ha,k=c.contextType;typeof k=="object"&&k!==null&&(x=Qn(k)),x=new c(f,x),r.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=zf,r.stateNode=x,x._reactInternals=r,x=r.stateNode,x.props=f,x.state=r.memoizedState,x.refs={},df(r),k=c.contextType,x.context=typeof k=="object"&&k!==null?Qn(k):Ha,x.state=r.memoizedState,k=c.getDerivedStateFromProps,typeof k=="function"&&(If(r,c,k,f),x.state=r.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(k=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),k!==x.state&&zf.enqueueReplaceState(x,x.state,null),Fi(r,f,x,m),qi(),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308),f=!0}else if(s===null){x=r.stateNode;var M=r.memoizedProps,K=ha(c,M);x.props=K;var ce=x.context,je=c.contextType;k=Ha,typeof je=="object"&&je!==null&&(k=Qn(je));var De=c.getDerivedStateFromProps;je=typeof De=="function"||typeof x.getSnapshotBeforeUpdate=="function",M=r.pendingProps!==M,je||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(M||ce!==k)&&Pg(r,x,f,k),fr=!1;var he=r.memoizedState;x.state=he,Fi(r,f,x,m),qi(),ce=r.memoizedState,M||he!==ce||fr?(typeof De=="function"&&(If(r,c,De,f),ce=r.memoizedState),(K=fr||Bg(r,c,K,f,he,ce,k))?(je||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(r.flags|=4194308)):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=ce),x.props=f,x.state=ce,x.context=k,f=K):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{x=r.stateNode,uf(s,r),k=r.memoizedProps,je=ha(c,k),x.props=je,De=r.pendingProps,he=x.context,ce=c.contextType,K=Ha,typeof ce=="object"&&ce!==null&&(K=Qn(ce)),M=c.getDerivedStateFromProps,(ce=typeof M=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(k!==De||he!==K)&&Pg(r,x,f,K),fr=!1,he=r.memoizedState,x.state=he,Fi(r,f,x,m),qi();var Ne=r.memoizedState;k!==De||he!==Ne||fr||s!==null&&s.dependencies!==null&&fc(s.dependencies)?(typeof M=="function"&&(If(r,c,M,f),Ne=r.memoizedState),(je=fr||Bg(r,c,je,f,he,Ne,K)||s!==null&&s.dependencies!==null&&fc(s.dependencies))?(ce||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(f,Ne,K),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(f,Ne,K)),typeof x.componentDidUpdate=="function"&&(r.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof x.componentDidUpdate!="function"||k===s.memoizedProps&&he===s.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&he===s.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=Ne),x.props=f,x.state=Ne,x.context=K,f=je):(typeof x.componentDidUpdate!="function"||k===s.memoizedProps&&he===s.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&he===s.memoizedState||(r.flags|=1024),f=!1)}return x=f,Dc(s,r),f=(r.flags&128)!==0,x||f?(x=r.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:x.render(),r.flags|=1,s!==null&&f?(r.child=ua(r,s.child,null,m),r.child=ua(r,null,c,m)):Zn(s,r,c,m),r.memoizedState=x.state,s=r.child):s=Hl(s,r,m),s}function ex(s,r,c,f){return ra(),r.flags|=256,Zn(s,r,c,f),r.child}var Pf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Hf(s){return{baseLanes:s,cachePool:V0()}}function $f(s,r,c){return s=s!==null?s.childLanes&~c:0,r&&(s|=Ps),s}function tx(s,r,c){var f=r.pendingProps,m=!1,x=(r.flags&128)!==0,k;if((k=x)||(k=s!==null&&s.memoizedState===null?!1:(An.current&2)!==0),k&&(m=!0,r.flags&=-129),k=(r.flags&32)!==0,r.flags&=-33,s===null){if(Lt){if(m?mr(r):gr(),(s=cn)?(s=cb(s,tl),s=s!==null&&s.data!=="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:or!==null?{id:kl,overflow:wl}:null,retryLane:536870912,hydrationErrors:null},c=I0(s),c.return=r,r.child=c,Jn=r,cn=null)):s=null,s===null)throw dr(r);return wh(s)?r.lanes=32:r.lanes=536870912,null}var M=f.children;return f=f.fallback,m?(gr(),m=r.mode,M=Oc({mode:"hidden",children:M},m),f=la(f,m,c,null),M.return=r,f.return=r,M.sibling=f,r.child=M,f=r.child,f.memoizedState=Hf(c),f.childLanes=$f(s,k,c),r.memoizedState=Pf,Ji(null,f)):(mr(r),Uf(r,M))}var K=s.memoizedState;if(K!==null&&(M=K.dehydrated,M!==null)){if(x)r.flags&256?(mr(r),r.flags&=-257,r=Vf(s,r,c)):r.memoizedState!==null?(gr(),r.child=s.child,r.flags|=128,r=null):(gr(),M=f.fallback,m=r.mode,f=Oc({mode:"visible",children:f.children},m),M=la(M,m,c,null),M.flags|=2,f.return=r,M.return=r,f.sibling=M,r.child=f,ua(r,s.child,null,c),f=r.child,f.memoizedState=Hf(c),f.childLanes=$f(s,k,c),r.memoizedState=Pf,r=Ji(null,f));else if(mr(r),wh(M)){if(k=M.nextSibling&&M.nextSibling.dataset,k)var ce=k.dgst;k=ce,f=Error(l(419)),f.stack="",f.digest=k,Bi({value:f,source:null,stack:null}),r=Vf(s,r,c)}else if(Ln||qa(s,r,c,!1),k=(c&s.childLanes)!==0,Ln||k){if(k=an,k!==null&&(f=ws(k,c),f!==0&&f!==K.retryLane))throw K.retryLane=f,sa(s,f),Ts(k,s,f),_f;kh(M)||$c(),r=Vf(s,r,c)}else kh(M)?(r.flags|=192,r.child=s.child,r=null):(s=K.treeContext,cn=sl(M.nextSibling),Jn=r,Lt=!0,cr=null,tl=!1,s!==null&&_0(r,s),r=Uf(r,f.children),r.flags|=4096);return r}return m?(gr(),M=f.fallback,m=r.mode,K=s.child,ce=K.sibling,f=Il(K,{mode:"hidden",children:f.children}),f.subtreeFlags=K.subtreeFlags&65011712,ce!==null?M=Il(ce,M):(M=la(M,m,c,null),M.flags|=2),M.return=r,f.return=r,f.sibling=M,r.child=f,Ji(null,f),f=r.child,M=s.child.memoizedState,M===null?M=Hf(c):(m=M.cachePool,m!==null?(K=In._currentValue,m=m.parent!==K?{parent:K,pool:K}:m):m=V0(),M={baseLanes:M.baseLanes|c,cachePool:m}),f.memoizedState=M,f.childLanes=$f(s,k,c),r.memoizedState=Pf,Ji(s.child,f)):(mr(r),c=s.child,s=c.sibling,c=Il(c,{mode:"visible",children:f.children}),c.return=r,c.sibling=null,s!==null&&(k=r.deletions,k===null?(r.deletions=[s],r.flags|=16):k.push(s)),r.child=c,r.memoizedState=null,c)}function Uf(s,r){return r=Oc({mode:"visible",children:r},s.mode),r.return=s,s.child=r}function Oc(s,r){return s=zs(22,s,null,r),s.lanes=0,s}function Vf(s,r,c){return ua(r,s.child,null,c),s=Uf(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function nx(s,r,c){s.lanes|=r;var f=s.alternate;f!==null&&(f.lanes|=r),sf(s.return,r,c)}function qf(s,r,c,f,m,x){var k=s.memoizedState;k===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:m,treeForkCount:x}:(k.isBackwards=r,k.rendering=null,k.renderingStartTime=0,k.last=f,k.tail=c,k.tailMode=m,k.treeForkCount=x)}function sx(s,r,c){var f=r.pendingProps,m=f.revealOrder,x=f.tail;f=f.children;var k=An.current,M=(k&2)!==0;if(M?(k=k&1|2,r.flags|=128):k&=1,ke(An,k),Zn(s,r,f,c),f=Lt?_i:0,!M&&s!==null&&(s.flags&128)!==0)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&nx(s,c,r);else if(s.tag===19)nx(s,c,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(m){case"forwards":for(c=r.child,m=null;c!==null;)s=c.alternate,s!==null&&vc(s)===null&&(m=c),c=c.sibling;c=m,c===null?(m=r.child,r.child=null):(m=c.sibling,c.sibling=null),qf(r,!1,m,c,x,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,m=r.child,r.child=null;m!==null;){if(s=m.alternate,s!==null&&vc(s)===null){r.child=m;break}s=m.sibling,m.sibling=c,c=m,m=s}qf(r,!0,c,null,x,f);break;case"together":qf(r,!1,null,null,void 0,f);break;default:r.memoizedState=null}return r.child}function Hl(s,r,c){if(s!==null&&(r.dependencies=s.dependencies),yr|=r.lanes,(c&r.childLanes)===0)if(s!==null){if(qa(s,r,c,!1),(c&r.childLanes)===0)return null}else return null;if(s!==null&&r.child!==s.child)throw Error(l(153));if(r.child!==null){for(s=r.child,c=Il(s,s.pendingProps),r.child=c,c.return=r;s.sibling!==null;)s=s.sibling,c=c.sibling=Il(s,s.pendingProps),c.return=r;c.sibling=null}return r.child}function Ff(s,r){return(s.lanes&r)!==0?!0:(s=s.dependencies,!!(s!==null&&fc(s)))}function Wk(s,r,c){switch(r.tag){case 3:Ie(r,r.stateNode.containerInfo),ur(r,In,s.memoizedState.cache),ra();break;case 27:case 5:we(r);break;case 4:Ie(r,r.stateNode.containerInfo);break;case 10:ur(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,gf(r),null;break;case 13:var f=r.memoizedState;if(f!==null)return f.dehydrated!==null?(mr(r),r.flags|=128,null):(c&r.child.childLanes)!==0?tx(s,r,c):(mr(r),s=Hl(s,r,c),s!==null?s.sibling:null);mr(r);break;case 19:var m=(s.flags&128)!==0;if(f=(c&r.childLanes)!==0,f||(qa(s,r,c,!1),f=(c&r.childLanes)!==0),m){if(f)return sx(s,r,c);r.flags|=128}if(m=r.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ke(An,An.current),f)break;return null;case 22:return r.lanes=0,Xg(s,r,c,r.pendingProps);case 24:ur(r,In,s.memoizedState.cache)}return Hl(s,r,c)}function lx(s,r,c){if(s!==null)if(s.memoizedProps!==r.pendingProps)Ln=!0;else{if(!Ff(s,c)&&(r.flags&128)===0)return Ln=!1,Wk(s,r,c);Ln=(s.flags&131072)!==0}else Ln=!1,Lt&&(r.flags&1048576)!==0&&L0(r,_i,r.index);switch(r.lanes=0,r.tag){case 16:e:{var f=r.pendingProps;if(s=ca(r.elementType),r.type=s,typeof s=="function")Xu(s)?(f=ha(s,f),r.tag=1,r=Wg(null,r,s,f,c)):(r.tag=0,r=Bf(null,r,s,f,c));else{if(s!=null){var m=s.$$typeof;if(m===H){r.tag=11,r=Kg(null,r,s,f,c);break e}else if(m===G){r.tag=14,r=Gg(null,r,s,f,c);break e}}throw r=J(s)||s,Error(l(306,r,""))}}return r;case 0:return Bf(s,r,r.type,r.pendingProps,c);case 1:return f=r.type,m=ha(f,r.pendingProps),Wg(s,r,f,m,c);case 3:e:{if(Ie(r,r.stateNode.containerInfo),s===null)throw Error(l(387));f=r.pendingProps;var x=r.memoizedState;m=x.element,uf(s,r),Fi(r,f,null,c);var k=r.memoizedState;if(f=k.cache,ur(r,In,f),f!==x.cache&&lf(r,[In],c,!0),qi(),f=k.element,x.isDehydrated)if(x={element:f,isDehydrated:!1,cache:k.cache},r.updateQueue.baseState=x,r.memoizedState=x,r.flags&256){r=ex(s,r,f,c);break e}else if(f!==m){m=Zs(Error(l(424)),r),Bi(m),r=ex(s,r,f,c);break e}else{switch(s=r.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(cn=sl(s.firstChild),Jn=r,Lt=!0,cr=null,tl=!0,c=X0(r,null,f,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ra(),f===m){r=Hl(s,r,c);break e}Zn(s,r,f,c)}r=r.child}return r;case 26:return Dc(s,r),s===null?(c=mb(r.type,null,r.pendingProps,null))?r.memoizedState=c:Lt||(c=r.type,s=r.pendingProps,f=Yc(Ee.current).createElement(c),f[ye]=r,f[be]=s,Wn(f,c,s),Mt(f),r.stateNode=f):r.memoizedState=mb(r.type,s.memoizedProps,r.pendingProps,s.memoizedState),null;case 27:return we(r),s===null&&Lt&&(f=r.stateNode=fb(r.type,r.pendingProps,Ee.current),Jn=r,tl=!0,m=cn,Sr(r.type)?(Sh=m,cn=sl(f.firstChild)):cn=m),Zn(s,r,r.pendingProps.children,c),Dc(s,r),s===null&&(r.flags|=4194304),r.child;case 5:return s===null&&Lt&&((m=f=cn)&&(f=Aw(f,r.type,r.pendingProps,tl),f!==null?(r.stateNode=f,Jn=r,cn=sl(f.firstChild),tl=!1,m=!0):m=!1),m||dr(r)),we(r),m=r.type,x=r.pendingProps,k=s!==null?s.memoizedProps:null,f=x.children,yh(m,x)?f=null:k!==null&&yh(m,k)&&(r.flags|=32),r.memoizedState!==null&&(m=bf(s,r,qk,null,null,c),fo._currentValue=m),Dc(s,r),Zn(s,r,f,c),r.child;case 6:return s===null&&Lt&&((s=c=cn)&&(c=Tw(c,r.pendingProps,tl),c!==null?(r.stateNode=c,Jn=r,cn=null,s=!0):s=!1),s||dr(r)),null;case 13:return tx(s,r,c);case 4:return Ie(r,r.stateNode.containerInfo),f=r.pendingProps,s===null?r.child=ua(r,null,f,c):Zn(s,r,f,c),r.child;case 11:return Kg(s,r,r.type,r.pendingProps,c);case 7:return Zn(s,r,r.pendingProps,c),r.child;case 8:return Zn(s,r,r.pendingProps.children,c),r.child;case 12:return Zn(s,r,r.pendingProps.children,c),r.child;case 10:return f=r.pendingProps,ur(r,r.type,f.value),Zn(s,r,f.children,c),r.child;case 9:return m=r.type._context,f=r.pendingProps.children,ia(r),m=Qn(m),f=f(m),r.flags|=1,Zn(s,r,f,c),r.child;case 14:return Gg(s,r,r.type,r.pendingProps,c);case 15:return Yg(s,r,r.type,r.pendingProps,c);case 19:return sx(s,r,c);case 31:return Zk(s,r,c);case 22:return Xg(s,r,c,r.pendingProps);case 24:return ia(r),f=Qn(In),s===null?(m=of(),m===null&&(m=an,x=rf(),m.pooledCache=x,x.refCount++,x!==null&&(m.pooledCacheLanes|=c),m=x),r.memoizedState={parent:f,cache:m},df(r),ur(r,In,m)):((s.lanes&c)!==0&&(uf(s,r),Fi(r,null,null,c),qi()),m=s.memoizedState,x=r.memoizedState,m.parent!==f?(m={parent:f,cache:f},r.memoizedState=m,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=m),ur(r,In,f)):(f=x.cache,ur(r,In,f),f!==m.cache&&lf(r,[In],c,!0))),Zn(s,r,r.pendingProps.children,c),r.child;case 29:throw r.pendingProps}throw Error(l(156,r.tag))}function $l(s){s.flags|=4}function Kf(s,r,c,f,m){if((r=(s.mode&32)!==0)&&(r=!1),r){if(s.flags|=16777216,(m&335544128)===m)if(s.stateNode.complete)s.flags|=8192;else if(Dx())s.flags|=8192;else throw da=gc,cf}else s.flags&=-16777217}function rx(s,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!vb(r))if(Dx())s.flags|=8192;else throw da=gc,cf}function Rc(s,r){r!==null&&(s.flags|=4),s.flags&16384&&(r=s.tag!==22?Jt():536870912,s.lanes|=r,ni|=r)}function Qi(s,r){if(!Lt)switch(s.tailMode){case"hidden":r=s.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function dn(s){var r=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(r)for(var m=s.child;m!==null;)c|=m.lanes|m.childLanes,f|=m.subtreeFlags&65011712,f|=m.flags&65011712,m.return=s,m=m.sibling;else for(m=s.child;m!==null;)c|=m.lanes|m.childLanes,f|=m.subtreeFlags,f|=m.flags,m.return=s,m=m.sibling;return s.subtreeFlags|=f,s.childLanes=c,r}function ew(s,r,c){var f=r.pendingProps;switch(Wu(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(r),null;case 1:return dn(r),null;case 3:return c=r.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),r.memoizedState.cache!==f&&(r.flags|=2048),_l(In),P(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(Va(r)?$l(r):s===null||s.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,tf())),dn(r),null;case 26:var m=r.type,x=r.memoizedState;return s===null?($l(r),x!==null?(dn(r),rx(r,x)):(dn(r),Kf(r,m,null,f,c))):x?x!==s.memoizedState?($l(r),dn(r),rx(r,x)):(dn(r),r.flags&=-16777217):(s=s.memoizedProps,s!==f&&$l(r),dn(r),Kf(r,m,s,f,c)),null;case 27:if(ue(r),c=Ee.current,m=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==f&&$l(r);else{if(!f){if(r.stateNode===null)throw Error(l(166));return dn(r),null}s=U.current,Va(r)?B0(r):(s=fb(m,f,c),r.stateNode=s,$l(r))}return dn(r),null;case 5:if(ue(r),m=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==f&&$l(r);else{if(!f){if(r.stateNode===null)throw Error(l(166));return dn(r),null}if(x=U.current,Va(r))B0(r);else{var k=Yc(Ee.current);switch(x){case 1:x=k.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:x=k.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":x=k.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":x=k.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":x=k.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof f.is=="string"?k.createElement("select",{is:f.is}):k.createElement("select"),f.multiple?x.multiple=!0:f.size&&(x.size=f.size);break;default:x=typeof f.is=="string"?k.createElement(m,{is:f.is}):k.createElement(m)}}x[ye]=r,x[be]=f;e:for(k=r.child;k!==null;){if(k.tag===5||k.tag===6)x.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===r)break e;for(;k.sibling===null;){if(k.return===null||k.return===r)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}r.stateNode=x;e:switch(Wn(x,m,f),m){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&$l(r)}}return dn(r),Kf(r,r.type,s===null?null:s.memoizedProps,r.pendingProps,c),null;case 6:if(s&&r.stateNode!=null)s.memoizedProps!==f&&$l(r);else{if(typeof f!="string"&&r.stateNode===null)throw Error(l(166));if(s=Ee.current,Va(r)){if(s=r.stateNode,c=r.memoizedProps,f=null,m=Jn,m!==null)switch(m.tag){case 27:case 5:f=m.memoizedProps}s[ye]=r,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||tb(s.nodeValue,c)),s||dr(r,!0)}else s=Yc(s).createTextNode(f),s[ye]=r,r.stateNode=s}return dn(r),null;case 31:if(c=r.memoizedState,s===null||s.memoizedState!==null){if(f=Va(r),c!==null){if(s===null){if(!f)throw Error(l(318));if(s=r.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(l(557));s[ye]=r}else ra(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;dn(r),s=!1}else c=tf(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return r.flags&256?(_s(r),r):(_s(r),null);if((r.flags&128)!==0)throw Error(l(558))}return dn(r),null;case 13:if(f=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(m=Va(r),f!==null&&f.dehydrated!==null){if(s===null){if(!m)throw Error(l(318));if(m=r.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(l(317));m[ye]=r}else ra(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;dn(r),m=!1}else m=tf(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=m),m=!0;if(!m)return r.flags&256?(_s(r),r):(_s(r),null)}return _s(r),(r.flags&128)!==0?(r.lanes=c,r):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=r.child,m=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(m=f.alternate.memoizedState.cachePool.pool),x=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(x=f.memoizedState.cachePool.pool),x!==m&&(f.flags|=2048)),c!==s&&c&&(r.child.flags|=8192),Rc(r,r.updateQueue),dn(r),null);case 4:return P(),s===null&&ph(r.stateNode.containerInfo),dn(r),null;case 10:return _l(r.type),dn(r),null;case 19:if(te(An),f=r.memoizedState,f===null)return dn(r),null;if(m=(r.flags&128)!==0,x=f.rendering,x===null)if(m)Qi(f,!1);else{if(wn!==0||s!==null&&(s.flags&128)!==0)for(s=r.child;s!==null;){if(x=vc(s),x!==null){for(r.flags|=128,Qi(f,!1),s=x.updateQueue,r.updateQueue=s,Rc(r,s),r.subtreeFlags=0,s=c,c=r.child;c!==null;)R0(c,s),c=c.sibling;return ke(An,An.current&1|2),Lt&&zl(r,f.treeForkCount),r.child}s=s.sibling}f.tail!==null&&fe()>Bc&&(r.flags|=128,m=!0,Qi(f,!1),r.lanes=4194304)}else{if(!m)if(s=vc(x),s!==null){if(r.flags|=128,m=!0,s=s.updateQueue,r.updateQueue=s,Rc(r,s),Qi(f,!0),f.tail===null&&f.tailMode==="hidden"&&!x.alternate&&!Lt)return dn(r),null}else 2*fe()-f.renderingStartTime>Bc&&c!==536870912&&(r.flags|=128,m=!0,Qi(f,!1),r.lanes=4194304);f.isBackwards?(x.sibling=r.child,r.child=x):(s=f.last,s!==null?s.sibling=x:r.child=x,f.last=x)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=fe(),s.sibling=null,c=An.current,ke(An,m?c&1|2:c&1),Lt&&zl(r,f.treeForkCount),s):(dn(r),null);case 22:case 23:return _s(r),mf(),f=r.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(r.flags|=8192):f&&(r.flags|=8192),f?(c&536870912)!==0&&(r.flags&128)===0&&(dn(r),r.subtreeFlags&6&&(r.flags|=8192)):dn(r),c=r.updateQueue,c!==null&&Rc(r,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(f=r.memoizedState.cachePool.pool),f!==c&&(r.flags|=2048),s!==null&&te(oa),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),_l(In),dn(r),null;case 25:return null;case 30:return null}throw Error(l(156,r.tag))}function tw(s,r){switch(Wu(r),r.tag){case 1:return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return _l(In),P(),s=r.flags,(s&65536)!==0&&(s&128)===0?(r.flags=s&-65537|128,r):null;case 26:case 27:case 5:return ue(r),null;case 31:if(r.memoizedState!==null){if(_s(r),r.alternate===null)throw Error(l(340));ra()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 13:if(_s(r),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(l(340));ra()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return te(An),null;case 4:return P(),null;case 10:return _l(r.type),null;case 22:case 23:return _s(r),mf(),s!==null&&te(oa),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 24:return _l(In),null;case 25:return null;default:return null}}function ax(s,r){switch(Wu(r),r.tag){case 3:_l(In),P();break;case 26:case 27:case 5:ue(r);break;case 4:P();break;case 31:r.memoizedState!==null&&_s(r);break;case 13:_s(r);break;case 19:te(An);break;case 10:_l(r.type);break;case 22:case 23:_s(r),mf(),s!==null&&te(oa);break;case 24:_l(In)}}function Zi(s,r){try{var c=r.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var m=f.next;c=m;do{if((c.tag&s)===s){f=void 0;var x=c.create,k=c.inst;f=x(),k.destroy=f}c=c.next}while(c!==m)}}catch(M){Wt(r,r.return,M)}}function xr(s,r,c){try{var f=r.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var x=m.next;f=x;do{if((f.tag&s)===s){var k=f.inst,M=k.destroy;if(M!==void 0){k.destroy=void 0,m=r;var K=c,ce=M;try{ce()}catch(je){Wt(m,K,je)}}}f=f.next}while(f!==x)}}catch(je){Wt(r,r.return,je)}}function ix(s){var r=s.updateQueue;if(r!==null){var c=s.stateNode;try{Q0(r,c)}catch(f){Wt(s,s.return,f)}}}function ox(s,r,c){c.props=ha(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){Wt(s,r,f)}}function Wi(s,r){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(m){Wt(s,r,m)}}function Sl(s,r){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(m){Wt(s,r,m)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(m){Wt(s,r,m)}else c.current=null}function cx(s){var r=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(m){Wt(s,s.return,m)}}function Gf(s,r,c){try{var f=s.stateNode;ww(f,s.type,c,r),f[be]=r}catch(m){Wt(s,s.return,m)}}function dx(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Sr(s.type)||s.tag===4}function Yf(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||dx(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Sr(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Xf(s,r,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,r?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,r):(r=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,r.appendChild(s),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=rn));else if(f!==4&&(f===27&&Sr(s.type)&&(c=s.stateNode,r=null),s=s.child,s!==null))for(Xf(s,r,c),s=s.sibling;s!==null;)Xf(s,r,c),s=s.sibling}function Ic(s,r,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,r?c.insertBefore(s,r):c.appendChild(s);else if(f!==4&&(f===27&&Sr(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(Ic(s,r,c),s=s.sibling;s!==null;)Ic(s,r,c),s=s.sibling}function ux(s){var r=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,m=r.attributes;m.length;)r.removeAttributeNode(m[0]);Wn(r,f,c),r[ye]=s,r[be]=c}catch(x){Wt(s,s.return,x)}}var Ul=!1,_n=!1,Jf=!1,fx=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function nw(s,r){if(s=s.containerInfo,xh=td,s=S0(s),Uu(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var m=f.anchorOffset,x=f.focusNode;f=f.focusOffset;try{c.nodeType,x.nodeType}catch{c=null;break e}var k=0,M=-1,K=-1,ce=0,je=0,De=s,he=null;t:for(;;){for(var Ne;De!==c||m!==0&&De.nodeType!==3||(M=k+m),De!==x||f!==0&&De.nodeType!==3||(K=k+f),De.nodeType===3&&(k+=De.nodeValue.length),(Ne=De.firstChild)!==null;)he=De,De=Ne;for(;;){if(De===s)break t;if(he===c&&++ce===m&&(M=k),he===x&&++je===f&&(K=k),(Ne=De.nextSibling)!==null)break;De=he,he=De.parentNode}De=Ne}c=M===-1||K===-1?null:{start:M,end:K}}else c=null}c=c||{start:0,end:0}}else c=null;for(bh={focusedElem:s,selectionRange:c},td=!1,Fn=r;Fn!==null;)if(r=Fn,s=r.child,(r.subtreeFlags&1028)!==0&&s!==null)s.return=r,Fn=s;else for(;Fn!==null;){switch(r=Fn,x=r.alternate,s=r.flags,r.tag){case 0:if((s&4)!==0&&(s=r.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)m=s[c],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&x!==null){s=void 0,c=r,m=x.memoizedProps,x=x.memoizedState,f=c.stateNode;try{var We=ha(c.type,m);s=f.getSnapshotBeforeUpdate(We,x),f.__reactInternalSnapshotBeforeUpdate=s}catch(ut){Wt(c,c.return,ut)}}break;case 3:if((s&1024)!==0){if(s=r.stateNode.containerInfo,c=s.nodeType,c===9)Nh(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Nh(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(l(163))}if(s=r.sibling,s!==null){s.return=r.return,Fn=s;break}Fn=r.return}}function hx(s,r,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ql(s,c),f&4&&Zi(5,c);break;case 1:if(ql(s,c),f&4)if(s=c.stateNode,r===null)try{s.componentDidMount()}catch(k){Wt(c,c.return,k)}else{var m=ha(c.type,r.memoizedProps);r=r.memoizedState;try{s.componentDidUpdate(m,r,s.__reactInternalSnapshotBeforeUpdate)}catch(k){Wt(c,c.return,k)}}f&64&&ix(c),f&512&&Wi(c,c.return);break;case 3:if(ql(s,c),f&64&&(s=c.updateQueue,s!==null)){if(r=null,c.child!==null)switch(c.child.tag){case 27:case 5:r=c.child.stateNode;break;case 1:r=c.child.stateNode}try{Q0(s,r)}catch(k){Wt(c,c.return,k)}}break;case 27:r===null&&f&4&&ux(c);case 26:case 5:ql(s,c),r===null&&f&4&&cx(c),f&512&&Wi(c,c.return);break;case 12:ql(s,c);break;case 31:ql(s,c),f&4&&gx(s,c);break;case 13:ql(s,c),f&4&&xx(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=uw.bind(null,c),Dw(s,c))));break;case 22:if(f=c.memoizedState!==null||Ul,!f){r=r!==null&&r.memoizedState!==null||_n,m=Ul;var x=_n;Ul=f,(_n=r)&&!x?Fl(s,c,(c.subtreeFlags&8772)!==0):ql(s,c),Ul=m,_n=x}break;case 30:break;default:ql(s,c)}}function px(s){var r=s.alternate;r!==null&&(s.alternate=null,px(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&rs(r)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var hn=null,Cs=!1;function Vl(s,r,c){for(c=c.child;c!==null;)mx(s,r,c),c=c.sibling}function mx(s,r,c){if(oe&&typeof oe.onCommitFiberUnmount=="function")try{oe.onCommitFiberUnmount(ee,c)}catch{}switch(c.tag){case 26:_n||Sl(c,r),Vl(s,r,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Sl(c,r);var f=hn,m=Cs;Sr(c.type)&&(hn=c.stateNode,Cs=!1),Vl(s,r,c),oo(c.stateNode),hn=f,Cs=m;break;case 5:_n||Sl(c,r);case 6:if(f=hn,m=Cs,hn=null,Vl(s,r,c),hn=f,Cs=m,hn!==null)if(Cs)try{(hn.nodeType===9?hn.body:hn.nodeName==="HTML"?hn.ownerDocument.body:hn).removeChild(c.stateNode)}catch(x){Wt(c,r,x)}else try{hn.removeChild(c.stateNode)}catch(x){Wt(c,r,x)}break;case 18:hn!==null&&(Cs?(s=hn,ib(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),di(s)):ib(hn,c.stateNode));break;case 4:f=hn,m=Cs,hn=c.stateNode.containerInfo,Cs=!0,Vl(s,r,c),hn=f,Cs=m;break;case 0:case 11:case 14:case 15:xr(2,c,r),_n||xr(4,c,r),Vl(s,r,c);break;case 1:_n||(Sl(c,r),f=c.stateNode,typeof f.componentWillUnmount=="function"&&ox(c,r,f)),Vl(s,r,c);break;case 21:Vl(s,r,c);break;case 22:_n=(f=_n)||c.memoizedState!==null,Vl(s,r,c),_n=f;break;default:Vl(s,r,c)}}function gx(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{di(s)}catch(c){Wt(r,r.return,c)}}}function xx(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{di(s)}catch(c){Wt(r,r.return,c)}}function sw(s){switch(s.tag){case 31:case 13:case 19:var r=s.stateNode;return r===null&&(r=s.stateNode=new fx),r;case 22:return s=s.stateNode,r=s._retryCache,r===null&&(r=s._retryCache=new fx),r;default:throw Error(l(435,s.tag))}}function zc(s,r){var c=sw(s);r.forEach(function(f){if(!c.has(f)){c.add(f);var m=fw.bind(null,s,f);f.then(m,m)}})}function Es(s,r){var c=r.deletions;if(c!==null)for(var f=0;f<c.length;f++){var m=c[f],x=s,k=r,M=k;e:for(;M!==null;){switch(M.tag){case 27:if(Sr(M.type)){hn=M.stateNode,Cs=!1;break e}break;case 5:hn=M.stateNode,Cs=!1;break e;case 3:case 4:hn=M.stateNode.containerInfo,Cs=!0;break e}M=M.return}if(hn===null)throw Error(l(160));mx(x,k,m),hn=null,Cs=!1,x=m.alternate,x!==null&&(x.return=null),m.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)bx(r,s),r=r.sibling}var pl=null;function bx(s,r){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Es(r,s),Ms(s),f&4&&(xr(3,s,s.return),Zi(3,s),xr(5,s,s.return));break;case 1:Es(r,s),Ms(s),f&512&&(_n||c===null||Sl(c,c.return)),f&64&&Ul&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var m=pl;if(Es(r,s),Ms(s),f&512&&(_n||c===null||Sl(c,c.return)),f&4){var x=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,m=m.ownerDocument||m;t:switch(f){case"title":x=m.getElementsByTagName("title")[0],(!x||x[Ss]||x[ye]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=m.createElement(f),m.head.insertBefore(x,m.querySelector("head > title"))),Wn(x,f,c),x[ye]=s,Mt(x),f=x;break e;case"link":var k=bb("link","href",m).get(f+(c.href||""));if(k){for(var M=0;M<k.length;M++)if(x=k[M],x.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&x.getAttribute("rel")===(c.rel==null?null:c.rel)&&x.getAttribute("title")===(c.title==null?null:c.title)&&x.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){k.splice(M,1);break t}}x=m.createElement(f),Wn(x,f,c),m.head.appendChild(x);break;case"meta":if(k=bb("meta","content",m).get(f+(c.content||""))){for(M=0;M<k.length;M++)if(x=k[M],x.getAttribute("content")===(c.content==null?null:""+c.content)&&x.getAttribute("name")===(c.name==null?null:c.name)&&x.getAttribute("property")===(c.property==null?null:c.property)&&x.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&x.getAttribute("charset")===(c.charSet==null?null:c.charSet)){k.splice(M,1);break t}}x=m.createElement(f),Wn(x,f,c),m.head.appendChild(x);break;default:throw Error(l(468,f))}x[ye]=s,Mt(x),f=x}s.stateNode=f}else yb(m,s.type,s.stateNode);else s.stateNode=xb(m,f,s.memoizedProps);else x!==f?(x===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):x.count--,f===null?yb(m,s.type,s.stateNode):xb(m,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Gf(s,s.memoizedProps,c.memoizedProps)}break;case 27:Es(r,s),Ms(s),f&512&&(_n||c===null||Sl(c,c.return)),c!==null&&f&4&&Gf(s,s.memoizedProps,c.memoizedProps);break;case 5:if(Es(r,s),Ms(s),f&512&&(_n||c===null||Sl(c,c.return)),s.flags&32){m=s.stateNode;try{Oe(m,"")}catch(We){Wt(s,s.return,We)}}f&4&&s.stateNode!=null&&(m=s.memoizedProps,Gf(s,m,c!==null?c.memoizedProps:m)),f&1024&&(Jf=!0);break;case 6:if(Es(r,s),Ms(s),f&4){if(s.stateNode===null)throw Error(l(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(We){Wt(s,s.return,We)}}break;case 3:if(Qc=null,m=pl,pl=Xc(r.containerInfo),Es(r,s),pl=m,Ms(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{di(r.containerInfo)}catch(We){Wt(s,s.return,We)}Jf&&(Jf=!1,yx(s));break;case 4:f=pl,pl=Xc(s.stateNode.containerInfo),Es(r,s),Ms(s),pl=f;break;case 12:Es(r,s),Ms(s);break;case 31:Es(r,s),Ms(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,zc(s,f)));break;case 13:Es(r,s),Ms(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(_c=fe()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,zc(s,f)));break;case 22:m=s.memoizedState!==null;var K=c!==null&&c.memoizedState!==null,ce=Ul,je=_n;if(Ul=ce||m,_n=je||K,Es(r,s),_n=je,Ul=ce,Ms(s),f&8192)e:for(r=s.stateNode,r._visibility=m?r._visibility&-2:r._visibility|1,m&&(c===null||K||Ul||_n||pa(s)),c=null,r=s;;){if(r.tag===5||r.tag===26){if(c===null){K=c=r;try{if(x=K.stateNode,m)k=x.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{M=K.stateNode;var De=K.memoizedProps.style,he=De!=null&&De.hasOwnProperty("display")?De.display:null;M.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(We){Wt(K,K.return,We)}}}else if(r.tag===6){if(c===null){K=r;try{K.stateNode.nodeValue=m?"":K.memoizedProps}catch(We){Wt(K,K.return,We)}}}else if(r.tag===18){if(c===null){K=r;try{var Ne=K.stateNode;m?ob(Ne,!0):ob(K.stateNode,!1)}catch(We){Wt(K,K.return,We)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===s)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;c===r&&(c=null),r=r.return}c===r&&(c=null),r.sibling.return=r.return,r=r.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,zc(s,c))));break;case 19:Es(r,s),Ms(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,zc(s,f)));break;case 30:break;case 21:break;default:Es(r,s),Ms(s)}}function Ms(s){var r=s.flags;if(r&2){try{for(var c,f=s.return;f!==null;){if(dx(f)){c=f;break}f=f.return}if(c==null)throw Error(l(160));switch(c.tag){case 27:var m=c.stateNode,x=Yf(s);Ic(s,x,m);break;case 5:var k=c.stateNode;c.flags&32&&(Oe(k,""),c.flags&=-33);var M=Yf(s);Ic(s,M,k);break;case 3:case 4:var K=c.stateNode.containerInfo,ce=Yf(s);Xf(s,ce,K);break;default:throw Error(l(161))}}catch(je){Wt(s,s.return,je)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function yx(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var r=s;yx(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),s=s.sibling}}function ql(s,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)hx(s,r.alternate,r),r=r.sibling}function pa(s){for(s=s.child;s!==null;){var r=s;switch(r.tag){case 0:case 11:case 14:case 15:xr(4,r,r.return),pa(r);break;case 1:Sl(r,r.return);var c=r.stateNode;typeof c.componentWillUnmount=="function"&&ox(r,r.return,c),pa(r);break;case 27:oo(r.stateNode);case 26:case 5:Sl(r,r.return),pa(r);break;case 22:r.memoizedState===null&&pa(r);break;case 30:pa(r);break;default:pa(r)}s=s.sibling}}function Fl(s,r,c){for(c=c&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var f=r.alternate,m=s,x=r,k=x.flags;switch(x.tag){case 0:case 11:case 15:Fl(m,x,c),Zi(4,x);break;case 1:if(Fl(m,x,c),f=x,m=f.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(ce){Wt(f,f.return,ce)}if(f=x,m=f.updateQueue,m!==null){var M=f.stateNode;try{var K=m.shared.hiddenCallbacks;if(K!==null)for(m.shared.hiddenCallbacks=null,m=0;m<K.length;m++)J0(K[m],M)}catch(ce){Wt(f,f.return,ce)}}c&&k&64&&ix(x),Wi(x,x.return);break;case 27:ux(x);case 26:case 5:Fl(m,x,c),c&&f===null&&k&4&&cx(x),Wi(x,x.return);break;case 12:Fl(m,x,c);break;case 31:Fl(m,x,c),c&&k&4&&gx(m,x);break;case 13:Fl(m,x,c),c&&k&4&&xx(m,x);break;case 22:x.memoizedState===null&&Fl(m,x,c),Wi(x,x.return);break;case 30:break;default:Fl(m,x,c)}r=r.sibling}}function Qf(s,r){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Pi(c))}function Zf(s,r){s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Pi(s))}function ml(s,r,c,f){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)vx(s,r,c,f),r=r.sibling}function vx(s,r,c,f){var m=r.flags;switch(r.tag){case 0:case 11:case 15:ml(s,r,c,f),m&2048&&Zi(9,r);break;case 1:ml(s,r,c,f);break;case 3:ml(s,r,c,f),m&2048&&(s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Pi(s)));break;case 12:if(m&2048){ml(s,r,c,f),s=r.stateNode;try{var x=r.memoizedProps,k=x.id,M=x.onPostCommit;typeof M=="function"&&M(k,r.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(K){Wt(r,r.return,K)}}else ml(s,r,c,f);break;case 31:ml(s,r,c,f);break;case 13:ml(s,r,c,f);break;case 23:break;case 22:x=r.stateNode,k=r.alternate,r.memoizedState!==null?x._visibility&2?ml(s,r,c,f):eo(s,r):x._visibility&2?ml(s,r,c,f):(x._visibility|=2,Wa(s,r,c,f,(r.subtreeFlags&10256)!==0||!1)),m&2048&&Qf(k,r);break;case 24:ml(s,r,c,f),m&2048&&Zf(r.alternate,r);break;default:ml(s,r,c,f)}}function Wa(s,r,c,f,m){for(m=m&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var x=s,k=r,M=c,K=f,ce=k.flags;switch(k.tag){case 0:case 11:case 15:Wa(x,k,M,K,m),Zi(8,k);break;case 23:break;case 22:var je=k.stateNode;k.memoizedState!==null?je._visibility&2?Wa(x,k,M,K,m):eo(x,k):(je._visibility|=2,Wa(x,k,M,K,m)),m&&ce&2048&&Qf(k.alternate,k);break;case 24:Wa(x,k,M,K,m),m&&ce&2048&&Zf(k.alternate,k);break;default:Wa(x,k,M,K,m)}r=r.sibling}}function eo(s,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var c=s,f=r,m=f.flags;switch(f.tag){case 22:eo(c,f),m&2048&&Qf(f.alternate,f);break;case 24:eo(c,f),m&2048&&Zf(f.alternate,f);break;default:eo(c,f)}r=r.sibling}}var to=8192;function ei(s,r,c){if(s.subtreeFlags&to)for(s=s.child;s!==null;)Nx(s,r,c),s=s.sibling}function Nx(s,r,c){switch(s.tag){case 26:ei(s,r,c),s.flags&to&&s.memoizedState!==null&&Vw(c,pl,s.memoizedState,s.memoizedProps);break;case 5:ei(s,r,c);break;case 3:case 4:var f=pl;pl=Xc(s.stateNode.containerInfo),ei(s,r,c),pl=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=to,to=16777216,ei(s,r,c),to=f):ei(s,r,c));break;default:ei(s,r,c)}}function kx(s){var r=s.alternate;if(r!==null&&(s=r.child,s!==null)){r.child=null;do r=s.sibling,s.sibling=null,s=r;while(s!==null)}}function no(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];Fn=f,Sx(f,s)}kx(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)wx(s),s=s.sibling}function wx(s){switch(s.tag){case 0:case 11:case 15:no(s),s.flags&2048&&xr(9,s,s.return);break;case 3:no(s);break;case 12:no(s);break;case 22:var r=s.stateNode;s.memoizedState!==null&&r._visibility&2&&(s.return===null||s.return.tag!==13)?(r._visibility&=-3,Lc(s)):no(s);break;default:no(s)}}function Lc(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];Fn=f,Sx(f,s)}kx(s)}for(s=s.child;s!==null;){switch(r=s,r.tag){case 0:case 11:case 15:xr(8,r,r.return),Lc(r);break;case 22:c=r.stateNode,c._visibility&2&&(c._visibility&=-3,Lc(r));break;default:Lc(r)}s=s.sibling}}function Sx(s,r){for(;Fn!==null;){var c=Fn;switch(c.tag){case 0:case 11:case 15:xr(8,c,r);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Pi(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Fn=f;else e:for(c=s;Fn!==null;){f=Fn;var m=f.sibling,x=f.return;if(px(f),f===c){Fn=null;break e}if(m!==null){m.return=x,Fn=m;break e}Fn=x}}}var lw={getCacheForType:function(s){var r=Qn(In),c=r.data.get(s);return c===void 0&&(c=s(),r.data.set(s,c)),c},cacheSignal:function(){return Qn(In).controller.signal}},rw=typeof WeakMap=="function"?WeakMap:Map,Kt=0,an=null,Tt=null,Rt=0,Zt=0,Bs=null,br=!1,ti=!1,Wf=!1,Kl=0,wn=0,yr=0,ma=0,eh=0,Ps=0,ni=0,so=null,As=null,th=!1,_c=0,jx=0,Bc=1/0,Pc=null,vr=null,Un=0,Nr=null,si=null,Gl=0,nh=0,sh=null,Cx=null,lo=0,lh=null;function Hs(){return(Kt&2)!==0&&Rt!==0?Rt&-Rt:w.T!==null?dh():ls()}function Ex(){if(Ps===0)if((Rt&536870912)===0||Lt){var s=bn;bn<<=1,(bn&3932160)===0&&(bn=262144),Ps=s}else Ps=536870912;return s=Ls.current,s!==null&&(s.flags|=32),Ps}function Ts(s,r,c){(s===an&&(Zt===2||Zt===9)||s.cancelPendingCommit!==null)&&(li(s,0),kr(s,Rt,Ps,!1)),Yt(s,c),((Kt&2)===0||s!==an)&&(s===an&&((Kt&2)===0&&(ma|=c),wn===4&&kr(s,Rt,Ps,!1)),jl(s))}function Mx(s,r,c){if((Kt&6)!==0)throw Error(l(327));var f=!c&&(r&127)===0&&(r&s.expiredLanes)===0||Re(s,r),m=f?ow(s,r):ah(s,r,!0),x=f;do{if(m===0){ti&&!f&&kr(s,r,0,!1);break}else{if(c=s.current.alternate,x&&!aw(c)){m=ah(s,r,!1),x=!1;continue}if(m===2){if(x=r,s.errorRecoveryDisabledLanes&x)var k=0;else k=s.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){r=k;e:{var M=s;m=so;var K=M.current.memoizedState.isDehydrated;if(K&&(li(M,k).flags|=256),k=ah(M,k,!1),k!==2){if(Wf&&!K){M.errorRecoveryDisabledLanes|=x,ma|=x,m=4;break e}x=As,As=m,x!==null&&(As===null?As=x:As.push.apply(As,x))}m=k}if(x=!1,m!==2)continue}}if(m===1){li(s,0),kr(s,r,0,!0);break}e:{switch(f=s,x=m,x){case 0:case 1:throw Error(l(345));case 4:if((r&4194048)!==r)break;case 6:kr(f,r,Ps,!br);break e;case 2:As=null;break;case 3:case 5:break;default:throw Error(l(329))}if((r&62914560)===r&&(m=_c+300-fe(),10<m)){if(kr(f,r,Ps,!br),Gs(f,0,!0)!==0)break e;Gl=r,f.timeoutHandle=rb(Ax.bind(null,f,c,As,Pc,th,r,Ps,ma,ni,br,x,"Throttled",-0,0),m);break e}Ax(f,c,As,Pc,th,r,Ps,ma,ni,br,x,null,-0,0)}}break}while(!0);jl(s)}function Ax(s,r,c,f,m,x,k,M,K,ce,je,De,he,Ne){if(s.timeoutHandle=-1,De=r.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rn},Nx(r,x,De);var We=(x&62914560)===x?_c-fe():(x&4194048)===x?jx-fe():0;if(We=qw(De,We),We!==null){Gl=x,s.cancelPendingCommit=We(_x.bind(null,s,r,x,c,f,m,k,M,K,je,De,null,he,Ne)),kr(s,x,k,!ce);return}}_x(s,r,x,c,f,m,k,M,K)}function aw(s){for(var r=s;;){var c=r.tag;if((c===0||c===11||c===15)&&r.flags&16384&&(c=r.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var m=c[f],x=m.getSnapshot;m=m.value;try{if(!Is(x(),m))return!1}catch{return!1}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function kr(s,r,c,f){r&=~eh,r&=~ma,s.suspendedLanes|=r,s.pingedLanes&=~r,f&&(s.warmLanes|=r),f=s.expirationTimes;for(var m=r;0<m;){var x=31-$e(m),k=1<<x;f[x]=-1,m&=~k}c!==0&&$n(s,c,r)}function Hc(){return(Kt&6)===0?(ro(0),!1):!0}function rh(){if(Tt!==null){if(Zt===0)var s=Tt.return;else s=Tt,Ll=aa=null,Nf(s),Ya=null,$i=0,s=Tt;for(;s!==null;)ax(s.alternate,s),s=s.return;Tt=null}}function li(s,r){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,Cw(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),Gl=0,rh(),an=s,Tt=c=Il(s.current,null),Rt=r,Zt=0,Bs=null,br=!1,ti=Re(s,r),Wf=!1,ni=Ps=eh=ma=yr=wn=0,As=so=null,th=!1,(r&8)!==0&&(r|=r&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=r;0<f;){var m=31-$e(f),x=1<<m;r|=s[m],f&=~x}return Kl=r,ic(),c}function Tx(s,r){kt=null,w.H=Xi,r===Ga||r===mc?(r=K0(),Zt=3):r===cf?(r=K0(),Zt=4):Zt=r===_f?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Bs=r,Tt===null&&(wn=1,Ac(s,Zs(r,s.current)))}function Dx(){var s=Ls.current;return s===null?!0:(Rt&4194048)===Rt?nl===null:(Rt&62914560)===Rt||(Rt&536870912)!==0?s===nl:!1}function Ox(){var s=w.H;return w.H=Xi,s===null?Xi:s}function Rx(){var s=w.A;return w.A=lw,s}function $c(){wn=4,br||(Rt&4194048)!==Rt&&Ls.current!==null||(ti=!0),(yr&134217727)===0&&(ma&134217727)===0||an===null||kr(an,Rt,Ps,!1)}function ah(s,r,c){var f=Kt;Kt|=2;var m=Ox(),x=Rx();(an!==s||Rt!==r)&&(Pc=null,li(s,r)),r=!1;var k=wn;e:do try{if(Zt!==0&&Tt!==null){var M=Tt,K=Bs;switch(Zt){case 8:rh(),k=6;break e;case 3:case 2:case 9:case 6:Ls.current===null&&(r=!0);var ce=Zt;if(Zt=0,Bs=null,ri(s,M,K,ce),c&&ti){k=0;break e}break;default:ce=Zt,Zt=0,Bs=null,ri(s,M,K,ce)}}iw(),k=wn;break}catch(je){Tx(s,je)}while(!0);return r&&s.shellSuspendCounter++,Ll=aa=null,Kt=f,w.H=m,w.A=x,Tt===null&&(an=null,Rt=0,ic()),k}function iw(){for(;Tt!==null;)Ix(Tt)}function ow(s,r){var c=Kt;Kt|=2;var f=Ox(),m=Rx();an!==s||Rt!==r?(Pc=null,Bc=fe()+500,li(s,r)):ti=Re(s,r);e:do try{if(Zt!==0&&Tt!==null){r=Tt;var x=Bs;t:switch(Zt){case 1:Zt=0,Bs=null,ri(s,r,x,1);break;case 2:case 9:if(q0(x)){Zt=0,Bs=null,zx(r);break}r=function(){Zt!==2&&Zt!==9||an!==s||(Zt=7),jl(s)},x.then(r,r);break e;case 3:Zt=7;break e;case 4:Zt=5;break e;case 7:q0(x)?(Zt=0,Bs=null,zx(r)):(Zt=0,Bs=null,ri(s,r,x,7));break;case 5:var k=null;switch(Tt.tag){case 26:k=Tt.memoizedState;case 5:case 27:var M=Tt;if(k?vb(k):M.stateNode.complete){Zt=0,Bs=null;var K=M.sibling;if(K!==null)Tt=K;else{var ce=M.return;ce!==null?(Tt=ce,Uc(ce)):Tt=null}break t}}Zt=0,Bs=null,ri(s,r,x,5);break;case 6:Zt=0,Bs=null,ri(s,r,x,6);break;case 8:rh(),wn=6;break e;default:throw Error(l(462))}}cw();break}catch(je){Tx(s,je)}while(!0);return Ll=aa=null,w.H=f,w.A=m,Kt=c,Tt!==null?0:(an=null,Rt=0,ic(),wn)}function cw(){for(;Tt!==null&&!bt();)Ix(Tt)}function Ix(s){var r=lx(s.alternate,s,Kl);s.memoizedProps=s.pendingProps,r===null?Uc(s):Tt=r}function zx(s){var r=s,c=r.alternate;switch(r.tag){case 15:case 0:r=Zg(c,r,r.pendingProps,r.type,void 0,Rt);break;case 11:r=Zg(c,r,r.pendingProps,r.type.render,r.ref,Rt);break;case 5:Nf(r);default:ax(c,r),r=Tt=R0(r,Kl),r=lx(c,r,Kl)}s.memoizedProps=s.pendingProps,r===null?Uc(s):Tt=r}function ri(s,r,c,f){Ll=aa=null,Nf(r),Ya=null,$i=0;var m=r.return;try{if(Qk(s,m,r,c,Rt)){wn=1,Ac(s,Zs(c,s.current)),Tt=null;return}}catch(x){if(m!==null)throw Tt=m,x;wn=1,Ac(s,Zs(c,s.current)),Tt=null;return}r.flags&32768?(Lt||f===1?s=!0:ti||(Rt&536870912)!==0?s=!1:(br=s=!0,(f===2||f===9||f===3||f===6)&&(f=Ls.current,f!==null&&f.tag===13&&(f.flags|=16384))),Lx(r,s)):Uc(r)}function Uc(s){var r=s;do{if((r.flags&32768)!==0){Lx(r,br);return}s=r.return;var c=ew(r.alternate,r,Kl);if(c!==null){Tt=c;return}if(r=r.sibling,r!==null){Tt=r;return}Tt=r=s}while(r!==null);wn===0&&(wn=5)}function Lx(s,r){do{var c=tw(s.alternate,s);if(c!==null){c.flags&=32767,Tt=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!r&&(s=s.sibling,s!==null)){Tt=s;return}Tt=s=c}while(s!==null);wn=6,Tt=null}function _x(s,r,c,f,m,x,k,M,K){s.cancelPendingCommit=null;do Vc();while(Un!==0);if((Kt&6)!==0)throw Error(l(327));if(r!==null){if(r===s.current)throw Error(l(177));if(x=r.lanes|r.childLanes,x|=Gu,yn(s,c,x,k,M,K),s===an&&(Tt=an=null,Rt=0),si=r,Nr=s,Gl=c,nh=x,sh=m,Cx=f,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,hw(et,function(){return Ux(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||f){f=w.T,w.T=null,m=T.p,T.p=2,k=Kt,Kt|=4;try{nw(s,r,c)}finally{Kt=k,T.p=m,w.T=f}}Un=1,Bx(),Px(),Hx()}}function Bx(){if(Un===1){Un=0;var s=Nr,r=si,c=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||c){c=w.T,w.T=null;var f=T.p;T.p=2;var m=Kt;Kt|=4;try{bx(r,s);var x=bh,k=S0(s.containerInfo),M=x.focusedElem,K=x.selectionRange;if(k!==M&&M&&M.ownerDocument&&w0(M.ownerDocument.documentElement,M)){if(K!==null&&Uu(M)){var ce=K.start,je=K.end;if(je===void 0&&(je=ce),"selectionStart"in M)M.selectionStart=ce,M.selectionEnd=Math.min(je,M.value.length);else{var De=M.ownerDocument||document,he=De&&De.defaultView||window;if(he.getSelection){var Ne=he.getSelection(),We=M.textContent.length,ut=Math.min(K.start,We),ln=K.end===void 0?ut:Math.min(K.end,We);!Ne.extend&&ut>ln&&(k=ln,ln=ut,ut=k);var le=k0(M,ut),W=k0(M,ln);if(le&&W&&(Ne.rangeCount!==1||Ne.anchorNode!==le.node||Ne.anchorOffset!==le.offset||Ne.focusNode!==W.node||Ne.focusOffset!==W.offset)){var ae=De.createRange();ae.setStart(le.node,le.offset),Ne.removeAllRanges(),ut>ln?(Ne.addRange(ae),Ne.extend(W.node,W.offset)):(ae.setEnd(W.node,W.offset),Ne.addRange(ae))}}}}for(De=[],Ne=M;Ne=Ne.parentNode;)Ne.nodeType===1&&De.push({element:Ne,left:Ne.scrollLeft,top:Ne.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<De.length;M++){var Ae=De[M];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}td=!!xh,bh=xh=null}finally{Kt=m,T.p=f,w.T=c}}s.current=r,Un=2}}function Px(){if(Un===2){Un=0;var s=Nr,r=si,c=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||c){c=w.T,w.T=null;var f=T.p;T.p=2;var m=Kt;Kt|=4;try{hx(s,r.alternate,r)}finally{Kt=m,T.p=f,w.T=c}}Un=3}}function Hx(){if(Un===4||Un===3){Un=0,ot();var s=Nr,r=si,c=Gl,f=Cx;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Un=5:(Un=0,si=Nr=null,$x(s,s.pendingLanes));var m=s.pendingLanes;if(m===0&&(vr=null),Ys(c),r=r.stateNode,oe&&typeof oe.onCommitFiberRoot=="function")try{oe.onCommitFiberRoot(ee,r,void 0,(r.current.flags&128)===128)}catch{}if(f!==null){r=w.T,m=T.p,T.p=2,w.T=null;try{for(var x=s.onRecoverableError,k=0;k<f.length;k++){var M=f[k];x(M.value,{componentStack:M.stack})}}finally{w.T=r,T.p=m}}(Gl&3)!==0&&Vc(),jl(s),m=s.pendingLanes,(c&261930)!==0&&(m&42)!==0?s===lh?lo++:(lo=0,lh=s):lo=0,ro(0)}}function $x(s,r){(s.pooledCacheLanes&=r)===0&&(r=s.pooledCache,r!=null&&(s.pooledCache=null,Pi(r)))}function Vc(){return Bx(),Px(),Hx(),Ux()}function Ux(){if(Un!==5)return!1;var s=Nr,r=nh;nh=0;var c=Ys(Gl),f=w.T,m=T.p;try{T.p=32>c?32:c,w.T=null,c=sh,sh=null;var x=Nr,k=Gl;if(Un=0,si=Nr=null,Gl=0,(Kt&6)!==0)throw Error(l(331));var M=Kt;if(Kt|=4,wx(x.current),vx(x,x.current,k,c),Kt=M,ro(0,!1),oe&&typeof oe.onPostCommitFiberRoot=="function")try{oe.onPostCommitFiberRoot(ee,x)}catch{}return!0}finally{T.p=m,w.T=f,$x(s,r)}}function Vx(s,r,c){r=Zs(c,r),r=Lf(s.stateNode,r,2),s=pr(s,r,2),s!==null&&(Yt(s,2),jl(s))}function Wt(s,r,c){if(s.tag===3)Vx(s,s,c);else for(;r!==null;){if(r.tag===3){Vx(r,s,c);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(vr===null||!vr.has(f))){s=Zs(c,s),c=qg(2),f=pr(r,c,2),f!==null&&(Fg(c,f,r,s),Yt(f,2),jl(f));break}}r=r.return}}function ih(s,r,c){var f=s.pingCache;if(f===null){f=s.pingCache=new rw;var m=new Set;f.set(r,m)}else m=f.get(r),m===void 0&&(m=new Set,f.set(r,m));m.has(c)||(Wf=!0,m.add(c),s=dw.bind(null,s,r,c),r.then(s,s))}function dw(s,r,c){var f=s.pingCache;f!==null&&f.delete(r),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,an===s&&(Rt&c)===c&&(wn===4||wn===3&&(Rt&62914560)===Rt&&300>fe()-_c?(Kt&2)===0&&li(s,0):eh|=c,ni===Rt&&(ni=0)),jl(s)}function qx(s,r){r===0&&(r=Jt()),s=sa(s,r),s!==null&&(Yt(s,r),jl(s))}function uw(s){var r=s.memoizedState,c=0;r!==null&&(c=r.retryLane),qx(s,c)}function fw(s,r){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,m=s.memoizedState;m!==null&&(c=m.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(l(314))}f!==null&&f.delete(r),qx(s,c)}function hw(s,r){return xt(s,r)}var qc=null,ai=null,oh=!1,Fc=!1,ch=!1,wr=0;function jl(s){s!==ai&&s.next===null&&(ai===null?qc=ai=s:ai=ai.next=s),Fc=!0,oh||(oh=!0,mw())}function ro(s,r){if(!ch&&Fc){ch=!0;do for(var c=!1,f=qc;f!==null;){if(s!==0){var m=f.pendingLanes;if(m===0)var x=0;else{var k=f.suspendedLanes,M=f.pingedLanes;x=(1<<31-$e(42|s)+1)-1,x&=m&~(k&~M),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(c=!0,Yx(f,x))}else x=Rt,x=Gs(f,f===an?x:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(x&3)===0||Re(f,x)||(c=!0,Yx(f,x));f=f.next}while(c);ch=!1}}function pw(){Fx()}function Fx(){Fc=oh=!1;var s=0;wr!==0&&jw()&&(s=wr);for(var r=fe(),c=null,f=qc;f!==null;){var m=f.next,x=Kx(f,r);x===0?(f.next=null,c===null?qc=m:c.next=m,m===null&&(ai=c)):(c=f,(s!==0||(x&3)!==0)&&(Fc=!0)),f=m}Un!==0&&Un!==5||ro(s),wr!==0&&(wr=0)}function Kx(s,r){for(var c=s.suspendedLanes,f=s.pingedLanes,m=s.expirationTimes,x=s.pendingLanes&-62914561;0<x;){var k=31-$e(x),M=1<<k,K=m[k];K===-1?((M&c)===0||(M&f)!==0)&&(m[k]=Le(M,r)):K<=r&&(s.expiredLanes|=M),x&=~M}if(r=an,c=Rt,c=Gs(s,s===r?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===r&&(Zt===2||Zt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&lt(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Re(s,c)){if(r=c&-c,r===s.callbackPriority)return r;switch(f!==null&&lt(f),Ys(c)){case 2:case 8:c=He;break;case 32:c=et;break;case 268435456:c=rt;break;default:c=et}return f=Gx.bind(null,s),c=xt(c,f),s.callbackPriority=r,s.callbackNode=c,r}return f!==null&&f!==null&&lt(f),s.callbackPriority=2,s.callbackNode=null,2}function Gx(s,r){if(Un!==0&&Un!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Vc()&&s.callbackNode!==c)return null;var f=Rt;return f=Gs(s,s===an?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(Mx(s,f,r),Kx(s,fe()),s.callbackNode!=null&&s.callbackNode===c?Gx.bind(null,s):null)}function Yx(s,r){if(Vc())return null;Mx(s,r,!0)}function mw(){Ew(function(){(Kt&6)!==0?xt(Me,pw):Fx()})}function dh(){if(wr===0){var s=Fa;s===0&&(s=xn,xn<<=1,(xn&261888)===0&&(xn=256)),wr=s}return wr}function Xx(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Pt(""+s)}function Jx(s,r){var c=r.ownerDocument.createElement("input");return c.name=r.name,c.value=r.value,s.id&&c.setAttribute("form",s.id),r.parentNode.insertBefore(c,r),s=new FormData(s),c.parentNode.removeChild(c),s}function gw(s,r,c,f,m){if(r==="submit"&&c&&c.stateNode===m){var x=Xx((m[be]||null).action),k=f.submitter;k&&(r=(r=k[be]||null)?Xx(r.formAction):k.getAttribute("formAction"),r!==null&&(x=r,k=null));var M=new fn("action","action",null,f,m);s.push({event:M,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(wr!==0){var K=k?Jx(m,k):new FormData(m);Tf(c,{pending:!0,data:K,method:m.method,action:x},null,K)}}else typeof x=="function"&&(M.preventDefault(),K=k?Jx(m,k):new FormData(m),Tf(c,{pending:!0,data:K,method:m.method,action:x},x,K))},currentTarget:m}]})}}for(var uh=0;uh<Ku.length;uh++){var fh=Ku[uh],xw=fh.toLowerCase(),bw=fh[0].toUpperCase()+fh.slice(1);hl(xw,"on"+bw)}hl(E0,"onAnimationEnd"),hl(M0,"onAnimationIteration"),hl(A0,"onAnimationStart"),hl("dblclick","onDoubleClick"),hl("focusin","onFocus"),hl("focusout","onBlur"),hl(Ik,"onTransitionRun"),hl(zk,"onTransitionStart"),hl(Lk,"onTransitionCancel"),hl(T0,"onTransitionEnd"),Xs("onMouseEnter",["mouseout","mouseover"]),Xs("onMouseLeave",["mouseout","mouseover"]),Xs("onPointerEnter",["pointerout","pointerover"]),Xs("onPointerLeave",["pointerout","pointerover"]),vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ao="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ao));function Qx(s,r){r=(r&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],m=f.event;f=f.listeners;e:{var x=void 0;if(r)for(var k=f.length-1;0<=k;k--){var M=f[k],K=M.instance,ce=M.currentTarget;if(M=M.listener,K!==x&&m.isPropagationStopped())break e;x=M,m.currentTarget=ce;try{x(m)}catch(je){ac(je)}m.currentTarget=null,x=K}else for(k=0;k<f.length;k++){if(M=f[k],K=M.instance,ce=M.currentTarget,M=M.listener,K!==x&&m.isPropagationStopped())break e;x=M,m.currentTarget=ce;try{x(m)}catch(je){ac(je)}m.currentTarget=null,x=K}}}}function Dt(s,r){var c=r[jt];c===void 0&&(c=r[jt]=new Set);var f=s+"__bubble";c.has(f)||(Zx(r,s,2,!1),c.add(f))}function hh(s,r,c){var f=0;r&&(f|=4),Zx(c,s,f,r)}var Kc="_reactListening"+Math.random().toString(36).slice(2);function ph(s){if(!s[Kc]){s[Kc]=!0,On.forEach(function(c){c!=="selectionchange"&&(yw.has(c)||hh(c,!1,s),hh(c,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[Kc]||(r[Kc]=!0,hh("selectionchange",!1,r))}}function Zx(s,r,c,f){switch(Eb(r)){case 2:var m=Gw;break;case 8:m=Yw;break;default:m=Ah}c=m.bind(null,r,c,s),m=void 0,!Be||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(m=!0),f?m!==void 0?s.addEventListener(r,c,{capture:!0,passive:m}):s.addEventListener(r,c,!0):m!==void 0?s.addEventListener(r,c,{passive:m}):s.addEventListener(r,c,!1)}function mh(s,r,c,f,m){var x=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var M=f.stateNode.containerInfo;if(M===m)break;if(k===4)for(k=f.return;k!==null;){var K=k.tag;if((K===3||K===4)&&k.stateNode.containerInfo===m)return;k=k.return}for(;M!==null;){if(k=qn(M),k===null)return;if(K=k.tag,K===5||K===6||K===26||K===27){f=x=k;continue e}M=M.parentNode}}f=f.return}sc(function(){var ce=x,je=Nl(c),De=[];e:{var he=D0.get(s);if(he!==void 0){var Ne=fn,We=s;switch(s){case"keypress":if(At(c)===0)break e;case"keydown":case"keyup":Ne=fk;break;case"focusin":We="focus",Ne=_u;break;case"focusout":We="blur",Ne=_u;break;case"beforeblur":case"afterblur":Ne=_u;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ne=a0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ne=ek;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ne=mk;break;case E0:case M0:case A0:Ne=sk;break;case T0:Ne=xk;break;case"scroll":case"scrollend":Ne=Iu;break;case"wheel":Ne=yk;break;case"copy":case"cut":case"paste":Ne=rk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ne=o0;break;case"toggle":case"beforetoggle":Ne=Nk}var ut=(r&4)!==0,ln=!ut&&(s==="scroll"||s==="scrollend"),le=ut?he!==null?he+"Capture":null:he;ut=[];for(var W=ce,ae;W!==null;){var Ae=W;if(ae=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||ae===null||le===null||(Ae=ea(W,le),Ae!=null&&ut.push(io(W,Ae,ae))),ln)break;W=W.return}0<ut.length&&(he=new Ne(he,We,null,c,je),De.push({event:he,listeners:ut}))}}if((r&7)===0){e:{if(he=s==="mouseover"||s==="pointerover",Ne=s==="mouseout"||s==="pointerout",he&&c!==ir&&(We=c.relatedTarget||c.fromElement)&&(qn(We)||We[qe]))break e;if((Ne||he)&&(he=je.window===je?je:(he=je.ownerDocument)?he.defaultView||he.parentWindow:window,Ne?(We=c.relatedTarget||c.toElement,Ne=ce,We=We?qn(We):null,We!==null&&(ln=i(We),ut=We.tag,We!==ln||ut!==5&&ut!==27&&ut!==6)&&(We=null)):(Ne=null,We=ce),Ne!==We)){if(ut=a0,Ae="onMouseLeave",le="onMouseEnter",W="mouse",(s==="pointerout"||s==="pointerover")&&(ut=o0,Ae="onPointerLeave",le="onPointerEnter",W="pointer"),ln=Ne==null?he:as(Ne),ae=We==null?he:as(We),he=new ut(Ae,W+"leave",Ne,c,je),he.target=ln,he.relatedTarget=ae,Ae=null,qn(je)===ce&&(ut=new ut(le,W+"enter",We,c,je),ut.target=ae,ut.relatedTarget=ln,Ae=ut),ln=Ae,Ne&&We)t:{for(ut=vw,le=Ne,W=We,ae=0,Ae=le;Ae;Ae=ut(Ae))ae++;Ae=0;for(var at=W;at;at=ut(at))Ae++;for(;0<ae-Ae;)le=ut(le),ae--;for(;0<Ae-ae;)W=ut(W),Ae--;for(;ae--;){if(le===W||W!==null&&le===W.alternate){ut=le;break t}le=ut(le),W=ut(W)}ut=null}else ut=null;Ne!==null&&Wx(De,he,Ne,ut,!1),We!==null&&ln!==null&&Wx(De,ln,We,ut,!0)}}e:{if(he=ce?as(ce):window,Ne=he.nodeName&&he.nodeName.toLowerCase(),Ne==="select"||Ne==="input"&&he.type==="file")var Ut=g0;else if(p0(he))if(x0)Ut=Dk;else{Ut=Ak;var tt=Mk}else Ne=he.nodeName,!Ne||Ne.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?ce&&yt(ce.elementType)&&(Ut=g0):Ut=Tk;if(Ut&&(Ut=Ut(s,ce))){m0(De,Ut,c,je);break e}tt&&tt(s,he,ce),s==="focusout"&&ce&&he.type==="number"&&ce.memoizedProps.value!=null&&ne(he,"number",he.value)}switch(tt=ce?as(ce):window,s){case"focusin":(p0(tt)||tt.contentEditable==="true")&&(_a=tt,Vu=ce,Li=null);break;case"focusout":Li=Vu=_a=null;break;case"mousedown":qu=!0;break;case"contextmenu":case"mouseup":case"dragend":qu=!1,j0(De,c,je);break;case"selectionchange":if(Rk)break;case"keydown":case"keyup":j0(De,c,je)}var wt;if(Pu)e:{switch(s){case"compositionstart":var It="onCompositionStart";break e;case"compositionend":It="onCompositionEnd";break e;case"compositionupdate":It="onCompositionUpdate";break e}It=void 0}else La?f0(s,c)&&(It="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(It="onCompositionStart");It&&(c0&&c.locale!=="ko"&&(La||It!=="onCompositionStart"?It==="onCompositionEnd"&&La&&(wt=Ge()):(Ke=je,vt="value"in Ke?Ke.value:Ke.textContent,La=!0)),tt=Gc(ce,It),0<tt.length&&(It=new i0(It,s,null,c,je),De.push({event:It,listeners:tt}),wt?It.data=wt:(wt=h0(c),wt!==null&&(It.data=wt)))),(wt=wk?Sk(s,c):jk(s,c))&&(It=Gc(ce,"onBeforeInput"),0<It.length&&(tt=new i0("onBeforeInput","beforeinput",null,c,je),De.push({event:tt,listeners:It}),tt.data=wt)),gw(De,s,ce,c,je)}Qx(De,r)})}function io(s,r,c){return{instance:s,listener:r,currentTarget:c}}function Gc(s,r){for(var c=r+"Capture",f=[];s!==null;){var m=s,x=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||x===null||(m=ea(s,c),m!=null&&f.unshift(io(s,m,x)),m=ea(s,r),m!=null&&f.push(io(s,m,x))),s.tag===3)return f;s=s.return}return[]}function vw(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Wx(s,r,c,f,m){for(var x=r._reactName,k=[];c!==null&&c!==f;){var M=c,K=M.alternate,ce=M.stateNode;if(M=M.tag,K!==null&&K===f)break;M!==5&&M!==26&&M!==27||ce===null||(K=ce,m?(ce=ea(c,x),ce!=null&&k.unshift(io(c,ce,K))):m||(ce=ea(c,x),ce!=null&&k.push(io(c,ce,K)))),c=c.return}k.length!==0&&s.push({event:r,listeners:k})}var Nw=/\r\n?/g,kw=/\u0000|\uFFFD/g;function eb(s){return(typeof s=="string"?s:""+s).replace(Nw,`
`).replace(kw,"")}function tb(s,r){return r=eb(r),eb(s)===r}function sn(s,r,c,f,m,x){switch(c){case"children":typeof f=="string"?r==="body"||r==="textarea"&&f===""||Oe(s,f):(typeof f=="number"||typeof f=="bigint")&&r!=="body"&&Oe(s,""+f);break;case"className":vl(s,"class",f);break;case"tabIndex":vl(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":vl(s,c,f);break;case"style":Te(s,f,x);break;case"data":if(r!=="object"){vl(s,"data",f);break}case"src":case"href":if(f===""&&(r!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Pt(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(c==="formAction"?(r!=="input"&&sn(s,r,"name",m.name,m,null),sn(s,r,"formEncType",m.formEncType,m,null),sn(s,r,"formMethod",m.formMethod,m,null),sn(s,r,"formTarget",m.formTarget,m,null)):(sn(s,r,"encType",m.encType,m,null),sn(s,r,"method",m.method,m,null),sn(s,r,"target",m.target,m,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Pt(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=rn);break;case"onScroll":f!=null&&Dt("scroll",s);break;case"onScrollEnd":f!=null&&Dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(l(61));if(c=f.__html,c!=null){if(m.children!=null)throw Error(l(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=Pt(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":Dt("beforetoggle",s),Dt("toggle",s),Js(s,"popover",f);break;case"xlinkActuate":cs(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":cs(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":cs(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":cs(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":cs(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":cs(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":cs(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":cs(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":cs(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Js(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=qt.get(c)||c,Js(s,c,f))}}function gh(s,r,c,f,m,x){switch(c){case"style":Te(s,f,x);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(l(61));if(c=f.__html,c!=null){if(m.children!=null)throw Error(l(60));s.innerHTML=c}}break;case"children":typeof f=="string"?Oe(s,f):(typeof f=="number"||typeof f=="bigint")&&Oe(s,""+f);break;case"onScroll":f!=null&&Dt("scroll",s);break;case"onScrollEnd":f!=null&&Dt("scrollend",s);break;case"onClick":f!=null&&(s.onclick=rn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!is.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(m=c.endsWith("Capture"),r=c.slice(2,m?c.length-7:void 0),x=s[be]||null,x=x!=null?x[c]:null,typeof x=="function"&&s.removeEventListener(r,x,m),typeof f=="function")){typeof x!="function"&&x!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(r,f,m);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):Js(s,c,f)}}}function Wn(s,r,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Dt("error",s),Dt("load",s);var f=!1,m=!1,x;for(x in c)if(c.hasOwnProperty(x)){var k=c[x];if(k!=null)switch(x){case"src":f=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:sn(s,r,x,k,c,null)}}m&&sn(s,r,"srcSet",c.srcSet,c,null),f&&sn(s,r,"src",c.src,c,null);return;case"input":Dt("invalid",s);var M=x=k=m=null,K=null,ce=null;for(f in c)if(c.hasOwnProperty(f)){var je=c[f];if(je!=null)switch(f){case"name":m=je;break;case"type":k=je;break;case"checked":K=je;break;case"defaultChecked":ce=je;break;case"value":x=je;break;case"defaultValue":M=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(l(137,r));break;default:sn(s,r,f,je,c,null)}}q(s,x,M,K,ce,k,m,!1);return;case"select":Dt("invalid",s),f=k=x=null;for(m in c)if(c.hasOwnProperty(m)&&(M=c[m],M!=null))switch(m){case"value":x=M;break;case"defaultValue":k=M;break;case"multiple":f=M;default:sn(s,r,m,M,c,null)}r=x,c=k,s.multiple=!!f,r!=null?se(s,!!f,r,!1):c!=null&&se(s,!!f,c,!0);return;case"textarea":Dt("invalid",s),x=m=f=null;for(k in c)if(c.hasOwnProperty(k)&&(M=c[k],M!=null))switch(k){case"value":f=M;break;case"defaultValue":m=M;break;case"children":x=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(l(91));break;default:sn(s,r,k,M,c,null)}Se(s,f,m,x);return;case"option":for(K in c)if(c.hasOwnProperty(K)&&(f=c[K],f!=null))switch(K){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:sn(s,r,K,f,c,null)}return;case"dialog":Dt("beforetoggle",s),Dt("toggle",s),Dt("cancel",s),Dt("close",s);break;case"iframe":case"object":Dt("load",s);break;case"video":case"audio":for(f=0;f<ao.length;f++)Dt(ao[f],s);break;case"image":Dt("error",s),Dt("load",s);break;case"details":Dt("toggle",s);break;case"embed":case"source":case"link":Dt("error",s),Dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in c)if(c.hasOwnProperty(ce)&&(f=c[ce],f!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:sn(s,r,ce,f,c,null)}return;default:if(yt(r)){for(je in c)c.hasOwnProperty(je)&&(f=c[je],f!==void 0&&gh(s,r,je,f,c,void 0));return}}for(M in c)c.hasOwnProperty(M)&&(f=c[M],f!=null&&sn(s,r,M,f,c,null))}function ww(s,r,c,f){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,x=null,k=null,M=null,K=null,ce=null,je=null;for(Ne in c){var De=c[Ne];if(c.hasOwnProperty(Ne)&&De!=null)switch(Ne){case"checked":break;case"value":break;case"defaultValue":K=De;default:f.hasOwnProperty(Ne)||sn(s,r,Ne,null,f,De)}}for(var he in f){var Ne=f[he];if(De=c[he],f.hasOwnProperty(he)&&(Ne!=null||De!=null))switch(he){case"type":x=Ne;break;case"name":m=Ne;break;case"checked":ce=Ne;break;case"defaultChecked":je=Ne;break;case"value":k=Ne;break;case"defaultValue":M=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(l(137,r));break;default:Ne!==De&&sn(s,r,he,Ne,f,De)}}z(s,k,M,K,ce,je,x,m);return;case"select":Ne=k=M=he=null;for(x in c)if(K=c[x],c.hasOwnProperty(x)&&K!=null)switch(x){case"value":break;case"multiple":Ne=K;default:f.hasOwnProperty(x)||sn(s,r,x,null,f,K)}for(m in f)if(x=f[m],K=c[m],f.hasOwnProperty(m)&&(x!=null||K!=null))switch(m){case"value":he=x;break;case"defaultValue":M=x;break;case"multiple":k=x;default:x!==K&&sn(s,r,m,x,f,K)}r=M,c=k,f=Ne,he!=null?se(s,!!c,he,!1):!!f!=!!c&&(r!=null?se(s,!!c,r,!0):se(s,!!c,c?[]:"",!1));return;case"textarea":Ne=he=null;for(M in c)if(m=c[M],c.hasOwnProperty(M)&&m!=null&&!f.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:sn(s,r,M,null,f,m)}for(k in f)if(m=f[k],x=c[k],f.hasOwnProperty(k)&&(m!=null||x!=null))switch(k){case"value":he=m;break;case"defaultValue":Ne=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(l(91));break;default:m!==x&&sn(s,r,k,m,f,x)}me(s,he,Ne);return;case"option":for(var We in c)if(he=c[We],c.hasOwnProperty(We)&&he!=null&&!f.hasOwnProperty(We))switch(We){case"selected":s.selected=!1;break;default:sn(s,r,We,null,f,he)}for(K in f)if(he=f[K],Ne=c[K],f.hasOwnProperty(K)&&he!==Ne&&(he!=null||Ne!=null))switch(K){case"selected":s.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:sn(s,r,K,he,f,Ne)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ut in c)he=c[ut],c.hasOwnProperty(ut)&&he!=null&&!f.hasOwnProperty(ut)&&sn(s,r,ut,null,f,he);for(ce in f)if(he=f[ce],Ne=c[ce],f.hasOwnProperty(ce)&&he!==Ne&&(he!=null||Ne!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(l(137,r));break;default:sn(s,r,ce,he,f,Ne)}return;default:if(yt(r)){for(var ln in c)he=c[ln],c.hasOwnProperty(ln)&&he!==void 0&&!f.hasOwnProperty(ln)&&gh(s,r,ln,void 0,f,he);for(je in f)he=f[je],Ne=c[je],!f.hasOwnProperty(je)||he===Ne||he===void 0&&Ne===void 0||gh(s,r,je,he,f,Ne);return}}for(var le in c)he=c[le],c.hasOwnProperty(le)&&he!=null&&!f.hasOwnProperty(le)&&sn(s,r,le,null,f,he);for(De in f)he=f[De],Ne=c[De],!f.hasOwnProperty(De)||he===Ne||he==null&&Ne==null||sn(s,r,De,he,f,Ne)}function nb(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Sw(){if(typeof performance.getEntriesByType=="function"){for(var s=0,r=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var m=c[f],x=m.transferSize,k=m.initiatorType,M=m.duration;if(x&&M&&nb(k)){for(k=0,M=m.responseEnd,f+=1;f<c.length;f++){var K=c[f],ce=K.startTime;if(ce>M)break;var je=K.transferSize,De=K.initiatorType;je&&nb(De)&&(K=K.responseEnd,k+=je*(K<M?1:(M-ce)/(K-ce)))}if(--f,r+=8*(x+k)/(m.duration/1e3),s++,10<s)break}}if(0<s)return r/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var xh=null,bh=null;function Yc(s){return s.nodeType===9?s:s.ownerDocument}function sb(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lb(s,r){if(s===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&r==="foreignObject"?0:s}function yh(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var vh=null;function jw(){var s=window.event;return s&&s.type==="popstate"?s===vh?!1:(vh=s,!0):(vh=null,!1)}var rb=typeof setTimeout=="function"?setTimeout:void 0,Cw=typeof clearTimeout=="function"?clearTimeout:void 0,ab=typeof Promise=="function"?Promise:void 0,Ew=typeof queueMicrotask=="function"?queueMicrotask:typeof ab<"u"?function(s){return ab.resolve(null).then(s).catch(Mw)}:rb;function Mw(s){setTimeout(function(){throw s})}function Sr(s){return s==="head"}function ib(s,r){var c=r,f=0;do{var m=c.nextSibling;if(s.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(m),di(r);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")oo(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,oo(c);for(var x=c.firstChild;x;){var k=x.nextSibling,M=x.nodeName;x[Ss]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&x.rel.toLowerCase()==="stylesheet"||c.removeChild(x),x=k}}else c==="body"&&oo(s.ownerDocument.body);c=m}while(c);di(r)}function ob(s,r){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?r?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(r?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function Nh(s){var r=s.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var c=r;switch(r=r.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Nh(c),rs(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function Aw(s,r,c,f){for(;s.nodeType===1;){var m=c;if(s.nodeName.toLowerCase()!==r.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[Ss])switch(r){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(x=s.getAttribute("rel"),x==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(x!==m.rel||s.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||s.getAttribute("title")!==(m.title==null?null:m.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(x=s.getAttribute("src"),(x!==(m.src==null?null:m.src)||s.getAttribute("type")!==(m.type==null?null:m.type)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&x&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(r==="input"&&s.type==="hidden"){var x=m.name==null?null:""+m.name;if(m.type==="hidden"&&s.getAttribute("name")===x)return s}else return s;if(s=sl(s.nextSibling),s===null)break}return null}function Tw(s,r,c){if(r==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=sl(s.nextSibling),s===null))return null;return s}function cb(s,r){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!r||(s=sl(s.nextSibling),s===null))return null;return s}function kh(s){return s.data==="$?"||s.data==="$~"}function wh(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function Dw(s,r){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=r;else if(s.data!=="$?"||c.readyState!=="loading")r();else{var f=function(){r(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function sl(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return s}var Sh=null;function db(s){s=s.nextSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(r===0)return sl(s.nextSibling);r--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||r++}s=s.nextSibling}return null}function ub(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(r===0)return s;r--}else c!=="/$"&&c!=="/&"||r++}s=s.previousSibling}return null}function fb(s,r,c){switch(r=Yc(c),s){case"html":if(s=r.documentElement,!s)throw Error(l(452));return s;case"head":if(s=r.head,!s)throw Error(l(453));return s;case"body":if(s=r.body,!s)throw Error(l(454));return s;default:throw Error(l(451))}}function oo(s){for(var r=s.attributes;r.length;)s.removeAttributeNode(r[0]);rs(s)}var ll=new Map,hb=new Set;function Xc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Yl=T.d;T.d={f:Ow,r:Rw,D:Iw,C:zw,L:Lw,m:_w,X:Pw,S:Bw,M:Hw};function Ow(){var s=Yl.f(),r=Hc();return s||r}function Rw(s){var r=Xe(s);r!==null&&r.tag===5&&r.type==="form"?Tg(r):Yl.r(s)}var ii=typeof document>"u"?null:document;function pb(s,r,c){var f=ii;if(f&&typeof r=="string"&&r){var m=us(r);m='link[rel="'+s+'"][href="'+m+'"]',typeof c=="string"&&(m+='[crossorigin="'+c+'"]'),hb.has(m)||(hb.add(m),s={rel:s,crossOrigin:c,href:r},f.querySelector(m)===null&&(r=f.createElement("link"),Wn(r,"link",s),Mt(r),f.head.appendChild(r)))}}function Iw(s){Yl.D(s),pb("dns-prefetch",s,null)}function zw(s,r){Yl.C(s,r),pb("preconnect",s,r)}function Lw(s,r,c){Yl.L(s,r,c);var f=ii;if(f&&s&&r){var m='link[rel="preload"][as="'+us(r)+'"]';r==="image"&&c&&c.imageSrcSet?(m+='[imagesrcset="'+us(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(m+='[imagesizes="'+us(c.imageSizes)+'"]')):m+='[href="'+us(s)+'"]';var x=m;switch(r){case"style":x=oi(s);break;case"script":x=ci(s)}ll.has(x)||(s=b({rel:"preload",href:r==="image"&&c&&c.imageSrcSet?void 0:s,as:r},c),ll.set(x,s),f.querySelector(m)!==null||r==="style"&&f.querySelector(co(x))||r==="script"&&f.querySelector(uo(x))||(r=f.createElement("link"),Wn(r,"link",s),Mt(r),f.head.appendChild(r)))}}function _w(s,r){Yl.m(s,r);var c=ii;if(c&&s){var f=r&&typeof r.as=="string"?r.as:"script",m='link[rel="modulepreload"][as="'+us(f)+'"][href="'+us(s)+'"]',x=m;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=ci(s)}if(!ll.has(x)&&(s=b({rel:"modulepreload",href:s},r),ll.set(x,s),c.querySelector(m)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(uo(x)))return}f=c.createElement("link"),Wn(f,"link",s),Mt(f),c.head.appendChild(f)}}}function Bw(s,r,c){Yl.S(s,r,c);var f=ii;if(f&&s){var m=pn(f).hoistableStyles,x=oi(s);r=r||"default";var k=m.get(x);if(!k){var M={loading:0,preload:null};if(k=f.querySelector(co(x)))M.loading=5;else{s=b({rel:"stylesheet",href:s,"data-precedence":r},c),(c=ll.get(x))&&jh(s,c);var K=k=f.createElement("link");Mt(K),Wn(K,"link",s),K._p=new Promise(function(ce,je){K.onload=ce,K.onerror=je}),K.addEventListener("load",function(){M.loading|=1}),K.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Jc(k,r,f)}k={type:"stylesheet",instance:k,count:1,state:M},m.set(x,k)}}}function Pw(s,r){Yl.X(s,r);var c=ii;if(c&&s){var f=pn(c).hoistableScripts,m=ci(s),x=f.get(m);x||(x=c.querySelector(uo(m)),x||(s=b({src:s,async:!0},r),(r=ll.get(m))&&Ch(s,r),x=c.createElement("script"),Mt(x),Wn(x,"link",s),c.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(m,x))}}function Hw(s,r){Yl.M(s,r);var c=ii;if(c&&s){var f=pn(c).hoistableScripts,m=ci(s),x=f.get(m);x||(x=c.querySelector(uo(m)),x||(s=b({src:s,async:!0,type:"module"},r),(r=ll.get(m))&&Ch(s,r),x=c.createElement("script"),Mt(x),Wn(x,"link",s),c.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(m,x))}}function mb(s,r,c,f){var m=(m=Ee.current)?Xc(m):null;if(!m)throw Error(l(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(r=oi(c.href),c=pn(m).hoistableStyles,f=c.get(r),f||(f={type:"style",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=oi(c.href);var x=pn(m).hoistableStyles,k=x.get(s);if(k||(m=m.ownerDocument||m,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(s,k),(x=m.querySelector(co(s)))&&!x._p&&(k.instance=x,k.state.loading=5),ll.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},ll.set(s,c),x||$w(m,s,c,k.state))),r&&f===null)throw Error(l(528,""));return k}if(r&&f!==null)throw Error(l(529,""));return null;case"script":return r=c.async,c=c.src,typeof c=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=ci(c),c=pn(m).hoistableScripts,f=c.get(r),f||(f={type:"script",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,s))}}function oi(s){return'href="'+us(s)+'"'}function co(s){return'link[rel="stylesheet"]['+s+"]"}function gb(s){return b({},s,{"data-precedence":s.precedence,precedence:null})}function $w(s,r,c,f){s.querySelector('link[rel="preload"][as="style"]['+r+"]")?f.loading=1:(r=s.createElement("link"),f.preload=r,r.addEventListener("load",function(){return f.loading|=1}),r.addEventListener("error",function(){return f.loading|=2}),Wn(r,"link",c),Mt(r),s.head.appendChild(r))}function ci(s){return'[src="'+us(s)+'"]'}function uo(s){return"script[async]"+s}function xb(s,r,c){if(r.count++,r.instance===null)switch(r.type){case"style":var f=s.querySelector('style[data-href~="'+us(c.href)+'"]');if(f)return r.instance=f,Mt(f),f;var m=b({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),Mt(f),Wn(f,"style",m),Jc(f,c.precedence,s),r.instance=f;case"stylesheet":m=oi(c.href);var x=s.querySelector(co(m));if(x)return r.state.loading|=4,r.instance=x,Mt(x),x;f=gb(c),(m=ll.get(m))&&jh(f,m),x=(s.ownerDocument||s).createElement("link"),Mt(x);var k=x;return k._p=new Promise(function(M,K){k.onload=M,k.onerror=K}),Wn(x,"link",f),r.state.loading|=4,Jc(x,c.precedence,s),r.instance=x;case"script":return x=ci(c.src),(m=s.querySelector(uo(x)))?(r.instance=m,Mt(m),m):(f=c,(m=ll.get(x))&&(f=b({},c),Ch(f,m)),s=s.ownerDocument||s,m=s.createElement("script"),Mt(m),Wn(m,"link",f),s.head.appendChild(m),r.instance=m);case"void":return null;default:throw Error(l(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(f=r.instance,r.state.loading|=4,Jc(f,c.precedence,s));return r.instance}function Jc(s,r,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=f.length?f[f.length-1]:null,x=m,k=0;k<f.length;k++){var M=f[k];if(M.dataset.precedence===r)x=M;else if(x!==m)break}x?x.parentNode.insertBefore(s,x.nextSibling):(r=c.nodeType===9?c.head:c,r.insertBefore(s,r.firstChild))}function jh(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.title==null&&(s.title=r.title)}function Ch(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.integrity==null&&(s.integrity=r.integrity)}var Qc=null;function bb(s,r,c){if(Qc===null){var f=new Map,m=Qc=new Map;m.set(c,f)}else m=Qc,f=m.get(c),f||(f=new Map,m.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),m=0;m<c.length;m++){var x=c[m];if(!(x[Ss]||x[ye]||s==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var k=x.getAttribute(r)||"";k=s+k;var M=f.get(k);M?M.push(x):f.set(k,[x])}}return f}function yb(s,r,c){s=s.ownerDocument||s,s.head.insertBefore(c,r==="title"?s.querySelector("head > title"):null)}function Uw(s,r,c){if(c===1||r.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return s=r.disabled,typeof r.precedence=="string"&&s==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function vb(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function Vw(s,r,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var m=oi(f.href),x=r.querySelector(co(m));if(x){r=x._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(s.count++,s=Zc.bind(s),r.then(s,s)),c.state.loading|=4,c.instance=x,Mt(x);return}x=r.ownerDocument||r,f=gb(f),(m=ll.get(m))&&jh(f,m),x=x.createElement("link"),Mt(x);var k=x;k._p=new Promise(function(M,K){k.onload=M,k.onerror=K}),Wn(x,"link",f),c.instance=x}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,r),(r=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Zc.bind(s),r.addEventListener("load",c),r.addEventListener("error",c))}}var Eh=0;function qw(s,r){return s.stylesheets&&s.count===0&&ed(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&ed(s,s.stylesheets),s.unsuspend){var x=s.unsuspend;s.unsuspend=null,x()}},6e4+r);0<s.imgBytes&&Eh===0&&(Eh=62500*Sw());var m=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&ed(s,s.stylesheets),s.unsuspend)){var x=s.unsuspend;s.unsuspend=null,x()}},(s.imgBytes>Eh?50:800)+r);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(m)}}:null}function Zc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ed(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Wc=null;function ed(s,r){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Wc=new Map,r.forEach(Fw,s),Wc=null,Zc.call(s))}function Fw(s,r){if(!(r.state.loading&4)){var c=Wc.get(s);if(c)var f=c.get(null);else{c=new Map,Wc.set(s,c);for(var m=s.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<m.length;x++){var k=m[x];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(c.set(k.dataset.precedence,k),f=k)}f&&c.set(null,f)}m=r.instance,k=m.getAttribute("data-precedence"),x=c.get(k)||f,x===f&&c.set(null,m),c.set(k,m),this.count++,f=Zc.bind(this),m.addEventListener("load",f),m.addEventListener("error",f),x?x.parentNode.insertBefore(m,x.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(m,s.firstChild)),r.state.loading|=4}}var fo={$$typeof:_,Provider:null,Consumer:null,_currentValue:I,_currentValue2:I,_threadCount:0};function Kw(s,r,c,f,m,x,k,M,K){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gt(0),this.hiddenUpdates=Gt(null),this.identifierPrefix=f,this.onUncaughtError=m,this.onCaughtError=x,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function Nb(s,r,c,f,m,x,k,M,K,ce,je,De){return s=new Kw(s,r,c,k,K,ce,je,De,M),r=1,x===!0&&(r|=24),x=zs(3,null,null,r),s.current=x,x.stateNode=s,r=rf(),r.refCount++,s.pooledCache=r,r.refCount++,x.memoizedState={element:f,isDehydrated:c,cache:r},df(x),s}function kb(s){return s?(s=Ha,s):Ha}function wb(s,r,c,f,m,x){m=kb(m),f.context===null?f.context=m:f.pendingContext=m,f=hr(r),f.payload={element:c},x=x===void 0?null:x,x!==null&&(f.callback=x),c=pr(s,f,r),c!==null&&(Ts(c,s,r),Vi(c,s,r))}function Sb(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<r?c:r}}function Mh(s,r){Sb(s,r),(s=s.alternate)&&Sb(s,r)}function jb(s){if(s.tag===13||s.tag===31){var r=sa(s,67108864);r!==null&&Ts(r,s,67108864),Mh(s,67108864)}}function Cb(s){if(s.tag===13||s.tag===31){var r=Hs();r=En(r);var c=sa(s,r);c!==null&&Ts(c,s,r),Mh(s,r)}}var td=!0;function Gw(s,r,c,f){var m=w.T;w.T=null;var x=T.p;try{T.p=2,Ah(s,r,c,f)}finally{T.p=x,w.T=m}}function Yw(s,r,c,f){var m=w.T;w.T=null;var x=T.p;try{T.p=8,Ah(s,r,c,f)}finally{T.p=x,w.T=m}}function Ah(s,r,c,f){if(td){var m=Th(f);if(m===null)mh(s,r,f,nd,c),Mb(s,f);else if(Jw(m,s,r,c,f))f.stopPropagation();else if(Mb(s,f),r&4&&-1<Xw.indexOf(s)){for(;m!==null;){var x=Xe(m);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var k=ss(x.pendingLanes);if(k!==0){var M=x;for(M.pendingLanes|=2,M.entangledLanes|=2;k;){var K=1<<31-$e(k);M.entanglements[1]|=K,k&=~K}jl(x),(Kt&6)===0&&(Bc=fe()+500,ro(0))}}break;case 31:case 13:M=sa(x,2),M!==null&&Ts(M,x,2),Hc(),Mh(x,2)}if(x=Th(f),x===null&&mh(s,r,f,nd,c),x===m)break;m=x}m!==null&&f.stopPropagation()}else mh(s,r,f,null,c)}}function Th(s){return s=Nl(s),Dh(s)}var nd=null;function Dh(s){if(nd=null,s=qn(s),s!==null){var r=i(s);if(r===null)s=null;else{var c=r.tag;if(c===13){if(s=d(r),s!==null)return s;s=null}else if(c===31){if(s=u(r),s!==null)return s;s=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return nd=s,null}function Eb(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ze()){case Me:return 2;case He:return 8;case et:case st:return 32;case rt:return 268435456;default:return 32}default:return 32}}var Oh=!1,jr=null,Cr=null,Er=null,ho=new Map,po=new Map,Mr=[],Xw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Mb(s,r){switch(s){case"focusin":case"focusout":jr=null;break;case"dragenter":case"dragleave":Cr=null;break;case"mouseover":case"mouseout":Er=null;break;case"pointerover":case"pointerout":ho.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":po.delete(r.pointerId)}}function mo(s,r,c,f,m,x){return s===null||s.nativeEvent!==x?(s={blockedOn:r,domEventName:c,eventSystemFlags:f,nativeEvent:x,targetContainers:[m]},r!==null&&(r=Xe(r),r!==null&&jb(r)),s):(s.eventSystemFlags|=f,r=s.targetContainers,m!==null&&r.indexOf(m)===-1&&r.push(m),s)}function Jw(s,r,c,f,m){switch(r){case"focusin":return jr=mo(jr,s,r,c,f,m),!0;case"dragenter":return Cr=mo(Cr,s,r,c,f,m),!0;case"mouseover":return Er=mo(Er,s,r,c,f,m),!0;case"pointerover":var x=m.pointerId;return ho.set(x,mo(ho.get(x)||null,s,r,c,f,m)),!0;case"gotpointercapture":return x=m.pointerId,po.set(x,mo(po.get(x)||null,s,r,c,f,m)),!0}return!1}function Ab(s){var r=qn(s.target);if(r!==null){var c=i(r);if(c!==null){if(r=c.tag,r===13){if(r=d(c),r!==null){s.blockedOn=r,zt(s.priority,function(){Cb(c)});return}}else if(r===31){if(r=u(c),r!==null){s.blockedOn=r,zt(s.priority,function(){Cb(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function sd(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var c=Th(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);ir=f,c.target.dispatchEvent(f),ir=null}else return r=Xe(c),r!==null&&jb(r),s.blockedOn=c,!1;r.shift()}return!0}function Tb(s,r,c){sd(s)&&c.delete(r)}function Qw(){Oh=!1,jr!==null&&sd(jr)&&(jr=null),Cr!==null&&sd(Cr)&&(Cr=null),Er!==null&&sd(Er)&&(Er=null),ho.forEach(Tb),po.forEach(Tb)}function ld(s,r){s.blockedOn===r&&(s.blockedOn=null,Oh||(Oh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Qw)))}var rd=null;function Db(s){rd!==s&&(rd=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){rd===s&&(rd=null);for(var r=0;r<s.length;r+=3){var c=s[r],f=s[r+1],m=s[r+2];if(typeof f!="function"){if(Dh(f||c)===null)continue;break}var x=Xe(c);x!==null&&(s.splice(r,3),r-=3,Tf(x,{pending:!0,data:m,method:c.method,action:f},f,m))}}))}function di(s){function r(K){return ld(K,s)}jr!==null&&ld(jr,s),Cr!==null&&ld(Cr,s),Er!==null&&ld(Er,s),ho.forEach(r),po.forEach(r);for(var c=0;c<Mr.length;c++){var f=Mr[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<Mr.length&&(c=Mr[0],c.blockedOn===null);)Ab(c),c.blockedOn===null&&Mr.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var m=c[f],x=c[f+1],k=m[be]||null;if(typeof x=="function")k||Db(c);else if(k){var M=null;if(x&&x.hasAttribute("formAction")){if(m=x,k=x[be]||null)M=k.formAction;else if(Dh(m)!==null)continue}else M=k.action;typeof M=="function"?c[f+1]=M:(c.splice(f,3),f-=3),Db(c)}}}function Ob(){function s(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(k){return m=k})},focusReset:"manual",scroll:"manual"})}function r(){m!==null&&(m(),m=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,m=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),m!==null&&(m(),m=null)}}}function Rh(s){this._internalRoot=s}ad.prototype.render=Rh.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(l(409));var c=r.current,f=Hs();wb(c,f,s,r,null,null)},ad.prototype.unmount=Rh.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;wb(s.current,2,null,s,null,null),Hc(),r[qe]=null}};function ad(s){this._internalRoot=s}ad.prototype.unstable_scheduleHydration=function(s){if(s){var r=ls();s={blockedOn:null,target:s,priority:r};for(var c=0;c<Mr.length&&r!==0&&r<Mr[c].priority;c++);Mr.splice(c,0,s),c===0&&Ab(s)}};var Rb=e.version;if(Rb!=="19.2.1")throw Error(l(527,Rb,"19.2.1"));T.findDOMNode=function(s){var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(l(188)):(s=Object.keys(s).join(","),Error(l(268,s)));return s=p(r),s=s!==null?g(s):null,s=s===null?null:s.stateNode,s};var Zw={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:w,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{ee=id.inject(Zw),oe=id}catch{}}return xo.createRoot=function(s,r){if(!a(s))throw Error(l(299));var c=!1,f="",m=Hg,x=$g,k=Ug;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onUncaughtError!==void 0&&(m=r.onUncaughtError),r.onCaughtError!==void 0&&(x=r.onCaughtError),r.onRecoverableError!==void 0&&(k=r.onRecoverableError)),r=Nb(s,1,!1,null,null,c,f,null,m,x,k,Ob),s[qe]=r.current,ph(s),new Rh(r)},xo.hydrateRoot=function(s,r,c){if(!a(s))throw Error(l(299));var f=!1,m="",x=Hg,k=$g,M=Ug,K=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(x=c.onUncaughtError),c.onCaughtError!==void 0&&(k=c.onCaughtError),c.onRecoverableError!==void 0&&(M=c.onRecoverableError),c.formState!==void 0&&(K=c.formState)),r=Nb(s,1,!0,r,c??null,f,m,K,x,k,M,Ob),r.context=kb(null),c=r.current,f=Hs(),f=En(f),m=hr(f),m.callback=null,pr(c,m,f),c=f,r.current.lanes=c,Yt(r,c),jl(r),s[qe]=r.current,ph(s),new ad(r)},xo.version="19.2.1",xo}var Vb;function iS(){if(Vb)return Lh.exports;Vb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Lh.exports=aS(),Lh.exports}var oS=iS();const cS=hm(oS);async function dS(){return window.electronAPI&&typeof window.electronAPI.getLastOpenedFile=="function"?await window.electronAPI.getLastOpenedFile():null}async function uS(){if(window.electronAPI&&typeof window.electronAPI.openDatabaseDialog=="function")return await window.electronAPI.openDatabaseDialog();throw new Error("Kan bara ppna databasdialog i desktop/Electron-lge!")}async function qb(){if(console.log("[DEBUG] window.electronAPI:",window.electronAPI),window.electronAPI&&typeof window.electronAPI.createNewDatabase=="function")return console.log("[DEBUG] window.electronAPI.createNewDatabase finns!"),await window.electronAPI.createNewDatabase();throw console.error("[DEBUG] window.electronAPI saknas eller har ingen createNewDatabase:",window.electronAPI),new Error("Kan bara skapa ny databas i desktop/Electron-lge!")}async function Fb(n){if(window.electronAPI&&typeof window.electronAPI.openDatabase=="function")return await window.electronAPI.openDatabase(n);throw new Error("Kan bara ppna databas i desktop/Electron-lge!")}async function fS(n,e){if(window.electronAPI&&typeof window.electronAPI.saveDatabase=="function")return console.log("[database.js] saveFile:",{fileHandle:n,antalPersoner:Array.isArray(e?.people)?e.people.length:"ej array",personer:Array.isArray(e?.people)&&e.people.length>0?e.people.map(t=>({id:t.id,firstName:t.firstName,lastName:t.lastName})):e?.people}),await window.electronAPI.saveDatabase(n,e);throw new Error("Kan bara spara databas i desktop/Electron-lge!")}async function hS(n){if(window.electronAPI&&typeof window.electronAPI.saveFileAs=="function")return await window.electronAPI.saveFileAs(n);throw new Error('Kan bara anvnda "Spara som" i desktop/Electron-lge!')}function Cd({archive:n,volume:e,imagePage:t,page:l,aid:a,nad:i,date:d}){let u="";n&&n.trim()==="Arkiv Digital"?u+="Arkiv Digital":n&&(u+=n),e&&(u+=(u?" ":"")+e),d&&(u+=` (${d})`);let h="";if(t){const p=t.match(/Bild\s*(\d+)/i);p&&(h=`Bild ${p[1]}`)}if(h){u+=`
${h}`;let p=[];a&&p.push(`AID: ${a}`),i&&p.push(`NAD: ${i}`),p.length&&(u+=` (${p.join(", ")})`)}return u.trim()}function Ep(n){const e={archive:"",volume:"",imagePage:"",page:"",aid:"",nad:"",date:"",raId:"",note:"",trust:0,tags:"",title:""};if(!n||typeof n!="string")return e;let t=n.trim();const l=t.match(/(?:AID:\s*|www\.arkivdigital\.se\/aid\/show\/)(v\d+\.b\d+\.s\d+|v\d+\.b\d+|v\d+)/i);l&&(e.aid=l[1].trim(),t=t.replace(l[0],""));const a=t.match(/(SE\/[A-Z]{2,}\/[^\s,]+)/i);a&&(e.nad=a[1].trim(),t=t.replace(a[0],""));const i=t.match(/(?:RA-bildid:\s*|sok\.riksarkivet\.se\/bildvisning\/)([A-Z0-9_]+)/i);if(i&&(e.raId=i[1].trim(),t=t.replace(i[0],"")),e.aid){const h=e.aid.match(/v\d+\.b(\d+)(?:\.s(\d+))?/);h&&(e.imagePage=h[1]||"",e.page=h[2]||"")}const d=t.match(/Bild\s*(\d+)(?:\s*\/\s*sid\s*(\d+))?/i);d&&(e.imagePage||(e.imagePage=d[1]),e.page||(e.page=d[2]||""),t=t.replace(d[0],""));const u=t.match(/([A-Z]{1,4}:\d+[a-z]?)\s*(?:\((\d{4}-\d{4})\))?/);return u&&(e.volume=u[1].trim(),e.date=u[2]||"",t=t.replace(u[0],"")),e.archive=t.replace(/Klla:|Klldetalj:|Notes:|Bild:/gi,"").replace(/[,]/g," ").trim(),e.title=[e.archive,e.volume,e.date?`(${e.date})`:""].filter(Boolean).join(" ").trim(),e.aid&&(e.trust=4),e}function pm(n,e,t=[]){if(!n||!e||!Array.isArray(t)||t.length===0)return null;const l=t.filter(N=>N&&N!==e);if(l.length===0)return null;const a=n.people||[],i=l.map(N=>{const S=a.find(E=>E.id===N)||{id:N},j=(S.events||[]).length;return{id:N,name:`${S.firstName||""} ${S.lastName||""}`.trim(),eventsCount:j,raw:S}}),d=i.reduce((N,S)=>N+S.eventsCount,0),u=(n.relations||[]).slice(),h=new Set,p=[],g=[];for(const N of u){if(!N||N._archived)continue;const S={...N};if(l.includes(S.fromPersonId)&&(S.fromPersonId=e),l.includes(S.toPersonId)&&(S.toPersonId=e),S.fromPersonId===S.toPersonId){g.push({original:N,reason:"self-relation after remap",remapped:S});continue}const j=`${(S.type||"").toString().toLowerCase()}::${S.fromPersonId}::${S.toPersonId}`;h.has(j)?g.push({original:N,reason:"duplicate after remap",remapped:S}):(h.add(j),p.push({original:N,remapped:S}))}const b=N=>{const S=a.find(j=>j.id===N);return S?`${S.firstName||""} ${S.lastName||""}`.trim():N},y=p.map(N=>({id:N.original.id,type:N.original.type,fromId:N.remapped.fromPersonId,toId:N.remapped.toPersonId,from:b(N.remapped.fromPersonId),to:b(N.remapped.toPersonId),sources:N.original.sourceIds||[],note:N.original.note||""})),v=g.map(N=>({id:N.original.id,type:N.original.type,fromId:N.remapped.fromPersonId,toId:N.remapped.toPersonId,from:b(N.remapped.fromPersonId),to:b(N.remapped.toPersonId),reason:N.reason,sources:N.original.sourceIds||[],note:N.original.note||""}));return{previews:i,totalEvents:d,keptList:y,archivedList:v,remappedRelations:p.map(N=>N.remapped),archivedRelations:g.map(N=>N.remapped)}}function pS(n=[],e,t=[],l="system"){const a=t.filter(h=>h&&h!==e),i=(n||[]).map(h=>{const p={...h};return a.includes(p.fromPersonId)&&(p.fromPersonId=e),a.includes(p.toPersonId)&&(p.toPersonId=e),p.fromPersonId===p.toPersonId&&(p._archived=!0,p.modifiedAt=new Date().toISOString(),p.modifiedBy=l),p}),d=new Set,u=[];for(const h of i){if(h._archived){u.push(h);continue}const p=`${(h.type||"").toString().toLowerCase()}::${h.fromPersonId}::${h.toPersonId}`;d.has(p)?u.push({...h,_archived:!0,modifiedAt:new Date().toISOString(),modifiedBy:l}):(d.add(p),u.push(h))}return u}function mS(n=[],e,t=[]){if(!Array.isArray(n)||!e)return n;const l=t.filter(h=>h&&h!==e),a=n.map(h=>({...h,events:Array.isArray(h.events)?h.events.map(p=>({...p})):[],links:h.links?{...h.links}:{}})),i=a.findIndex(h=>h.id===e);if(i===-1)return a;const d=a[i];for(const h of l){const p=a.findIndex(b=>b.id===h);if(p===-1)continue;const g=a[p];if(Array.isArray(g.events)&&g.events.length>0){d.events=d.events||[];for(const b of g.events){const y={...b};for(y.id||(y.id=`e_${Date.now()}_${Math.random().toString(36).slice(2,8)}`);d.events.find(v=>v.id===y.id);)y.id=`e_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;d.events.push(y)}}if(d.links=d.links||{},g.links)for(const b of Object.keys(g.links))d.links[b]||(d.links[b]=g.links[b])}return a.map(h=>l.includes(h.id)?{...h,_archived:!0,archiveReason:`Merged into ${e}`}:h)}function gS(){const[n,e]=C.useState(null),[t,l]=C.useState(null),[a,i]=C.useState(!1);C.useEffect(()=>{async function z(){try{console.log("[useAppContext] Anropar getLastOpenedFile...");const q=await dS();if(console.log("[useAppContext] getLastOpenedFile svar:",q),q){const se=await Fb(q);if(console.log("[useAppContext] openFile svar:",se),se&&se.people){e({...se,meta:se.meta||{}}),l({name:q.split(/[\\/]/).pop(),path:q});return}}const ne=await qb();e(ne),l(null)}catch(q){console.error("[useAppContext] FEL vid initDb:",q),e(null),window.dbInitError=q,typeof Me=="function"&&Me("Fel vid laddning av databas: "+(q.message||q),"error")}}z()},[]);const[d,u]=C.useState(""),[h,p]=C.useState(""),[g,b]=C.useState(!1),[y,v]=C.useState(null),[N,S]=C.useState(null),[j,E]=C.useState("people"),[D,_]=C.useState({primary:null,secondary:null}),[H,L]=C.useState([]),[V,G]=C.useState({selectedSourceId:null,sortOrder:"name_asc",searchTerm:"",expanded:{}}),[X,$]=C.useState({selectedPlaceId:null,sortOrder:"country_asc",searchTerm:"",expanded:{}});C.useEffect(()=>{if(!n||!(window&&window.electronAPI&&typeof window.electronAPI.saveDatabase=="function")||!t||!t.path)return;const z={...n,meta:{...n.meta,focusPair:D,bookmarks:H}};window.electronAPI.saveDatabase(t,z).then(()=>i(!1)).catch(()=>{})},[n,t,D,H]);const[R,A]=C.useState(null),[B,Y]=C.useState(null),[J,de]=C.useState(null),[w,T]=C.useState(null),[I,Z]=C.useState(!1),[pe,O]=C.useState(!1),[te,ke]=C.useState(!1),[U,ge]=C.useState(!1),[Ee,ie]=C.useState({selectedPersonId:null,searchTerm:"",expanded:{}}),[Ie,P]=C.useState(!1),[we,ue]=C.useState({sourceString:"",archive:"",volume:"",imagePage:"",otherInfo:"",imagePreview:null,imageFile:null,imageFilename:"",imagePath:""}),[Ue,Q]=C.useState({isVisible:!1,message:"",onUndo:null}),[re,Ce]=C.useState({isVisible:!1,message:"",severity:"info"}),[Ye,Ve]=C.useState({isOpen:!1,warnings:[]}),ft=(z=[])=>{Ve({isOpen:!0,warnings:Array.isArray(z)?z.slice():[]})},dt=()=>Ve({isOpen:!1,warnings:[]}),[xt,lt]=C.useState({past:[],present:{tab:j,editingPersonId:null},future:[]}),[bt,ot]=C.useState(!1),fe=C.useRef({}),ze=z=>{try{const q=fe.current[z];if(!q)return;const ne=q.before,se=(n&&n.people?n.people:[]).find(Oe=>Oe.id===z);if(!se){delete fe.current[z];return}const me={firstName:se.firstName,lastName:se.lastName,refNumber:se.refNumber},Se={};if(ne.firstName!==me.firstName&&(Se.firstName={before:ne.firstName,after:me.firstName}),ne.lastName!==me.lastName&&(Se.lastName={before:ne.lastName,after:me.lastName}),ne.refNumber!==me.refNumber&&(Se.refNumber={before:ne.refNumber,after:me.refNumber}),Object.keys(Se).length>0)try{Xe({type:"edit",entityType:"person",entityId:z,details:{before:ne,after:me,changes:Se}})}catch{}}catch{}finally{const q=fe.current[z];q&&q.timer&&clearTimeout(q.timer),delete fe.current[z]}},Me=(z,q="success")=>{window.statusTimeout&&clearTimeout(window.statusTimeout),Ce({isVisible:!0,message:z,severity:q}),window.statusTimeout=setTimeout(()=>{Ce({isVisible:!1,message:"",severity:"info"})},4e3)},He=C.useCallback(()=>{try{et({tab:j,editingPersonId:null})}catch{}v(null),S(null),O(!1),ke(!1)},[j]),et=z=>{const q={tab:z.tab||j,editingPersonId:z.editingPersonId||null,selectedSourceId:z.selectedSourceId||null,selectedPlaceId:z.selectedPlaceId||null};lt(ne=>({past:[...ne.past,ne.present],present:q,future:[]}))},st=()=>{lt(z=>{const{past:q,present:ne,future:se}=z;if(q.length===0)return z;const me=q[q.length-1],Se=q.slice(0,-1),Oe=[ne,...se];if(me.editingPersonId){const Je=(n&&n.people?n.people:[]).find(Qe=>Qe.id===me.editingPersonId);v(Je?JSON.parse(JSON.stringify(Je)):null)}else v(null);return E(me.tab||"people"),{past:Se,present:me,future:Oe}})},rt=()=>{lt(z=>{const{past:q,present:ne,future:se}=z;if(se.length===0)return z;const me=se[0],Se=se.slice(1),Oe=[...q,ne];if(me.editingPersonId){const Je=(n&&n.people?n.people:[]).find(Qe=>Qe.id===me.editingPersonId);v(Je?JSON.parse(JSON.stringify(Je)):null)}else v(null);return E(me.tab||"people"),{past:Oe,present:me,future:Se}})},ht=()=>ot(z=>!z),St=z=>{if(!z)return;const{tab:q,editingPersonId:ne,selectedSourceId:se,selectedPlaceId:me}=z;if(ne){const Oe=n.people.find(Je=>Je.id===ne);v(Oe?JSON.parse(JSON.stringify(Oe)):null)}else v(null);E(q||"people"),G(Oe=>({...Oe,selectedSourceId:se||null})),$(Oe=>({...Oe,selectedPlaceId:me||null}));const Se=!!ne;se&&Se?(O(!0),ke(!1)):O(!1),me&&Se?(ke(!0),O(!1)):ke(!1),ot(!1)};function ee(z=null,q=null){if(te&&X.selectedPlaceId===z){ke(!1),$(ne=>({...ne,selectedPlaceId:null,pendingLink:null}));try{et({tab:j,editingPersonId:y?.id||null,selectedPlaceId:null})}catch{}}else{ke(!0),O(!1),$(ne=>({...ne,selectedPlaceId:z,pendingLink:q||null}));try{et({tab:j,editingPersonId:y?.id||null,selectedPlaceId:z})}catch{}}}const oe=(z=null)=>{ke(!0),O(!1),$(q=>({...q,selectedPlaceId:null,pendingLink:null})),T(z&&typeof z=="object"?{mediaId:z.id,mediaItem:z,type:"place"}:z?{mediaId:z,type:"place"}:null)};function xe(z=null){if(U&&Ee.selectedPersonId===z){ge(!1),ie(q=>({...q,selectedPersonId:null}));try{et({tab:j,editingPersonId:y?.id||null,selectedPlaceId:null})}catch{}}else{ge(!0),O(!1),ke(!1),ie(q=>({...q,selectedPersonId:z}));try{et({tab:j,editingPersonId:y?.id||null,selectedPlaceId:null})}catch{}}}const $e=z=>{$(q=>({...q,selectedPlaceId:z})),y?ke(!0):E("places");try{et({tab:y?j:"places",editingPersonId:y?.id||null,selectedPlaceId:z})}catch{}};C.useEffect(()=>{window.electronAPI&&window.electronAPI.onInitialData&&window.electronAPI.onInitialData(({data:z,filePath:q})=>{console.log("Mottog initial data frn senast ppnade fil:",q),e(z),L(z.meta?.bookmarks||[]),_(z.meta?.focusPair||{primary:null,secondary:null}),Me(`ppnade senast anvnda fil: ${q.split(/[\\/]/).pop()}`)})},[]);const Xt=z=>{e(q=>({...q,meta:{...q.meta||{},auditBackupDir:z}})),i(!0),Me(z?`Audit-backup-mapp satt: ${z}`:"Audit-backup-mapp rensad.")},Ot=async()=>{if(a&&!confirm("Du har osparade ndringar. Vill du verkligen skapa en ny fil?"))return;const z=await qb();if(!z){Me("Skapande avbrutet.");return}e({people:[],relations:[]}),l({name:z.dbPath?z.dbPath.split(/[\\/]/).pop():"namnls.db",path:z.dbPath}),i(!1),Me(`Ny databas skapad: ${z.dbPath}`)},_t=async()=>{if(a&&!confirm("Du har osparade ndringar. Vill du kasta dem och ppna en ny fil?"))return;let z=null;try{z=await uS()}catch(ne){Me("Kunde inte ppna dialog: "+(ne.message||ne),"error");return}if(!z)return;const q=await Fb(z);q&&(e(q.people?{...q,meta:{}}:q.data),L(q.meta?.bookmarks||[]),_(q.meta?.focusPair||{primary:null,secondary:null}),l({name:z.split(/[\\/]/).pop(),path:z}),i(!1),Me(`Filen '${z.split(/[\\/]/).pop()}' ppnades.`))},xn=C.useRef(!1),bn=!!(window&&window.electronAPI&&typeof window.electronAPI.saveFileAs=="function"),Cn=async(z="button")=>{if(bn&&z!=="menu"){Me("Anvnd menyn fr Spara som i desktop-lge!");return}if(!xn.current){xn.current=!0;try{const q={...n,meta:{...n.meta,focusPair:D,bookmarks:H}},ne=await hS(q);return ne&&(l(ne),i(!1),window.electronAPI&&ne.path,Me(`Sparad som '${ne.name||ne.path||"fil"}'.`)),ne}finally{setTimeout(()=>{xn.current=!1},500)}}},ss=async()=>{let z=t;if(!z&&(z=await Cn(),!z))return;const q={...n,meta:{...n.meta,focusPair:D,bookmarks:H}};console.log("[DEBUG] Sparar till backend:",{fileHandle:z,antalPersoner:Array.isArray(q.people)?q.people.length:"ej array",personer:Array.isArray(q.people)&&q.people.length>0?q.people.map(se=>({id:se.id,firstName:se.firstName,lastName:se.lastName})):q.people}),await fS(z,q)&&(i(!1),Me("Sparad!"))},Gs=(z,q)=>{_(se=>z==="primary"&&q===se.secondary?{primary:q,secondary:se.primary}:z==="secondary"&&q===se.primary?{primary:se.secondary,secondary:q}:{...se,[z]:q}),i(!0),Me(`Ny ${z==="primary"?"Primr":"Sekundr"} Fokusperson vald.`)};function Re(z){const q={...z},ne=["country","region","municipality","parish","village","specific"];for(const se of ne)if(typeof q[se]=="string"){let me=q[se].trim();me.length>0&&(me=me.charAt(0).toUpperCase()+me.slice(1).toLowerCase()),q[se]=me}return q}const Le=async z=>{const q={...Re(z),matched_place_id:"user"};try{const ne=await fetch("http://127.0.0.1:5005/place",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!ne.ok)throw new Error("Kunde inte spara platsen i backend");const se=await ne.json(),me=await fetch("http://127.0.0.1:5005/places"),Se=me.ok?await me.json():[];e(Oe=>({...Oe,places:Se})),i(!0),$(Oe=>({...Oe,selectedPlaceId:se.id}));try{Xe({type:"create",entityType:"place",entityId:se.id,details:{label:se.specific||""}})}catch{}Me("Ny plats skapad och sparad!")}catch{Me("Kunde inte spara platsen i backend.","error")}},Jt=async z=>{const q=Re(z);if(q.id)try{if(!(await fetch(`http://127.0.0.1:5005/place/${q.id}/match`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...q,matched_place_id:q.matched_place_id||"user"})})).ok)throw new Error("Kunde inte spara platsen i backend")}catch{Me("Kunde inte spara platsen i backend.","error");return}e(ne=>({...ne,places:ne.places.map(se=>se.id===q.id?q:se)})),i(!0),Me("Platsen har sparats."),y&&v(ne=>ne&&JSON.parse(JSON.stringify(ne)));try{Xe({type:"edit",entityType:"place",entityId:q.id,details:{label:[q.specific,q.village].filter(Boolean).join(", ")}})}catch{}},Gt=z=>{L(q=>q.includes(z)?q.filter(se=>se!==z):[...q,z]),i(!0)},Yt=()=>_(z=>({primary:z.secondary,secondary:z.primary})),yn=()=>_({primary:null,secondary:null}),$n=z=>{if(z.preventDefault(),!d.trim()||!h.trim())return alert("Frnamn och efternamn fr inte vara tomma.");const q=(n&&n.people?n.people:[]).reduce((se,me)=>me.refNumber>se?me.refNumber:se,0),ne={id:`p_${Date.now()}`,refNumber:q+1,firstName:d.trim(),lastName:h.trim(),gender:"",events:[],notes:"",links:{},relations:{parents:[],children:[]}};e({...n,people:n&&n.people?[...n.people,ne]:[ne]}),i(!0),Me(`Personen '${ne.firstName} ${ne.lastName}' lades till.`);try{Xe({type:"create",entityType:"person",entityId:ne.id,details:{refNumber:ne.refNumber,name:`${ne.firstName} ${ne.lastName}`}})}catch{}u(""),p("")},Qt=(z,q)=>{window.undoTimeout&&clearTimeout(window.undoTimeout),Q({isVisible:!0,message:z,onUndo:q}),window.undoTimeout=setTimeout(()=>{Q({isVisible:!1,message:"",onUndo:null})},1e4)},ws=z=>{const q=(n&&n.people?n.people:[]).find(Oe=>Oe.id===z);if(!q)return;const ne=n,se=(n&&n.people?n.people:[]).filter(Oe=>Oe.id!==z),me=(n.relations||[]).map(Oe=>Oe.fromPersonId===z||Oe.toPersonId===z?{...Oe,_archived:!0,modifiedAt:new Date().toISOString()}:Oe),Se=qn(me,se||[]);e({...n,people:Se,relations:me}),i(!0),Qt(`Personen '${q.firstName} ${q.lastName}' har raderats.`,()=>e(ne));try{Xe({type:"archive",entityType:"person",entityId:q.id,details:{name:`${q.firstName} ${q.lastName}`}})}catch{}},En=C.useCallback(z=>{if(!z){v(null),S(null);return}const q=(n&&n.people?n.people:[]).find(ne=>ne.id===z);if(!q){typeof Me=="function"&&Me("Fel: Person hittades inte.","error"),v(null),S(null);return}try{et({tab:j,editingPersonId:z})}catch{}v(JSON.parse(JSON.stringify(q))),S(JSON.parse(JSON.stringify(q)))},[n&&n.people?n.people:[],Me,j,et]),Ys=()=>{if(i(!1),!!y){try{const z=N,q=y;if(z&&q&&z.id===q.id){const ne={firstName:z.firstName,lastName:z.lastName,refNumber:z.refNumber},se={firstName:q.firstName,lastName:q.lastName,refNumber:q.refNumber},me={};if(ne.firstName!==se.firstName&&(me.firstName={before:ne.firstName,after:se.firstName}),ne.lastName!==se.lastName&&(me.lastName={before:ne.lastName,after:se.lastName}),ne.refNumber!==se.refNumber&&(me.refNumber={before:ne.refNumber,after:se.refNumber}),Object.keys(me).length>0)try{Xe({type:"edit",entityType:"person",entityId:q.id,details:{before:ne,after:se,changes:me}})}catch{}}}catch{}i(!1),Me("ndringar sparade."),He()}},ls=z=>{if(!z)return;y&&v(z);const q=(n&&n.people?n.people:[]).findIndex(se=>se.id===z.id);if(q===-1)return;const ne=n&&n.people?[...n.people]:[];ne[q]=z,e(se=>({...se,people:ne})),i(!0);try{const se=z.id;if(!fe.current[se]){const Se=n.people.find(Oe=>Oe.id===se)||{firstName:"",lastName:"",refNumber:""};fe.current[se]={before:{firstName:Se.firstName,lastName:Se.lastName,refNumber:Se.refNumber},timer:null}}fe.current[se]&&fe.current[se].timer&&clearTimeout(fe.current[se].timer),fe.current[se].timer=setTimeout(()=>ze(se),1500)}catch{}},zt=z=>{y&&He();try{et({tab:z,editingPersonId:y?.id||null})}catch{}E(z)},F=(z,q)=>{const ne=n,se=(n&&n.people?n.people:[]).findIndex(Je=>Je.id===z);if(se===-1)return;const me=n&&n.people?[...n.people]:[],Se={...me[se]};if(!Se.events||!Se.events[q])return;const Oe=Se.events[q];Se.events.splice(q,1),me[se]=Se,e({...n,people:me}),y&&y.id===z&&v(Se),i(!0),Qt(`Hndelsen '${Oe.type}' har raderats.`,()=>e(ne))},ye=C.useCallback(z=>{A(z),y&&He(),E("familyTree")},[y,He]);C.useEffect(()=>()=>{try{const z=Object.keys(fe.current||{});for(const q of z){const ne=fe.current[q];ne&&ne.timer&&clearTimeout(ne.timer)}fe.current={}}catch{}},[]);const be=z=>{const q=n,ne=n.people.map(se=>se.id===z.id?z:se);e(se=>({...se,people:ne})),i(!0),Qt("Relationer har uppdaterats.",()=>e(q))},qe=z=>{if(!w||w.type!=="source")return;const{mediaId:q}=w,ne=n.sources?.find(se=>se.id===z);ne&&(e(se=>{const me=Array.isArray(se.media)?se.media:[],Je=(me.some(Qe=>Qe.id===q)?me:w?.mediaItem?[...me,w.mediaItem]:me).map(Qe=>{if(Qe.id!==q)return Qe;const Te=Array.isArray(Qe.connections?.sources)?Qe.connections.sources:[];return Te.some(yt=>yt.id===z)?(Me("Kllan r redan kopplad","warning"),Qe):{...Qe,connections:{...Qe.connections,sources:[...Te,ne]}}});return{...se,media:Je}}),i(!0),Me("Klla kopplad till bild!"),O(!1),T(null))},jt=z=>{if(!w||w.type!=="place")return;const{mediaId:q}=w;if(!z||!z.id){Me("Ogiltig plats","error");return}const ne={id:z.id,name:z.name,type:z.type||"Plats"};e(se=>{const me=Array.isArray(se.media)?se.media:[],Je=(me.some(Qe=>Qe.id===q)?me:w?.mediaItem?[...me,w.mediaItem]:me).map(Qe=>{if(Qe.id!==q)return Qe;const Te=Array.isArray(Qe.connections?.places)?Qe.connections.places:[];return Te.some(yt=>yt.id===z.id)?(Me("Platsen r redan kopplad","warning"),Qe):{...Qe,connections:{...Qe.connections,places:[...Te,ne]}}});return{...se,media:Je}}),i(!0),Me("Plats kopplad till bild!"),ke(!1),T(null)},Bt=z=>{G(q=>({...q,selectedSourceId:z})),y?O(!0):E("sources");try{et({tab:y?j:"sources",editingPersonId:y?.id||null,selectedSourceId:z})}catch{}},fl=(z=null)=>{O(!0),ke(!1),de(null),T(z&&typeof z=="object"?{mediaId:z.id,mediaItem:z,type:"source"}:z?{mediaId:z,type:"source"}:null)},Rs=(z,q)=>{if(pe&&J?.eventId===q){O(!1),de(null);try{et({tab:j,editingPersonId:y?.id||null,selectedSourceId:null})}catch{}}else{O(!0),ke(!1),de({personId:z,eventId:q});try{et({tab:j,editingPersonId:y?.id||null,selectedSourceId:V.selectedSourceId||null})}catch{}}},Ss=z=>{if(console.log(" handleLinkSourceFromDrawer called with:",{sourceId:z,sourcingEventInfo:J,hasDbData:!!n.people}),!J){console.log(" No sourcingEventInfo");return}const{personId:q,eventId:ne}=J;if(ne==="__editing__"){window.__addSourceToEvent?(window.__addSourceToEvent(z),Me("Klla tillagd!"),console.log(" Source added to editing event via callback"),O(!1),de(null)):console.log(" No __addSourceToEvent callback found");return}console.log(" Looking for person:",q,"event:",ne);const se=n.people.findIndex(Qe=>Qe.id===q);if(se===-1){console.log(" Person not found:",q);return}const me=[...n.people],Se={...me[se]};console.log(" Found person:",Se.firstName,Se.lastName,"Events:",Se.events?.length);const Oe=Se.events.findIndex(Qe=>Qe.id===ne);if(Oe===-1){console.log(" Event not found:",ne,"Available events:",Se.events.map(Qe=>({id:Qe.id,type:Qe.type})));return}console.log(" Found event at index:",Oe);const Je={...Se.events[Oe]};Je.sources.includes(z)?console.log(" Source already linked"):(Je.sources.push(z),Se.events[Oe]=Je,e(Qe=>({...Qe,people:me})),v(Se),i(!0),console.log(" Source linked successfully!"),Me("Klla kopplad!"),O(!1),de(null))},rs=z=>{if(!J)return;const{personId:q,eventId:ne}=J,se=n.people.findIndex(Qe=>Qe.id===q);if(se===-1)return;const me=[...n.people],Se={...me[se]},Oe=Se.events.findIndex(Qe=>Qe.id===ne);if(Oe===-1)return;const Je={...Se.events[Oe]};Je.sources&&Je.sources.includes(z)&&(Je.sources=Je.sources.filter(Qe=>Qe!==z),Se.events[Oe]=Je,me[se]=Se,e(Qe=>({...Qe,people:me})),v(Se),i(!0),Me("Koppling borttagen."))},qn=(z,q)=>{const ne=new Map((q||[]).map(me=>[me.id,{...me,relations:{parents:[],children:[],spouseId:null,siblings:[]}}]));for(const me of z||[]){if(!me||me._archived)continue;const Se=me.fromPersonId,Oe=me.toPersonId;if(!Se||!Oe)continue;const Je=(me.type||"").toLowerCase();ne.has(Se)||ne.set(Se,{id:Se,firstName:"",lastName:"",relations:{parents:[],children:[],spouseId:null,siblings:[]}}),ne.has(Oe)||ne.set(Oe,{id:Oe,firstName:"",lastName:"",relations:{parents:[],children:[],spouseId:null,siblings:[]}});const Qe=ne.get(Se),Te=ne.get(Oe);Je==="parent"?(Te.relations.parents=Array.from(new Set([...Te.relations.parents||[],Se])),Qe.relations.children=Array.from(new Set([...Qe.relations.children||[],Oe]))):Je==="child"?(Qe.relations.parents=Array.from(new Set([...Qe.relations.parents||[],Oe])),Te.relations.children=Array.from(new Set([...Te.relations.children||[],Se]))):Je==="spouse"||Je==="partner"?(Qe.relations.spouseId=Oe,Te.relations.spouseId=Se):Je==="sibling"&&(Qe.relations.siblings=Array.from(new Set([...Qe.relations.siblings||[],Oe])),Te.relations.siblings=Array.from(new Set([...Te.relations.siblings||[],Se])))}const se=(q||[]).map(me=>{const Se=ne.get(me.id)||me;return{...me,relations:{...Se.relations||{}}}});for(const[me,Se]of ne.entries())se.find(Oe=>Oe.id===me)||se.push({id:Se.id,firstName:Se.firstName||"",lastName:Se.lastName||"",relations:Se.relations});return se},Xe=({type:z,entityType:q,entityId:ne=null,actor:se=null,details:me=null,sourceIds:Se=[]}={})=>{try{const Oe={id:`audit_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,type:z||"edit",entityType:q||"unknown",entityId:ne||null,actor:se||n?.meta?.currentUser||"local",timestamp:new Date().toISOString(),details:me||null,sourceIds:Array.isArray(Se)?Se.slice():[]};e(Je=>({...Je,meta:{...Je.meta||{},audit:[...Je.meta?.audit||[],Oe]}}));try{const Je=n?.meta?.audit||[],Qe=Array.isArray(Je)?Je.concat([Oe]):[Oe];localStorage.setItem("wft_audit_backup",JSON.stringify(Qe));try{if(window.electronAPI&&typeof window.electronAPI.saveAuditBackup=="function"){const Te="audit_backup.json",yt=n?.meta?.auditBackupDir||null;window.electronAPI.saveAuditBackup(Te,JSON.stringify(Qe),yt).then(qt=>{if(!(qt&&qt.success))try{Me("Misslyckades spara audit-backup till disk.")}catch{}}).catch(qt=>{try{Me("Misslyckades spara audit-backup (IPC).")}catch{}})}}catch{}}catch{}return Oe.id}catch{return null}},as=z=>{try{let me={...{PARENT_MIN_YEARS:15,PARENT_MAX_YEARS:60,PARENT_LOOSE_MIN:11,LARGE_AGE_GAP:50,SIBLING_LARGE_GAP:10,SPOUSAL_LARGE_GAP:30,POSTHUMOUS_TOLERANCE:1}};try{const pt=window.localStorage.getItem("relationEngineConfig");pt&&(me={...me,...JSON.parse(pt)||{}})}catch{}if(z.fromPersonId&&z.toPersonId&&z.fromPersonId===z.toPersonId){Me("Ogiltig relation: en person kan inte relateras till sig sjlv.","error");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"self-relation prevented",svMessage:"Ogiltig relation: en person kan inte relateras till sig sjlv.",relation:z}})}catch{}return null}const Se=new Map((n.people||[]).map(pt=>[pt.id,pt])),Oe=pt=>{if(!pt)return null;const Pt=pt.toString().match(/(\d{3,4})/);if(!Pt)return null;const rn=parseInt(Pt[1],10);return isNaN(rn)?null:rn},Je=(z.type||"").toString().toLowerCase(),Qe=Se.get(z.fromPersonId)||null,Te=Se.get(z.toPersonId)||null;let yt=null,qt=null;if(Qe&&Array.isArray(Qe.events)){const pt=Qe.events.find(Pt=>Pt.type==="Fdelse"||Pt.type==="Birth");pt&&(yt=Oe(pt.date))}if(Te&&Array.isArray(Te.events)){const pt=Te.events.find(Pt=>Pt.type==="Fdelse"||Pt.type==="Birth");pt&&(qt=Oe(pt.date))}if(Je==="parent"&&yt!==null&&qt!==null){const pt=qt-yt;if(pt<=0){Me("Ogiltig relation: datumkontradiktion (barn ftt fre eller samtidigt som frlder).","error");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"date contradiction prevented",svMessage:"Ogiltig relation: datumkontradiktion (barn ftt fre eller samtidigt som frlder).",relation:z}})}catch{}return null}if(pt<me.PARENT_LOOSE_MIN){Me(`Varning: freslagen frlder var endast ${pt} r vid barnets fdelse.`,"warn");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"parent very young",svMessage:`Varning: freslagen frlder var endast ${pt} r vid barnets fdelse.`,relation:z,ageDiff:pt}})}catch{}}if(pt>me.LARGE_AGE_GAP){Me(`Varning: mycket stor ldersskillnad (${pt} r) mellan frlder och barn.`,"warn");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"parent large gap",svMessage:`Varning: mycket stor ldersskillnad (${pt} r) mellan frlder och barn.`,relation:z,ageDiff:pt}})}catch{}}}if(Je==="spouse"&&yt!==null&&qt!==null){const pt=Math.abs(yt-qt);if(pt>=me.SPOUSAL_LARGE_GAP){Me(`Varning: stor ldersskillnad mellan makar (${pt} r).`,"warn");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"spousal large gap",svMessage:`Varning: stor ldersskillnad mellan makar (${pt} r).`,relation:z,gap:pt}})}catch{}}}}catch{}const q={id:z.id||`rel_${Date.now()}`,type:(z.type||"other").toString(),fromPersonId:z.fromPersonId||null,toPersonId:z.toPersonId||null,roleFrom:z.roleFrom||null,roleTo:z.roleTo||null,startDate:z.startDate||"",endDate:z.endDate||"",certainty:z.certainty!==void 0?z.certainty:null,sourceIds:Array.isArray(z.sourceIds)?z.sourceIds.slice():[],note:z.note||"",reason:z.reason||"",createdBy:z.createdBy||n?.meta?.currentUser||"local",createdAt:z.createdAt||new Date().toISOString(),modifiedAt:new Date().toISOString(),modifiedBy:z.modifiedBy||n?.meta?.currentUser||"local",_archived:!!z._archived};if((n.relations||[]).some(se=>!se._archived&&se.fromPersonId===q.fromPersonId&&se.toPersonId===q.toPersonId&&(se.type||"").toString().toLowerCase()===(q.type||"").toString().toLowerCase())){Me("Relation redan finns  ingen ndring gjord.");try{Xe({type:"warning",entityType:"relation-validation",details:{message:"duplicate prevented",svMessage:"Relation redan finns  ingen ndring gjord.",relation:q}})}catch{}return null}e(se=>{const me=[...se.relations||[],q],Se=qn(me,se.people||[]);return{...se,relations:me,people:Se}}),i(!0),Me("Relation tillagd.");try{Xe({type:"link",entityType:"relation",entityId:q.id,details:{relation:q}})}catch{}return q.id},pn=(z,q)=>{e(ne=>{const se=(ne.relations||[]).map(Se=>{if(Se.id!==z)return Se;const Oe={...Se,...q};return Oe.modifiedAt=new Date().toISOString(),Oe.modifiedBy=q.modifiedBy||ne.meta?.currentUser||"local",q.sourceIds&&(Oe.sourceIds=Array.isArray(q.sourceIds)?q.sourceIds.slice():Oe.sourceIds),Oe}),me=qn(se,ne.people||[]);return{...ne,relations:se,people:me}}),i(!0),Me("Relation uppdaterad.");try{Xe({type:"edit",entityType:"relation",entityId:z,details:q})}catch{}},Mt=z=>{e(q=>{const ne=(q.relations||[]).map(me=>me.id===z?{...me,_archived:!0,modifiedAt:new Date().toISOString(),modifiedBy:q.meta?.currentUser||"local"}:me),se=qn(ne,q.people||[]);return{...q,relations:ne,people:se}}),i(!0),Me("Relation arkiverad.");try{Xe({type:"archive",entityType:"relation",entityId:z})}catch{}},On=z=>(n.relations||[]).filter(q=>!q._archived&&(q.fromPersonId===z||q.toPersonId===z)),is=(z=[])=>{if(!Array.isArray(z)||z.length===0)return[];const q=[],ne=[],se=new Set((n.relations||[]).filter(Te=>!Te._archived).map(Te=>`${Te.fromPersonId}|${Te.toPersonId}|${(Te.type||"").toLowerCase()}`));let me={PARENT_MIN_YEARS:15,PARENT_MAX_YEARS:60,PARENT_LOOSE_MIN:11,LARGE_AGE_GAP:50,SIBLING_LARGE_GAP:10,SPOUSAL_LARGE_GAP:30,POSTHUMOUS_TOLERANCE:1};try{const Te=window.localStorage.getItem("relationEngineConfig");Te&&(me={...me,...JSON.parse(Te)||{}})}catch{}const Se=new Map((n.people||[]).map(Te=>[Te.id,Te])),Oe=Te=>{if(!Te)return null;const yt=Te.toString().match(/(\d{3,4})/);if(!yt)return null;const qt=parseInt(yt[1],10);return isNaN(qt)?null:qt},Je=new Map;for(const Te of n.relations||[])Te._archived||(Te.type||"").toString().toLowerCase()==="parent"&&Te.fromPersonId&&Te.toPersonId&&(Je.has(Te.fromPersonId)||Je.set(Te.fromPersonId,new Set),Je.get(Te.fromPersonId).add(Te.toPersonId));const Qe=(Te,yt,qt,pt=new Set)=>{if(!Te||!yt)return!1;if(Te===yt)return!0;if(pt.has(Te))return!1;pt.add(Te);const Pt=qt.get(Te);if(!Pt)return!1;for(const rn of Pt)if(rn===yt||Qe(rn,yt,qt,pt))return!0;return!1};for(const Te of z){if(!Te||!Te.fromPersonId||!Te.toPersonId)continue;if(Te.fromPersonId===Te.toPersonId){ne.push(`Ignorerar omjlig relation: person ${Te.fromPersonId} kan inte vara slkt med sig sjlv.`);continue}const yt=`${Te.fromPersonId}|${Te.toPersonId}|${(Te.type||"").toLowerCase()}`;if(se.has(yt))continue;const qt=Se.get(Te.fromPersonId)||null,pt=Se.get(Te.toPersonId)||null;let Pt=null,rn=null;if(qt&&Array.isArray(qt.events)){const Ht=qt.events.find(Rn=>Rn.type==="Fdelse"||Rn.type==="Birth");Ht&&(Pt=Oe(Ht.date))}if(pt&&Array.isArray(pt.events)){const Ht=pt.events.find(Rn=>Rn.type==="Fdelse"||Rn.type==="Birth");Ht&&(rn=Oe(Ht.date))}if((Te.type||"").toString().toLowerCase()==="parent"&&Pt!==null&&rn!==null){const Ht=rn-Pt;if(Ht<=0){ne.push(`Ignorerar relation pga. datumkontradiktion: freslagen frlder ${Te.fromPersonId} ser yngre eller lika gammal ut som barnet ${Te.toPersonId}.`);continue}Ht<me.PARENT_LOOSE_MIN&&ne.push(`Varning: freslagen frlder ${Te.fromPersonId} var endast ${Ht} r vid ${Te.toPersonId}s fdelse.`),Ht>me.LARGE_AGE_GAP&&ne.push(`Varning: stor ldersskillnad (${Ht} r) mellan ${Te.fromPersonId} och ${Te.toPersonId}.`)}if((Te.type||"").toString().toLowerCase()==="spouse"&&Pt!==null&&rn!==null){const Ht=Math.abs(Pt-rn);Ht>=me.SPOUSAL_LARGE_GAP&&ne.push(`Varning: stor ldersskillnad (${Ht} r) mellan makar ${Te.fromPersonId} och ${Te.toPersonId}.`)}if((Te.type||"").toString().toLowerCase()==="parent"){const Ht=Te.fromPersonId,Rn=Te.toPersonId;if(Qe(Rn,Ht,Je)){ne.push(`Ignorerar relation pga. slktcykel: att lgga till ${Ht} som frlder till ${Rn} skulle skapa en cyklisk hrstamning.`);continue}}const ir={type:Te.type||"other",fromPersonId:Te.fromPersonId,toPersonId:Te.toPersonId,certainty:typeof Te.confidence=="number"?Te.confidence:null,sourceIds:Te.sourceId?[Te.sourceId]:Te.sourceIds||[],note:`Auto-fill from source (confidence=${Te.confidence||0}). Reasons: ${(Te.reasons||[]).join(", ")}`,reason:"auto-fill-from-source",createdBy:n?.meta?.currentUser||"local"},Nl=as(ir);if(Nl&&q.push({id:Nl,relation:ir}),Nl&&(Te.type||"").toString().toLowerCase()==="parent"){const Ht=Te.fromPersonId,Rn=Te.toPersonId;Ht&&Rn&&(Je.has(Ht)||Je.set(Ht,new Set),Je.get(Ht).add(Rn))}se.add(yt)}if(q.length>0){try{Xe({type:"link",entityType:"relation-bulk",details:{count:q.length,summary:q.map(Te=>({id:Te.id,type:Te.relation.type,from:Te.relation.fromPersonId,to:Te.relation.toPersonId}))},sourceIds:Array.from(new Set(q.flatMap(Te=>Te.relation.sourceIds||[])))})}catch{}i(!0),Me(`${q.length} relationer skapade frn klla.`)}if(ne.length>0){const Te=Array.from(new Set(ne)).slice(0,5);try{Xe({type:"warning",entityType:"relation-validation",details:{warnings:Te,svWarnings:Te}})}catch{}Me(`${Te.length} varning(ar): ${Te.join("  ")}`,"error");try{ft(Te)}catch{}}return q.map(Te=>Te.id)},vn=(z,q="")=>{e(ne=>({...ne,people:(ne.people||[]).map(se=>se.id===z?{...se,_archived:!0,archiveReason:q}:se)})),i(!0),Me("Person flyttad till arkiv.");try{Xe({type:"archive",entityType:"person",entityId:z,details:{reason:q}})}catch{}},Xs=z=>{e(q=>{const ne=(q.people||[]).map(se=>se.id===z?(()=>{const me={...se};return delete me._archived,delete me.archiveReason,me})():se);if(y&&y.id===z){const se=ne.find(me=>me.id===z);try{v(se?JSON.parse(JSON.stringify(se)):null)}catch{v(se||null)}}i(!0),Me("Person terstlld frn arkiv.");try{Xe({type:"restore",entityType:"person",entityId:z})}catch{}return{...q,people:ne}})},rr=z=>{if(!z)return!1;const q=n;e(ne=>{const se=(ne.people||[]).filter(Se=>Se.id!==z),me=(ne.relations||[]).filter(Se=>Se.fromPersonId!==z&&Se.toPersonId!==z);return{...ne,people:se,relations:me}}),i(!0),Qt("Person raderad permanent.",()=>e(q));try{Xe({type:"delete",entityType:"person",entityId:z})}catch{}return!0},Dl=({mergedIntoId:z,originalPersonIds:q,createdBy:ne})=>{const se=(n.people||[]).filter(Se=>q.includes(Se.id)).map(Se=>JSON.parse(JSON.stringify(Se))),me={id:`merge_${Date.now()}`,mergedIntoId:z,originalPersonIds:q.slice(),snapshot:se,createdBy:ne||"system",createdAt:new Date().toISOString()};return e(Se=>({...Se,meta:{...Se.meta||{},merges:[...Se.meta?.merges||[],me]}})),i(!0),Me("Merge registrerad."),me.id},Zr=z=>{const q=n.meta?.merges?.find(ne=>ne.id===z);return q?(e(ne=>{const se=new Map(ne.people.map(Oe=>[Oe.id,Oe]));for(const Oe of q.snapshot||[])se.set(Oe.id,Oe);const me=Array.from(se.values()),Se=(ne.meta?.merges||[]).filter(Oe=>Oe.id!==z);if(y&&y.id){const Oe=me.find(Je=>Je.id===y.id);if(Oe)try{v(JSON.parse(JSON.stringify(Oe)))}catch{v(Oe)}}return i(!0),Me("Merge terstlld."),{...ne,people:me,meta:{...ne.meta||{},merges:Se}}}),!0):!1},za=({targetId:z,sourceIds:q=[],createdBy:ne=null})=>{if(!z||!Array.isArray(q)||q.length===0)return null;const se=q.filter(Se=>Se&&Se!==z);if(se.length===0)return null;const me=Dl({mergedIntoId:z,originalPersonIds:se.slice(),createdBy:ne||n?.meta?.currentUser||"system"});e(Se=>{const Oe=pm(Se,z,se)||{archivedList:[]};new Set((Oe.archivedList||[]).map(qt=>qt.id));const Je=pS(Se.relations||[],z,se,Se.meta?.currentUser||ne||"system"),Qe=mS(Se.people||[],z,se).map(qt=>qt.id===z?{...qt}:qt);for(const qt of se){const pt=Qe.findIndex(Pt=>Pt.id===qt);pt!==-1&&(Qe[pt]={...Qe[pt],_archived:!0,archiveReason:`Merged into ${z} (merge ${me})`})}const Te=qn(Je,Qe||[]),yt={...Se.meta||{},lastMerge:me};return{...Se,relations:Je,people:Te,meta:yt}}),i(!0),Me("Personer sammanslagna. Du kan ngra via historiken.");try{Xe({type:"merge",entityType:"person",entityId:z,details:{sourceIds:se.slice(),mergeId:me}})}catch{}return me},Js=()=>{const z=n.people.reduce((ne,se)=>se.refNumber>ne?se.refNumber:ne,0),q={id:`p_${Date.now()}`,refNumber:z+1,firstName:"",lastName:"",gender:"",events:[],notes:"",links:{},relations:{parents:[],children:[],spouseId:null}};e(ne=>{const se=[...ne.people,q];return setTimeout(()=>En(q.id),0),{...ne,people:se}}),i(!0),Me(`Ny person (REF: ${q.refNumber}) skapad. Fyll i uppgifter.`);try{Xe({type:"create",entityType:"person",entityId:q.id,details:{refNumber:q.refNumber}})}catch{}},vl=(z,q,ne="")=>{de({personId:z,eventId:q});const se=Ep(ne||"");ue({sourceString:ne||"",...se,trust:4,tags:"",note:"",imagePreview:null,imageFile:null,imageFilename:"",imagePath:""}),P(!0)},cs=()=>{de(null),Z(!1),P(!1)},ds=z=>ue(q=>({...q,[z.target.name]:z.target.value})),Ol=()=>ue(z=>({...z,...Ep(z.sourceString)})),xs=async()=>{},Wr=(z,q=null)=>{e(ne=>{const se={...z,title:z.title||"",archive:z.archive||"",volume:z.volume||"",page:z.page||"",date:z.date||""},me=typeof Cd=="function"?Cd(se):se.title,Se={...se,sourceString:me},Oe=ne.sources||[],Je=Oe.find(Te=>(Te.sourceString||"").trim()===(me||"").trim()&&Te.id!==Se.id);let Qe;if(Je){const Te={...Je,...Se,id:Je.id};Qe=Oe.map(yt=>yt.id===Je.id?Te:yt).filter(yt=>yt.id!==Se.id),Me("Dubblett hittades  kllor slogs ihop!")}else Oe.some(yt=>yt.id===Se.id)?(Qe=Oe.map(yt=>yt.id===Se.id?Se:yt),Me("Klla uppdaterad!")):(Qe=[...Oe,Se],Me("Ny klla skapad!"));return{...ne,sources:Qe,people:q||ne.people}}),i(!0);try{const se=Array.isArray(n.sources)&&n.sources.some(me=>me.id===z.id)?"edit":"create";Xe({type:se,entityType:"source",entityId:z.id,details:{sourceString:z.sourceString}})}catch{}},ar=()=>{Ue.onUndo&&Ue.onUndo(),Q({isVisible:!1,message:"",onUndo:null}),window.undoTimeout&&clearTimeout(window.undoTimeout)},Rl=C.useCallback(z=>{const q=n,ne=n.sources.filter(me=>me.id!==z),se=n.people.map(me=>{const Se=me.events.map(Oe=>Oe.sources?.includes(z)?{...Oe,sources:Oe.sources.filter(Je=>Je!==z)}:Oe);return{...me,events:Se}});e({...n,sources:ne,people:se}),i(!0),Qt("Kllan har raderats.",()=>e(q));try{Xe({type:"delete",entityType:"source",entityId:z})}catch{}},[n]);return{dbData:n,setDbData:e,fileHandle:t,isDirty:a,setIsDirty:i,newFirstName:d,setNewFirstName:u,newLastName:h,setNewLastName:p,showSettings:g,setShowSettings:b,editingPerson:y,activeTab:j,focusPair:D,bookmarks:H,sourceCatalogState:V,setSourceCatalogState:G,placeCatalogState:X,setPlaceCatalogState:$,familyTreeFocusPersonId:R,setFamilyTreeFocusPersonId:A,editingRelationsForPerson:B,setEditingRelationsForPerson:Y,sourcingEventInfo:J,linkingMediaInfo:w,isAttachingSource:I,isSourceDrawerOpen:pe,isPlaceDrawerOpen:te,isCreatingSource:Ie,sourceState:we,undoState:Ue,statusToast:re,handleNewFile:Ot,handleOpenFile:_t,handleSaveFile:ss,handleSaveFileAs:Cn,handleAddPerson:$n,handleDeletePerson:ws,handleOpenEditModal:En,handleCloseEditModal:He,handleSavePersonDetails:Ys,handleEditFormChange:ls,handleTabChange:zt,handleDeleteEvent:F,handleViewInFamilyTree:ye,handleSaveRelations:be,handleNavigateToSource:Bt,handleNavigateToPlace:$e,handleToggleSourceDrawer:Rs,handleLinkSourceFromDrawer:Ss,handleUnlinkSourceFromDrawer:rs,handleLinkSourceToMedia:qe,handleLinkPlaceToMedia:jt,openSourceDrawerForSelection:fl,handleTogglePlaceDrawer:ee,openPlaceDrawerForSelection:oe,handleCreateAndEditPerson:Js,handleOpenSourceModal:vl,handleCloseSourceModal:cs,handleSourceFormChange:ds,handleParseSource:Ol,handleSaveSource:xs,handleSaveEditedSource:Wr,handleUndo:ar,handleDeleteSource:Rl,handleSetFocusPair:Gs,handleToggleBookmark:Gt,handleSwapFocus:Yt,handleClearFocus:yn,handleAddNewPlace:Le,handleSavePlace:Jt,handleAttachSources:z=>{if(!J||z.length===0)return;const q=n.people.findIndex(Je=>Je.id===J.personId);if(q===-1)return;const ne=[...n.people],se={...ne[q]},me=se.events.findIndex(Je=>Je.id===J.eventId);if(me===-1)return;const Se={...se.events[me]};Se.sources||(Se.sources=[]);const Oe=z.filter(Je=>!Se.sources.includes(Je));Se.sources=[...Se.sources,...Oe],se.events[me]=Se,ne[q]=se,e(Je=>({...Je,people:ne})),y&&y.id===J.personId&&v(se),i(!0),Me(`${Oe.length} kllor kopplades.`),cs()},handleSwitchToCreateSource:(z="")=>{Z(!1),ue({sourceString:z,archive:"",volume:"",imagePage:"",otherInfo:"",imagePreview:null,imageFile:null,imageFilename:"",imagePath:""})},addRelation:as,updateRelation:pn,unlinkRelation:Mt,getPersonRelations:On,handleBulkCreateRelations:is,archivePerson:vn,restorePerson:Xs,deletePersonPermanently:rr,isRelationshipDrawerOpen:U,setRelationshipDrawerOpen:ge,relationshipCatalogState:Ee,setRelationshipCatalogState:ie,handleToggleRelationshipDrawer:xe,recordMerge:Dl,undoMerge:Zr,mergePersons:za,showStatus:Me,recordAudit:Xe,setAuditBackupDir:Xt,bulkWarningsModal:Ye,openBulkWarningsModal:ft,closeBulkWarningsModal:dt,showUndoToast:Qt,applyHistoryEntry:St,historyState:xt,isHistoryOpen:bt,handleBack:st,handleForward:rt,handleShowHistory:ht}}const Xv=C.createContext(null);function Fs(){return C.useContext(Xv)}function xS({children:n}){const e=gS();return o.jsx(Xv.Provider,{value:e,children:n})}function bS({newFirstName:n,setNewFirstName:e,newLastName:t,setNewLastName:l,onAddPerson:a}){return o.jsxs("div",{className:"card p-5 sticky top-4",children:[o.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-200",children:"Snabbregistrering"}),o.jsxs("form",{onSubmit:a,className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-slate-300 uppercase mb-1",children:"Frnamn"}),o.jsx("input",{type:"text",placeholder:"T.ex. Anna MARIA",required:!0,value:n,onChange:i=>e(i.target.value),className:"w-full p-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),o.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Tips: Skriv tilltalsnamn med STORA bokstver."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-medium text-slate-300 uppercase mb-1",children:"Efternamn"}),o.jsx("input",{type:"text",placeholder:"T.ex. Andersson",required:!0,value:t,onChange:i=>l(i.target.value),className:"w-full p-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),o.jsx("button",{type:"submit",className:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-medium transition-colors shadow-sm",children:"Skapa Person"})]})]})}function yS({gender:n,className:e=""}){return n==="M"?o.jsx("svg",{className:`w-5 h-5 text-blue-200 fill-current ${e}`,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M12 2a5 5 0 0 0-5 5c0 2.47 1.8 4.5 4.1 4.92L11 13H9v2h2v7h2v-7h2v-2h-2l-.1-1.08A5 5 0 0 0 12 2zm0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3z"})}):n==="K"?o.jsx("svg",{className:`w-5 h-5 text-pink-200 fill-current ${e}`,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M12 2a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5zm0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3zm0 8c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4zm0 2c2.11 0 3.63.53 4.4 1H7.6c.77-.47 2.29-1 4.4-1z"})}):null}function vS({people:n,onOpenEditModal:e,onOpenRelationModal:t,onDeletePerson:l,focusPair:a,onSetFocusPair:i,bookmarks:d}){const u=_=>{const H=_.events?.find(X=>X.type==="Fdelse"),L=_.events?.find(X=>X.type==="Dd"),V=H?.date||"",G=L?.date||"";return!V&&!G?"":`(${V} - ${G})`},h=(_,H)=>{_.preventDefault(),window.electron&&window.electron.showPersonContextMenu&&window.electron.showPersonContextMenu(H)};C.useEffect(()=>{if(window.electron&&window.electron.onContextMenuCommand){const _=window.electron.onContextMenuCommand((H,L)=>{const V=n.find(G=>G.id===L);if(V)switch(H){case"edit-person":e(V.id);break;case"view-in-family-tree":t(V.id);break;case"set-primary-focus":i("primary",V.id);break;case"set-secondary-focus":i("secondary",V.id);break;case"delete-person":l(L);break;case"copy-ref":navigator.clipboard.writeText(V.refNumber);break;case"copy-name":navigator.clipboard.writeText(`${V.firstName} ${V.lastName}`);break}});return()=>_()}},[n,e,l,t,i]);const p=[...n].sort((_,H)=>_.refNumber-H.refNumber),g=p.filter(_=>d.includes(_.id)),b=p.filter(_=>!d.includes(_.id)),{dbData:y,undoMerge:v,restorePerson:N,showStatus:S,setFamilyTreeFocusPersonId:j,familyTreeFocusPersonId:E}=Fs(),D=({person:_})=>{const H=L=>{L.stopPropagation();const V=(y?.meta?.merges||[]).find(G=>(G.originalPersonIds||[]).includes(_.id));if(V&&v)try{const G=v(V.id);S(G?"Sammanfogning ngrad.":"terstllning misslyckades.")}catch{S("terstllning misslyckades.")}else if(N)try{N(_.id),S("Person terstlld frn arkiv.")}catch{S("terstllning misslyckades.")}else S("Ingen ngra-information hittades.")};return o.jsxs("div",{onContextMenu:L=>h(L,_.id),className:"flex justify-between items-center p-4 hover:bg-slate-700 transition border-b border-slate-700 last:border-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-xs text-slate-500 font-mono mr-2",children:["REF: ",_.refNumber]}),o.jsx("span",{onClick:L=>{L.stopPropagation(),i("primary",_.id)},className:`cursor-pointer text-xl ${_.id===a.primary?"text-yellow-400":"text-slate-500 hover:text-yellow-300"}`,title:"Stt som Primr Fokus",children:""}),o.jsx("span",{onClick:L=>{L.stopPropagation(),i("secondary",_.id)},className:`cursor-pointer text-xl ${_.id===a.secondary?"text-blue-500":"text-slate-500 hover:text-blue-400"}`,title:"Stt som Sekundr Fokus",children:""}),o.jsx(yS,{gender:_.gender,className:"mr-2 flex-shrink-0"}),o.jsxs("span",{className:"cursor-pointer hover:text-blue-400",onClick:()=>e(_.id),children:[o.jsxs("span",{className:"font-bold text-slate-200",children:[_.firstName," ",_.lastName]}),_._archived&&o.jsx("span",{className:"text-red-500 font-semibold ml-2",children:"ARKIVERAD"}),_._archived&&o.jsx("button",{onClick:L=>H(L),className:"ml-2 px-2 py-0.5 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"terstll"}),o.jsx("span",{className:"text-slate-400 text-sm font-normal ml-1",children:u(_)})]})]}),o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsx("button",{onClick:L=>{L.stopPropagation(),j(_.id),S("Huvudperson uppdaterad.")},title:"Huvudperson - stt som fokus i trdvyn",className:`px-2 py-0.5 text-xs border rounded ${E===_.id?"bg-yellow-600 border-yellow-500 text-yellow-100":"bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600"}`,children:"Huvudperson"}),o.jsx("button",{onClick:()=>e(_.id),title:"Redigera person",className:"px-2 py-0.5 text-xs bg-slate-700 border border-slate-600 text-slate-200 rounded hover:bg-slate-600",children:"Redigera"}),o.jsx("button",{onClick:()=>t(_.id),title:"Koppla person till annan",className:"px-2 py-0.5 text-xs border border-purple-600 text-purple-300 rounded hover:bg-purple-900",children:"Koppla"}),o.jsx("button",{onClick:()=>l(_.id),title:"Ta bort person",className:"px-2 py-0.5 text-xs border border-red-600 text-red-400 rounded hover:bg-red-900 font-semibold",children:"Ta bort"})]})]},_.id)};return o.jsx("div",{className:"lg:col-span-2 h-[84vh]",children:o.jsxs("div",{className:"card min-h-[500px] h-full flex flex-col",children:[o.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-900 flex justify-between items-center rounded-t-lg",children:[o.jsx("h2",{className:"font-semibold text-slate-200",children:"Mnniskor i databasen"}),o.jsxs("span",{className:"text-xs bg-slate-700 px-2 py-1 rounded-full text-slate-300",children:[n.length," st"]})]}),o.jsx("div",{className:"divide-y divide-slate-700 flex-grow max-h-[600px] overflow-y-auto bg-slate-800",children:n.length===0?o.jsx("div",{className:"p-8 text-center text-slate-500",children:"Registret r tomt."}):o.jsxs(o.Fragment,{children:[g.map(_=>o.jsx(D,{person:_},_.id)),g.length>0&&b.length>0&&o.jsx("hr",{className:"my-2 border-t-2 border-dashed border-slate-700"}),b.map(_=>o.jsx(D,{person:_},_.id))]})})]})})}const NS=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kS=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,l)=>l?l.toUpperCase():t.toLowerCase()),Kb=n=>{const e=kS(n);return e.charAt(0).toUpperCase()+e.slice(1)},Jv=(...n)=>n.filter((e,t,l)=>!!e&&e.trim()!==""&&l.indexOf(e)===t).join(" ").trim(),wS=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var SS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const jS=C.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:l,className:a="",children:i,iconNode:d,...u},h)=>C.createElement("svg",{ref:h,...SS,width:e,height:e,stroke:n,strokeWidth:l?Number(t)*24/Number(e):t,className:Jv("lucide",a),...!i&&!wS(u)&&{"aria-hidden":"true"},...u},[...d.map(([p,g])=>C.createElement(p,g)),...Array.isArray(i)?i:[i]]));const nt=(n,e)=>{const t=C.forwardRef(({className:l,...a},i)=>C.createElement(jS,{ref:i,iconNode:e,className:Jv(`lucide-${NS(Kb(n))}`,`lucide-${n}`,l),...a}));return t.displayName=Kb(n),t};const CS=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Hh=nt("activity",CS);const ES=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Qv=nt("arrow-left",ES);const MS=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],AS=nt("arrow-right",MS);const TS=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],Zv=nt("baby",TS);const DS=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Wv=nt("bookmark",DS);const OS=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],e1=nt("calendar",OS);const RS=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Mp=nt("camera",RS);const IS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],vd=nt("circle-alert",IS);const zS=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Gb=nt("cloud-upload",zS);const LS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 18a6 6 0 0 0 0-12v12z",key:"j4l70d"}]],_S=nt("contrast",LS);const BS=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],Yb=nt("crop",BS);const PS=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],HS=nt("download",PS);const $S=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],US=nt("file-exclamation-point",$S);const VS=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],wo=nt("file-text",VS);const qS=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]],FS=nt("flip-horizontal",qS);const KS=[["path",{d:"M21 8V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v3",key:"14bfxa"}],["path",{d:"M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3",key:"14rx03"}],["path",{d:"M4 12H2",key:"rhcxmi"}],["path",{d:"M10 12H8",key:"s88cx1"}],["path",{d:"M16 12h-2",key:"10asgb"}],["path",{d:"M22 12h-2",key:"14jgyd"}]],GS=nt("flip-vertical",KS);const YS=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],$h=nt("folder",YS);const XS=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],JS=nt("funnel",XS);const QS=[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]],t1=nt("git-fork",QS);const ZS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],WS=nt("globe",ZS);const ej=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],n1=nt("grid-3x3",ej);const tj=[["path",{d:"M12.409 5.824c-.702.792-1.15 1.496-1.415 2.166l2.153 2.156a.5.5 0 0 1 0 .707l-2.293 2.293a.5.5 0 0 0 0 .707L12 15",key:"idzbju"}],["path",{d:"M13.508 20.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5a5.5 5.5 0 0 1 9.591-3.677.6.6 0 0 0 .818.001A5.5 5.5 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5z",key:"1su70f"}]],nj=nt("heart-crack",tj);const sj=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ed=nt("heart",sj);const lj=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],rj=nt("house",lj);const aj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Or=nt("image",aj);const ij=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],oj=nt("info",ij);const cj=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],s1=nt("layers",cj);const dj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Po=nt("link",dj);const uj=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],mm=nt("list",uj);const fj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ni=nt("map-pin",fj);const hj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],l1=nt("maximize-2",hj);const pj=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],mj=nt("minimize-2",pj);const gj=[["path",{d:"M5 12h14",key:"1ays0h"}]],r1=nt("minus",gj);const xj=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],bj=nt("move-right",xj);const yj=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],Md=nt("network",yj);const vj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Xb=nt("pen-line",vj);const Nj=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],kj=nt("pen-tool",Nj);const wj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],gm=nt("pen",wj);const Sj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],gl=nt("plus",Sj);const jj=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Cj=nt("repeat",jj);const Ej=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Mj=nt("rotate-ccw",Ej);const Aj=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Ap=nt("rotate-cw",Aj);const Tj=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],a1=nt("save",Tj);const Dj=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]],Tp=nt("scan-face",Dj);const Oj=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Fr=nt("search",Oj);const Rj=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ij=nt("settings",Rj);const zj=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Jb=nt("square-check-big",zj);const Lj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Qb=nt("square",Lj);const _j=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Dp=nt("star",_j);const Bj=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Pj=nt("sun",Bj);const Hj=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],i1=nt("tag",Hj);const $j=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ol=nt("trash-2",$j);const Uj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],o1=nt("triangle-alert",Uj);const Vj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],c1=nt("user-plus",Vj);const qj=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Rr=nt("user",qj);const Fj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],bu=nt("users",Fj);const Kj=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ys=nt("x",Kj);const Gj=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Yj=nt("zoom-in",Gj);const Xj=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Jj=nt("zoom-out",Xj);let bo=null;function Vs({windowId:n,children:e,title:t,icon:l=s1,initialWidth:a=1e3,initialHeight:i=700,onClose:d,zIndex:u=null,isActive:h=!0,onActivate:p}){const b=C.useRef(n||`wf-${Date.now()}-${Math.random()}`).current,y=`windowState:${t.replace(/\s/g,"")}`,v=()=>{try{const w=JSON.parse(localStorage.getItem(y));if(w)return{x:w.x||100,y:w.y||50,width:Math.max(600,w.width||a),height:Math.max(400,w.height||i),isMaximized:!1,isMinimized:!1}}catch{}return{x:100,y:50,width:a,height:i,isMaximized:!1,isMinimized:!1}},[N,S]=C.useState(v),j=C.useRef(!1),E=C.useRef(!1),D=C.useRef({x:0,y:0}),_=C.useRef({w:0,h:0,x:0,y:0}),H=C.useRef(null),[L,V]=C.useState(null),G=w=>{V(w)},X=w=>{if(!w.isMaximized&&!w.isMinimized){const T={x:w.x,y:w.y,width:w.width,height:w.height};localStorage.setItem(y,JSON.stringify(T))}};C.useEffect(()=>{const w=I=>{j.current&&!N.isMaximized&&S(Z=>{const pe={...Z,x:I.clientX-D.current.x,y:I.clientY-D.current.y};return clearTimeout(H.current),H.current=setTimeout(()=>X(pe),50),pe}),E.current&&!N.isMaximized&&S(Z=>{const pe={...Z,width:Math.max(600,_.current.w+(I.clientX-_.current.x)),height:Math.max(400,_.current.h+(I.clientY-_.current.y))};return clearTimeout(H.current),H.current=setTimeout(()=>X(pe),50),pe})},T=()=>{(j.current||E.current)&&(j.current=!1,E.current=!1,X(N))};return window.addEventListener("mousemove",w),window.addEventListener("mouseup",T),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",T),clearTimeout(H.current)}},[N.isMaximized,N.x,N.y,N.width,N.height]),C.useEffect(()=>(bo=b,p&&p(),()=>{bo===b&&(bo=null)}),[]),C.useEffect(()=>{const w=T=>{T.key==="Escape"&&bo===b&&(T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation(),d())};return window.addEventListener("keydown",w,!0),()=>{window.removeEventListener("keydown",w,!0)}},[d,b]);const $=w=>{N.isMaximized||N.isMinimized||(j.current=!0,D.current={x:w.clientX-N.x,y:w.clientY-N.y})},R=w=>{w.stopPropagation(),!(N.isMaximized||N.isMinimized)&&(E.current=!0,_.current={w:N.width,h:N.height,x:w.clientX,y:w.clientY})},A=()=>{S(w=>{const T={...w,isMaximized:!w.isMaximized,isMinimized:!1};return X(T),T})},B=()=>{S(w=>({...w,isMinimized:!w.isMinimized}))},Y=w=>{w.target===w.currentTarget&&!N.isMaximized&&d()},J=N.isMaximized?{top:0,left:0,width:"100%",height:"100%",borderRadius:0}:N.isMinimized?{bottom:10,left:10,width:250,height:40,overflow:"hidden"}:{top:N.y,left:N.x,width:N.width,height:N.height},de=u!==null?u:5e3;return o.jsxs("div",{className:"fixed z-[5000] inset-0",style:{zIndex:de},onMouseDown:Y,children:[o.jsxs("div",{className:`bg-slate-900 border border-slate-700 shadow-2xl flex flex-col overflow-hidden transition-all duration-200 ease-out 
             ${N.isMaximized?"":"rounded-xl"}`,style:{...J,position:"fixed"},onMouseDown:w=>{w.stopPropagation(),bo=b,p&&p()},children:[o.jsxs("div",{className:"bg-slate-900 border-b border-slate-800 p-2 flex justify-between items-center select-none cursor-grab active:cursor-grabbing",onMouseDown:$,onDoubleClick:A,children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-sm font-bold pl-2",children:[o.jsx(l,{size:16})," ",t]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("button",{onClick:B,className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",title:"Minimera",children:o.jsx(r1,{size:16})}),o.jsx("button",{onClick:A,className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",title:N.isMaximized?"terstll":"Maximera",children:N.isMaximized?o.jsx(mj,{size:16}):o.jsx(l1,{size:16})}),o.jsx("button",{onClick:d,className:"p-1.5 hover:bg-red-900/50 rounded text-slate-400 hover:text-red-400",title:"Stng",children:o.jsx(ys,{size:16})})]})]}),!N.isMinimized&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex-1 overflow-hidden",children:ps.isValidElement(e)?ps.cloneElement(e,{setDynamicFooter:G}):e}),o.jsxs("div",{className:"h-8 bg-slate-900 border-t border-slate-700 flex items-center px-4 text-xs text-slate-400 justify-between shrink-0",children:[L||o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx(Ij,{size:12,className:"text-slate-500"}),"Redo."]}),o.jsxs("span",{className:"text-slate-600",children:[N.width," x ",N.height," px"]})]})]}),!N.isMaximized&&!N.isMinimized&&o.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 cursor-se-resize flex items-center justify-center",onMouseDown:R,children:o.jsx("div",{className:"w-2 h-2 bg-slate-500 rounded-full"})})]}),o.jsx("style",{dangerouslySetInnerHTML:{__html:`
            .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
            .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
            .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; border: 2px solid #0f172a; }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
        `}})]})}const Qj=["sverige","sweden","swe"],Zj=["usa","united states","amerika","america"],Zb="ln",Wb=/^[A-Z]{2}$/;function Ad(n){let e=!1;if(!n||typeof n!="string")return{raw:n,parts:[],usedHeuristics:e};let t=n.split(",").map(u=>u.trim()).filter(Boolean);if(t.length===1){const u=n.split(/\s+/).filter(Boolean);if(u.length>2){t=[];let h=u.length-1;t.unshift(u[h]),h--,t.unshift(u[h]),h--,h>=0&&t.unshift(u.slice(0,h+1).join(" ")),e=!0}}let l=t[t.length-1]?.toLowerCase()||"",a=null,i=null;if(Qj.includes(l)?(a="SE",i="sweden"):Zj.includes(l)?(a="US",i="usa"):l.endsWith(Zb)?(a="SE",i="sweden",e=!0):Wb.test(l)?(a="US",i="usa",e=!0):l==="norge"||l==="norway"||l==="no"?(a="NO",i="norway"):(l==="finland"||l==="suomi"||l==="fi")&&(a="FI",i="finland"),!i&&t.length>0){const u=t[t.length-1];u.endsWith(Zb)?(a="SE",i="sweden",e=!0):Wb.test(u)&&(a="US",i="usa",e=!0)}let d={raw:n,parts:t,countryCode:a,type:i,usedHeuristics:e};return i==="sweden"?(d.land=t[t.length-1]||"",d.lan=t[t.length-2]||"",d.socken=t[t.length-3]||"",d.by=t[t.length-4]||"",d.gard=t[t.length-5]||""):i==="usa"?(d.land=t[t.length-1]||"",d.state=t[t.length-2]||"",d.county=t[t.length-3]||"",d.city=t[t.length-4]||"",d.address=t[t.length-5]||""):i==="norway"?(d.land=t[t.length-1]||"",d.fylke=t[t.length-2]||"",d.by=t[t.length-3]||""):i==="finland"&&(d.land=t[t.length-1]||"",d.lan=t[t.length-2]||"",d.by=t[t.length-3]||""),d}const Wj=[{value:"Country",label:"Land",icon:""},{value:"Landscape",label:"Landskap",icon:""},{value:"County",label:"Ln",icon:""},{value:"Municipality",label:"Kommun",icon:""},{value:"Parish",label:"Frsamling/socken",icon:""},{value:"Village",label:"By/Ort",icon:""},{value:"Building",label:"Byggnad",icon:""},{value:"Cemetary",label:"Kyrkogrd",icon:""}];function eC({place:n,onClose:e,onSave:t}){const[l,a]=C.useState({name:"",type:"Village",latitude:"",longitude:"",note:"",...n?.metadata}),[i,d]=C.useState(!1);C.useEffect(()=>{n&&a({name:n.name||"",type:n.type||"Village",latitude:n.metadata?.latitude||"",longitude:n.metadata?.longitude||"",note:n.metadata?.note||"",...n.metadata})},[n]);const u=p=>{const{name:g,value:b}=p.target;a(y=>({...y,[g]:b}))},h=async p=>{p.preventDefault(),d(!0);try{await t(l),e()}catch(g){alert("Kunde inte spara plats: "+g.message)}finally{d(!1)}};return n?o.jsxs("form",{onSubmit:h,className:"p-6 space-y-4 flex flex-col h-full",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-bold text-slate-300 mb-1",children:["Namn ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsx("input",{type:"text",name:"name",value:l.name,onChange:u,required:!0,className:"w-full px-3 py-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-slate-300 mb-1",children:"Typ"}),o.jsx("select",{name:"type",value:l.type,onChange:u,className:"w-full px-3 py-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:Wj.map(p=>o.jsxs("option",{value:p.value,children:[p.icon," ",p.label]},p.value))})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-slate-300 mb-1",children:"Latitud"}),o.jsx("input",{type:"number",step:"any",name:"latitude",value:l.latitude,onChange:u,placeholder:"55.6050",className:"w-full px-3 py-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-slate-300 mb-1",children:"Longitud"}),o.jsx("input",{type:"number",step:"any",name:"longitude",value:l.longitude,onChange:u,placeholder:"13.0038",className:"w-full px-3 py-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-bold text-slate-300 mb-1",children:"Notering"}),o.jsx("textarea",{name:"note",value:l.note,onChange:u,rows:4,className:"w-full px-3 py-2 border border-slate-600 rounded bg-slate-900 text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.ortnamn&&o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-sm",children:[o.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"Ortinformation"}),o.jsxs("div",{className:"text-blue-700",children:[l.ortnamn&&o.jsxs("div",{children:["Ort: ",l.ortnamn]}),l.kommunnamn&&o.jsxs("div",{children:["Kommun: ",l.kommunnamn]}),l.lansnamn&&o.jsxs("div",{children:["Ln: ",l.lansnamn]})]})]}),o.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-700",children:[o.jsx("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Sparar...":" Spara"}),o.jsx("button",{type:"button",onClick:e,disabled:i,className:"px-4 py-2 bg-slate-600 text-slate-200 font-semibold rounded hover:bg-slate-500 disabled:opacity-50",children:"Avbryt"})]})]}):null}const tC=[{value:"Village",label:"By/Ort",icon:""},{value:"Parish",label:"Frsamling/socken",icon:""},{value:"Municipality",label:"Kommun",icon:""},{value:"County",label:"Ln",icon:""},{value:"Building",label:"Byggnad",icon:""},{value:"Cemetary",label:"Kyrkogrd",icon:""}];function nC({parentNode:n,onClose:e,onCreate:t}){const[l,a]=C.useState({name:"",type:"Village",latitude:"",longitude:"",note:""}),[i,d]=C.useState(!1),u=p=>{const{name:g,value:b}=p.target;a(y=>({...y,[g]:b}))},h=async p=>{p.preventDefault(),d(!0);try{await t({...l,parentid:n?.metadata?.id||null}),e()}catch(g){alert("Kunde inte skapa plats: "+g.message)}finally{d(!1)}};return o.jsxs("form",{onSubmit:h,className:"p-6 space-y-4 flex flex-col h-full",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-300",children:"Namn"}),o.jsx("input",{type:"text",name:"name",value:l.name,onChange:u,required:!0,autoComplete:"off",className:"w-full border border-slate-600 bg-slate-900 text-slate-200 rounded px-3 py-2"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-300",children:"Typ"}),o.jsx("select",{name:"type",value:l.type,onChange:u,className:"w-full border border-slate-600 bg-slate-900 text-slate-200 rounded px-3 py-2",children:tC.map(p=>o.jsxs("option",{value:p.value,children:[p.icon," ",p.label]},p.value))})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-300",children:"Latitud"}),o.jsx("input",{type:"text",name:"latitude",value:l.latitude,onChange:u,autoComplete:"off",className:"w-full border border-slate-600 bg-slate-900 text-slate-200 rounded px-3 py-2"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-300",children:"Longitud"}),o.jsx("input",{type:"text",name:"longitude",value:l.longitude,onChange:u,autoComplete:"off",className:"w-full border border-slate-600 bg-slate-900 text-slate-200 rounded px-3 py-2"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-slate-300",children:"Notering"}),o.jsx("textarea",{name:"note",value:l.note,onChange:u,rows:3,className:"w-full border border-slate-600 bg-slate-900 text-slate-200 rounded px-3 py-2"})]}),o.jsxs("div",{className:"flex gap-2 pt-2",children:[o.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded",children:i?"Skapar...":"Skapa"}),o.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 bg-slate-700 text-slate-200 rounded",children:"Avbryt"})]})]})}var d1=Yv();const sC=hm(d1);var Uh={exports:{}},Vh={};var ey;function lC(){if(ey)return Vh;ey=1;var n=Jo();function e(b,y){return b===y&&(b!==0||1/b===1/y)||b!==b&&y!==y}var t=typeof Object.is=="function"?Object.is:e,l=n.useState,a=n.useEffect,i=n.useLayoutEffect,d=n.useDebugValue;function u(b,y){var v=y(),N=l({inst:{value:v,getSnapshot:y}}),S=N[0].inst,j=N[1];return i(function(){S.value=v,S.getSnapshot=y,h(S)&&j({inst:S})},[b,v,y]),a(function(){return h(S)&&j({inst:S}),b(function(){h(S)&&j({inst:S})})},[b]),d(v),v}function h(b){var y=b.getSnapshot;b=b.value;try{var v=y();return!t(b,v)}catch{return!0}}function p(b,y){return y()}var g=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:u;return Vh.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:g,Vh}var ty;function u1(){return ty||(ty=1,Uh.exports=lC()),Uh.exports}var f1=u1();function es(n){this.content=n}es.prototype={constructor:es,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var l=t&&t!=n?this.remove(t):this,a=l.find(n),i=l.content.slice();return a==-1?i.push(t||n,e):(i[a+1]=e,t&&(i[a]=t)),new es(i)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new es(t)},addToStart:function(n,e){return new es([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new es(t)},addBefore:function(n,e,t){var l=this.remove(e),a=l.content.slice(),i=l.find(n);return a.splice(i==-1?a.length:i,0,e,t),new es(a)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=es.from(n),n.size?new es(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=es.from(n),n.size?new es(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=es.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};es.from=function(n){if(n instanceof es)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new es(e)};function h1(n,e,t){for(let l=0;;l++){if(l==n.childCount||l==e.childCount)return n.childCount==e.childCount?null:t;let a=n.child(l),i=e.child(l);if(a==i){t+=a.nodeSize;continue}if(!a.sameMarkup(i))return t;if(a.isText&&a.text!=i.text){for(let d=0;a.text[d]==i.text[d];d++)t++;return t}if(a.content.size||i.content.size){let d=h1(a.content,i.content,t+1);if(d!=null)return d}t+=a.nodeSize}}function p1(n,e,t,l){for(let a=n.childCount,i=e.childCount;;){if(a==0||i==0)return a==i?null:{a:t,b:l};let d=n.child(--a),u=e.child(--i),h=d.nodeSize;if(d==u){t-=h,l-=h;continue}if(!d.sameMarkup(u))return{a:t,b:l};if(d.isText&&d.text!=u.text){let p=0,g=Math.min(d.text.length,u.text.length);for(;p<g&&d.text[d.text.length-p-1]==u.text[u.text.length-p-1];)p++,t--,l--;return{a:t,b:l}}if(d.content.size||u.content.size){let p=p1(d.content,u.content,t-1,l-1);if(p)return p}t-=h,l-=h}}class _e{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let l=0;l<e.length;l++)this.size+=e[l].nodeSize}nodesBetween(e,t,l,a=0,i){for(let d=0,u=0;u<t;d++){let h=this.content[d],p=u+h.nodeSize;if(p>e&&l(h,a+u,i||null,d)!==!1&&h.content.size){let g=u+1;h.nodesBetween(Math.max(0,e-g),Math.min(h.content.size,t-g),l,a+g)}u=p}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,l,a){let i="",d=!0;return this.nodesBetween(e,t,(u,h)=>{let p=u.isText?u.text.slice(Math.max(e,h)-h,t-h):u.isLeaf?a?typeof a=="function"?a(u):a:u.type.spec.leafText?u.type.spec.leafText(u):"":"";u.isBlock&&(u.isLeaf&&p||u.isTextblock)&&l&&(d?d=!1:i+=l),i+=p},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,l=e.firstChild,a=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(l)&&(a[a.length-1]=t.withText(t.text+l.text),i=1);i<e.content.length;i++)a.push(e.content[i]);return new _e(a,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let l=[],a=0;if(t>e)for(let i=0,d=0;d<t;i++){let u=this.content[i],h=d+u.nodeSize;h>e&&((d<e||h>t)&&(u.isText?u=u.cut(Math.max(0,e-d),Math.min(u.text.length,t-d)):u=u.cut(Math.max(0,e-d-1),Math.min(u.content.size,t-d-1))),l.push(u),a+=u.nodeSize),d=h}return new _e(l,a)}cutByIndex(e,t){return e==t?_e.empty:e==0&&t==this.content.length?this:new _e(this.content.slice(e,t))}replaceChild(e,t){let l=this.content[e];if(l==t)return this;let a=this.content.slice(),i=this.size+t.nodeSize-l.nodeSize;return a[e]=t,new _e(a,i)}addToStart(e){return new _e([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new _e(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,l=0;t<this.content.length;t++){let a=this.content[t];e(a,l,t),l+=a.nodeSize}}findDiffStart(e,t=0){return h1(this,e,t)}findDiffEnd(e,t=this.size,l=e.size){return p1(this,e,t,l)}findIndex(e){if(e==0)return od(0,e);if(e==this.size)return od(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,l=0;;t++){let a=this.child(t),i=l+a.nodeSize;if(i>=e)return i==e?od(t+1,i):od(t,l);l=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return _e.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new _e(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return _e.empty;let t,l=0;for(let a=0;a<e.length;a++){let i=e[a];l+=i.nodeSize,a&&i.isText&&e[a-1].sameMarkup(i)?(t||(t=e.slice(0,a)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new _e(t||e,l)}static from(e){if(!e)return _e.empty;if(e instanceof _e)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new _e([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}_e.empty=new _e([],0);const qh={index:0,offset:0};function od(n,e){return qh.index=n,qh.offset=e,qh}function Td(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let l=0;l<n.length;l++)if(!Td(n[l],e[l]))return!1}else{for(let l in n)if(!(l in e)||!Td(n[l],e[l]))return!1;for(let l in e)if(!(l in n))return!1}return!0}let on=class Op{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,l=!1;for(let a=0;a<e.length;a++){let i=e[a];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,a));else{if(i.type.excludes(this.type))return e;!l&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,a)),t.push(this),l=!0),t&&t.push(i)}}return t||(t=e.slice()),l||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Td(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let l=e.marks[t.type];if(!l)throw new RangeError(`There is no mark type ${t.type} in this schema`);let a=l.create(t.attrs);return l.checkAttrs(a.attrs),a}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let l=0;l<e.length;l++)if(!e[l].eq(t[l]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Op.none;if(e instanceof Op)return[e];let t=e.slice();return t.sort((l,a)=>l.type.rank-a.type.rank),t}};on.none=[];class Dd extends Error{}class Ze{constructor(e,t,l){this.content=e,this.openStart=t,this.openEnd=l}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let l=g1(this.content,e+this.openStart,t);return l&&new Ze(l,this.openStart,this.openEnd)}removeBetween(e,t){return new Ze(m1(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Ze.empty;let l=t.openStart||0,a=t.openEnd||0;if(typeof l!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ze(_e.fromJSON(e,t.content),l,a)}static maxOpen(e,t=!0){let l=0,a=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)l++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)a++;return new Ze(e,l,a)}}Ze.empty=new Ze(_e.empty,0,0);function m1(n,e,t){let{index:l,offset:a}=n.findIndex(e),i=n.maybeChild(l),{index:d,offset:u}=n.findIndex(t);if(a==e||i.isText){if(u!=t&&!n.child(d).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(l!=d)throw new RangeError("Removing non-flat range");return n.replaceChild(l,i.copy(m1(i.content,e-a-1,t-a-1)))}function g1(n,e,t,l){let{index:a,offset:i}=n.findIndex(e),d=n.maybeChild(a);if(i==e||d.isText)return l&&!l.canReplace(a,a,t)?null:n.cut(0,e).append(t).append(n.cut(e));let u=g1(d.content,e-i-1,t,d);return u&&n.replaceChild(a,d.copy(u))}function rC(n,e,t){if(t.openStart>n.depth)throw new Dd("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new Dd("Inconsistent open depths");return x1(n,e,t,0)}function x1(n,e,t,l){let a=n.index(l),i=n.node(l);if(a==e.index(l)&&l<n.depth-t.openStart){let d=x1(n,e,t,l+1);return i.copy(i.content.replaceChild(a,d))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==l&&e.depth==l){let d=n.parent,u=d.content;return wa(d,u.cut(0,n.parentOffset).append(t.content).append(u.cut(e.parentOffset)))}else{let{start:d,end:u}=aC(t,n);return wa(i,y1(n,d,u,e,l))}else return wa(i,Od(n,e,l))}function b1(n,e){if(!e.type.compatibleContent(n.type))throw new Dd("Cannot join "+e.type.name+" onto "+n.type.name)}function Rp(n,e,t){let l=n.node(t);return b1(l,e.node(t)),l}function ka(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function Mo(n,e,t,l){let a=(e||n).node(t),i=0,d=e?e.index(t):a.childCount;n&&(i=n.index(t),n.depth>t?i++:n.textOffset&&(ka(n.nodeAfter,l),i++));for(let u=i;u<d;u++)ka(a.child(u),l);e&&e.depth==t&&e.textOffset&&ka(e.nodeBefore,l)}function wa(n,e){return n.type.checkContent(e),n.copy(e)}function y1(n,e,t,l,a){let i=n.depth>a&&Rp(n,e,a+1),d=l.depth>a&&Rp(t,l,a+1),u=[];return Mo(null,n,a,u),i&&d&&e.index(a)==t.index(a)?(b1(i,d),ka(wa(i,y1(n,e,t,l,a+1)),u)):(i&&ka(wa(i,Od(n,e,a+1)),u),Mo(e,t,a,u),d&&ka(wa(d,Od(t,l,a+1)),u)),Mo(l,null,a,u),new _e(u)}function Od(n,e,t){let l=[];if(Mo(null,n,t,l),n.depth>t){let a=Rp(n,e,t+1);ka(wa(a,Od(n,e,t+1)),l)}return Mo(e,null,t,l),new _e(l)}function aC(n,e){let t=e.depth-n.openStart,a=e.node(t).copy(n.content);for(let i=t-1;i>=0;i--)a=e.node(i).copy(_e.from(a));return{start:a.resolveNoCache(n.openStart+t),end:a.resolveNoCache(a.content.size-n.openEnd-t)}}class Ho{constructor(e,t,l){this.pos=e,this.path=t,this.parentOffset=l,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let l=this.pos-this.path[this.path.length-1],a=e.child(t);return l?e.child(t).cut(l):a}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let l=this.path[t*3],a=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)a+=l.child(i).nodeSize;return a}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return on.none;if(this.textOffset)return e.child(t).marks;let l=e.maybeChild(t-1),a=e.maybeChild(t);if(!l){let u=l;l=a,a=u}let i=l.marks;for(var d=0;d<i.length;d++)i[d].type.spec.inclusive===!1&&(!a||!i[d].isInSet(a.marks))&&(i=i[d--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let l=t.marks,a=e.parent.maybeChild(e.index());for(var i=0;i<l.length;i++)l[i].type.spec.inclusive===!1&&(!a||!l[i].isInSet(a.marks))&&(l=l[i--].removeFromSet(l));return l}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let l=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);l>=0;l--)if(e.pos<=this.end(l)&&(!t||t(this.node(l))))return new Rd(this,e,l);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let l=[],a=0,i=t;for(let d=e;;){let{index:u,offset:h}=d.content.findIndex(i),p=i-h;if(l.push(d,u,a+h),!p||(d=d.child(u),d.isText))break;i=p-1,a+=h+1}return new Ho(t,l,i)}static resolveCached(e,t){let l=ny.get(e);if(l)for(let i=0;i<l.elts.length;i++){let d=l.elts[i];if(d.pos==t)return d}else ny.set(e,l=new iC);let a=l.elts[l.i]=Ho.resolve(e,t);return l.i=(l.i+1)%oC,a}}class iC{constructor(){this.elts=[],this.i=0}}const oC=12,ny=new WeakMap;class Rd{constructor(e,t,l){this.$from=e,this.$to=t,this.depth=l}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const cC=Object.create(null);class yl{constructor(e,t,l,a=on.none){this.type=e,this.attrs=t,this.marks=a,this.content=l||_e.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,l,a=0){this.content.nodesBetween(e,t,l,a,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,l,a){return this.content.textBetween(e,t,l,a)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,l){return this.type==e&&Td(this.attrs,t||e.defaultAttrs||cC)&&on.sameSet(this.marks,l||on.none)}copy(e=null){return e==this.content?this:new yl(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new yl(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,l=!1){if(e==t)return Ze.empty;let a=this.resolve(e),i=this.resolve(t),d=l?0:a.sharedDepth(t),u=a.start(d),p=a.node(d).content.cut(a.pos-u,i.pos-u);return new Ze(p,a.depth-d,i.depth-d)}replace(e,t,l){return rC(this.resolve(e),this.resolve(t),l)}nodeAt(e){for(let t=this;;){let{index:l,offset:a}=t.content.findIndex(e);if(t=t.maybeChild(l),!t)return null;if(a==e||t.isText)return t;e-=a+1}}childAfter(e){let{index:t,offset:l}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:l}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:l}=this.content.findIndex(e);if(l<e)return{node:this.content.child(t),index:t,offset:l};let a=this.content.child(t-1);return{node:a,index:t-1,offset:l-a.nodeSize}}resolve(e){return Ho.resolveCached(this,e)}resolveNoCache(e){return Ho.resolve(this,e)}rangeHasMark(e,t,l){let a=!1;return t>e&&this.nodesBetween(e,t,i=>(l.isInSet(i.marks)&&(a=!0),!a)),a}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),v1(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,l=_e.empty,a=0,i=l.childCount){let d=this.contentMatchAt(e).matchFragment(l,a,i),u=d&&d.matchFragment(this.content,t);if(!u||!u.validEnd)return!1;for(let h=a;h<i;h++)if(!this.type.allowsMarks(l.child(h).marks))return!1;return!0}canReplaceWith(e,t,l,a){if(a&&!this.type.allowsMarks(a))return!1;let i=this.contentMatchAt(e).matchType(l),d=i&&i.matchFragment(this.content,t);return d?d.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=on.none;for(let t=0;t<this.marks.length;t++){let l=this.marks[t];l.type.checkAttrs(l.attrs),e=l.addToSet(e)}if(!on.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let l;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");l=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,l)}let a=_e.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,a,l);return i.type.checkAttrs(i.attrs),i}}yl.prototype.text=void 0;class Id extends yl{constructor(e,t,l,a){if(super(e,t,null,a),!l)throw new RangeError("Empty text nodes are not allowed");this.text=l}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):v1(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Id(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Id(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function v1(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class Ea{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let l=new dC(e,t);if(l.next==null)return Ea.empty;let a=N1(l);l.next&&l.err("Unexpected trailing text");let i=xC(gC(a));return bC(i,l),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,l=e.childCount){let a=this;for(let i=t;a&&i<l;i++)a=a.matchType(e.child(i).type);return a}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let l=0;l<e.next.length;l++)if(this.next[t].type==e.next[l].type)return!0;return!1}fillBefore(e,t=!1,l=0){let a=[this];function i(d,u){let h=d.matchFragment(e,l);if(h&&(!t||h.validEnd))return _e.from(u.map(p=>p.createAndFill()));for(let p=0;p<d.next.length;p++){let{type:g,next:b}=d.next[p];if(!(g.isText||g.hasRequiredAttrs())&&a.indexOf(b)==-1){a.push(b);let y=i(b,u.concat(g));if(y)return y}}return null}return i(this,[])}findWrapping(e){for(let l=0;l<this.wrapCache.length;l+=2)if(this.wrapCache[l]==e)return this.wrapCache[l+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),l=[{match:this,type:null,via:null}];for(;l.length;){let a=l.shift(),i=a.match;if(i.matchType(e)){let d=[];for(let u=a;u.type;u=u.via)d.push(u.type);return d.reverse()}for(let d=0;d<i.next.length;d++){let{type:u,next:h}=i.next[d];!u.isLeaf&&!u.hasRequiredAttrs()&&!(u.name in t)&&(!a.type||h.validEnd)&&(l.push({match:u.contentMatch,type:u,via:a}),t[u.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(l){e.push(l);for(let a=0;a<l.next.length;a++)e.indexOf(l.next[a].next)==-1&&t(l.next[a].next)}return t(this),e.map((l,a)=>{let i=a+(l.validEnd?"*":" ")+" ";for(let d=0;d<l.next.length;d++)i+=(d?", ":"")+l.next[d].type.name+"->"+e.indexOf(l.next[d].next);return i}).join(`
`)}}Ea.empty=new Ea(!0);class dC{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function N1(n){let e=[];do e.push(uC(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function uC(n){let e=[];do e.push(fC(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function fC(n){let e=mC(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=hC(n,e);else break;return e}function sy(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function hC(n,e){let t=sy(n),l=t;return n.eat(",")&&(n.next!="}"?l=sy(n):l=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:l,expr:e}}function pC(n,e){let t=n.nodeTypes,l=t[e];if(l)return[l];let a=[];for(let i in t){let d=t[i];d.isInGroup(e)&&a.push(d)}return a.length==0&&n.err("No node type or group '"+e+"' found"),a}function mC(n){if(n.eat("(")){let e=N1(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=pC(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function gC(n){let e=[[]];return a(i(n,0),t()),e;function t(){return e.push([])-1}function l(d,u,h){let p={term:h,to:u};return e[d].push(p),p}function a(d,u){d.forEach(h=>h.to=u)}function i(d,u){if(d.type=="choice")return d.exprs.reduce((h,p)=>h.concat(i(p,u)),[]);if(d.type=="seq")for(let h=0;;h++){let p=i(d.exprs[h],u);if(h==d.exprs.length-1)return p;a(p,u=t())}else if(d.type=="star"){let h=t();return l(u,h),a(i(d.expr,h),h),[l(h)]}else if(d.type=="plus"){let h=t();return a(i(d.expr,u),h),a(i(d.expr,h),h),[l(h)]}else{if(d.type=="opt")return[l(u)].concat(i(d.expr,u));if(d.type=="range"){let h=u;for(let p=0;p<d.min;p++){let g=t();a(i(d.expr,h),g),h=g}if(d.max==-1)a(i(d.expr,h),h);else for(let p=d.min;p<d.max;p++){let g=t();l(h,g),a(i(d.expr,h),g),h=g}return[l(h)]}else{if(d.type=="name")return[l(u,void 0,d.value)];throw new Error("Unknown expr type")}}}}function k1(n,e){return e-n}function ly(n,e){let t=[];return l(e),t.sort(k1);function l(a){let i=n[a];if(i.length==1&&!i[0].term)return l(i[0].to);t.push(a);for(let d=0;d<i.length;d++){let{term:u,to:h}=i[d];!u&&t.indexOf(h)==-1&&l(h)}}}function xC(n){let e=Object.create(null);return t(ly(n,0));function t(l){let a=[];l.forEach(d=>{n[d].forEach(({term:u,to:h})=>{if(!u)return;let p;for(let g=0;g<a.length;g++)a[g][0]==u&&(p=a[g][1]);ly(n,h).forEach(g=>{p||a.push([u,p=[]]),p.indexOf(g)==-1&&p.push(g)})})});let i=e[l.join(",")]=new Ea(l.indexOf(n.length-1)>-1);for(let d=0;d<a.length;d++){let u=a[d][1].sort(k1);i.next.push({type:a[d][0],next:e[u.join(",")]||t(u)})}return i}}function bC(n,e){for(let t=0,l=[n];t<l.length;t++){let a=l[t],i=!a.validEnd,d=[];for(let u=0;u<a.next.length;u++){let{type:h,next:p}=a.next[u];d.push(h.name),i&&!(h.isText||h.hasRequiredAttrs())&&(i=!1),l.indexOf(p)==-1&&l.push(p)}i&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function w1(n){let e=Object.create(null);for(let t in n){let l=n[t];if(!l.hasDefault)return null;e[t]=l.default}return e}function S1(n,e){let t=Object.create(null);for(let l in n){let a=e&&e[l];if(a===void 0){let i=n[l];if(i.hasDefault)a=i.default;else throw new RangeError("No value supplied for attribute "+l)}t[l]=a}return t}function j1(n,e,t,l){for(let a in e)if(!(a in n))throw new RangeError(`Unsupported attribute ${a} for ${t} of type ${a}`);for(let a in n){let i=n[a];i.validate&&i.validate(e[a])}}function C1(n,e){let t=Object.create(null);if(e)for(let l in e)t[l]=new vC(n,l,e[l]);return t}let ry=class E1{constructor(e,t,l){this.name=e,this.schema=t,this.spec=l,this.markSet=null,this.groups=l.group?l.group.split(" "):[],this.attrs=C1(e,l.attrs),this.defaultAttrs=w1(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(l.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ea.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:S1(this.attrs,e)}create(e=null,t,l){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new yl(this,this.computeAttrs(e),_e.from(t),on.setFrom(l))}createChecked(e=null,t,l){return t=_e.from(t),this.checkContent(t),new yl(this,this.computeAttrs(e),t,on.setFrom(l))}createAndFill(e=null,t,l){if(e=this.computeAttrs(e),t=_e.from(t),t.size){let d=this.contentMatch.fillBefore(t);if(!d)return null;t=d.append(t)}let a=this.contentMatch.matchFragment(t),i=a&&a.fillBefore(_e.empty,!0);return i?new yl(this,e,t.append(i),on.setFrom(l)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let l=0;l<e.childCount;l++)if(!this.allowsMarks(e.child(l).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){j1(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let l=0;l<e.length;l++)this.allowsMarkType(e[l].type)?t&&t.push(e[l]):t||(t=e.slice(0,l));return t?t.length?t:on.none:e}static compile(e,t){let l=Object.create(null);e.forEach((i,d)=>l[i]=new E1(i,t,d));let a=t.spec.topNode||"doc";if(!l[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!l.text)throw new RangeError("Every schema needs a 'text' type");for(let i in l.text.attrs)throw new RangeError("The text node type should not have attributes");return l}};function yC(n,e,t){let l=t.split("|");return a=>{let i=a===null?"null":typeof a;if(l.indexOf(i)<0)throw new RangeError(`Expected value of type ${l} for attribute ${e} on type ${n}, got ${i}`)}}class vC{constructor(e,t,l){this.hasDefault=Object.prototype.hasOwnProperty.call(l,"default"),this.default=l.default,this.validate=typeof l.validate=="string"?yC(e,t,l.validate):l.validate}get isRequired(){return!this.hasDefault}}class yu{constructor(e,t,l,a){this.name=e,this.rank=t,this.schema=l,this.spec=a,this.attrs=C1(e,a.attrs),this.excluded=null;let i=w1(this.attrs);this.instance=i?new on(this,i):null}create(e=null){return!e&&this.instance?this.instance:new on(this,S1(this.attrs,e))}static compile(e,t){let l=Object.create(null),a=0;return e.forEach((i,d)=>l[i]=new yu(i,a++,t,d)),l}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){j1(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class M1{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let a in e)t[a]=e[a];t.nodes=es.from(e.nodes),t.marks=es.from(e.marks||{}),this.nodes=ry.compile(this.spec.nodes,this),this.marks=yu.compile(this.spec.marks,this);let l=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");let i=this.nodes[a],d=i.spec.content||"",u=i.spec.marks;if(i.contentMatch=l[d]||(l[d]=Ea.parse(d,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=u=="_"?null:u?ay(this,u.split(" ")):u==""||!i.inlineContent?[]:null}for(let a in this.marks){let i=this.marks[a],d=i.spec.excludes;i.excluded=d==null?[i]:d==""?[]:ay(this,d.split(" "))}this.nodeFromJSON=a=>yl.fromJSON(this,a),this.markFromJSON=a=>on.fromJSON(this,a),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,l,a){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof ry){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,l,a)}text(e,t){let l=this.nodes.text;return new Id(l,l.defaultAttrs,e,on.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function ay(n,e){let t=[];for(let l=0;l<e.length;l++){let a=e[l],i=n.marks[a],d=i;if(i)t.push(i);else for(let u in n.marks){let h=n.marks[u];(a=="_"||h.spec.group&&h.spec.group.split(" ").indexOf(a)>-1)&&t.push(d=h)}if(!d)throw new SyntaxError("Unknown mark type: '"+e[l]+"'")}return t}function NC(n){return n.tag!=null}function kC(n){return n.style!=null}let Ao=class Ip{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let l=this.matchedStyles=[];t.forEach(a=>{if(NC(a))this.tags.push(a);else if(kC(a)){let i=/[^=]*/.exec(a.style)[0];l.indexOf(i)<0&&l.push(i),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(a=>{if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;let i=e.nodes[a.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let l=new oy(this,t,!1);return l.addAll(e,on.none,t.from,t.to),l.finish()}parseSlice(e,t={}){let l=new oy(this,t,!0);return l.addAll(e,on.none,t.from,t.to),Ze.maxOpen(l.finish())}matchTag(e,t,l){for(let a=l?this.tags.indexOf(l)+1:0;a<this.tags.length;a++){let i=this.tags[a];if(jC(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let d=i.getAttrs(e);if(d===!1)continue;i.attrs=d||void 0}return i}}}matchStyle(e,t,l,a){for(let i=a?this.styles.indexOf(a)+1:0;i<this.styles.length;i++){let d=this.styles[i],u=d.style;if(!(u.indexOf(e)!=0||d.context&&!l.matchesContext(d.context)||u.length>e.length&&(u.charCodeAt(e.length)!=61||u.slice(e.length+1)!=t))){if(d.getAttrs){let h=d.getAttrs(t);if(h===!1)continue;d.attrs=h||void 0}return d}}}static schemaRules(e){let t=[];function l(a){let i=a.priority==null?50:a.priority,d=0;for(;d<t.length;d++){let u=t[d];if((u.priority==null?50:u.priority)<i)break}t.splice(d,0,a)}for(let a in e.marks){let i=e.marks[a].spec.parseDOM;i&&i.forEach(d=>{l(d=cy(d)),d.mark||d.ignore||d.clearMark||(d.mark=a)})}for(let a in e.nodes){let i=e.nodes[a].spec.parseDOM;i&&i.forEach(d=>{l(d=cy(d)),d.node||d.ignore||d.mark||(d.node=a)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ip(e,Ip.schemaRules(e)))}};const A1={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},wC={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},T1={ol:!0,ul:!0},$o=1,zp=2,To=4;function iy(n,e,t){return e!=null?(e?$o:0)|(e==="full"?zp:0):n&&n.whitespace=="pre"?$o|zp:t&~To}class cd{constructor(e,t,l,a,i,d){this.type=e,this.attrs=t,this.marks=l,this.solid=a,this.options=d,this.content=[],this.activeMarks=on.none,this.match=i||(d&To?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(_e.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let l=this.type.contentMatch,a;return(a=l.findWrapping(e.type))?(this.match=l,a):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&$o)){let l=this.content[this.content.length-1],a;if(l&&l.isText&&(a=/[ \t\r\n\u000c]+$/.exec(l.text))){let i=l;l.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-a[0].length))}}let t=_e.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(_e.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!A1.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class oy{constructor(e,t,l){this.parser=e,this.options=t,this.isOpen=l,this.open=0,this.localPreserveWS=!1;let a=t.topNode,i,d=iy(null,t.preserveWhitespace,0)|(l?To:0);a?i=new cd(a.type,a.attrs,on.none,!0,t.topMatch||a.type.contentMatch,d):l?i=new cd(null,null,on.none,!0,null,d):i=new cd(e.schema.topNodeType,null,on.none,!0,null,d),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let l=e.nodeValue,a=this.top,i=a.options&zp?"full":this.localPreserveWS||(a.options&$o)>0,{schema:d}=this.parser;if(i==="full"||a.inlineContext(e)||/[^ \t\r\n\u000c]/.test(l)){if(i)if(i==="full")l=l.replace(/\r\n?/g,`
`);else if(d.linebreakReplacement&&/[\r\n]/.test(l)&&this.top.findWrapping(d.linebreakReplacement.create())){let u=l.split(/\r?\n|\r/);for(let h=0;h<u.length;h++)h&&this.insertNode(d.linebreakReplacement.create(),t,!0),u[h]&&this.insertNode(d.text(u[h]),t,!/\S/.test(u[h]));l=""}else l=l.replace(/\r?\n|\r/g," ");else if(l=l.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(l)&&this.open==this.nodes.length-1){let u=a.content[a.content.length-1],h=e.previousSibling;(!u||h&&h.nodeName=="BR"||u.isText&&/[ \t\r\n\u000c]$/.test(u.text))&&(l=l.slice(1))}l&&this.insertNode(d.text(l),t,!/\S/.test(l)),this.findInText(e)}else this.findInside(e)}addElement(e,t,l){let a=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let d=e.nodeName.toLowerCase(),u;T1.hasOwnProperty(d)&&this.parser.normalizeLists&&SC(e);let h=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(u=this.parser.matchTag(e,this,l));e:if(h?h.ignore:wC.hasOwnProperty(d))this.findInside(e),this.ignoreFallback(e,t);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(e=h.skip);let p,g=this.needsBlock;if(A1.hasOwnProperty(d))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),p=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let b=h&&h.skip?t:this.readStyles(e,t);b&&this.addAll(e,b),p&&this.sync(i),this.needsBlock=g}else{let p=this.readStyles(e,t);p&&this.addElementByRule(e,h,p,h.consuming===!1?u:void 0)}this.localPreserveWS=a}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let l=e.style;if(l&&l.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let i=this.parser.matchedStyles[a],d=l.getPropertyValue(i);if(d)for(let u=void 0;;){let h=this.parser.matchStyle(i,d,this,u);if(!h)break;if(h.ignore)return null;if(h.clearMark?t=t.filter(p=>!h.clearMark(p)):t=t.concat(this.parser.schema.marks[h.mark].create(h.attrs)),h.consuming===!1)u=h;else break}}return t}addElementByRule(e,t,l,a){let i,d;if(t.node)if(d=this.parser.schema.nodes[t.node],d.isLeaf)this.insertNode(d.create(t.attrs),l,e.nodeName=="BR")||this.leafFallback(e,l);else{let h=this.enter(d,t.attrs||null,l,t.preserveWhitespace);h&&(i=!0,l=h)}else{let h=this.parser.schema.marks[t.mark];l=l.concat(h.create(t.attrs))}let u=this.top;if(d&&d.isLeaf)this.findInside(e);else if(a)this.addElement(e,l,a);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(h=>this.insertNode(h,l,!1));else{let h=e;typeof t.contentElement=="string"?h=e.querySelector(t.contentElement):typeof t.contentElement=="function"?h=t.contentElement(e):t.contentElement&&(h=t.contentElement),this.findAround(e,h,!0),this.addAll(h,l),this.findAround(e,h,!1)}i&&this.sync(u)&&this.open--}addAll(e,t,l,a){let i=l||0;for(let d=l?e.childNodes[l]:e.firstChild,u=a==null?null:e.childNodes[a];d!=u;d=d.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(d,t);this.findAtPoint(e,i)}findPlace(e,t,l){let a,i;for(let d=this.open,u=0;d>=0;d--){let h=this.nodes[d],p=h.findWrapping(e);if(p&&(!a||a.length>p.length+u)&&(a=p,i=h,!p.length))break;if(h.solid){if(l)break;u+=2}}if(!a)return null;this.sync(i);for(let d=0;d<a.length;d++)t=this.enterInner(a[d],null,t,!1);return t}insertNode(e,t,l){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let a=this.findPlace(e,t,l);if(a){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let d=on.none;for(let u of a.concat(e.marks))(i.type?i.type.allowsMarkType(u.type):dy(u.type,e.type))&&(d=u.addToSet(d));return i.content.push(e.mark(d)),!0}return!1}enter(e,t,l,a){let i=this.findPlace(e.create(t),l,!1);return i&&(i=this.enterInner(e,t,l,!0,a)),i}enterInner(e,t,l,a=!1,i){this.closeExtra();let d=this.top;d.match=d.match&&d.match.matchType(e);let u=iy(e,i,d.options);d.options&To&&d.content.length==0&&(u|=To);let h=on.none;return l=l.filter(p=>(d.type?d.type.allowsMarkType(p.type):dy(p.type,e))?(h=p.addToSet(h),!1):!0),this.nodes.push(new cd(e,t,h,a,null,u)),this.open++,l}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=$o)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let l=this.nodes[t].content;for(let a=l.length-1;a>=0;a--)e+=l[a].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let l=0;l<this.find.length;l++)this.find[l].node==e&&this.find[l].offset==t&&(this.find[l].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,l){if(e!=t&&this.find)for(let a=0;a<this.find.length;a++)this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)&&t.compareDocumentPosition(this.find[a].node)&(l?2:4)&&(this.find[a].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),l=this.options.context,a=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),i=-(l?l.depth+1:0)+(a?0:1),d=(u,h)=>{for(;u>=0;u--){let p=t[u];if(p==""){if(u==t.length-1||u==0)continue;for(;h>=i;h--)if(d(u-1,h))return!0;return!1}else{let g=h>0||h==0&&a?this.nodes[h].type:l&&h>=i?l.node(h-i).type:null;if(!g||g.name!=p&&!g.isInGroup(p))return!1;h--}}return!0};return d(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let l=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(l&&l.isTextblock&&l.defaultAttrs)return l}for(let t in this.parser.schema.nodes){let l=this.parser.schema.nodes[t];if(l.isTextblock&&l.defaultAttrs)return l}}}function SC(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let l=e.nodeType==1?e.nodeName.toLowerCase():null;l&&T1.hasOwnProperty(l)&&t?(t.appendChild(e),e=t):l=="li"?t=e:l&&(t=null)}}function jC(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function cy(n){let e={};for(let t in n)e[t]=n[t];return e}function dy(n,e){let t=e.schema.nodes;for(let l in t){let a=t[l];if(!a.allowsMarkType(n))continue;let i=[],d=u=>{i.push(u);for(let h=0;h<u.edgeCount;h++){let{type:p,next:g}=u.edge(h);if(p==e||i.indexOf(g)<0&&d(g))return!0}};if(d(a.contentMatch))return!0}}class Oa{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},l){l||(l=Fh(t).createDocumentFragment());let a=l,i=[];return e.forEach(d=>{if(i.length||d.marks.length){let u=0,h=0;for(;u<i.length&&h<d.marks.length;){let p=d.marks[h];if(!this.marks[p.type.name]){h++;continue}if(!p.eq(i[u][0])||p.type.spec.spanning===!1)break;u++,h++}for(;u<i.length;)a=i.pop()[1];for(;h<d.marks.length;){let p=d.marks[h++],g=this.serializeMark(p,d.isInline,t);g&&(i.push([p,a]),a.appendChild(g.dom),a=g.contentDOM||g.dom)}}a.appendChild(this.serializeNodeInner(d,t))}),l}serializeNodeInner(e,t){let{dom:l,contentDOM:a}=Nd(Fh(t),this.nodes[e.type.name](e),null,e.attrs);if(a){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,a)}return l}serializeNode(e,t={}){let l=this.serializeNodeInner(e,t);for(let a=e.marks.length-1;a>=0;a--){let i=this.serializeMark(e.marks[a],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(l),l=i.dom)}return l}serializeMark(e,t,l={}){let a=this.marks[e.type.name];return a&&Nd(Fh(l),a(e,t),null,e.attrs)}static renderSpec(e,t,l=null,a){return Nd(e,t,l,a)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Oa(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=uy(e.nodes);return t.text||(t.text=l=>l.text),t}static marksFromSchema(e){return uy(e.marks)}}function uy(n){let e={};for(let t in n){let l=n[t].spec.toDOM;l&&(e[t]=l)}return e}function Fh(n){return n.document||window.document}const fy=new WeakMap;function CC(n){let e=fy.get(n);return e===void 0&&fy.set(n,e=EC(n)),e}function EC(n){let e=null;function t(l){if(l&&typeof l=="object")if(Array.isArray(l))if(typeof l[0]=="string")e||(e=[]),e.push(l);else for(let a=0;a<l.length;a++)t(l[a]);else for(let a in l)t(l[a])}return t(n),e}function Nd(n,e,t,l){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let a=e[0],i;if(typeof a!="string")throw new RangeError("Invalid array passed to renderSpec");if(l&&(i=CC(l))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let d=a.indexOf(" ");d>0&&(t=a.slice(0,d),a=a.slice(d+1));let u,h=t?n.createElementNS(t,a):n.createElement(a),p=e[1],g=1;if(p&&typeof p=="object"&&p.nodeType==null&&!Array.isArray(p)){g=2;for(let b in p)if(p[b]!=null){let y=b.indexOf(" ");y>0?h.setAttributeNS(b.slice(0,y),b.slice(y+1),p[b]):b=="style"&&h.style?h.style.cssText=p[b]:h.setAttribute(b,p[b])}}for(let b=g;b<e.length;b++){let y=e[b];if(y===0){if(b<e.length-1||b>g)throw new RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}else{let{dom:v,contentDOM:N}=Nd(n,y,t,l);if(h.appendChild(v),N){if(u)throw new RangeError("Multiple content holes");u=N}}}return{dom:h,contentDOM:u}}const D1=65535,O1=Math.pow(2,16);function MC(n,e){return n+e*O1}function hy(n){return n&D1}function AC(n){return(n-(n&D1))/O1}const R1=1,I1=2,kd=4,z1=8;class Lp{constructor(e,t,l){this.pos=e,this.delInfo=t,this.recover=l}get deleted(){return(this.delInfo&z1)>0}get deletedBefore(){return(this.delInfo&(R1|kd))>0}get deletedAfter(){return(this.delInfo&(I1|kd))>0}get deletedAcross(){return(this.delInfo&kd)>0}}class Us{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Us.empty)return Us.empty}recover(e){let t=0,l=hy(e);if(!this.inverted)for(let a=0;a<l;a++)t+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[l*3]+t+AC(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,l){let a=0,i=this.inverted?2:1,d=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let h=this.ranges[u]-(this.inverted?a:0);if(h>e)break;let p=this.ranges[u+i],g=this.ranges[u+d],b=h+p;if(e<=b){let y=p?e==h?-1:e==b?1:t:t,v=h+a+(y<0?0:g);if(l)return v;let N=e==(t<0?h:b)?null:MC(u/3,e-h),S=e==h?I1:e==b?R1:kd;return(t<0?e!=h:e!=b)&&(S|=z1),new Lp(v,S,N)}a+=g-p}return l?e+a:new Lp(e+a,0,null)}touches(e,t){let l=0,a=hy(t),i=this.inverted?2:1,d=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let h=this.ranges[u]-(this.inverted?l:0);if(h>e)break;let p=this.ranges[u+i],g=h+p;if(e<=g&&u==a*3)return!0;l+=this.ranges[u+d]-p}return!1}forEach(e){let t=this.inverted?2:1,l=this.inverted?1:2;for(let a=0,i=0;a<this.ranges.length;a+=3){let d=this.ranges[a],u=d-(this.inverted?i:0),h=d+(this.inverted?0:i),p=this.ranges[a+t],g=this.ranges[a+l];e(u,u+p,h,h+g),i+=g-p}}invert(){return new Us(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Us.empty:new Us(e<0?[0,-e,0]:[0,0,e])}}Us.empty=new Us([]);class Uo{constructor(e,t,l=0,a=e?e.length:0){this.mirror=t,this.from=l,this.to=a,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Uo(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,l=this._maps.length;t<e._maps.length;t++){let a=e.getMirror(t);this.appendMap(e._maps[t],a!=null&&a<t?l+a:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,l=this._maps.length+e._maps.length;t>=0;t--){let a=e.getMirror(t);this.appendMap(e._maps[t].invert(),a!=null&&a>t?l-a-1:void 0)}}invert(){let e=new Uo;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let l=this.from;l<this.to;l++)e=this._maps[l].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,l){let a=0;for(let i=this.from;i<this.to;i++){let d=this._maps[i],u=d.mapResult(e,t);if(u.recover!=null){let h=this.getMirror(i);if(h!=null&&h>i&&h<this.to){i=h,e=this._maps[h].recover(u.recover);continue}}a|=u.delInfo,e=u.pos}return l?e:new Lp(e,a,null)}}const Kh=Object.create(null);class gs{getMap(){return Us.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let l=Kh[t.stepType];if(!l)throw new RangeError(`No step type ${t.stepType} defined`);return l.fromJSON(e,t)}static jsonID(e,t){if(e in Kh)throw new RangeError("Duplicate use of step JSON ID "+e);return Kh[e]=t,t.prototype.jsonID=e,t}}class Bn{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Bn(e,null)}static fail(e){return new Bn(null,e)}static fromReplace(e,t,l,a){try{return Bn.ok(e.replace(t,l,a))}catch(i){if(i instanceof Dd)return Bn.fail(i.message);throw i}}}function xm(n,e,t){let l=[];for(let a=0;a<n.childCount;a++){let i=n.child(a);i.content.size&&(i=i.copy(xm(i.content,e,i))),i.isInline&&(i=e(i,t,a)),l.push(i)}return _e.fromArray(l)}class Pr extends gs{constructor(e,t,l){super(),this.from=e,this.to=t,this.mark=l}apply(e){let t=e.slice(this.from,this.to),l=e.resolve(this.from),a=l.node(l.sharedDepth(this.to)),i=new Ze(xm(t.content,(d,u)=>!d.isAtom||!u.type.allowsMarkType(this.mark.type)?d:d.mark(this.mark.addToSet(d.marks)),a),t.openStart,t.openEnd);return Bn.fromReplace(e,this.from,this.to,i)}invert(){return new bl(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),l=e.mapResult(this.to,-1);return t.deleted&&l.deleted||t.pos>=l.pos?null:new Pr(t.pos,l.pos,this.mark)}merge(e){return e instanceof Pr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Pr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Pr(t.from,t.to,e.markFromJSON(t.mark))}}gs.jsonID("addMark",Pr);class bl extends gs{constructor(e,t,l){super(),this.from=e,this.to=t,this.mark=l}apply(e){let t=e.slice(this.from,this.to),l=new Ze(xm(t.content,a=>a.mark(this.mark.removeFromSet(a.marks)),e),t.openStart,t.openEnd);return Bn.fromReplace(e,this.from,this.to,l)}invert(){return new Pr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),l=e.mapResult(this.to,-1);return t.deleted&&l.deleted||t.pos>=l.pos?null:new bl(t.pos,l.pos,this.mark)}merge(e){return e instanceof bl&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new bl(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new bl(t.from,t.to,e.markFromJSON(t.mark))}}gs.jsonID("removeMark",bl);class Hr extends gs{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Bn.fail("No node at mark step's position");let l=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Bn.fromReplace(e,this.pos,this.pos+1,new Ze(_e.from(l),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let l=this.mark.addToSet(t.marks);if(l.length==t.marks.length){for(let a=0;a<t.marks.length;a++)if(!t.marks[a].isInSet(l))return new Hr(this.pos,t.marks[a]);return new Hr(this.pos,this.mark)}}return new Ma(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Hr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Hr(t.pos,e.markFromJSON(t.mark))}}gs.jsonID("addNodeMark",Hr);class Ma extends gs{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Bn.fail("No node at mark step's position");let l=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Bn.fromReplace(e,this.pos,this.pos+1,new Ze(_e.from(l),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Hr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ma(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ma(t.pos,e.markFromJSON(t.mark))}}gs.jsonID("removeNodeMark",Ma);class Kn extends gs{constructor(e,t,l,a=!1){super(),this.from=e,this.to=t,this.slice=l,this.structure=a}apply(e){return this.structure&&_p(e,this.from,this.to)?Bn.fail("Structure replace would overwrite content"):Bn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Us([this.from,this.to-this.from,this.slice.size])}invert(e){return new Kn(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),l=e.mapResult(this.to,-1);return t.deletedAcross&&l.deletedAcross?null:new Kn(t.pos,Math.max(t.pos,l.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Kn)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ze.empty:new Ze(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Kn(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ze.empty:new Ze(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Kn(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Kn(t.from,t.to,Ze.fromJSON(e,t.slice),!!t.structure)}}gs.jsonID("replace",Kn);class Yn extends gs{constructor(e,t,l,a,i,d,u=!1){super(),this.from=e,this.to=t,this.gapFrom=l,this.gapTo=a,this.slice=i,this.insert=d,this.structure=u}apply(e){if(this.structure&&(_p(e,this.from,this.gapFrom)||_p(e,this.gapTo,this.to)))return Bn.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Bn.fail("Gap is not a flat range");let l=this.slice.insertAt(this.insert,t.content);return l?Bn.fromReplace(e,this.from,this.to,l):Bn.fail("Content does not fit in gap")}getMap(){return new Us([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Yn(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),l=e.mapResult(this.to,-1),a=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?l.pos:e.map(this.gapTo,1);return t.deletedAcross&&l.deletedAcross||a<t.pos||i>l.pos?null:new Yn(t.pos,l.pos,a,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Yn(t.from,t.to,t.gapFrom,t.gapTo,Ze.fromJSON(e,t.slice),t.insert,!!t.structure)}}gs.jsonID("replaceAround",Yn);function _p(n,e,t){let l=n.resolve(e),a=t-e,i=l.depth;for(;a>0&&i>0&&l.indexAfter(i)==l.node(i).childCount;)i--,a--;if(a>0){let d=l.node(i).maybeChild(l.indexAfter(i));for(;a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}}return!1}function TC(n,e,t,l){let a=[],i=[],d,u;n.doc.nodesBetween(e,t,(h,p,g)=>{if(!h.isInline)return;let b=h.marks;if(!l.isInSet(b)&&g.type.allowsMarkType(l.type)){let y=Math.max(p,e),v=Math.min(p+h.nodeSize,t),N=l.addToSet(b);for(let S=0;S<b.length;S++)b[S].isInSet(N)||(d&&d.to==y&&d.mark.eq(b[S])?d.to=v:a.push(d=new bl(y,v,b[S])));u&&u.to==y?u.to=v:i.push(u=new Pr(y,v,l))}}),a.forEach(h=>n.step(h)),i.forEach(h=>n.step(h))}function DC(n,e,t,l){let a=[],i=0;n.doc.nodesBetween(e,t,(d,u)=>{if(!d.isInline)return;i++;let h=null;if(l instanceof yu){let p=d.marks,g;for(;g=l.isInSet(p);)(h||(h=[])).push(g),p=g.removeFromSet(p)}else l?l.isInSet(d.marks)&&(h=[l]):h=d.marks;if(h&&h.length){let p=Math.min(u+d.nodeSize,t);for(let g=0;g<h.length;g++){let b=h[g],y;for(let v=0;v<a.length;v++){let N=a[v];N.step==i-1&&b.eq(a[v].style)&&(y=N)}y?(y.to=p,y.step=i):a.push({style:b,from:Math.max(u,e),to:p,step:i})}}}),a.forEach(d=>n.step(new bl(d.from,d.to,d.style)))}function bm(n,e,t,l=t.contentMatch,a=!0){let i=n.doc.nodeAt(e),d=[],u=e+1;for(let h=0;h<i.childCount;h++){let p=i.child(h),g=u+p.nodeSize,b=l.matchType(p.type);if(!b)d.push(new Kn(u,g,Ze.empty));else{l=b;for(let y=0;y<p.marks.length;y++)t.allowsMarkType(p.marks[y].type)||n.step(new bl(u,g,p.marks[y]));if(a&&p.isText&&t.whitespace!="pre"){let y,v=/\r?\n|\r/g,N;for(;y=v.exec(p.text);)N||(N=new Ze(_e.from(t.schema.text(" ",t.allowedMarks(p.marks))),0,0)),d.push(new Kn(u+y.index,u+y.index+y[0].length,N))}}u=g}if(!l.validEnd){let h=l.fillBefore(_e.empty,!0);n.replace(u,u,new Ze(h,0,0))}for(let h=d.length-1;h>=0;h--)n.step(d[h])}function OC(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function Ai(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let l=n.depth,a=0,i=0;;--l){let d=n.$from.node(l),u=n.$from.index(l)+a,h=n.$to.indexAfter(l)-i;if(l<n.depth&&d.canReplace(u,h,t))return l;if(l==0||d.type.spec.isolating||!OC(d,u,h))break;u&&(a=1),h<d.childCount&&(i=1)}return null}function RC(n,e,t){let{$from:l,$to:a,depth:i}=e,d=l.before(i+1),u=a.after(i+1),h=d,p=u,g=_e.empty,b=0;for(let N=i,S=!1;N>t;N--)S||l.index(N)>0?(S=!0,g=_e.from(l.node(N).copy(g)),b++):h--;let y=_e.empty,v=0;for(let N=i,S=!1;N>t;N--)S||a.after(N+1)<a.end(N)?(S=!0,y=_e.from(a.node(N).copy(y)),v++):p++;n.step(new Yn(h,p,d,u,new Ze(g.append(y),b,v),g.size-b,!0))}function ym(n,e,t=null,l=n){let a=IC(n,e),i=a&&zC(l,e);return i?a.map(py).concat({type:e,attrs:t}).concat(i.map(py)):null}function py(n){return{type:n,attrs:null}}function IC(n,e){let{parent:t,startIndex:l,endIndex:a}=n,i=t.contentMatchAt(l).findWrapping(e);if(!i)return null;let d=i.length?i[0]:e;return t.canReplaceWith(l,a,d)?i:null}function zC(n,e){let{parent:t,startIndex:l,endIndex:a}=n,i=t.child(l),d=e.contentMatch.findWrapping(i.type);if(!d)return null;let h=(d.length?d[d.length-1]:e).contentMatch;for(let p=l;h&&p<a;p++)h=h.matchType(t.child(p).type);return!h||!h.validEnd?null:d}function LC(n,e,t){let l=_e.empty;for(let d=t.length-1;d>=0;d--){if(l.size){let u=t[d].type.contentMatch.matchFragment(l);if(!u||!u.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}l=_e.from(t[d].type.create(t[d].attrs,l))}let a=e.start,i=e.end;n.step(new Yn(a,i,a,i,new Ze(l,0,0),t.length,!0))}function _C(n,e,t,l,a){if(!l.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=n.steps.length;n.doc.nodesBetween(e,t,(d,u)=>{let h=typeof a=="function"?a(d):a;if(d.isTextblock&&!d.hasMarkup(l,h)&&BC(n.doc,n.mapping.slice(i).map(u),l)){let p=null;if(l.schema.linebreakReplacement){let v=l.whitespace=="pre",N=!!l.contentMatch.matchType(l.schema.linebreakReplacement);v&&!N?p=!1:!v&&N&&(p=!0)}p===!1&&_1(n,d,u,i),bm(n,n.mapping.slice(i).map(u,1),l,void 0,p===null);let g=n.mapping.slice(i),b=g.map(u,1),y=g.map(u+d.nodeSize,1);return n.step(new Yn(b,y,b+1,y-1,new Ze(_e.from(l.create(h,null,d.marks)),0,0),1,!0)),p===!0&&L1(n,d,u,i),!1}})}function L1(n,e,t,l){e.forEach((a,i)=>{if(a.isText){let d,u=/\r?\n|\r/g;for(;d=u.exec(a.text);){let h=n.mapping.slice(l).map(t+1+i+d.index);n.replaceWith(h,h+1,e.type.schema.linebreakReplacement.create())}}})}function _1(n,e,t,l){e.forEach((a,i)=>{if(a.type==a.type.schema.linebreakReplacement){let d=n.mapping.slice(l).map(t+1+i);n.replaceWith(d,d+1,e.type.schema.text(`
`))}})}function BC(n,e,t){let l=n.resolve(e),a=l.index();return l.parent.canReplaceWith(a,a+1,t)}function PC(n,e,t,l,a){let i=n.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let d=t.create(l,null,a||i.marks);if(i.isLeaf)return n.replaceWith(e,e+i.nodeSize,d);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new Yn(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Ze(_e.from(d),0,0),1,!0))}function nr(n,e,t=1,l){let a=n.resolve(e),i=a.depth-t,d=l&&l[l.length-1]||a.parent;if(i<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!d.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(let p=a.depth-1,g=t-2;p>i;p--,g--){let b=a.node(p),y=a.index(p);if(b.type.spec.isolating)return!1;let v=b.content.cutByIndex(y,b.childCount),N=l&&l[g+1];N&&(v=v.replaceChild(0,N.type.create(N.attrs)));let S=l&&l[g]||b;if(!b.canReplace(y+1,b.childCount)||!S.type.validContent(v))return!1}let u=a.indexAfter(i),h=l&&l[0];return a.node(i).canReplaceWith(u,u,h?h.type:a.node(i+1).type)}function HC(n,e,t=1,l){let a=n.doc.resolve(e),i=_e.empty,d=_e.empty;for(let u=a.depth,h=a.depth-t,p=t-1;u>h;u--,p--){i=_e.from(a.node(u).copy(i));let g=l&&l[p];d=_e.from(g?g.type.create(g.attrs,d):a.node(u).copy(d))}n.step(new Kn(e,e,new Ze(i.append(d),t,t),!0))}function Xr(n,e){let t=n.resolve(e),l=t.index();return B1(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(l,l+1)}function $C(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:l}=n.type.schema;for(let a=0;a<e.childCount;a++){let i=e.child(a),d=i.type==l?n.type.schema.nodes.text:i.type;if(t=t.matchType(d),!t||!n.type.allowsMarks(i.marks))return!1}return t.validEnd}function B1(n,e){return!!(n&&e&&!n.isLeaf&&$C(n,e))}function vu(n,e,t=-1){let l=n.resolve(e);for(let a=l.depth;;a--){let i,d,u=l.index(a);if(a==l.depth?(i=l.nodeBefore,d=l.nodeAfter):t>0?(i=l.node(a+1),u++,d=l.node(a).maybeChild(u)):(i=l.node(a).maybeChild(u-1),d=l.node(a+1)),i&&!i.isTextblock&&B1(i,d)&&l.node(a).canReplace(u,u+1))return e;if(a==0)break;e=t<0?l.before(a):l.after(a)}}function UC(n,e,t){let l=null,{linebreakReplacement:a}=n.doc.type.schema,i=n.doc.resolve(e-t),d=i.node().type;if(a&&d.inlineContent){let g=d.whitespace=="pre",b=!!d.contentMatch.matchType(a);g&&!b?l=!1:!g&&b&&(l=!0)}let u=n.steps.length;if(l===!1){let g=n.doc.resolve(e+t);_1(n,g.node(),g.before(),u)}d.inlineContent&&bm(n,e+t-1,d,i.node().contentMatchAt(i.index()),l==null);let h=n.mapping.slice(u),p=h.map(e-t);if(n.step(new Kn(p,h.map(e+t,-1),Ze.empty,!0)),l===!0){let g=n.doc.resolve(p);L1(n,g.node(),g.before(),n.steps.length)}return n}function VC(n,e,t){let l=n.resolve(e);if(l.parent.canReplaceWith(l.index(),l.index(),t))return e;if(l.parentOffset==0)for(let a=l.depth-1;a>=0;a--){let i=l.index(a);if(l.node(a).canReplaceWith(i,i,t))return l.before(a+1);if(i>0)return null}if(l.parentOffset==l.parent.content.size)for(let a=l.depth-1;a>=0;a--){let i=l.indexAfter(a);if(l.node(a).canReplaceWith(i,i,t))return l.after(a+1);if(i<l.node(a).childCount)return null}return null}function P1(n,e,t){let l=n.resolve(e);if(!t.content.size)return e;let a=t.content;for(let i=0;i<t.openStart;i++)a=a.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let d=l.depth;d>=0;d--){let u=d==l.depth?0:l.pos<=(l.start(d+1)+l.end(d+1))/2?-1:1,h=l.index(d)+(u>0?1:0),p=l.node(d),g=!1;if(i==1)g=p.canReplace(h,h,a);else{let b=p.contentMatchAt(h).findWrapping(a.firstChild.type);g=b&&p.canReplaceWith(h,h,b[0])}if(g)return u==0?l.pos:u<0?l.before(d+1):l.after(d+1)}return null}function Nu(n,e,t=e,l=Ze.empty){if(e==t&&!l.size)return null;let a=n.resolve(e),i=n.resolve(t);return H1(a,i,l)?new Kn(e,t,l):new qC(a,i,l).fit()}function H1(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class qC{constructor(e,t,l){this.$from=e,this.$to=t,this.unplaced=l,this.frontier=[],this.placed=_e.empty;for(let a=0;a<=e.depth;a++){let i=e.node(a);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(a))})}for(let a=e.depth;a>0;a--)this.placed=_e.from(e.node(a).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let p=this.findFittable();p?this.placeNodes(p):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,l=this.$from,a=this.close(e<0?this.$to:l.doc.resolve(e));if(!a)return null;let i=this.placed,d=l.depth,u=a.depth;for(;d&&u&&i.childCount==1;)i=i.firstChild.content,d--,u--;let h=new Ze(i,d,u);return e>-1?new Yn(l.pos,e,this.$to.pos,this.$to.end(),h,t):h.size||l.pos!=this.$to.pos?new Kn(l.pos,a.pos,h):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,l=0,a=this.unplaced.openEnd;l<e;l++){let i=t.firstChild;if(t.childCount>1&&(a=0),i.type.spec.isolating&&a<=l){e=l;break}t=i.content}for(let t=1;t<=2;t++)for(let l=t==1?e:this.unplaced.openStart;l>=0;l--){let a,i=null;l?(i=Gh(this.unplaced.content,l-1).firstChild,a=i.content):a=this.unplaced.content;let d=a.firstChild;for(let u=this.depth;u>=0;u--){let{type:h,match:p}=this.frontier[u],g,b=null;if(t==1&&(d?p.matchType(d.type)||(b=p.fillBefore(_e.from(d),!1)):i&&h.compatibleContent(i.type)))return{sliceDepth:l,frontierDepth:u,parent:i,inject:b};if(t==2&&d&&(g=p.findWrapping(d.type)))return{sliceDepth:l,frontierDepth:u,parent:i,wrap:g};if(i&&p.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:l}=this.unplaced,a=Gh(e,t);return!a.childCount||a.firstChild.isLeaf?!1:(this.unplaced=new Ze(e,t+1,Math.max(l,a.size+t>=e.size-l?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:l}=this.unplaced,a=Gh(e,t);if(a.childCount<=1&&t>0){let i=e.size-t<=t+a.size;this.unplaced=new Ze(So(e,t-1,1),t-1,i?t-1:l)}else this.unplaced=new Ze(So(e,t,1),t,l)}placeNodes({sliceDepth:e,frontierDepth:t,parent:l,inject:a,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let S=0;S<i.length;S++)this.openFrontierNode(i[S]);let d=this.unplaced,u=l?l.content:d.content,h=d.openStart-e,p=0,g=[],{match:b,type:y}=this.frontier[t];if(a){for(let S=0;S<a.childCount;S++)g.push(a.child(S));b=b.matchFragment(a)}let v=u.size+e-(d.content.size-d.openEnd);for(;p<u.childCount;){let S=u.child(p),j=b.matchType(S.type);if(!j)break;p++,(p>1||h==0||S.content.size)&&(b=j,g.push($1(S.mark(y.allowedMarks(S.marks)),p==1?h:0,p==u.childCount?v:-1)))}let N=p==u.childCount;N||(v=-1),this.placed=jo(this.placed,t,_e.from(g)),this.frontier[t].match=b,N&&v<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,j=u;S<v;S++){let E=j.lastChild;this.frontier.push({type:E.type,match:E.contentMatchAt(E.childCount)}),j=E.content}this.unplaced=N?e==0?Ze.empty:new Ze(So(d.content,e-1,1),e-1,v<0?d.openEnd:e-1):new Ze(So(d.content,e,p),d.openStart,d.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Yh(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:l}=this.$to,a=this.$to.after(l);for(;l>1&&a==this.$to.end(--l);)++a;return a}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:l,type:a}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),d=Yh(e,t,a,l,i);if(d){for(let u=t-1;u>=0;u--){let{match:h,type:p}=this.frontier[u],g=Yh(e,u,p,h,!0);if(!g||g.childCount)continue e}return{depth:t,fit:d,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=jo(this.placed,t.depth,t.fit)),e=t.move;for(let l=t.depth+1;l<=e.depth;l++){let a=e.node(l),i=a.type.contentMatch.fillBefore(a.content,!0,e.index(l));this.openFrontierNode(a.type,a.attrs,i)}return e}openFrontierNode(e,t=null,l){let a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=jo(this.placed,this.depth,_e.from(e.create(t,l))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(_e.empty,!0);t.childCount&&(this.placed=jo(this.placed,this.frontier.length,t))}}function So(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(So(n.firstChild.content,e-1,t)))}function jo(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(jo(n.lastChild.content,e-1,t)))}function Gh(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function $1(n,e,t){if(e<=0)return n;let l=n.content;return e>1&&(l=l.replaceChild(0,$1(l.firstChild,e-1,l.childCount==1?t-1:0))),e>0&&(l=n.type.contentMatch.fillBefore(l).append(l),t<=0&&(l=l.append(n.type.contentMatch.matchFragment(l).fillBefore(_e.empty,!0)))),n.copy(l)}function Yh(n,e,t,l,a){let i=n.node(e),d=a?n.indexAfter(e):n.index(e);if(d==i.childCount&&!t.compatibleContent(i.type))return null;let u=l.fillBefore(i.content,!0,d);return u&&!FC(t,i.content,d)?u:null}function FC(n,e,t){for(let l=t;l<e.childCount;l++)if(!n.allowsMarks(e.child(l).marks))return!0;return!1}function KC(n){return n.spec.defining||n.spec.definingForContent}function GC(n,e,t,l){if(!l.size)return n.deleteRange(e,t);let a=n.doc.resolve(e),i=n.doc.resolve(t);if(H1(a,i,l))return n.step(new Kn(e,t,l));let d=V1(a,i);d[d.length-1]==0&&d.pop();let u=-(a.depth+1);d.unshift(u);for(let y=a.depth,v=a.pos-1;y>0;y--,v--){let N=a.node(y).type.spec;if(N.defining||N.definingAsContext||N.isolating)break;d.indexOf(y)>-1?u=y:a.before(y)==v&&d.splice(1,0,-y)}let h=d.indexOf(u),p=[],g=l.openStart;for(let y=l.content,v=0;;v++){let N=y.firstChild;if(p.push(N),v==l.openStart)break;y=N.content}for(let y=g-1;y>=0;y--){let v=p[y],N=KC(v.type);if(N&&!v.sameMarkup(a.node(Math.abs(u)-1)))g=y;else if(N||!v.type.isTextblock)break}for(let y=l.openStart;y>=0;y--){let v=(y+g+1)%(l.openStart+1),N=p[v];if(N)for(let S=0;S<d.length;S++){let j=d[(S+h)%d.length],E=!0;j<0&&(E=!1,j=-j);let D=a.node(j-1),_=a.index(j-1);if(D.canReplaceWith(_,_,N.type,N.marks))return n.replace(a.before(j),E?i.after(j):t,new Ze(U1(l.content,0,l.openStart,v),v,l.openEnd))}}let b=n.steps.length;for(let y=d.length-1;y>=0&&(n.replace(e,t,l),!(n.steps.length>b));y--){let v=d[y];v<0||(e=a.before(v),t=i.after(v))}}function U1(n,e,t,l,a){if(e<t){let i=n.firstChild;n=n.replaceChild(0,i.copy(U1(i.content,e+1,t,l,i)))}if(e>l){let i=a.contentMatchAt(0),d=i.fillBefore(n).append(n);n=d.append(i.matchFragment(d).fillBefore(_e.empty,!0))}return n}function YC(n,e,t,l){if(!l.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let a=VC(n.doc,e,l.type);a!=null&&(e=t=a)}n.replaceRange(e,t,new Ze(_e.from(l),0,0))}function XC(n,e,t){let l=n.doc.resolve(e),a=n.doc.resolve(t),i=V1(l,a);for(let d=0;d<i.length;d++){let u=i[d],h=d==i.length-1;if(h&&u==0||l.node(u).type.contentMatch.validEnd)return n.delete(l.start(u),a.end(u));if(u>0&&(h||l.node(u-1).canReplace(l.index(u-1),a.indexAfter(u-1))))return n.delete(l.before(u),a.after(u))}for(let d=1;d<=l.depth&&d<=a.depth;d++)if(e-l.start(d)==l.depth-d&&t>l.end(d)&&a.end(d)-t!=a.depth-d&&l.start(d-1)==a.start(d-1)&&l.node(d-1).canReplace(l.index(d-1),a.index(d-1)))return n.delete(l.before(d),t);n.delete(e,t)}function V1(n,e){let t=[],l=Math.min(n.depth,e.depth);for(let a=l;a>=0;a--){let i=n.start(a);if(i<n.pos-(n.depth-a)||e.end(a)>e.pos+(e.depth-a)||n.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(i==e.start(a)||a==n.depth&&a==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==i-1)&&t.push(a)}return t}class yi extends gs{constructor(e,t,l){super(),this.pos=e,this.attr=t,this.value=l}apply(e){let t=e.nodeAt(this.pos);if(!t)return Bn.fail("No node at attribute step's position");let l=Object.create(null);for(let i in t.attrs)l[i]=t.attrs[i];l[this.attr]=this.value;let a=t.type.create(l,null,t.marks);return Bn.fromReplace(e,this.pos,this.pos+1,new Ze(_e.from(a),0,t.isLeaf?0:1))}getMap(){return Us.empty}invert(e){return new yi(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new yi(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new yi(t.pos,t.attr,t.value)}}gs.jsonID("attr",yi);class Vo extends gs{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let a in e.attrs)t[a]=e.attrs[a];t[this.attr]=this.value;let l=e.type.create(t,e.content,e.marks);return Bn.ok(l)}getMap(){return Us.empty}invert(e){return new Vo(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Vo(t.attr,t.value)}}gs.jsonID("docAttr",Vo);let ki=class extends Error{};ki=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};ki.prototype=Object.create(Error.prototype);ki.prototype.constructor=ki;ki.prototype.name="TransformError";class q1{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Uo}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new ki(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,l=Ze.empty){let a=Nu(this.doc,e,t,l);return a&&this.step(a),this}replaceWith(e,t,l){return this.replace(e,t,new Ze(_e.from(l),0,0))}delete(e,t){return this.replace(e,t,Ze.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,l){return GC(this,e,t,l),this}replaceRangeWith(e,t,l){return YC(this,e,t,l),this}deleteRange(e,t){return XC(this,e,t),this}lift(e,t){return RC(this,e,t),this}join(e,t=1){return UC(this,e,t),this}wrap(e,t){return LC(this,e,t),this}setBlockType(e,t=e,l,a=null){return _C(this,e,t,l,a),this}setNodeMarkup(e,t,l=null,a){return PC(this,e,t,l,a),this}setNodeAttribute(e,t,l){return this.step(new yi(e,t,l)),this}setDocAttribute(e,t){return this.step(new Vo(e,t)),this}addNodeMark(e,t){return this.step(new Hr(e,t)),this}removeNodeMark(e,t){let l=this.doc.nodeAt(e);if(!l)throw new RangeError("No node at position "+e);if(t instanceof on)t.isInSet(l.marks)&&this.step(new Ma(e,t));else{let a=l.marks,i,d=[];for(;i=t.isInSet(a);)d.push(new Ma(e,i)),a=i.removeFromSet(a);for(let u=d.length-1;u>=0;u--)this.step(d[u])}return this}split(e,t=1,l){return HC(this,e,t,l),this}addMark(e,t,l){return TC(this,e,t,l),this}removeMark(e,t,l){return DC(this,e,t,l),this}clearIncompatible(e,t,l){return bm(this,e,t,l),this}}const Xh=Object.create(null);class Et{constructor(e,t,l){this.$anchor=e,this.$head=t,this.ranges=l||[new JC(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ze.empty){let l=t.content.lastChild,a=null;for(let u=0;u<t.openEnd;u++)a=l,l=l.lastChild;let i=e.steps.length,d=this.ranges;for(let u=0;u<d.length;u++){let{$from:h,$to:p}=d[u],g=e.mapping.slice(i);e.replaceRange(g.map(h.pos),g.map(p.pos),u?Ze.empty:t),u==0&&xy(e,i,(l?l.isInline:a&&a.isTextblock)?-1:1)}}replaceWith(e,t){let l=e.steps.length,a=this.ranges;for(let i=0;i<a.length;i++){let{$from:d,$to:u}=a[i],h=e.mapping.slice(l),p=h.map(d.pos),g=h.map(u.pos);i?e.deleteRange(p,g):(e.replaceRangeWith(p,g,t),xy(e,l,t.isInline?-1:1))}}static findFrom(e,t,l=!1){let a=e.parent.inlineContent?new gt(e):pi(e.node(0),e.parent,e.pos,e.index(),t,l);if(a)return a;for(let i=e.depth-1;i>=0;i--){let d=t<0?pi(e.node(0),e.node(i),e.before(i+1),e.index(i),t,l):pi(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,l);if(d)return d}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new qs(e.node(0))}static atStart(e){return pi(e,e,0,0,1)||new qs(e)}static atEnd(e){return pi(e,e,e.content.size,e.childCount,-1)||new qs(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let l=Xh[t.type];if(!l)throw new RangeError(`No selection type ${t.type} defined`);return l.fromJSON(e,t)}static jsonID(e,t){if(e in Xh)throw new RangeError("Duplicate use of selection JSON ID "+e);return Xh[e]=t,t.prototype.jsonID=e,t}getBookmark(){return gt.between(this.$anchor,this.$head).getBookmark()}}Et.prototype.visible=!0;class JC{constructor(e,t){this.$from=e,this.$to=t}}let my=!1;function gy(n){!my&&!n.parent.inlineContent&&(my=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class gt extends Et{constructor(e,t=e){gy(e),gy(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let l=e.resolve(t.map(this.head));if(!l.parent.inlineContent)return Et.near(l);let a=e.resolve(t.map(this.anchor));return new gt(a.parent.inlineContent?a:l,l)}replace(e,t=Ze.empty){if(super.replace(e,t),t==Ze.empty){let l=this.$from.marksAcross(this.$to);l&&e.ensureMarks(l)}}eq(e){return e instanceof gt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ku(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new gt(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,l=t){let a=e.resolve(t);return new this(a,l==t?a:e.resolve(l))}static between(e,t,l){let a=e.pos-t.pos;if((!l||a)&&(l=a>=0?1:-1),!t.parent.inlineContent){let i=Et.findFrom(t,l,!0)||Et.findFrom(t,-l,!0);if(i)t=i.$head;else return Et.near(t,l)}return e.parent.inlineContent||(a==0?e=t:(e=(Et.findFrom(e,-l,!0)||Et.findFrom(e,l,!0)).$anchor,e.pos<t.pos!=a<0&&(e=t))),new gt(e,t)}}Et.jsonID("text",gt);class ku{constructor(e,t){this.anchor=e,this.head=t}map(e){return new ku(e.map(this.anchor),e.map(this.head))}resolve(e){return gt.between(e.resolve(this.anchor),e.resolve(this.head))}}class ct extends Et{constructor(e){let t=e.nodeAfter,l=e.node(0).resolve(e.pos+t.nodeSize);super(e,l),this.node=t}map(e,t){let{deleted:l,pos:a}=t.mapResult(this.anchor),i=e.resolve(a);return l?Et.near(i):new ct(i)}content(){return new Ze(_e.from(this.node),0,0)}eq(e){return e instanceof ct&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new vm(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ct(e.resolve(t.anchor))}static create(e,t){return new ct(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ct.prototype.visible=!1;Et.jsonID("node",ct);class vm{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:l}=e.mapResult(this.anchor);return t?new ku(l,l):new vm(l)}resolve(e){let t=e.resolve(this.anchor),l=t.nodeAfter;return l&&ct.isSelectable(l)?new ct(t):Et.near(t)}}class qs extends Et{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ze.empty){if(t==Ze.empty){e.delete(0,e.doc.content.size);let l=Et.atStart(e.doc);l.eq(e.selection)||e.setSelection(l)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new qs(e)}map(e){return new qs(e)}eq(e){return e instanceof qs}getBookmark(){return QC}}Et.jsonID("all",qs);const QC={map(){return this},resolve(n){return new qs(n)}};function pi(n,e,t,l,a,i=!1){if(e.inlineContent)return gt.create(n,t);for(let d=l-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){let u=e.child(d);if(u.isAtom){if(!i&&ct.isSelectable(u))return ct.create(n,t-(a<0?u.nodeSize:0))}else{let h=pi(n,u,t+a,a<0?u.childCount:0,a,i);if(h)return h}t+=u.nodeSize*a}return null}function xy(n,e,t){let l=n.steps.length-1;if(l<e)return;let a=n.steps[l];if(!(a instanceof Kn||a instanceof Yn))return;let i=n.mapping.maps[l],d;i.forEach((u,h,p,g)=>{d==null&&(d=g)}),n.setSelection(Et.near(n.doc.resolve(d),t))}const by=1,dd=2,yy=4;class ZC extends q1{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|by)&~dd,this.storedMarks=null,this}get selectionSet(){return(this.updated&by)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=dd,this}ensureMarks(e){return on.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&dd)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~dd,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let l=this.selection;return t&&(e=e.mark(this.storedMarks||(l.empty?l.$from.marks():l.$from.marksAcross(l.$to)||on.none))),l.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,l){let a=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(a.text(e),!0):this.deleteSelection();{if(l==null&&(l=t),!e)return this.deleteRange(t,l);let i=this.storedMarks;if(!i){let d=this.doc.resolve(t);i=l==t?d.marks():d.marksAcross(this.doc.resolve(l))}return this.replaceRangeWith(t,l,a.text(e,i)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(Et.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=yy,this}get scrolledIntoView(){return(this.updated&yy)>0}}function vy(n,e){return!e||!n?n:n.bind(e)}class Co{constructor(e,t,l){this.name=e,this.init=vy(t.init,l),this.apply=vy(t.apply,l)}}const WC=[new Co("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Co("selection",{init(n,e){return n.selection||Et.atStart(e.doc)},apply(n){return n.selection}}),new Co("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,l){return l.selection.$cursor?n.storedMarks:null}}),new Co("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class Jh{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=WC.slice(),t&&t.forEach(l=>{if(this.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");this.plugins.push(l),this.pluginsByKey[l.key]=l,l.spec.state&&this.fields.push(new Co(l.key,l.spec.state,l))})}}class bi{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let l=0;l<this.config.plugins.length;l++)if(l!=t){let a=this.config.plugins[l];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],l=this.applyInner(e),a=null;for(;;){let i=!1;for(let d=0;d<this.config.plugins.length;d++){let u=this.config.plugins[d];if(u.spec.appendTransaction){let h=a?a[d].n:0,p=a?a[d].state:this,g=h<t.length&&u.spec.appendTransaction.call(u,h?t.slice(h):t,p,l);if(g&&l.filterTransaction(g,d)){if(g.setMeta("appendedTransaction",e),!a){a=[];for(let b=0;b<this.config.plugins.length;b++)a.push(b<d?{state:l,n:t.length}:{state:this,n:0})}t.push(g),l=l.applyInner(g),i=!0}a&&(a[d]={state:l,n:t.length})}}if(!i)return{state:l,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new bi(this.config),l=this.config.fields;for(let a=0;a<l.length;a++){let i=l[a];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new ZC(this)}static create(e){let t=new Jh(e.doc?e.doc.type.schema:e.schema,e.plugins),l=new bi(t);for(let a=0;a<t.fields.length;a++)l[t.fields[a].name]=t.fields[a].init(e,l);return l}reconfigure(e){let t=new Jh(this.schema,e.plugins),l=t.fields,a=new bi(t);for(let i=0;i<l.length;i++){let d=l[i].name;a[d]=this.hasOwnProperty(d)?this[d]:l[i].init(e,a)}return a}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(l=>l.toJSON())),e&&typeof e=="object")for(let l in e){if(l=="doc"||l=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let a=e[l],i=a.spec.state;i&&i.toJSON&&(t[l]=i.toJSON.call(a,this[a.key]))}return t}static fromJSON(e,t,l){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let a=new Jh(e.schema,e.plugins),i=new bi(a);return a.fields.forEach(d=>{if(d.name=="doc")i.doc=yl.fromJSON(e.schema,t.doc);else if(d.name=="selection")i.selection=Et.fromJSON(i.doc,t.selection);else if(d.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(l)for(let u in l){let h=l[u],p=h.spec.state;if(h.key==d.name&&p&&p.fromJSON&&Object.prototype.hasOwnProperty.call(t,u)){i[d.name]=p.fromJSON.call(h,e,t[u],i);return}}i[d.name]=d.init(e,i)}}),i}}function F1(n,e,t){for(let l in n){let a=n[l];a instanceof Function?a=a.bind(e):l=="handleDOMEvents"&&(a=F1(a,e,{})),t[l]=a}return t}class gn{constructor(e){this.spec=e,this.props={},e.props&&F1(e.props,this,this.props),this.key=e.key?e.key.key:K1("plugin")}getState(e){return e[this.key]}}const Qh=Object.create(null);function K1(n){return n in Qh?n+"$"+ ++Qh[n]:(Qh[n]=0,n+"$")}class Vn{constructor(e="key"){this.key=K1(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Nm=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function G1(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const Y1=(n,e,t)=>{let l=G1(n,t);if(!l)return!1;let a=km(l);if(!a){let d=l.blockRange(),u=d&&Ai(d);return u==null?!1:(e&&e(n.tr.lift(d,u).scrollIntoView()),!0)}let i=a.nodeBefore;if(sN(n,a,e,-1))return!0;if(l.parent.content.size==0&&(wi(i,"end")||ct.isSelectable(i)))for(let d=l.depth;;d--){let u=Nu(n.doc,l.before(d),l.after(d),Ze.empty);if(u&&u.slice.size<u.to-u.from){if(e){let h=n.tr.step(u);h.setSelection(wi(i,"end")?Et.findFrom(h.doc.resolve(h.mapping.map(a.pos,-1)),-1):ct.create(h.doc,a.pos-i.nodeSize)),e(h.scrollIntoView())}return!0}if(d==1||l.node(d-1).childCount>1)break}return i.isAtom&&a.depth==l.depth-1?(e&&e(n.tr.delete(a.pos-i.nodeSize,a.pos).scrollIntoView()),!0):!1},eE=(n,e,t)=>{let l=G1(n,t);if(!l)return!1;let a=km(l);return a?X1(n,a,e):!1},tE=(n,e,t)=>{let l=Q1(n,t);if(!l)return!1;let a=wm(l);return a?X1(n,a,e):!1};function X1(n,e,t){let l=e.nodeBefore,a=l,i=e.pos-1;for(;!a.isTextblock;i--){if(a.type.spec.isolating)return!1;let g=a.lastChild;if(!g)return!1;a=g}let d=e.nodeAfter,u=d,h=e.pos+1;for(;!u.isTextblock;h++){if(u.type.spec.isolating)return!1;let g=u.firstChild;if(!g)return!1;u=g}let p=Nu(n.doc,i,h,Ze.empty);if(!p||p.from!=i||p instanceof Kn&&p.slice.size>=h-i)return!1;if(t){let g=n.tr.step(p);g.setSelection(gt.create(g.doc,i)),t(g.scrollIntoView())}return!0}function wi(n,e,t=!1){for(let l=n;l;l=e=="start"?l.firstChild:l.lastChild){if(l.isTextblock)return!0;if(t&&l.childCount!=1)return!1}return!1}const J1=(n,e,t)=>{let{$head:l,empty:a}=n.selection,i=l;if(!a)return!1;if(l.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):l.parentOffset>0)return!1;i=km(l)}let d=i&&i.nodeBefore;return!d||!ct.isSelectable(d)?!1:(e&&e(n.tr.setSelection(ct.create(n.doc,i.pos-d.nodeSize)).scrollIntoView()),!0)};function km(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function Q1(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const Z1=(n,e,t)=>{let l=Q1(n,t);if(!l)return!1;let a=wm(l);if(!a)return!1;let i=a.nodeAfter;if(sN(n,a,e,1))return!0;if(l.parent.content.size==0&&(wi(i,"start")||ct.isSelectable(i))){let d=Nu(n.doc,l.before(),l.after(),Ze.empty);if(d&&d.slice.size<d.to-d.from){if(e){let u=n.tr.step(d);u.setSelection(wi(i,"start")?Et.findFrom(u.doc.resolve(u.mapping.map(a.pos)),1):ct.create(u.doc,u.mapping.map(a.pos))),e(u.scrollIntoView())}return!0}}return i.isAtom&&a.depth==l.depth-1?(e&&e(n.tr.delete(a.pos,a.pos+i.nodeSize).scrollIntoView()),!0):!1},W1=(n,e,t)=>{let{$head:l,empty:a}=n.selection,i=l;if(!a)return!1;if(l.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):l.parentOffset<l.parent.content.size)return!1;i=wm(l)}let d=i&&i.nodeAfter;return!d||!ct.isSelectable(d)?!1:(e&&e(n.tr.setSelection(ct.create(n.doc,i.pos)).scrollIntoView()),!0)};function wm(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const nE=(n,e)=>{let t=n.selection,l=t instanceof ct,a;if(l){if(t.node.isTextblock||!Xr(n.doc,t.from))return!1;a=t.from}else if(a=vu(n.doc,t.from,-1),a==null)return!1;if(e){let i=n.tr.join(a);l&&i.setSelection(ct.create(i.doc,a-n.doc.resolve(a).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},sE=(n,e)=>{let t=n.selection,l;if(t instanceof ct){if(t.node.isTextblock||!Xr(n.doc,t.to))return!1;l=t.to}else if(l=vu(n.doc,t.to,1),l==null)return!1;return e&&e(n.tr.join(l).scrollIntoView()),!0},lE=(n,e)=>{let{$from:t,$to:l}=n.selection,a=t.blockRange(l),i=a&&Ai(a);return i==null?!1:(e&&e(n.tr.lift(a,i).scrollIntoView()),!0)},eN=(n,e)=>{let{$head:t,$anchor:l}=n.selection;return!t.parent.type.spec.code||!t.sameParent(l)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function Sm(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const rE=(n,e)=>{let{$head:t,$anchor:l}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(l))return!1;let a=t.node(-1),i=t.indexAfter(-1),d=Sm(a.contentMatchAt(i));if(!d||!a.canReplaceWith(i,i,d))return!1;if(e){let u=t.after(),h=n.tr.replaceWith(u,u,d.createAndFill());h.setSelection(Et.near(h.doc.resolve(u),1)),e(h.scrollIntoView())}return!0},tN=(n,e)=>{let t=n.selection,{$from:l,$to:a}=t;if(t instanceof qs||l.parent.inlineContent||a.parent.inlineContent)return!1;let i=Sm(a.parent.contentMatchAt(a.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let d=(!l.parentOffset&&a.index()<a.parent.childCount?l:a).pos,u=n.tr.insert(d,i.createAndFill());u.setSelection(gt.create(u.doc,d+1)),e(u.scrollIntoView())}return!0},nN=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(nr(n.doc,i))return e&&e(n.tr.split(i).scrollIntoView()),!0}let l=t.blockRange(),a=l&&Ai(l);return a==null?!1:(e&&e(n.tr.lift(l,a).scrollIntoView()),!0)};function aE(n){return(e,t)=>{let{$from:l,$to:a}=e.selection;if(e.selection instanceof ct&&e.selection.node.isBlock)return!l.parentOffset||!nr(e.doc,l.pos)?!1:(t&&t(e.tr.split(l.pos).scrollIntoView()),!0);if(!l.depth)return!1;let i=[],d,u,h=!1,p=!1;for(let v=l.depth;;v--)if(l.node(v).isBlock){h=l.end(v)==l.pos+(l.depth-v),p=l.start(v)==l.pos-(l.depth-v),u=Sm(l.node(v-1).contentMatchAt(l.indexAfter(v-1))),i.unshift(h&&u?{type:u}:null),d=v;break}else{if(v==1)return!1;i.unshift(null)}let g=e.tr;(e.selection instanceof gt||e.selection instanceof qs)&&g.deleteSelection();let b=g.mapping.map(l.pos),y=nr(g.doc,b,i.length,i);if(y||(i[0]=u?{type:u}:null,y=nr(g.doc,b,i.length,i)),!y)return!1;if(g.split(b,i.length,i),!h&&p&&l.node(d).type!=u){let v=g.mapping.map(l.before(d)),N=g.doc.resolve(v);u&&l.node(d-1).canReplaceWith(N.index(),N.index()+1,u)&&g.setNodeMarkup(g.mapping.map(l.before(d)),u)}return t&&t(g.scrollIntoView()),!0}}const iE=aE(),oE=(n,e)=>{let{$from:t,to:l}=n.selection,a,i=t.sharedDepth(l);return i==0?!1:(a=t.before(i),e&&e(n.tr.setSelection(ct.create(n.doc,a))),!0)};function cE(n,e,t){let l=e.nodeBefore,a=e.nodeAfter,i=e.index();return!l||!a||!l.type.compatibleContent(a.type)?!1:!l.content.size&&e.parent.canReplace(i-1,i)?(t&&t(n.tr.delete(e.pos-l.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(a.isTextblock||Xr(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function sN(n,e,t,l){let a=e.nodeBefore,i=e.nodeAfter,d,u,h=a.type.spec.isolating||i.type.spec.isolating;if(!h&&cE(n,e,t))return!0;let p=!h&&e.parent.canReplace(e.index(),e.index()+1);if(p&&(d=(u=a.contentMatchAt(a.childCount)).findWrapping(i.type))&&u.matchType(d[0]||i.type).validEnd){if(t){let v=e.pos+i.nodeSize,N=_e.empty;for(let E=d.length-1;E>=0;E--)N=_e.from(d[E].create(null,N));N=_e.from(a.copy(N));let S=n.tr.step(new Yn(e.pos-1,v,e.pos,v,new Ze(N,1,0),d.length,!0)),j=S.doc.resolve(v+2*d.length);j.nodeAfter&&j.nodeAfter.type==a.type&&Xr(S.doc,j.pos)&&S.join(j.pos),t(S.scrollIntoView())}return!0}let g=i.type.spec.isolating||l>0&&h?null:Et.findFrom(e,1),b=g&&g.$from.blockRange(g.$to),y=b&&Ai(b);if(y!=null&&y>=e.depth)return t&&t(n.tr.lift(b,y).scrollIntoView()),!0;if(p&&wi(i,"start",!0)&&wi(a,"end")){let v=a,N=[];for(;N.push(v),!v.isTextblock;)v=v.lastChild;let S=i,j=1;for(;!S.isTextblock;S=S.firstChild)j++;if(v.canReplace(v.childCount,v.childCount,S.content)){if(t){let E=_e.empty;for(let _=N.length-1;_>=0;_--)E=_e.from(N[_].copy(E));let D=n.tr.step(new Yn(e.pos-N.length,e.pos+i.nodeSize,e.pos+j,e.pos+i.nodeSize-j,new Ze(E,N.length,0),0,!0));t(D.scrollIntoView())}return!0}}return!1}function lN(n){return function(e,t){let l=e.selection,a=n<0?l.$from:l.$to,i=a.depth;for(;a.node(i).isInline;){if(!i)return!1;i--}return a.node(i).isTextblock?(t&&t(e.tr.setSelection(gt.create(e.doc,n<0?a.start(i):a.end(i)))),!0):!1}}const dE=lN(-1),uE=lN(1);function fE(n,e=null){return function(t,l){let{$from:a,$to:i}=t.selection,d=a.blockRange(i),u=d&&ym(d,n,e);return u?(l&&l(t.tr.wrap(d,u).scrollIntoView()),!0):!1}}function Ny(n,e=null){return function(t,l){let a=!1;for(let i=0;i<t.selection.ranges.length&&!a;i++){let{$from:{pos:d},$to:{pos:u}}=t.selection.ranges[i];t.doc.nodesBetween(d,u,(h,p)=>{if(a)return!1;if(!(!h.isTextblock||h.hasMarkup(n,e)))if(h.type==n)a=!0;else{let g=t.doc.resolve(p),b=g.index();a=g.parent.canReplaceWith(b,b+1,n)}})}if(!a)return!1;if(l){let i=t.tr;for(let d=0;d<t.selection.ranges.length;d++){let{$from:{pos:u},$to:{pos:h}}=t.selection.ranges[d];i.setBlockType(u,h,n,e)}l(i.scrollIntoView())}return!0}}function jm(...n){return function(e,t,l){for(let a=0;a<n.length;a++)if(n[a](e,t,l))return!0;return!1}}jm(Nm,Y1,J1);jm(Nm,Z1,W1);jm(eN,tN,nN,iE);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function hE(n,e=null){return function(t,l){let{$from:a,$to:i}=t.selection,d=a.blockRange(i);if(!d)return!1;let u=l?t.tr:null;return pE(u,d,n,e)?(l&&l(u.scrollIntoView()),!0):!1}}function pE(n,e,t,l=null){let a=!1,i=e,d=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let h=d.resolve(e.start-2);i=new Rd(h,h,e.depth),e.endIndex<e.parent.childCount&&(e=new Rd(e.$from,d.resolve(e.$to.end(e.depth)),e.depth)),a=!0}let u=ym(i,t,l,e);return u?(n&&mE(n,e,u,a,t),!0):!1}function mE(n,e,t,l,a){let i=_e.empty;for(let g=t.length-1;g>=0;g--)i=_e.from(t[g].type.create(t[g].attrs,i));n.step(new Yn(e.start-(l?2:0),e.end,e.start,e.end,new Ze(i,0,0),t.length,!0));let d=0;for(let g=0;g<t.length;g++)t[g].type==a&&(d=g+1);let u=t.length-d,h=e.start+t.length-(l?2:0),p=e.parent;for(let g=e.startIndex,b=e.endIndex,y=!0;g<b;g++,y=!1)!y&&nr(n.doc,h,u)&&(n.split(h,u),h+=2*u),h+=p.child(g).nodeSize;return n}function gE(n){return function(e,t){let{$from:l,$to:a}=e.selection,i=l.blockRange(a,d=>d.childCount>0&&d.firstChild.type==n);return i?t?l.node(i.depth-1).type==n?xE(e,t,n,i):bE(e,t,i):!0:!1}}function xE(n,e,t,l){let a=n.tr,i=l.end,d=l.$to.end(l.depth);i<d&&(a.step(new Yn(i-1,d,i,d,new Ze(_e.from(t.create(null,l.parent.copy())),1,0),1,!0)),l=new Rd(a.doc.resolve(l.$from.pos),a.doc.resolve(d),l.depth));const u=Ai(l);if(u==null)return!1;a.lift(l,u);let h=a.doc.resolve(a.mapping.map(i,-1)-1);return Xr(a.doc,h.pos)&&h.nodeBefore.type==h.nodeAfter.type&&a.join(h.pos),e(a.scrollIntoView()),!0}function bE(n,e,t){let l=n.tr,a=t.parent;for(let v=t.end,N=t.endIndex-1,S=t.startIndex;N>S;N--)v-=a.child(N).nodeSize,l.delete(v-1,v+1);let i=l.doc.resolve(t.start),d=i.nodeAfter;if(l.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let u=t.startIndex==0,h=t.endIndex==a.childCount,p=i.node(-1),g=i.index(-1);if(!p.canReplace(g+(u?0:1),g+1,d.content.append(h?_e.empty:_e.from(a))))return!1;let b=i.pos,y=b+d.nodeSize;return l.step(new Yn(b-(u?1:0),y+(h?1:0),b+1,y-1,new Ze((u?_e.empty:_e.from(a.copy(_e.empty))).append(h?_e.empty:_e.from(a.copy(_e.empty))),u?0:1,h?0:1),u?0:1)),e(l.scrollIntoView()),!0}function yE(n){return function(e,t){let{$from:l,$to:a}=e.selection,i=l.blockRange(a,p=>p.childCount>0&&p.firstChild.type==n);if(!i)return!1;let d=i.startIndex;if(d==0)return!1;let u=i.parent,h=u.child(d-1);if(h.type!=n)return!1;if(t){let p=h.lastChild&&h.lastChild.type==u.type,g=_e.from(p?n.create():null),b=new Ze(_e.from(n.create(null,_e.from(u.type.create(null,g)))),p?3:1,0),y=i.start,v=i.end;t(e.tr.step(new Yn(y-(p?3:1),v,y,v,b,1,!0)).scrollIntoView())}return!0}}const ts=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},Si=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let Bp=null;const er=function(n,e,t){let l=Bp||(Bp=document.createRange());return l.setEnd(n,t??n.nodeValue.length),l.setStart(n,e||0),l},vE=function(){Bp=null},Aa=function(n,e,t,l){return t&&(ky(n,e,t,l,-1)||ky(n,e,t,l,1))},NE=/^(img|br|input|textarea|hr)$/i;function ky(n,e,t,l,a){for(var i;;){if(n==t&&e==l)return!0;if(e==(a<0?0:cl(n))){let d=n.parentNode;if(!d||d.nodeType!=1||Qo(n)||NE.test(n.nodeName)||n.contentEditable=="false")return!1;e=ts(n)+(a<0?0:1),n=d}else if(n.nodeType==1){let d=n.childNodes[e+(a<0?-1:0)];if(d.nodeType==1&&d.contentEditable=="false")if(!((i=d.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=a;else return!1;else n=d,e=a<0?cl(n):0}else return!1}}function cl(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function kE(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=cl(n)}else if(n.parentNode&&!Qo(n))e=ts(n),n=n.parentNode;else return null}}function wE(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!Qo(n))e=ts(n)+1,n=n.parentNode;else return null}}function SE(n,e,t){for(let l=e==0,a=e==cl(n);l||a;){if(n==t)return!0;let i=ts(n);if(n=n.parentNode,!n)return!1;l=l&&i==0,a=a&&i==cl(n)}}function Qo(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const wu=function(n){return n.focusNode&&Aa(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function xa(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function jE(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function CE(n,e,t){if(n.caretPositionFromPoint)try{let l=n.caretPositionFromPoint(e,t);if(l)return{node:l.offsetNode,offset:Math.min(cl(l.offsetNode),l.offset)}}catch{}if(n.caretRangeFromPoint){let l=n.caretRangeFromPoint(e,t);if(l)return{node:l.startContainer,offset:Math.min(cl(l.startContainer),l.startOffset)}}}const Al=typeof navigator<"u"?navigator:null,wy=typeof document<"u"?document:null,Jr=Al&&Al.userAgent||"",Pp=/Edge\/(\d+)/.exec(Jr),rN=/MSIE \d/.exec(Jr),Hp=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Jr),Os=!!(rN||Hp||Pp),Ur=rN?document.documentMode:Hp?+Hp[1]:Pp?+Pp[1]:0,dl=!Os&&/gecko\/(\d+)/i.test(Jr);dl&&+(/Firefox\/(\d+)/.exec(Jr)||[0,0])[1];const $p=!Os&&/Chrome\/(\d+)/.exec(Jr),Gn=!!$p,aN=$p?+$p[1]:0,ms=!Os&&!!Al&&/Apple Computer/.test(Al.vendor),ji=ms&&(/Mobile\/\w+/.test(Jr)||!!Al&&Al.maxTouchPoints>2),il=ji||(Al?/Mac/.test(Al.platform):!1),iN=Al?/Win/.test(Al.platform):!1,tr=/Android \d/.test(Jr),Zo=!!wy&&"webkitFontSmoothing"in wy.documentElement.style,EE=Zo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ME(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Xl(n,e){return typeof n=="number"?n:n[e]}function AE(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,l=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*l}}function Sy(n,e,t){let l=n.someProp("scrollThreshold")||0,a=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument;for(let d=t||n.dom;d;){if(d.nodeType!=1){d=Si(d);continue}let u=d,h=u==i.body,p=h?ME(i):AE(u),g=0,b=0;if(e.top<p.top+Xl(l,"top")?b=-(p.top-e.top+Xl(a,"top")):e.bottom>p.bottom-Xl(l,"bottom")&&(b=e.bottom-e.top>p.bottom-p.top?e.top+Xl(a,"top")-p.top:e.bottom-p.bottom+Xl(a,"bottom")),e.left<p.left+Xl(l,"left")?g=-(p.left-e.left+Xl(a,"left")):e.right>p.right-Xl(l,"right")&&(g=e.right-p.right+Xl(a,"right")),g||b)if(h)i.defaultView.scrollBy(g,b);else{let v=u.scrollLeft,N=u.scrollTop;b&&(u.scrollTop+=b),g&&(u.scrollLeft+=g);let S=u.scrollLeft-v,j=u.scrollTop-N;e={left:e.left-S,top:e.top-j,right:e.right-S,bottom:e.bottom-j}}let y=h?"fixed":getComputedStyle(d).position;if(/^(fixed|sticky)$/.test(y))break;d=y=="absolute"?d.offsetParent:Si(d)}}function TE(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),l,a;for(let i=(e.left+e.right)/2,d=t+1;d<Math.min(innerHeight,e.bottom);d+=5){let u=n.root.elementFromPoint(i,d);if(!u||u==n.dom||!n.dom.contains(u))continue;let h=u.getBoundingClientRect();if(h.top>=t-20){l=u,a=h.top;break}}return{refDOM:l,refTop:a,stack:oN(n.dom)}}function oN(n){let e=[],t=n.ownerDocument;for(let l=n;l&&(e.push({dom:l,top:l.scrollTop,left:l.scrollLeft}),n!=t);l=Si(l));return e}function DE({refDOM:n,refTop:e,stack:t}){let l=n?n.getBoundingClientRect().top:0;cN(t,l==0?0:l-e)}function cN(n,e){for(let t=0;t<n.length;t++){let{dom:l,top:a,left:i}=n[t];l.scrollTop!=a+e&&(l.scrollTop=a+e),l.scrollLeft!=i&&(l.scrollLeft=i)}}let ui=null;function OE(n){if(n.setActive)return n.setActive();if(ui)return n.focus(ui);let e=oN(n);n.focus(ui==null?{get preventScroll(){return ui={preventScroll:!0},!0}}:void 0),ui||(ui=!1,cN(e,0))}function dN(n,e){let t,l=2e8,a,i=0,d=e.top,u=e.top,h,p;for(let g=n.firstChild,b=0;g;g=g.nextSibling,b++){let y;if(g.nodeType==1)y=g.getClientRects();else if(g.nodeType==3)y=er(g).getClientRects();else continue;for(let v=0;v<y.length;v++){let N=y[v];if(N.top<=d&&N.bottom>=u){d=Math.max(N.bottom,d),u=Math.min(N.top,u);let S=N.left>e.left?N.left-e.left:N.right<e.left?e.left-N.right:0;if(S<l){t=g,l=S,a=S&&t.nodeType==3?{left:N.right<e.left?N.right:N.left,top:e.top}:e,g.nodeType==1&&S&&(i=b+(e.left>=(N.left+N.right)/2?1:0));continue}}else N.top>e.top&&!h&&N.left<=e.left&&N.right>=e.left&&(h=g,p={left:Math.max(N.left,Math.min(N.right,e.left)),top:N.top});!t&&(e.left>=N.right&&e.top>=N.top||e.left>=N.left&&e.top>=N.bottom)&&(i=b+1)}}return!t&&h&&(t=h,a=p,l=0),t&&t.nodeType==3?RE(t,a):!t||l&&t.nodeType==1?{node:n,offset:i}:dN(t,a)}function RE(n,e){let t=n.nodeValue.length,l=document.createRange(),a;for(let i=0;i<t;i++){l.setEnd(n,i+1),l.setStart(n,i);let d=Dr(l,1);if(d.top!=d.bottom&&Cm(e,d)){a={node:n,offset:i+(e.left>=(d.left+d.right)/2?1:0)};break}}return l.detach(),a||{node:n,offset:0}}function Cm(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function IE(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function zE(n,e,t){let{node:l,offset:a}=dN(e,t),i=-1;if(l.nodeType==1&&!l.firstChild){let d=l.getBoundingClientRect();i=d.left!=d.right&&t.left>(d.left+d.right)/2?1:-1}return n.docView.posFromDOM(l,a,i)}function LE(n,e,t,l){let a=-1;for(let i=e,d=!1;i!=n.dom;){let u=n.docView.nearestDesc(i,!0),h;if(!u)return null;if(u.dom.nodeType==1&&(u.node.isBlock&&u.parent||!u.contentDOM)&&((h=u.dom.getBoundingClientRect()).width||h.height)&&(u.node.isBlock&&u.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(u.dom.nodeName)&&(!d&&h.left>l.left||h.top>l.top?a=u.posBefore:(!d&&h.right<l.left||h.bottom<l.top)&&(a=u.posAfter),d=!0),!u.contentDOM&&a<0&&!u.node.isText))return(u.node.isBlock?l.top<(h.top+h.bottom)/2:l.left<(h.left+h.right)/2)?u.posBefore:u.posAfter;i=u.dom.parentNode}return a>-1?a:n.docView.posFromDOM(e,t,-1)}function uN(n,e,t){let l=n.childNodes.length;if(l&&t.top<t.bottom)for(let a=Math.max(0,Math.min(l-1,Math.floor(l*(e.top-t.top)/(t.bottom-t.top))-2)),i=a;;){let d=n.childNodes[i];if(d.nodeType==1){let u=d.getClientRects();for(let h=0;h<u.length;h++){let p=u[h];if(Cm(e,p))return uN(d,e,p)}}if((i=(i+1)%l)==a)break}return n}function _E(n,e){let t=n.dom.ownerDocument,l,a=0,i=CE(t,e.left,e.top);i&&({node:l,offset:a}=i);let d=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),u;if(!d||!n.dom.contains(d.nodeType!=1?d.parentNode:d)){let p=n.dom.getBoundingClientRect();if(!Cm(e,p)||(d=uN(n.dom,e,p),!d))return null}if(ms)for(let p=d;l&&p;p=Si(p))p.draggable&&(l=void 0);if(d=IE(d,e),l){if(dl&&l.nodeType==1&&(a=Math.min(a,l.childNodes.length),a<l.childNodes.length)){let g=l.childNodes[a],b;g.nodeName=="IMG"&&(b=g.getBoundingClientRect()).right<=e.left&&b.bottom>e.top&&a++}let p;Zo&&a&&l.nodeType==1&&(p=l.childNodes[a-1]).nodeType==1&&p.contentEditable=="false"&&p.getBoundingClientRect().top>=e.top&&a--,l==n.dom&&a==l.childNodes.length-1&&l.lastChild.nodeType==1&&e.top>l.lastChild.getBoundingClientRect().bottom?u=n.state.doc.content.size:(a==0||l.nodeType!=1||l.childNodes[a-1].nodeName!="BR")&&(u=LE(n,l,a,e))}u==null&&(u=zE(n,d,e));let h=n.docView.nearestDesc(d,!0);return{pos:u,inside:h?h.posAtStart-h.border:-1}}function jy(n){return n.top<n.bottom||n.left<n.right}function Dr(n,e){let t=n.getClientRects();if(t.length){let l=t[e<0?0:t.length-1];if(jy(l))return l}return Array.prototype.find.call(t,jy)||n.getBoundingClientRect()}const BE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function fN(n,e,t){let{node:l,offset:a,atom:i}=n.docView.domFromPos(e,t<0?-1:1),d=Zo||dl;if(l.nodeType==3)if(d&&(BE.test(l.nodeValue)||(t<0?!a:a==l.nodeValue.length))){let h=Dr(er(l,a,a),t);if(dl&&a&&/\s/.test(l.nodeValue[a-1])&&a<l.nodeValue.length){let p=Dr(er(l,a-1,a-1),-1);if(p.top==h.top){let g=Dr(er(l,a,a+1),-1);if(g.top!=h.top)return yo(g,g.left<p.left)}}return h}else{let h=a,p=a,g=t<0?1:-1;return t<0&&!a?(p++,g=-1):t>=0&&a==l.nodeValue.length?(h--,g=1):t<0?h--:p++,yo(Dr(er(l,h,p),g),g<0)}if(!n.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&a&&(t<0||a==cl(l))){let h=l.childNodes[a-1];if(h.nodeType==1)return Zh(h.getBoundingClientRect(),!1)}if(i==null&&a<cl(l)){let h=l.childNodes[a];if(h.nodeType==1)return Zh(h.getBoundingClientRect(),!0)}return Zh(l.getBoundingClientRect(),t>=0)}if(i==null&&a&&(t<0||a==cl(l))){let h=l.childNodes[a-1],p=h.nodeType==3?er(h,cl(h)-(d?0:1)):h.nodeType==1&&(h.nodeName!="BR"||!h.nextSibling)?h:null;if(p)return yo(Dr(p,1),!1)}if(i==null&&a<cl(l)){let h=l.childNodes[a];for(;h.pmViewDesc&&h.pmViewDesc.ignoreForCoords;)h=h.nextSibling;let p=h?h.nodeType==3?er(h,0,d?0:1):h.nodeType==1?h:null:null;if(p)return yo(Dr(p,-1),!0)}return yo(Dr(l.nodeType==3?er(l):l,-t),t>=0)}function yo(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function Zh(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function hN(n,e,t){let l=n.state,a=n.root.activeElement;l!=e&&n.updateState(e),a!=n.dom&&n.focus();try{return t()}finally{l!=e&&n.updateState(l),a!=n.dom&&a&&a.focus()}}function PE(n,e,t){let l=e.selection,a=t=="up"?l.$from:l.$to;return hN(n,e,()=>{let{node:i}=n.docView.domFromPos(a.pos,t=="up"?-1:1);for(;;){let u=n.docView.nearestDesc(i,!0);if(!u)break;if(u.node.isBlock){i=u.contentDOM||u.dom;break}i=u.dom.parentNode}let d=fN(n,a.pos,1);for(let u=i.firstChild;u;u=u.nextSibling){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=er(u,0,u.nodeValue.length).getClientRects();else continue;for(let p=0;p<h.length;p++){let g=h[p];if(g.bottom>g.top+1&&(t=="up"?d.top-g.top>(g.bottom-d.top)*2:g.bottom-d.bottom>(d.bottom-g.top)*2))return!1}}return!0})}const HE=/[\u0590-\u08ac]/;function $E(n,e,t){let{$head:l}=e.selection;if(!l.parent.isTextblock)return!1;let a=l.parentOffset,i=!a,d=a==l.parent.content.size,u=n.domSelection();return u?!HE.test(l.parent.textContent)||!u.modify?t=="left"||t=="backward"?i:d:hN(n,e,()=>{let{focusNode:h,focusOffset:p,anchorNode:g,anchorOffset:b}=n.domSelectionRange(),y=u.caretBidiLevel;u.modify("move",t,"character");let v=l.depth?n.docView.domAfterPos(l.before()):n.dom,{focusNode:N,focusOffset:S}=n.domSelectionRange(),j=N&&!v.contains(N.nodeType==1?N:N.parentNode)||h==N&&p==S;try{u.collapse(g,b),h&&(h!=g||p!=b)&&u.extend&&u.extend(h,p)}catch{}return y!=null&&(u.caretBidiLevel=y),j}):l.pos==l.start()||l.pos==l.end()}let Cy=null,Ey=null,My=!1;function UE(n,e,t){return Cy==e&&Ey==t?My:(Cy=e,Ey=t,My=t=="up"||t=="down"?PE(n,e,t):$E(n,e,t))}const ul=0,Ay=1,ba=2,Tl=3;class Wo{constructor(e,t,l,a){this.parent=e,this.children=t,this.dom=l,this.contentDOM=a,this.dirty=ul,l.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,l){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,l=this.posAtStart;;t++){let a=this.children[t];if(a==e)return l;l+=a.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,l){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(l<0){let i,d;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((d=i.pmViewDesc)&&d.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(d)+d.size:this.posAtStart}else{let i,d;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((d=i.pmViewDesc)&&d.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(d):this.posAtEnd}let a;if(e==this.dom&&this.contentDOM)a=t>ts(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){a=!1;break}if(i.previousSibling)break}if(a==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){a=!0;break}if(i.nextSibling)break}}return a??l>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let l=!0,a=e;a;a=a.parentNode){let i=this.getDesc(a),d;if(i&&(!t||i.node))if(l&&(d=i.nodeDOM)&&!(d.nodeType==1?d.contains(e.nodeType==1?e:e.parentNode):d==e))l=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let l=t;l;l=l.parent)if(l==this)return t}posFromDOM(e,t,l){for(let a=e;a;a=a.parentNode){let i=this.getDesc(a);if(i)return i.localPosFromDOM(e,t,l)}return-1}descAt(e){for(let t=0,l=0;t<this.children.length;t++){let a=this.children[t],i=l+a.size;if(l==e&&i!=l){for(;!a.border&&a.children.length;)for(let d=0;d<a.children.length;d++){let u=a.children[d];if(u.size){a=u;break}}return a}if(e<i)return a.descAt(e-l-a.border);l=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let l=0,a=0;for(let i=0;l<this.children.length;l++){let d=this.children[l],u=i+d.size;if(u>e||d instanceof mN){a=e-i;break}i=u}if(a)return this.children[l].domFromPos(a-this.children[l].border,t);for(let i;l&&!(i=this.children[l-1]).size&&i instanceof pN&&i.side>=0;l--);if(t<=0){let i,d=!0;for(;i=l?this.children[l-1]:null,!(!i||i.dom.parentNode==this.contentDOM);l--,d=!1);return i&&t&&d&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?ts(i.dom)+1:0}}else{let i,d=!0;for(;i=l<this.children.length?this.children[l]:null,!(!i||i.dom.parentNode==this.contentDOM);l++,d=!1);return i&&d&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?ts(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,l=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let a=-1,i=-1;for(let d=l,u=0;;u++){let h=this.children[u],p=d+h.size;if(a==-1&&e<=p){let g=d+h.border;if(e>=g&&t<=p-h.border&&h.node&&h.contentDOM&&this.contentDOM.contains(h.contentDOM))return h.parseRange(e,t,g);e=d;for(let b=u;b>0;b--){let y=this.children[b-1];if(y.size&&y.dom.parentNode==this.contentDOM&&!y.emptyChildAt(1)){a=ts(y.dom)+1;break}e-=y.size}a==-1&&(a=0)}if(a>-1&&(p>t||u==this.children.length-1)){t=p;for(let g=u+1;g<this.children.length;g++){let b=this.children[g];if(b.size&&b.dom.parentNode==this.contentDOM&&!b.emptyChildAt(-1)){i=ts(b.dom);break}t+=b.size}i==-1&&(i=this.contentDOM.childNodes.length);break}d=p}return{node:this.contentDOM,from:e,to:t,fromOffset:a,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:l}=this.domFromPos(e,0);if(t.nodeType!=1||l==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[l]}setSelection(e,t,l,a=!1){let i=Math.min(e,t),d=Math.max(e,t);for(let v=0,N=0;v<this.children.length;v++){let S=this.children[v],j=N+S.size;if(i>N&&d<j)return S.setSelection(e-N-S.border,t-N-S.border,l,a);N=j}let u=this.domFromPos(e,e?-1:1),h=t==e?u:this.domFromPos(t,t?-1:1),p=l.root.getSelection(),g=l.domSelectionRange(),b=!1;if((dl||ms)&&e==t){let{node:v,offset:N}=u;if(v.nodeType==3){if(b=!!(N&&v.nodeValue[N-1]==`
`),b&&N==v.nodeValue.length)for(let S=v,j;S;S=S.parentNode){if(j=S.nextSibling){j.nodeName=="BR"&&(u=h={node:j.parentNode,offset:ts(j)+1});break}let E=S.pmViewDesc;if(E&&E.node&&E.node.isBlock)break}}else{let S=v.childNodes[N-1];b=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(dl&&g.focusNode&&g.focusNode!=h.node&&g.focusNode.nodeType==1){let v=g.focusNode.childNodes[g.focusOffset];v&&v.contentEditable=="false"&&(a=!0)}if(!(a||b&&ms)&&Aa(u.node,u.offset,g.anchorNode,g.anchorOffset)&&Aa(h.node,h.offset,g.focusNode,g.focusOffset))return;let y=!1;if((p.extend||e==t)&&!(b&&dl)){p.collapse(u.node,u.offset);try{e!=t&&p.extend(h.node,h.offset),y=!0}catch{}}if(!y){if(e>t){let N=u;u=h,h=N}let v=document.createRange();v.setEnd(h.node,h.offset),v.setStart(u.node,u.offset),p.removeAllRanges(),p.addRange(v)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let l=0,a=0;a<this.children.length;a++){let i=this.children[a],d=l+i.size;if(l==d?e<=d&&t>=l:e<d&&t>l){let u=l+i.border,h=d-i.border;if(e>=u&&t<=h){this.dirty=e==l||t==d?ba:Ay,e==u&&t==h&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Tl:i.markDirty(e-u,t-u);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?ba:Tl}l=d}this.dirty=ba}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let l=e==1?ba:Ay;t.dirty<l&&(t.dirty=l)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class pN extends Wo{constructor(e,t,l,a){let i,d=t.type.toDOM;if(typeof d=="function"&&(d=d(l,()=>{if(!i)return a;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(d.nodeType!=1){let u=document.createElement("span");u.appendChild(d),d=u}d.contentEditable="false",d.classList.add("ProseMirror-widget")}super(e,[],d,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==ul&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class VE extends Wo{constructor(e,t,l,a){super(e,[],t,null),this.textDOM=l,this.text=a}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Ta extends Wo{constructor(e,t,l,a,i){super(e,[],l,a),this.mark=t,this.spec=i}static create(e,t,l,a){let i=a.nodeViews[t.type.name],d=i&&i(t,a,l);return(!d||!d.dom)&&(d=Oa.renderSpec(document,t.type.spec.toDOM(t,l),null,t.attrs)),new Ta(e,t,d.dom,d.contentDOM||d.dom,d)}parseRule(){return this.dirty&Tl||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Tl&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=ul){let l=this.parent;for(;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=ul}}slice(e,t,l){let a=Ta.create(this.parent,this.mark,!0,l),i=this.children,d=this.size;t<d&&(i=Vp(i,t,d,l)),e>0&&(i=Vp(i,0,e,l));for(let u=0;u<i.length;u++)i[u].parent=a;return a.children=i,a}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Vr extends Wo{constructor(e,t,l,a,i,d,u,h,p){super(e,[],i,d),this.node=t,this.outerDeco=l,this.innerDeco=a,this.nodeDOM=u}static create(e,t,l,a,i,d){let u=i.nodeViews[t.type.name],h,p=u&&u(t,i,()=>{if(!h)return d;if(h.parent)return h.parent.posBeforeChild(h)},l,a),g=p&&p.dom,b=p&&p.contentDOM;if(t.isText){if(!g)g=document.createTextNode(t.text);else if(g.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else g||({dom:g,contentDOM:b}=Oa.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!b&&!t.isText&&g.nodeName!="BR"&&(g.hasAttribute("contenteditable")||(g.contentEditable="false"),t.type.spec.draggable&&(g.draggable=!0));let y=g;return g=bN(g,l,t),p?h=new qE(e,t,l,a,g,b||null,y,p,i,d+1):t.isText?new Su(e,t,l,a,g,y,i):new Vr(e,t,l,a,g,b||null,y,i,d+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let l=this.children[t];if(this.dom.contains(l.dom.parentNode)){e.contentElement=l.dom.parentNode;break}}e.contentElement||(e.getContent=()=>_e.empty)}return e}matchesNode(e,t,l){return this.dirty==ul&&e.eq(this.node)&&zd(t,this.outerDeco)&&l.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let l=this.node.inlineContent,a=t,i=e.composing?this.localCompositionInfo(e,t):null,d=i&&i.pos>-1?i:null,u=i&&i.pos<0,h=new KE(this,d&&d.node,e);XE(this.node,this.innerDeco,(p,g,b)=>{p.spec.marks?h.syncToMarks(p.spec.marks,l,e):p.type.side>=0&&!b&&h.syncToMarks(g==this.node.childCount?on.none:this.node.child(g).marks,l,e),h.placeWidget(p,e,a)},(p,g,b,y)=>{h.syncToMarks(p.marks,l,e);let v;h.findNodeMatch(p,g,b,y)||u&&e.state.selection.from>a&&e.state.selection.to<a+p.nodeSize&&(v=h.findIndexWithChild(i.node))>-1&&h.updateNodeAt(p,g,b,v,e)||h.updateNextNode(p,g,b,e,y,a)||h.addNode(p,g,b,e,a),a+=p.nodeSize}),h.syncToMarks([],l,e),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||this.dirty==ba)&&(d&&this.protectLocalComposition(e,d),gN(this.contentDOM,this.children,e),ji&&JE(this.dom))}localCompositionInfo(e,t){let{from:l,to:a}=e.state.selection;if(!(e.state.selection instanceof gt)||l<t||a>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let d=i.nodeValue,u=QE(this.node.content,d,l-t,a-t);return u<0?null:{node:i,pos:u,text:d}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:l,text:a}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let d=new VE(this,i,t,a);e.input.compositionNodes.push(d),this.children=Vp(this.children,l,l+a.length,e,d)}update(e,t,l,a){return this.dirty==Tl||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,l,a),!0)}updateInner(e,t,l,a){this.updateOuterDeco(t),this.node=e,this.innerDeco=l,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=ul}updateOuterDeco(e){if(zd(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,l=this.dom;this.dom=xN(this.dom,this.nodeDOM,Up(this.outerDeco,this.node,t),Up(e,this.node,t)),this.dom!=l&&(l.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Ty(n,e,t,l,a){bN(l,e,n);let i=new Vr(void 0,n,e,t,l,l,l,a,0);return i.contentDOM&&i.updateChildren(a,0),i}class Su extends Vr{constructor(e,t,l,a,i,d,u){super(e,t,l,a,i,null,d,u,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,l,a){return this.dirty==Tl||this.dirty!=ul&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=ul||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=e,this.dirty=ul,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,l){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,l)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,l){let a=this.node.cut(e,t),i=document.createTextNode(a.text);return new Su(this.parent,a,this.outerDeco,this.innerDeco,i,i,l)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=Tl)}get domAtom(){return!1}isText(e){return this.node.text==e}}class mN extends Wo{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ul&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class qE extends Vr{constructor(e,t,l,a,i,d,u,h,p,g){super(e,t,l,a,i,d,u,p,g),this.spec=h}update(e,t,l,a){if(this.dirty==Tl)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,l);return i&&this.updateInner(e,t,l,a),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,l,a)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,l,a){this.spec.setSelection?this.spec.setSelection(e,t,l.root):super.setSelection(e,t,l,a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function gN(n,e,t){let l=n.firstChild,a=!1;for(let i=0;i<e.length;i++){let d=e[i],u=d.dom;if(u.parentNode==n){for(;u!=l;)l=Dy(l),a=!0;l=l.nextSibling}else a=!0,n.insertBefore(u,l);if(d instanceof Ta){let h=l?l.previousSibling:n.lastChild;gN(d.contentDOM,d.children,t),l=h?h.nextSibling:n.firstChild}}for(;l;)l=Dy(l),a=!0;a&&t.trackWrites==n&&(t.trackWrites=null)}const Do=function(n){n&&(this.nodeName=n)};Do.prototype=Object.create(null);const ya=[new Do];function Up(n,e,t){if(n.length==0)return ya;let l=t?ya[0]:new Do,a=[l];for(let i=0;i<n.length;i++){let d=n[i].type.attrs;if(d){d.nodeName&&a.push(l=new Do(d.nodeName));for(let u in d){let h=d[u];h!=null&&(t&&a.length==1&&a.push(l=new Do(e.isInline?"span":"div")),u=="class"?l.class=(l.class?l.class+" ":"")+h:u=="style"?l.style=(l.style?l.style+";":"")+h:u!="nodeName"&&(l[u]=h))}}}return a}function xN(n,e,t,l){if(t==ya&&l==ya)return e;let a=e;for(let i=0;i<l.length;i++){let d=l[i],u=t[i];if(i){let h;u&&u.nodeName==d.nodeName&&a!=n&&(h=a.parentNode)&&h.nodeName.toLowerCase()==d.nodeName||(h=document.createElement(d.nodeName),h.pmIsDeco=!0,h.appendChild(a),u=ya[0]),a=h}FE(a,u||ya[0],d)}return a}function FE(n,e,t){for(let l in e)l!="class"&&l!="style"&&l!="nodeName"&&!(l in t)&&n.removeAttribute(l);for(let l in t)l!="class"&&l!="style"&&l!="nodeName"&&t[l]!=e[l]&&n.setAttribute(l,t[l]);if(e.class!=t.class){let l=e.class?e.class.split(" ").filter(Boolean):[],a=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<l.length;i++)a.indexOf(l[i])==-1&&n.classList.remove(l[i]);for(let i=0;i<a.length;i++)l.indexOf(a[i])==-1&&n.classList.add(a[i]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let l=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,a;for(;a=l.exec(e.style);)n.style.removeProperty(a[1])}t.style&&(n.style.cssText+=t.style)}}function bN(n,e,t){return xN(n,n,ya,Up(e,t,n.nodeType!=1))}function zd(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function Dy(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class KE{constructor(e,t,l){this.lock=t,this.view=l,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=GE(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let l=e;l<t;l++)this.top.children[l].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,l){let a=0,i=this.stack.length>>1,d=Math.min(i,e.length);for(;a<d&&(a==i-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<i;)this.destroyRest(),this.top.dirty=ul,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let u=-1;for(let h=this.index;h<Math.min(this.index+3,this.top.children.length);h++){let p=this.top.children[h];if(p.matchesMark(e[i])&&!this.isLocked(p.dom)){u=h;break}}if(u>-1)u>this.index&&(this.changed=!0,this.destroyBetween(this.index,u)),this.top=this.top.children[this.index];else{let h=Ta.create(this.top,e[i],t,l);this.top.children.splice(this.index,0,h),this.top=h,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,l,a){let i=-1,d;if(a>=this.preMatch.index&&(d=this.preMatch.matches[a-this.preMatch.index]).parent==this.top&&d.matchesNode(e,t,l))i=this.top.children.indexOf(d,this.index);else for(let u=this.index,h=Math.min(this.top.children.length,u+5);u<h;u++){let p=this.top.children[u];if(p.matchesNode(e,t,l)&&!this.preMatch.matched.has(p)){i=u;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,l,a,i){let d=this.top.children[a];return d.dirty==Tl&&d.dom==d.contentDOM&&(d.dirty=ba),d.update(e,t,l,i)?(this.destroyBetween(this.index,a),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let l=e.pmViewDesc;if(l){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==l)return a}return-1}e=t}}updateNextNode(e,t,l,a,i,d){for(let u=this.index;u<this.top.children.length;u++){let h=this.top.children[u];if(h instanceof Vr){let p=this.preMatch.matched.get(h);if(p!=null&&p!=i)return!1;let g=h.dom,b,y=this.isLocked(g)&&!(e.isText&&h.node&&h.node.isText&&h.nodeDOM.nodeValue==e.text&&h.dirty!=Tl&&zd(t,h.outerDeco));if(!y&&h.update(e,t,l,a))return this.destroyBetween(this.index,u),h.dom!=g&&(this.changed=!0),this.index++,!0;if(!y&&(b=this.recreateWrapper(h,e,t,l,a,d)))return this.destroyBetween(this.index,u),this.top.children[this.index]=b,b.contentDOM&&(b.dirty=ba,b.updateChildren(a,d+1),b.dirty=ul),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,l,a,i,d){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!zd(l,e.outerDeco)||!a.eq(e.innerDeco))return null;let u=Vr.create(this.top,t,l,a,i,d);if(u.contentDOM){u.children=e.children,e.children=[];for(let h of u.children)h.parent=u}return e.destroy(),u}addNode(e,t,l,a,i){let d=Vr.create(this.top,e,t,l,a,i);d.contentDOM&&d.updateChildren(a,i+1),this.top.children.splice(this.index++,0,d),this.changed=!0}placeWidget(e,t,l){let a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(e)&&(e==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{let i=new pN(this.top,e,t,l);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof Ta;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Su)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((ms||Gn)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let l=document.createElement(e);e=="IMG"&&(l.className="ProseMirror-separator",l.alt=""),e=="BR"&&(l.className="ProseMirror-trailingBreak");let a=new mN(this.top,[],l,null);t!=this.top?t.children.push(a):t.children.splice(this.index++,0,a),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function GE(n,e){let t=e,l=t.children.length,a=n.childCount,i=new Map,d=[];e:for(;a>0;){let u;for(;;)if(l){let p=t.children[l-1];if(p instanceof Ta)t=p,l=p.children.length;else{u=p,l--;break}}else{if(t==e)break e;l=t.parent.children.indexOf(t),t=t.parent}let h=u.node;if(h){if(h!=n.child(a-1))break;--a,i.set(u,a),d.push(u)}}return{index:a,matched:i,matches:d.reverse()}}function YE(n,e){return n.type.side-e.type.side}function XE(n,e,t,l){let a=e.locals(n),i=0;if(a.length==0){for(let p=0;p<n.childCount;p++){let g=n.child(p);l(g,a,e.forChild(i,g),p),i+=g.nodeSize}return}let d=0,u=[],h=null;for(let p=0;;){let g,b;for(;d<a.length&&a[d].to==i;){let j=a[d++];j.widget&&(g?(b||(b=[g])).push(j):g=j)}if(g)if(b){b.sort(YE);for(let j=0;j<b.length;j++)t(b[j],p,!!h)}else t(g,p,!!h);let y,v;if(h)v=-1,y=h,h=null;else if(p<n.childCount)v=p,y=n.child(p++);else break;for(let j=0;j<u.length;j++)u[j].to<=i&&u.splice(j--,1);for(;d<a.length&&a[d].from<=i&&a[d].to>i;)u.push(a[d++]);let N=i+y.nodeSize;if(y.isText){let j=N;d<a.length&&a[d].from<j&&(j=a[d].from);for(let E=0;E<u.length;E++)u[E].to<j&&(j=u[E].to);j<N&&(h=y.cut(j-i),y=y.cut(0,j-i),N=j,v=-1)}else for(;d<a.length&&a[d].to<N;)d++;let S=y.isInline&&!y.isLeaf?u.filter(j=>!j.inline):u.slice();l(y,S,e.forChild(i,y),v),i=N}}function JE(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function QE(n,e,t,l){for(let a=0,i=0;a<n.childCount&&i<=l;){let d=n.child(a++),u=i;if(i+=d.nodeSize,!d.isText)continue;let h=d.text;for(;a<n.childCount;){let p=n.child(a++);if(i+=p.nodeSize,!p.isText)break;h+=p.text}if(i>=t){if(i>=l&&h.slice(l-e.length-u,l-u)==e)return l-e.length;let p=u<l?h.lastIndexOf(e,l-u-1):-1;if(p>=0&&p+e.length+u>=t)return u+p;if(t==l&&h.length>=l+e.length-u&&h.slice(l-u,l-u+e.length)==e)return l}}return-1}function Vp(n,e,t,l,a){let i=[];for(let d=0,u=0;d<n.length;d++){let h=n[d],p=u,g=u+=h.size;p>=t||g<=e?i.push(h):(p<e&&i.push(h.slice(0,e-p,l)),a&&(i.push(a),a=void 0),g>t&&i.push(h.slice(t-p,h.size,l)))}return i}function Em(n,e=null){let t=n.domSelectionRange(),l=n.state.doc;if(!t.focusNode)return null;let a=n.docView.nearestDesc(t.focusNode),i=a&&a.size==0,d=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(d<0)return null;let u=l.resolve(d),h,p;if(wu(t)){for(h=d;a&&!a.node;)a=a.parent;let b=a.node;if(a&&b.isAtom&&ct.isSelectable(b)&&a.parent&&!(b.isInline&&SE(t.focusNode,t.focusOffset,a.dom))){let y=a.posBefore;p=new ct(d==y?u:l.resolve(y))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let b=d,y=d;for(let v=0;v<t.rangeCount;v++){let N=t.getRangeAt(v);b=Math.min(b,n.docView.posFromDOM(N.startContainer,N.startOffset,1)),y=Math.max(y,n.docView.posFromDOM(N.endContainer,N.endOffset,-1))}if(b<0)return null;[h,d]=y==n.state.selection.anchor?[y,b]:[b,y],u=l.resolve(d)}else h=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(h<0)return null}let g=l.resolve(h);if(!p){let b=e=="pointer"||n.state.selection.head<u.pos&&!i?1:-1;p=Mm(n,g,u,b)}return p}function yN(n){return n.editable?n.hasFocus():NN(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function sr(n,e=!1){let t=n.state.selection;if(vN(n,t),!!yN(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Gn){let l=n.domSelectionRange(),a=n.domObserver.currentSelection;if(l.anchorNode&&a.anchorNode&&Aa(l.anchorNode,l.anchorOffset,a.anchorNode,a.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)WE(n);else{let{anchor:l,head:a}=t,i,d;Oy&&!(t instanceof gt)&&(t.$from.parent.inlineContent||(i=Ry(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(d=Ry(n,t.to))),n.docView.setSelection(l,a,n,e),Oy&&(i&&Iy(i),d&&Iy(d)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ZE(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const Oy=ms||Gn&&aN<63;function Ry(n,e){let{node:t,offset:l}=n.docView.domFromPos(e,0),a=l<t.childNodes.length?t.childNodes[l]:null,i=l?t.childNodes[l-1]:null;if(ms&&a&&a.contentEditable=="false")return Wh(a);if((!a||a.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(a)return Wh(a);if(i)return Wh(i)}}function Wh(n){return n.contentEditable="true",ms&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Iy(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function ZE(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),l=t.anchorNode,a=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=l||t.anchorOffset!=a)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!yN(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function WE(n){let e=n.domSelection();if(!e)return;let t=n.cursorWrapper.dom,l=t.nodeName=="IMG";l?e.collapse(t.parentNode,ts(t)+1):e.collapse(t,0),!l&&!n.state.selection.visible&&Os&&Ur<=11&&(t.disabled=!0,t.disabled=!1)}function vN(n,e){if(e instanceof ct){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(zy(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else zy(n)}function zy(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function Mm(n,e,t,l){return n.someProp("createSelectionBetween",a=>a(n,e,t))||gt.between(e,t,l)}function Ly(n){return n.editable&&!n.hasFocus()?!1:NN(n)}function NN(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function eM(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return Aa(e.node,e.offset,t.anchorNode,t.anchorOffset)}function qp(n,e){let{$anchor:t,$head:l}=n.selection,a=e>0?t.max(l):t.min(l),i=a.parent.inlineContent?a.depth?n.doc.resolve(e>0?a.after():a.before()):null:a;return i&&Et.findFrom(i,e)}function Ir(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function _y(n,e,t){let l=n.state.selection;if(l instanceof gt)if(t.indexOf("s")>-1){let{$head:a}=l,i=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let d=n.state.doc.resolve(a.pos+i.nodeSize*(e<0?-1:1));return Ir(n,new gt(l.$anchor,d))}else if(l.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let a=qp(n.state,e);return a&&a instanceof ct?Ir(n,a):!1}else if(!(il&&t.indexOf("m")>-1)){let a=l.$head,i=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter,d;if(!i||i.isText)return!1;let u=e<0?a.pos-i.nodeSize:a.pos;return i.isAtom||(d=n.docView.descAt(u))&&!d.contentDOM?ct.isSelectable(i)?Ir(n,new ct(e<0?n.state.doc.resolve(a.pos-i.nodeSize):a)):Zo?Ir(n,new gt(n.state.doc.resolve(e<0?u:u+i.nodeSize))):!1:!1}}else return!1;else{if(l instanceof ct&&l.node.isInline)return Ir(n,new gt(e>0?l.$to:l.$from));{let a=qp(n.state,e);return a?Ir(n,a):!1}}}function Ld(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Oo(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function fi(n,e){return e<0?tM(n):nM(n)}function tM(n){let e=n.domSelectionRange(),t=e.focusNode,l=e.focusOffset;if(!t)return;let a,i,d=!1;for(dl&&t.nodeType==1&&l<Ld(t)&&Oo(t.childNodes[l],-1)&&(d=!0);;)if(l>0){if(t.nodeType!=1)break;{let u=t.childNodes[l-1];if(Oo(u,-1))a=t,i=--l;else if(u.nodeType==3)t=u,l=t.nodeValue.length;else break}}else{if(kN(t))break;{let u=t.previousSibling;for(;u&&Oo(u,-1);)a=t.parentNode,i=ts(u),u=u.previousSibling;if(u)t=u,l=Ld(t);else{if(t=t.parentNode,t==n.dom)break;l=0}}}d?Fp(n,t,l):a&&Fp(n,a,i)}function nM(n){let e=n.domSelectionRange(),t=e.focusNode,l=e.focusOffset;if(!t)return;let a=Ld(t),i,d;for(;;)if(l<a){if(t.nodeType!=1)break;let u=t.childNodes[l];if(Oo(u,1))i=t,d=++l;else break}else{if(kN(t))break;{let u=t.nextSibling;for(;u&&Oo(u,1);)i=u.parentNode,d=ts(u)+1,u=u.nextSibling;if(u)t=u,l=0,a=Ld(t);else{if(t=t.parentNode,t==n.dom)break;l=a=0}}}i&&Fp(n,i,d)}function kN(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function sM(n,e){for(;n&&e==n.childNodes.length&&!Qo(n);)e=ts(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function lM(n,e){for(;n&&!e&&!Qo(n);)e=ts(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function Fp(n,e,t){if(e.nodeType!=3){let i,d;(d=sM(e,t))?(e=d,t=0):(i=lM(e,t))&&(e=i,t=i.nodeValue.length)}let l=n.domSelection();if(!l)return;if(wu(l)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),l.removeAllRanges(),l.addRange(i)}else l.extend&&l.extend(e,t);n.domObserver.setCurSelection();let{state:a}=n;setTimeout(()=>{n.state==a&&sr(n)},50)}function By(n,e){let t=n.state.doc.resolve(e);if(!(Gn||iN)&&t.parent.inlineContent){let a=n.coordsAtPos(e);if(e>t.start()){let i=n.coordsAtPos(e-1),d=(i.top+i.bottom)/2;if(d>a.top&&d<a.bottom&&Math.abs(i.left-a.left)>1)return i.left<a.left?"ltr":"rtl"}if(e<t.end()){let i=n.coordsAtPos(e+1),d=(i.top+i.bottom)/2;if(d>a.top&&d<a.bottom&&Math.abs(i.left-a.left)>1)return i.left>a.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Py(n,e,t){let l=n.state.selection;if(l instanceof gt&&!l.empty||t.indexOf("s")>-1||il&&t.indexOf("m")>-1)return!1;let{$from:a,$to:i}=l;if(!a.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let d=qp(n.state,e);if(d&&d instanceof ct)return Ir(n,d)}if(!a.parent.inlineContent){let d=e<0?a:i,u=l instanceof qs?Et.near(d,e):Et.findFrom(d,e);return u?Ir(n,u):!1}return!1}function Hy(n,e){if(!(n.state.selection instanceof gt))return!0;let{$head:t,$anchor:l,empty:a}=n.state.selection;if(!t.sameParent(l))return!0;if(!a)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let d=n.state.tr;return e<0?d.delete(t.pos-i.nodeSize,t.pos):d.delete(t.pos,t.pos+i.nodeSize),n.dispatch(d),!0}return!1}function $y(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function rM(n){if(!ms||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let l=e.firstChild;$y(n,l,"true"),setTimeout(()=>$y(n,l,"false"),20)}return!1}function aM(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function iM(n,e){let t=e.keyCode,l=aM(e);if(t==8||il&&t==72&&l=="c")return Hy(n,-1)||fi(n,-1);if(t==46&&!e.shiftKey||il&&t==68&&l=="c")return Hy(n,1)||fi(n,1);if(t==13||t==27)return!0;if(t==37||il&&t==66&&l=="c"){let a=t==37?By(n,n.state.selection.from)=="ltr"?-1:1:-1;return _y(n,a,l)||fi(n,a)}else if(t==39||il&&t==70&&l=="c"){let a=t==39?By(n,n.state.selection.from)=="ltr"?1:-1:1;return _y(n,a,l)||fi(n,a)}else{if(t==38||il&&t==80&&l=="c")return Py(n,-1,l)||fi(n,-1);if(t==40||il&&t==78&&l=="c")return rM(n)||Py(n,1,l)||fi(n,1);if(l==(il?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function Am(n,e){n.someProp("transformCopied",v=>{e=v(e,n)});let t=[],{content:l,openStart:a,openEnd:i}=e;for(;a>1&&i>1&&l.childCount==1&&l.firstChild.childCount==1;){a--,i--;let v=l.firstChild;t.push(v.type.name,v.attrs!=v.type.defaultAttrs?v.attrs:null),l=v.content}let d=n.someProp("clipboardSerializer")||Oa.fromSchema(n.state.schema),u=MN(),h=u.createElement("div");h.appendChild(d.serializeFragment(l,{document:u}));let p=h.firstChild,g,b=0;for(;p&&p.nodeType==1&&(g=EN[p.nodeName.toLowerCase()]);){for(let v=g.length-1;v>=0;v--){let N=u.createElement(g[v]);for(;h.firstChild;)N.appendChild(h.firstChild);h.appendChild(N),b++}p=h.firstChild}p&&p.nodeType==1&&p.setAttribute("data-pm-slice",`${a} ${i}${b?` -${b}`:""} ${JSON.stringify(t)}`);let y=n.someProp("clipboardTextSerializer",v=>v(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:h,text:y,slice:e}}function wN(n,e,t,l,a){let i=a.parent.type.spec.code,d,u;if(!t&&!e)return null;let h=!!e&&(l||i||!t);if(h){if(n.someProp("transformPastedText",y=>{e=y(e,i||l,n)}),i)return u=new Ze(_e.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),n.someProp("transformPasted",y=>{u=y(u,n,!0)}),u;let b=n.someProp("clipboardTextParser",y=>y(e,a,l,n));if(b)u=b;else{let y=a.marks(),{schema:v}=n.state,N=Oa.fromSchema(v);d=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let j=d.appendChild(document.createElement("p"));S&&j.appendChild(N.serializeNode(v.text(S,y)))})}}else n.someProp("transformPastedHTML",b=>{t=b(t,n)}),d=uM(t),Zo&&fM(d);let p=d&&d.querySelector("[data-pm-slice]"),g=p&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(p.getAttribute("data-pm-slice")||"");if(g&&g[3])for(let b=+g[3];b>0;b--){let y=d.firstChild;for(;y&&y.nodeType!=1;)y=y.nextSibling;if(!y)break;d=y}if(u||(u=(n.someProp("clipboardParser")||n.someProp("domParser")||Ao.fromSchema(n.state.schema)).parseSlice(d,{preserveWhitespace:!!(h||g),context:a,ruleFromNode(y){return y.nodeName=="BR"&&!y.nextSibling&&y.parentNode&&!oM.test(y.parentNode.nodeName)?{ignore:!0}:null}})),g)u=hM(Uy(u,+g[1],+g[2]),g[4]);else if(u=Ze.maxOpen(cM(u.content,a),!0),u.openStart||u.openEnd){let b=0,y=0;for(let v=u.content.firstChild;b<u.openStart&&!v.type.spec.isolating;b++,v=v.firstChild);for(let v=u.content.lastChild;y<u.openEnd&&!v.type.spec.isolating;y++,v=v.lastChild);u=Uy(u,b,y)}return n.someProp("transformPasted",b=>{u=b(u,n,h)}),u}const oM=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function cM(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let a=e.node(t).contentMatchAt(e.index(t)),i,d=[];if(n.forEach(u=>{if(!d)return;let h=a.findWrapping(u.type),p;if(!h)return d=null;if(p=d.length&&i.length&&jN(h,i,u,d[d.length-1],0))d[d.length-1]=p;else{d.length&&(d[d.length-1]=CN(d[d.length-1],i.length));let g=SN(u,h);d.push(g),a=a.matchType(g.type),i=h}}),d)return _e.from(d)}return n}function SN(n,e,t=0){for(let l=e.length-1;l>=t;l--)n=e[l].create(null,_e.from(n));return n}function jN(n,e,t,l,a){if(a<n.length&&a<e.length&&n[a]==e[a]){let i=jN(n,e,t,l.lastChild,a+1);if(i)return l.copy(l.content.replaceChild(l.childCount-1,i));if(l.contentMatchAt(l.childCount).matchType(a==n.length-1?t.type:n[a+1]))return l.copy(l.content.append(_e.from(SN(t,n,a+1))))}}function CN(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,CN(n.lastChild,e-1)),l=n.contentMatchAt(n.childCount).fillBefore(_e.empty,!0);return n.copy(t.append(l))}function Kp(n,e,t,l,a,i){let d=e<0?n.firstChild:n.lastChild,u=d.content;return n.childCount>1&&(i=0),a<l-1&&(u=Kp(u,e,t,l,a+1,i)),a>=t&&(u=e<0?d.contentMatchAt(0).fillBefore(u,i<=a).append(u):u.append(d.contentMatchAt(d.childCount).fillBefore(_e.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,d.copy(u))}function Uy(n,e,t){return e<n.openStart&&(n=new Ze(Kp(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new Ze(Kp(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const EN={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Vy=null;function MN(){return Vy||(Vy=document.implementation.createHTMLDocument("title"))}let ep=null;function dM(n){let e=window.trustedTypes;return e?(ep||(ep=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),ep.createHTML(n)):n}function uM(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=MN().createElement("div"),l=/<([a-z][^>\s]+)/i.exec(n),a;if((a=l&&EN[l[1].toLowerCase()])&&(n=a.map(i=>"<"+i+">").join("")+n+a.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=dM(n),a)for(let i=0;i<a.length;i++)t=t.querySelector(a[i])||t;return t}function fM(n){let e=n.querySelectorAll(Gn?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let l=e[t];l.childNodes.length==1&&l.textContent==""&&l.parentNode&&l.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),l)}}function hM(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,l;try{l=JSON.parse(e)}catch{return n}let{content:a,openStart:i,openEnd:d}=n;for(let u=l.length-2;u>=0;u-=2){let h=t.nodes[l[u]];if(!h||h.hasRequiredAttrs())break;a=_e.from(h.create(l[u+1],a)),i++,d++}return new Ze(a,i,d)}const Ns={},ks={},pM={touchstart:!0,touchmove:!0};class mM{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function gM(n){for(let e in Ns){let t=Ns[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=l=>{bM(n,l)&&!Tm(n,l)&&(n.editable||!(l.type in ks))&&t(n,l)},pM[e]?{passive:!0}:void 0)}ms&&n.dom.addEventListener("input",()=>null),Gp(n)}function $r(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function xM(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function Gp(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=l=>Tm(n,l))})}function Tm(n,e){return n.someProp("handleDOMEvents",t=>{let l=t[e.type];return l?l(n,e)||e.defaultPrevented:!1})}function bM(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function yM(n,e){!Tm(n,e)&&Ns[e.type]&&(n.editable||!(e.type in ks))&&Ns[e.type](n,e)}ks.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!TN(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(tr&&Gn&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),ji&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let l=Date.now();n.input.lastIOSEnter=l,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==l&&(n.someProp("handleKeyDown",a=>a(n,xa(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",l=>l(n,t))||iM(n,t)?t.preventDefault():$r(n,"key")};ks.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};ks.keypress=(n,e)=>{let t=e;if(TN(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||il&&t.metaKey)return;if(n.someProp("handleKeyPress",a=>a(n,t))){t.preventDefault();return}let l=n.state.selection;if(!(l instanceof gt)||!l.$from.sameParent(l.$to)){let a=String.fromCharCode(t.charCode),i=()=>n.state.tr.insertText(a).scrollIntoView();!/[\r\n]/.test(a)&&!n.someProp("handleTextInput",d=>d(n,l.$from.pos,l.$to.pos,a,i))&&n.dispatch(i()),t.preventDefault()}};function ju(n){return{left:n.clientX,top:n.clientY}}function vM(n,e){let t=e.x-n.clientX,l=e.y-n.clientY;return t*t+l*l<100}function Dm(n,e,t,l,a){if(l==-1)return!1;let i=n.state.doc.resolve(l);for(let d=i.depth+1;d>0;d--)if(n.someProp(e,u=>d>i.depth?u(n,t,i.nodeAfter,i.before(d),a,!0):u(n,t,i.node(d),i.before(d),a,!1)))return!0;return!1}function vi(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let l=n.state.tr.setSelection(e);l.setMeta("pointer",!0),n.dispatch(l)}function NM(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),l=t.nodeAfter;return l&&l.isAtom&&ct.isSelectable(l)?(vi(n,new ct(t)),!0):!1}function kM(n,e){if(e==-1)return!1;let t=n.state.selection,l,a;t instanceof ct&&(l=t.node);let i=n.state.doc.resolve(e);for(let d=i.depth+1;d>0;d--){let u=d>i.depth?i.nodeAfter:i.node(d);if(ct.isSelectable(u)){l&&t.$from.depth>0&&d>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?a=i.before(t.$from.depth):a=i.before(d);break}}return a!=null?(vi(n,ct.create(n.state.doc,a)),!0):!1}function wM(n,e,t,l,a){return Dm(n,"handleClickOn",e,t,l)||n.someProp("handleClick",i=>i(n,e,l))||(a?kM(n,t):NM(n,t))}function SM(n,e,t,l){return Dm(n,"handleDoubleClickOn",e,t,l)||n.someProp("handleDoubleClick",a=>a(n,e,l))}function jM(n,e,t,l){return Dm(n,"handleTripleClickOn",e,t,l)||n.someProp("handleTripleClick",a=>a(n,e,l))||CM(n,t,l)}function CM(n,e,t){if(t.button!=0)return!1;let l=n.state.doc;if(e==-1)return l.inlineContent?(vi(n,gt.create(l,0,l.content.size)),!0):!1;let a=l.resolve(e);for(let i=a.depth+1;i>0;i--){let d=i>a.depth?a.nodeAfter:a.node(i),u=a.before(i);if(d.inlineContent)vi(n,gt.create(l,u+1,u+1+d.content.size));else if(ct.isSelectable(d))vi(n,ct.create(l,u));else continue;return!0}}function Om(n){return _d(n)}const AN=il?"metaKey":"ctrlKey";Ns.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let l=Om(n),a=Date.now(),i="singleClick";a-n.input.lastClick.time<500&&vM(t,n.input.lastClick)&&!t[AN]&&n.input.lastClick.button==t.button&&(n.input.lastClick.type=="singleClick"?i="doubleClick":n.input.lastClick.type=="doubleClick"&&(i="tripleClick")),n.input.lastClick={time:a,x:t.clientX,y:t.clientY,type:i,button:t.button};let d=n.posAtCoords(ju(t));d&&(i=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new EM(n,d,t,!!l)):(i=="doubleClick"?SM:jM)(n,d.pos,d.inside,t)?t.preventDefault():$r(n,"pointer"))};class EM{constructor(e,t,l,a){this.view=e,this.pos=t,this.event=l,this.flushed=a,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!l[AN],this.allowDefault=l.shiftKey;let i,d;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),d=t.inside;else{let g=e.state.doc.resolve(t.pos);i=g.parent,d=g.depth?g.before():0}const u=a?null:l.target,h=u?e.docView.nearestDesc(u,!0):null;this.target=h&&h.nodeDOM.nodeType==1?h.nodeDOM:null;let{selection:p}=e.state;(l.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||p instanceof ct&&p.from<=d&&p.to>d)&&(this.mightDrag={node:i,pos:d,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&dl&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),$r(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>sr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(ju(e))),this.updateAllowDefault(e),this.allowDefault||!t?$r(this.view,"pointer"):wM(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ms&&this.mightDrag&&!this.mightDrag.node.isAtom||Gn&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(vi(this.view,Et.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):$r(this.view,"pointer")}move(e){this.updateAllowDefault(e),$r(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ns.touchstart=n=>{n.input.lastTouch=Date.now(),Om(n),$r(n,"pointer")};Ns.touchmove=n=>{n.input.lastTouch=Date.now(),$r(n,"pointer")};Ns.contextmenu=n=>Om(n);function TN(n,e){return n.composing?!0:ms&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const MM=tr?5e3:-1;ks.compositionstart=ks.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof gt&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(l=>l.type.spec.inclusive===!1)||Gn&&iN&&AM(n)))n.markCursor=n.state.storedMarks||t.marks(),_d(n,!0),n.markCursor=null;else if(_d(n,!e.selection.empty),dl&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let l=n.domSelectionRange();for(let a=l.focusNode,i=l.focusOffset;a&&a.nodeType==1&&i!=0;){let d=i<0?a.lastChild:a.childNodes[i-1];if(!d)break;if(d.nodeType==3){let u=n.domSelection();u&&u.collapse(d,d.nodeValue.length);break}else a=d,i=-1}}n.input.composing=!0}DN(n,MM)};function AM(n){let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(!e||e.nodeType!=1||t>=e.childNodes.length)return!1;let l=e.childNodes[t];return l.nodeType==1&&l.contentEditable=="false"}ks.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,DN(n,20))};function DN(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>_d(n),e))}function ON(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=DM());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function TM(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=kE(e.focusNode,e.focusOffset),l=wE(e.focusNode,e.focusOffset);if(t&&l&&t!=l){let a=l.pmViewDesc,i=n.domObserver.lastChangedTextNode;if(t==i||l==i)return i;if(!a||!a.isText(l.nodeValue))return l;if(n.input.compositionNode==l){let d=t.pmViewDesc;if(!(!d||!d.isText(t.nodeValue)))return l}}return t||l}function DM(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function _d(n,e=!1){if(!(tr&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),ON(n),e||n.docView&&n.docView.dirty){let t=Em(n),l=n.state.selection;return t&&!t.eq(l)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!l.$from.node(l.$from.sharedDepth(l.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function OM(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let l=getSelection(),a=document.createRange();a.selectNodeContents(e),n.dom.blur(),l.removeAllRanges(),l.addRange(a),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const qo=Os&&Ur<15||ji&&EE<604;Ns.copy=ks.cut=(n,e)=>{let t=e,l=n.state.selection,a=t.type=="cut";if(l.empty)return;let i=qo?null:t.clipboardData,d=l.content(),{dom:u,text:h}=Am(n,d);i?(t.preventDefault(),i.clearData(),i.setData("text/html",u.innerHTML),i.setData("text/plain",h)):OM(n,u),a&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function RM(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function IM(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,l=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(l.contentEditable="true"),l.style.cssText="position: fixed; left: -10000px; top: 10px",l.focus();let a=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),l.parentNode&&l.parentNode.removeChild(l),t?Fo(n,l.value,null,a,e):Fo(n,l.textContent,l.innerHTML,a,e)},50)}function Fo(n,e,t,l,a){let i=wN(n,e,t,l,n.state.selection.$from);if(n.someProp("handlePaste",h=>h(n,a,i||Ze.empty)))return!0;if(!i)return!1;let d=RM(i),u=d?n.state.tr.replaceSelectionWith(d,l):n.state.tr.replaceSelection(i);return n.dispatch(u.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function RN(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}ks.paste=(n,e)=>{let t=e;if(n.composing&&!tr)return;let l=qo?null:t.clipboardData,a=n.input.shiftKey&&n.input.lastKeyCode!=45;l&&Fo(n,RN(l),l.getData("text/html"),a,t)?t.preventDefault():IM(n,t)};class IN{constructor(e,t,l){this.slice=e,this.move=t,this.node=l}}const zM=il?"altKey":"ctrlKey";function zN(n,e){let t=n.someProp("dragCopies",l=>!l(e));return t??!e[zM]}Ns.dragstart=(n,e)=>{let t=e,l=n.input.mouseDown;if(l&&l.done(),!t.dataTransfer)return;let a=n.state.selection,i=a.empty?null:n.posAtCoords(ju(t)),d;if(!(i&&i.pos>=a.from&&i.pos<=(a instanceof ct?a.to-1:a.to))){if(l&&l.mightDrag)d=ct.create(n.state.doc,l.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let b=n.docView.nearestDesc(t.target,!0);b&&b.node.type.spec.draggable&&b!=n.docView&&(d=ct.create(n.state.doc,b.posBefore))}}let u=(d||n.state.selection).content(),{dom:h,text:p,slice:g}=Am(n,u);(!t.dataTransfer.files.length||!Gn||aN>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(qo?"Text":"text/html",h.innerHTML),t.dataTransfer.effectAllowed="copyMove",qo||t.dataTransfer.setData("text/plain",p),n.dragging=new IN(g,zN(n,t),d)};Ns.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};ks.dragover=ks.dragenter=(n,e)=>e.preventDefault();ks.drop=(n,e)=>{try{LM(n,e,n.dragging)}finally{n.dragging=null}};function LM(n,e,t){if(!e.dataTransfer)return;let l=n.posAtCoords(ju(e));if(!l)return;let a=n.state.doc.resolve(l.pos),i=t&&t.slice;i?n.someProp("transformPasted",v=>{i=v(i,n,!1)}):i=wN(n,RN(e.dataTransfer),qo?null:e.dataTransfer.getData("text/html"),!1,a);let d=!!(t&&zN(n,e));if(n.someProp("handleDrop",v=>v(n,e,i||Ze.empty,d))){e.preventDefault();return}if(!i)return;e.preventDefault();let u=i?P1(n.state.doc,a.pos,i):a.pos;u==null&&(u=a.pos);let h=n.state.tr;if(d){let{node:v}=t;v?v.replace(h):h.deleteSelection()}let p=h.mapping.map(u),g=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,b=h.doc;if(g?h.replaceRangeWith(p,p,i.content.firstChild):h.replaceRange(p,p,i),h.doc.eq(b))return;let y=h.doc.resolve(p);if(g&&ct.isSelectable(i.content.firstChild)&&y.nodeAfter&&y.nodeAfter.sameMarkup(i.content.firstChild))h.setSelection(new ct(y));else{let v=h.mapping.map(u);h.mapping.maps[h.mapping.maps.length-1].forEach((N,S,j,E)=>v=E),h.setSelection(Mm(n,y,h.doc.resolve(v)))}n.focus(),n.dispatch(h.setMeta("uiEvent","drop"))}Ns.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&sr(n)},20))};Ns.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};Ns.beforeinput=(n,e)=>{if(Gn&&tr&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:l}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=l||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",i=>i(n,xa(8,"Backspace")))))return;let{$cursor:a}=n.state.selection;a&&a.pos>0&&n.dispatch(n.state.tr.delete(a.pos-1,a.pos).scrollIntoView())},50)}};for(let n in ks)Ns[n]=ks[n];function Ko(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class Bd{constructor(e,t){this.toDOM=e,this.spec=t||Sa,this.side=this.spec.side||0}map(e,t,l,a){let{pos:i,deleted:d}=e.mapResult(t.from+a,this.side<0?-1:1);return d?null:new vs(i-l,i-l,this)}valid(){return!0}eq(e){return this==e||e instanceof Bd&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ko(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class qr{constructor(e,t){this.attrs=e,this.spec=t||Sa}map(e,t,l,a){let i=e.map(t.from+a,this.spec.inclusiveStart?-1:1)-l,d=e.map(t.to+a,this.spec.inclusiveEnd?1:-1)-l;return i>=d?null:new vs(i,d,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof qr&&Ko(this.attrs,e.attrs)&&Ko(this.spec,e.spec)}static is(e){return e.type instanceof qr}destroy(){}}class Rm{constructor(e,t){this.attrs=e,this.spec=t||Sa}map(e,t,l,a){let i=e.mapResult(t.from+a,1);if(i.deleted)return null;let d=e.mapResult(t.to+a,-1);return d.deleted||d.pos<=i.pos?null:new vs(i.pos-l,d.pos-l,this)}valid(e,t){let{index:l,offset:a}=e.content.findIndex(t.from),i;return a==t.from&&!(i=e.child(l)).isText&&a+i.nodeSize==t.to}eq(e){return this==e||e instanceof Rm&&Ko(this.attrs,e.attrs)&&Ko(this.spec,e.spec)}destroy(){}}class vs{constructor(e,t,l){this.from=e,this.to=t,this.type=l}copy(e,t){return new vs(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,l){return this.type.map(e,this,t,l)}static widget(e,t,l){return new vs(e,e,new Bd(t,l))}static inline(e,t,l,a){return new vs(e,t,new qr(l,a))}static node(e,t,l,a){return new vs(e,t,new Rm(l,a))}get spec(){return this.type.spec}get inline(){return this.type instanceof qr}get widget(){return this.type instanceof Bd}}const mi=[],Sa={};class mn{constructor(e,t){this.local=e.length?e:mi,this.children=t.length?t:mi}static create(e,t){return t.length?Pd(t,e,0,Sa):hs}find(e,t,l){let a=[];return this.findInner(e??0,t??1e9,a,0,l),a}findInner(e,t,l,a,i){for(let d=0;d<this.local.length;d++){let u=this.local[d];u.from<=t&&u.to>=e&&(!i||i(u.spec))&&l.push(u.copy(u.from+a,u.to+a))}for(let d=0;d<this.children.length;d+=3)if(this.children[d]<t&&this.children[d+1]>e){let u=this.children[d]+1;this.children[d+2].findInner(e-u,t-u,l,a+u,i)}}map(e,t,l){return this==hs||e.maps.length==0?this:this.mapInner(e,t,0,0,l||Sa)}mapInner(e,t,l,a,i){let d;for(let u=0;u<this.local.length;u++){let h=this.local[u].map(e,l,a);h&&h.type.valid(t,h)?(d||(d=[])).push(h):i.onRemove&&i.onRemove(this.local[u].spec)}return this.children.length?_M(this.children,d||[],e,t,l,a,i):d?new mn(d.sort(ja),mi):hs}add(e,t){return t.length?this==hs?mn.create(e,t):this.addInner(e,t,0):this}addInner(e,t,l){let a,i=0;e.forEach((u,h)=>{let p=h+l,g;if(g=_N(t,u,p)){for(a||(a=this.children.slice());i<a.length&&a[i]<h;)i+=3;a[i]==h?a[i+2]=a[i+2].addInner(u,g,p+1):a.splice(i,0,h,h+u.nodeSize,Pd(g,u,p+1,Sa)),i+=3}});let d=LN(i?BN(t):t,-l);for(let u=0;u<d.length;u++)d[u].type.valid(e,d[u])||d.splice(u--,1);return new mn(d.length?this.local.concat(d).sort(ja):this.local,a||this.children)}remove(e){return e.length==0||this==hs?this:this.removeInner(e,0)}removeInner(e,t){let l=this.children,a=this.local;for(let i=0;i<l.length;i+=3){let d,u=l[i]+t,h=l[i+1]+t;for(let g=0,b;g<e.length;g++)(b=e[g])&&b.from>u&&b.to<h&&(e[g]=null,(d||(d=[])).push(b));if(!d)continue;l==this.children&&(l=this.children.slice());let p=l[i+2].removeInner(d,u+1);p!=hs?l[i+2]=p:(l.splice(i,3),i-=3)}if(a.length){for(let i=0,d;i<e.length;i++)if(d=e[i])for(let u=0;u<a.length;u++)a[u].eq(d,t)&&(a==this.local&&(a=this.local.slice()),a.splice(u--,1))}return l==this.children&&a==this.local?this:a.length||l.length?new mn(a,l):hs}forChild(e,t){if(this==hs)return this;if(t.isLeaf)return mn.empty;let l,a;for(let u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(l=this.children[u+2]);break}let i=e+1,d=i+t.content.size;for(let u=0;u<this.local.length;u++){let h=this.local[u];if(h.from<d&&h.to>i&&h.type instanceof qr){let p=Math.max(i,h.from)-i,g=Math.min(d,h.to)-i;p<g&&(a||(a=[])).push(h.copy(p,g))}}if(a){let u=new mn(a.sort(ja),mi);return l?new _r([u,l]):u}return l||hs}eq(e){if(this==e)return!0;if(!(e instanceof mn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Im(this.localsInner(e))}localsInner(e){if(this==hs)return mi;if(e.inlineContent||!this.local.some(qr.is))return this.local;let t=[];for(let l=0;l<this.local.length;l++)this.local[l].type instanceof qr||t.push(this.local[l]);return t}forEachSet(e){e(this)}}mn.empty=new mn([],[]);mn.removeOverlap=Im;const hs=mn.empty;class _r{constructor(e){this.members=e}map(e,t){const l=this.members.map(a=>a.map(e,t,Sa));return _r.from(l)}forChild(e,t){if(t.isLeaf)return mn.empty;let l=[];for(let a=0;a<this.members.length;a++){let i=this.members[a].forChild(e,t);i!=hs&&(i instanceof _r?l=l.concat(i.members):l.push(i))}return _r.from(l)}eq(e){if(!(e instanceof _r)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,l=!0;for(let a=0;a<this.members.length;a++){let i=this.members[a].localsInner(e);if(i.length)if(!t)t=i;else{l&&(t=t.slice(),l=!1);for(let d=0;d<i.length;d++)t.push(i[d])}}return t?Im(l?t:t.sort(ja)):mi}static from(e){switch(e.length){case 0:return hs;case 1:return e[0];default:return new _r(e.every(t=>t instanceof mn)?e:e.reduce((t,l)=>t.concat(l instanceof mn?l:l.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function _M(n,e,t,l,a,i,d){let u=n.slice();for(let p=0,g=i;p<t.maps.length;p++){let b=0;t.maps[p].forEach((y,v,N,S)=>{let j=S-N-(v-y);for(let E=0;E<u.length;E+=3){let D=u[E+1];if(D<0||y>D+g-b)continue;let _=u[E]+g-b;v>=_?u[E+1]=y<=_?-2:-1:y>=g&&j&&(u[E]+=j,u[E+1]+=j)}b+=j}),g=t.maps[p].map(g,-1)}let h=!1;for(let p=0;p<u.length;p+=3)if(u[p+1]<0){if(u[p+1]==-2){h=!0,u[p+1]=-1;continue}let g=t.map(n[p]+i),b=g-a;if(b<0||b>=l.content.size){h=!0;continue}let y=t.map(n[p+1]+i,-1),v=y-a,{index:N,offset:S}=l.content.findIndex(b),j=l.maybeChild(N);if(j&&S==b&&S+j.nodeSize==v){let E=u[p+2].mapInner(t,j,g+1,n[p]+i+1,d);E!=hs?(u[p]=b,u[p+1]=v,u[p+2]=E):(u[p+1]=-2,h=!0)}else h=!0}if(h){let p=BM(u,n,e,t,a,i,d),g=Pd(p,l,0,d);e=g.local;for(let b=0;b<u.length;b+=3)u[b+1]<0&&(u.splice(b,3),b-=3);for(let b=0,y=0;b<g.children.length;b+=3){let v=g.children[b];for(;y<u.length&&u[y]<v;)y+=3;u.splice(y,0,g.children[b],g.children[b+1],g.children[b+2])}}return new mn(e.sort(ja),u)}function LN(n,e){if(!e||!n.length)return n;let t=[];for(let l=0;l<n.length;l++){let a=n[l];t.push(new vs(a.from+e,a.to+e,a.type))}return t}function BM(n,e,t,l,a,i,d){function u(h,p){for(let g=0;g<h.local.length;g++){let b=h.local[g].map(l,a,p);b?t.push(b):d.onRemove&&d.onRemove(h.local[g].spec)}for(let g=0;g<h.children.length;g+=3)u(h.children[g+2],h.children[g]+p+1)}for(let h=0;h<n.length;h+=3)n[h+1]==-1&&u(n[h+2],e[h]+i+1);return t}function _N(n,e,t){if(e.isLeaf)return null;let l=t+e.nodeSize,a=null;for(let i=0,d;i<n.length;i++)(d=n[i])&&d.from>t&&d.to<l&&((a||(a=[])).push(d),n[i]=null);return a}function BN(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function Pd(n,e,t,l){let a=[],i=!1;e.forEach((u,h)=>{let p=_N(n,u,h+t);if(p){i=!0;let g=Pd(p,u,t+h+1,l);g!=hs&&a.push(h,h+u.nodeSize,g)}});let d=LN(i?BN(n):n,-t).sort(ja);for(let u=0;u<d.length;u++)d[u].type.valid(e,d[u])||(l.onRemove&&l.onRemove(d[u].spec),d.splice(u--,1));return d.length||a.length?new mn(d,a):hs}function ja(n,e){return n.from-e.from||n.to-e.to}function Im(n){let e=n;for(let t=0;t<e.length-1;t++){let l=e[t];if(l.from!=l.to)for(let a=t+1;a<e.length;a++){let i=e[a];if(i.from==l.from){i.to!=l.to&&(e==n&&(e=n.slice()),e[a]=i.copy(i.from,l.to),qy(e,a+1,i.copy(l.to,i.to)));continue}else{i.from<l.to&&(e==n&&(e=n.slice()),e[t]=l.copy(l.from,i.from),qy(e,a,l.copy(i.from,l.to)));break}}}return e}function qy(n,e,t){for(;e<n.length&&ja(t,n[e])>0;)e++;n.splice(e,0,t)}function tp(n){let e=[];return n.someProp("decorations",t=>{let l=t(n.state);l&&l!=hs&&e.push(l)}),n.cursorWrapper&&e.push(mn.create(n.state.doc,[n.cursorWrapper.deco])),_r.from(e)}const PM={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},HM=Os&&Ur<=11;class $M{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class UM{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new $M,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(l=>{for(let a=0;a<l.length;a++)this.queue.push(l[a]);Os&&Ur<=11&&l.some(a=>a.type=="childList"&&a.removedNodes.length||a.type=="characterData"&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),HM&&(this.onCharData=l=>{this.queue.push({target:l.target,type:"characterData",oldValue:l.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,PM)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Ly(this.view)){if(this.suppressingSelectionUpdates)return sr(this.view);if(Os&&Ur<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Aa(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,l;for(let i=e.focusNode;i;i=Si(i))t.add(i);for(let i=e.anchorNode;i;i=Si(i))if(t.has(i)){l=i;break}let a=l&&this.view.docView.nearestDesc(l);if(a&&a.ignoreMutation({type:"selection",target:l.nodeType==3?l.parentNode:l}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let l=e.domSelectionRange(),a=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(l)&&Ly(e)&&!this.ignoreSelectionChange(l),i=-1,d=-1,u=!1,h=[];if(e.editable)for(let g=0;g<t.length;g++){let b=this.registerMutation(t[g],h);b&&(i=i<0?b.from:Math.min(b.from,i),d=d<0?b.to:Math.max(b.to,d),b.typeOver&&(u=!0))}if(dl&&h.length){let g=h.filter(b=>b.nodeName=="BR");if(g.length==2){let[b,y]=g;b.parentNode&&b.parentNode.parentNode==y.parentNode?y.remove():b.remove()}else{let{focusNode:b}=this.currentSelection;for(let y of g){let v=y.parentNode;v&&v.nodeName=="LI"&&(!b||FM(e,b)!=v)&&y.remove()}}}else if((Gn||ms)&&h.some(g=>g.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let g of h)if(g.nodeName=="BR"&&g.parentNode){let b=g.nextSibling;b&&b.nodeType==1&&b.contentEditable=="false"&&g.parentNode.removeChild(g)}}let p=null;i<0&&a&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&wu(l)&&(p=Em(e))&&p.eq(Et.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,sr(e),this.currentSelection.set(l),e.scrollToSelection()):(i>-1||a)&&(i>-1&&(e.docView.markDirty(i,d),VM(e)),this.handleDOMChange(i,d,u,h),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(l)||sr(e),this.currentSelection.set(l))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let l=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(l==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!l||l.ignoreMutation(e))return null;if(e.type=="childList"){for(let g=0;g<e.addedNodes.length;g++){let b=e.addedNodes[g];t.push(b),b.nodeType==3&&(this.lastChangedTextNode=b)}if(l.contentDOM&&l.contentDOM!=l.dom&&!l.contentDOM.contains(e.target))return{from:l.posBefore,to:l.posAfter};let a=e.previousSibling,i=e.nextSibling;if(Os&&Ur<=11&&e.addedNodes.length)for(let g=0;g<e.addedNodes.length;g++){let{previousSibling:b,nextSibling:y}=e.addedNodes[g];(!b||Array.prototype.indexOf.call(e.addedNodes,b)<0)&&(a=b),(!y||Array.prototype.indexOf.call(e.addedNodes,y)<0)&&(i=y)}let d=a&&a.parentNode==e.target?ts(a)+1:0,u=l.localPosFromDOM(e.target,d,-1),h=i&&i.parentNode==e.target?ts(i):e.target.childNodes.length,p=l.localPosFromDOM(e.target,h,1);return{from:u,to:p}}else return e.type=="attributes"?{from:l.posAtStart-l.border,to:l.posAtEnd+l.border}:(this.lastChangedTextNode=e.target,{from:l.posAtStart,to:l.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Fy=new WeakMap,Ky=!1;function VM(n){if(!Fy.has(n)&&(Fy.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=dl,Ky)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Ky=!0}}function Gy(n,e){let t=e.startContainer,l=e.startOffset,a=e.endContainer,i=e.endOffset,d=n.domAtPos(n.state.selection.anchor);return Aa(d.node,d.offset,a,i)&&([t,l,a,i]=[a,i,t,l]),{anchorNode:t,anchorOffset:l,focusNode:a,focusOffset:i}}function qM(n,e){if(e.getComposedRanges){let a=e.getComposedRanges(n.root)[0];if(a)return Gy(n,a)}let t;function l(a){a.preventDefault(),a.stopImmediatePropagation(),t=a.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",l,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",l,!0),t?Gy(n,t):null}function FM(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let l=n.docView.nearestDesc(t,!0);if(l&&l.node.isBlock)return t}return null}function KM(n,e,t){let{node:l,fromOffset:a,toOffset:i,from:d,to:u}=n.docView.parseRange(e,t),h=n.domSelectionRange(),p,g=h.anchorNode;if(g&&n.dom.contains(g.nodeType==1?g:g.parentNode)&&(p=[{node:g,offset:h.anchorOffset}],wu(h)||p.push({node:h.focusNode,offset:h.focusOffset})),Gn&&n.input.lastKeyCode===8)for(let j=i;j>a;j--){let E=l.childNodes[j-1],D=E.pmViewDesc;if(E.nodeName=="BR"&&!D){i=j;break}if(!D||D.size)break}let b=n.state.doc,y=n.someProp("domParser")||Ao.fromSchema(n.state.schema),v=b.resolve(d),N=null,S=y.parse(l,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:a,to:i,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:p,ruleFromNode:GM,context:v});if(p&&p[0].pos!=null){let j=p[0].pos,E=p[1]&&p[1].pos;E==null&&(E=j),N={anchor:j+d,head:E+d}}return{doc:S,sel:N,from:d,to:u}}function GM(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(ms&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||ms&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const YM=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function XM(n,e,t,l,a){let i=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let G=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,X=Em(n,G);if(X&&!n.state.selection.eq(X)){if(Gn&&tr&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",R=>R(n,xa(13,"Enter"))))return;let $=n.state.tr.setSelection(X);G=="pointer"?$.setMeta("pointer",!0):G=="key"&&$.scrollIntoView(),i&&$.setMeta("composition",i),n.dispatch($)}return}let d=n.state.doc.resolve(e),u=d.sharedDepth(t);e=d.before(u+1),t=n.state.doc.resolve(t).after(u+1);let h=n.state.selection,p=KM(n,e,t),g=n.state.doc,b=g.slice(p.from,p.to),y,v;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(y=n.state.selection.to,v="end"):(y=n.state.selection.from,v="start"),n.input.lastKeyCode=null;let N=ZM(b.content,p.doc.content,p.from,y,v);if(N&&n.input.domChangeCount++,(ji&&n.input.lastIOSEnter>Date.now()-225||tr)&&a.some(G=>G.nodeType==1&&!YM.test(G.nodeName))&&(!N||N.endA>=N.endB)&&n.someProp("handleKeyDown",G=>G(n,xa(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!N)if(l&&h instanceof gt&&!h.empty&&h.$head.sameParent(h.$anchor)&&!n.composing&&!(p.sel&&p.sel.anchor!=p.sel.head))N={start:h.from,endA:h.to,endB:h.to};else{if(p.sel){let G=Yy(n,n.state.doc,p.sel);if(G&&!G.eq(n.state.selection)){let X=n.state.tr.setSelection(G);i&&X.setMeta("composition",i),n.dispatch(X)}}return}n.state.selection.from<n.state.selection.to&&N.start==N.endB&&n.state.selection instanceof gt&&(N.start>n.state.selection.from&&N.start<=n.state.selection.from+2&&n.state.selection.from>=p.from?N.start=n.state.selection.from:N.endA<n.state.selection.to&&N.endA>=n.state.selection.to-2&&n.state.selection.to<=p.to&&(N.endB+=n.state.selection.to-N.endA,N.endA=n.state.selection.to)),Os&&Ur<=11&&N.endB==N.start+1&&N.endA==N.start&&N.start>p.from&&p.doc.textBetween(N.start-p.from-1,N.start-p.from+1)==" "&&(N.start--,N.endA--,N.endB--);let S=p.doc.resolveNoCache(N.start-p.from),j=p.doc.resolveNoCache(N.endB-p.from),E=g.resolve(N.start),D=S.sameParent(j)&&S.parent.inlineContent&&E.end()>=N.endA;if((ji&&n.input.lastIOSEnter>Date.now()-225&&(!D||a.some(G=>G.nodeName=="DIV"||G.nodeName=="P"))||!D&&S.pos<p.doc.content.size&&(!S.sameParent(j)||!S.parent.inlineContent)&&S.pos<j.pos&&!/\S/.test(p.doc.textBetween(S.pos,j.pos,"","")))&&n.someProp("handleKeyDown",G=>G(n,xa(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>N.start&&QM(g,N.start,N.endA,S,j)&&n.someProp("handleKeyDown",G=>G(n,xa(8,"Backspace")))){tr&&Gn&&n.domObserver.suppressSelectionUpdates();return}Gn&&N.endB==N.start&&(n.input.lastChromeDelete=Date.now()),tr&&!D&&S.start()!=j.start()&&j.parentOffset==0&&S.depth==j.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==N.endA&&(N.endB-=2,j=p.doc.resolveNoCache(N.endB-p.from),setTimeout(()=>{n.someProp("handleKeyDown",function(G){return G(n,xa(13,"Enter"))})},20));let _=N.start,H=N.endA,L=G=>{let X=G||n.state.tr.replace(_,H,p.doc.slice(N.start-p.from,N.endB-p.from));if(p.sel){let $=Yy(n,X.doc,p.sel);$&&!(Gn&&n.composing&&$.empty&&(N.start!=N.endB||n.input.lastChromeDelete<Date.now()-100)&&($.head==_||$.head==X.mapping.map(H)-1)||Os&&$.empty&&$.head==_)&&X.setSelection($)}return i&&X.setMeta("composition",i),X.scrollIntoView()},V;if(D)if(S.pos==j.pos){Os&&Ur<=11&&S.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>sr(n),20));let G=L(n.state.tr.delete(_,H)),X=g.resolve(N.start).marksAcross(g.resolve(N.endA));X&&G.ensureMarks(X),n.dispatch(G)}else if(N.endA==N.endB&&(V=JM(S.parent.content.cut(S.parentOffset,j.parentOffset),E.parent.content.cut(E.parentOffset,N.endA-E.start())))){let G=L(n.state.tr);V.type=="add"?G.addMark(_,H,V.mark):G.removeMark(_,H,V.mark),n.dispatch(G)}else if(S.parent.child(S.index()).isText&&S.index()==j.index()-(j.textOffset?0:1)){let G=S.parent.textBetween(S.parentOffset,j.parentOffset),X=()=>L(n.state.tr.insertText(G,_,H));n.someProp("handleTextInput",$=>$(n,_,H,G,X))||n.dispatch(X())}else n.dispatch(L());else n.dispatch(L())}function Yy(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:Mm(n,e.resolve(t.anchor),e.resolve(t.head))}function JM(n,e){let t=n.firstChild.marks,l=e.firstChild.marks,a=t,i=l,d,u,h;for(let g=0;g<l.length;g++)a=l[g].removeFromSet(a);for(let g=0;g<t.length;g++)i=t[g].removeFromSet(i);if(a.length==1&&i.length==0)u=a[0],d="add",h=g=>g.mark(u.addToSet(g.marks));else if(a.length==0&&i.length==1)u=i[0],d="remove",h=g=>g.mark(u.removeFromSet(g.marks));else return null;let p=[];for(let g=0;g<e.childCount;g++)p.push(h(e.child(g)));if(_e.from(p).eq(n))return{mark:u,type:d}}function QM(n,e,t,l,a){if(t-e<=a.pos-l.pos||np(l,!0,!1)<a.pos)return!1;let i=n.resolve(e);if(!l.parent.isTextblock){let u=i.nodeAfter;return u!=null&&t==e+u.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let d=n.resolve(np(i,!0,!0));return!d.parent.isTextblock||d.pos>t||np(d,!0,!1)<t?!1:l.parent.content.cut(l.parentOffset).eq(d.parent.content)}function np(n,e,t){let l=n.depth,a=e?n.end():n.pos;for(;l>0&&(e||n.indexAfter(l)==n.node(l).childCount);)l--,a++,e=!1;if(t){let i=n.node(l).maybeChild(n.indexAfter(l));for(;i&&!i.isLeaf;)i=i.firstChild,a++}return a}function ZM(n,e,t,l,a){let i=n.findDiffStart(e,t);if(i==null)return null;let{a:d,b:u}=n.findDiffEnd(e,t+n.size,t+e.size);if(a=="end"){let h=Math.max(0,i-Math.min(d,u));l-=d+h-i}if(d<i&&n.size<e.size){let h=l<=i&&l>=d?i-l:0;i-=h,i&&i<e.size&&Xy(e.textBetween(i-1,i+1))&&(i+=h?1:-1),u=i+(u-d),d=i}else if(u<i){let h=l<=i&&l>=u?i-l:0;i-=h,i&&i<n.size&&Xy(n.textBetween(i-1,i+1))&&(i+=h?1:-1),d=i+(d-u),u=i}return{start:i,endA:d,endB:u}}function Xy(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class PN{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new mM,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(ev),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Zy(this),Qy(this),this.nodeViews=Wy(this),this.docView=Ty(this.state.doc,Jy(this),tp(this),this.dom,this),this.domObserver=new UM(this,(l,a,i,d)=>XM(this,l,a,i,d)),this.domObserver.start(),gM(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Gp(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(ev),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let l in this._props)t[l]=this._props[l];t.state=this.state;for(let l in e)t[l]=e[l];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var l;let a=this.state,i=!1,d=!1;e.storedMarks&&this.composing&&(ON(this),d=!0),this.state=e;let u=a.plugins!=e.plugins||this._props.plugins!=t.plugins;if(u||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let v=Wy(this);eA(v,this.nodeViews)&&(this.nodeViews=v,i=!0)}(u||t.handleDOMEvents!=this._props.handleDOMEvents)&&Gp(this),this.editable=Zy(this),Qy(this);let h=tp(this),p=Jy(this),g=a.plugins!=e.plugins&&!a.doc.eq(e.doc)?"reset":e.scrollToSelection>a.scrollToSelection?"to selection":"preserve",b=i||!this.docView.matchesNode(e.doc,p,h);(b||!e.selection.eq(a.selection))&&(d=!0);let y=g=="preserve"&&d&&this.dom.style.overflowAnchor==null&&TE(this);if(d){this.domObserver.stop();let v=b&&(Os||Gn)&&!this.composing&&!a.selection.empty&&!e.selection.empty&&WM(a.selection,e.selection);if(b){let N=Gn?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=TM(this)),(i||!this.docView.update(e.doc,p,h,this))&&(this.docView.updateOuterDeco(p),this.docView.destroy(),this.docView=Ty(e.doc,p,h,this.dom,this)),N&&!this.trackWrites&&(v=!0)}v||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&eM(this))?sr(this,v):(vN(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(a),!((l=this.dragging)===null||l===void 0)&&l.node&&!a.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,a),g=="reset"?this.dom.scrollTop=0:g=="to selection"?this.scrollToSelection():y&&DE(y)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof ct){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Sy(this,t.getBoundingClientRect(),e)}else Sy(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let l=this.directPlugins[t];l.spec.view&&this.pluginViews.push(l.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let l=this.state.plugins[t];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let l=this.pluginViews[t];l.update&&l.update(this,e)}}updateDraggedNode(e,t){let l=e.node,a=-1;if(this.state.doc.nodeAt(l.from)==l.node)a=l.from;else{let i=l.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==l.node&&(a=i)}this.dragging=new IN(e.slice,e.move,a<0?void 0:ct.create(this.state.doc,a))}someProp(e,t){let l=this._props&&this._props[e],a;if(l!=null&&(a=t?t(l):l))return a;for(let d=0;d<this.directPlugins.length;d++){let u=this.directPlugins[d].props[e];if(u!=null&&(a=t?t(u):u))return a}let i=this.state.plugins;if(i)for(let d=0;d<i.length;d++){let u=i[d].props[e];if(u!=null&&(a=t?t(u):u))return a}}hasFocus(){if(Os){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&OE(this.dom),sr(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return _E(this,e)}coordsAtPos(e,t=1){return fN(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,l=-1){let a=this.docView.posFromDOM(e,t,l);if(a==null)throw new RangeError("DOM position not inside the editor");return a}endOfTextblock(e,t){return UE(this,t||this.state,e)}pasteHTML(e,t){return Fo(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Fo(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return Am(this,e)}destroy(){this.docView&&(xM(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],tp(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,vE())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return yM(this,e)}domSelectionRange(){let e=this.domSelection();return e?ms&&this.root.nodeType===11&&jE(this.dom.ownerDocument)==this.dom&&qM(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}PN.prototype.dispatch=function(n){let e=this._props.dispatchTransaction;e?e.call(this,n):this.updateState(this.state.apply(n))};function Jy(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let l in t)l=="class"?e.class+=" "+t[l]:l=="style"?e.style=(e.style?e.style+";":"")+t[l]:!e[l]&&l!="contenteditable"&&l!="nodeName"&&(e[l]=String(t[l]))}),e.translate||(e.translate="no"),[vs.node(0,n.state.doc.content.size,e)]}function Qy(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:vs.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function Zy(n){return!n.someProp("editable",e=>e(n.state)===!1)}function WM(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function Wy(n){let e=Object.create(null);function t(l){for(let a in l)Object.prototype.hasOwnProperty.call(e,a)||(e[a]=l[a])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function eA(n,e){let t=0,l=0;for(let a in n){if(n[a]!=e[a])return!0;t++}for(let a in e)l++;return t!=l}function ev(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Kr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Hd={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},tA=typeof navigator<"u"&&/Mac/.test(navigator.platform),nA=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ns=0;ns<10;ns++)Kr[48+ns]=Kr[96+ns]=String(ns);for(var ns=1;ns<=24;ns++)Kr[ns+111]="F"+ns;for(var ns=65;ns<=90;ns++)Kr[ns]=String.fromCharCode(ns+32),Hd[ns]=String.fromCharCode(ns);for(var sp in Kr)Hd.hasOwnProperty(sp)||(Hd[sp]=Kr[sp]);function sA(n){var e=tA&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||nA&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?Hd:Kr)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const lA=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),rA=typeof navigator<"u"&&/Win/.test(navigator.platform);function aA(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let l,a,i,d;for(let u=0;u<e.length-1;u++){let h=e[u];if(/^(cmd|meta|m)$/i.test(h))d=!0;else if(/^a(lt)?$/i.test(h))l=!0;else if(/^(c|ctrl|control)$/i.test(h))a=!0;else if(/^s(hift)?$/i.test(h))i=!0;else if(/^mod$/i.test(h))lA?d=!0:a=!0;else throw new Error("Unrecognized modifier name: "+h)}return l&&(t="Alt-"+t),a&&(t="Ctrl-"+t),d&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function iA(n){let e=Object.create(null);for(let t in n)e[aA(t)]=n[t];return e}function lp(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function oA(n){return new gn({props:{handleKeyDown:HN(n)}})}function HN(n){let e=iA(n);return function(t,l){let a=sA(l),i,d=e[lp(a,l)];if(d&&d(t.state,t.dispatch,t))return!0;if(a.length==1&&a!=" "){if(l.shiftKey){let u=e[lp(a,l,!1)];if(u&&u(t.state,t.dispatch,t))return!0}if((l.altKey||l.metaKey||l.ctrlKey)&&!(rA&&l.ctrlKey&&l.altKey)&&(i=Kr[l.keyCode])&&i!=a){let u=e[lp(i,l)];if(u&&u(t.state,t.dispatch,t))return!0}}return!1}}var cA=Object.defineProperty,zm=(n,e)=>{for(var t in e)cA(n,t,{get:e[t],enumerable:!0})};function Cu(n){const{state:e,transaction:t}=n;let{selection:l}=t,{doc:a}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return l},get doc(){return a},get tr(){return l=t.selection,a=t.doc,i=t.storedMarks,t}}}var Eu=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:n,editor:e,state:t}=this,{view:l}=e,{tr:a}=t,i=this.buildProps(a);return Object.fromEntries(Object.entries(n).map(([d,u])=>[d,(...p)=>{const g=u(...p)(i);return!a.getMeta("preventDispatch")&&!this.hasCustomState&&l.dispatch(a),g}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,e=!0){const{rawCommands:t,editor:l,state:a}=this,{view:i}=l,d=[],u=!!n,h=n||a.tr,p=()=>(!u&&e&&!h.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(h),d.every(b=>b===!0)),g={...Object.fromEntries(Object.entries(t).map(([b,y])=>[b,(...N)=>{const S=this.buildProps(h,e),j=y(...N)(S);return d.push(j),g}])),run:p};return g}createCan(n){const{rawCommands:e,state:t}=this,l=!1,a=n||t.tr,i=this.buildProps(a,l);return{...Object.fromEntries(Object.entries(e).map(([u,h])=>[u,(...p)=>h(...p)({...i,dispatch:void 0})])),chain:()=>this.createChain(a,l)}}buildProps(n,e=!0){const{rawCommands:t,editor:l,state:a}=this,{view:i}=l,d={tr:n,editor:l,view:i,state:Cu({state:a,transaction:n}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(n,e),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(t).map(([u,h])=>[u,(...p)=>h(...p)(d)]))}};return d}},$N={};zm($N,{blur:()=>dA,clearContent:()=>uA,clearNodes:()=>fA,command:()=>hA,createParagraphNear:()=>pA,cut:()=>mA,deleteCurrentNode:()=>gA,deleteNode:()=>xA,deleteRange:()=>bA,deleteSelection:()=>yA,enter:()=>vA,exitCode:()=>NA,extendMarkRange:()=>kA,first:()=>wA,focus:()=>jA,forEach:()=>CA,insertContent:()=>EA,insertContentAt:()=>TA,joinBackward:()=>RA,joinDown:()=>OA,joinForward:()=>IA,joinItemBackward:()=>zA,joinItemForward:()=>LA,joinTextblockBackward:()=>_A,joinTextblockForward:()=>BA,joinUp:()=>DA,keyboardShortcut:()=>HA,lift:()=>$A,liftEmptyBlock:()=>UA,liftListItem:()=>VA,newlineInCode:()=>qA,resetAttributes:()=>FA,scrollIntoView:()=>KA,selectAll:()=>GA,selectNodeBackward:()=>YA,selectNodeForward:()=>XA,selectParentNode:()=>JA,selectTextblockEnd:()=>QA,selectTextblockStart:()=>ZA,setContent:()=>WA,setMark:()=>yT,setMeta:()=>vT,setNode:()=>NT,setNodeSelection:()=>kT,setTextDirection:()=>wT,setTextSelection:()=>ST,sinkListItem:()=>jT,splitBlock:()=>CT,splitListItem:()=>ET,toggleList:()=>MT,toggleMark:()=>AT,toggleNode:()=>TT,toggleWrap:()=>DT,undoInputRule:()=>OT,unsetAllMarks:()=>RT,unsetMark:()=>IT,unsetTextDirection:()=>zT,updateAttributes:()=>LT,wrapIn:()=>_T,wrapInList:()=>BT});var dA=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),uA=(n=!0)=>({commands:e})=>e.setContent("",{emitUpdate:n}),fA=()=>({state:n,tr:e,dispatch:t})=>{const{selection:l}=e,{ranges:a}=l;return t&&a.forEach(({$from:i,$to:d})=>{n.doc.nodesBetween(i.pos,d.pos,(u,h)=>{if(u.type.isText)return;const{doc:p,mapping:g}=e,b=p.resolve(g.map(h)),y=p.resolve(g.map(h+u.nodeSize)),v=b.blockRange(y);if(!v)return;const N=Ai(v);if(u.type.isTextblock){const{defaultType:S}=b.parent.contentMatchAt(b.index());e.setNodeMarkup(v.start,S)}(N||N===0)&&e.lift(v,N)})}),!0},hA=n=>e=>n(e),pA=()=>({state:n,dispatch:e})=>tN(n,e),mA=(n,e)=>({editor:t,tr:l})=>{const{state:a}=t,i=a.doc.slice(n.from,n.to);l.deleteRange(n.from,n.to);const d=l.mapping.map(e);return l.insert(d,i.content),l.setSelection(new gt(l.doc.resolve(Math.max(d-1,0)))),!0},gA=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,l=t.$anchor.node();if(l.content.size>0)return!1;const a=n.selection.$anchor;for(let i=a.depth;i>0;i-=1)if(a.node(i).type===l.type){if(e){const u=a.before(i),h=a.after(i);n.delete(u,h).scrollIntoView()}return!0}return!1};function Pn(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}var xA=n=>({tr:e,state:t,dispatch:l})=>{const a=Pn(n,t.schema),i=e.selection.$anchor;for(let d=i.depth;d>0;d-=1)if(i.node(d).type===a){if(l){const h=i.before(d),p=i.after(d);e.delete(h,p).scrollIntoView()}return!0}return!1},bA=n=>({tr:e,dispatch:t})=>{const{from:l,to:a}=n;return t&&e.delete(l,a),!0},yA=()=>({state:n,dispatch:e})=>Nm(n,e),vA=()=>({commands:n})=>n.keyboardShortcut("Enter"),NA=()=>({state:n,dispatch:e})=>rE(n,e);function Lm(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function $d(n,e,t={strict:!0}){const l=Object.keys(e);return l.length?l.every(a=>t.strict?e[a]===n[a]:Lm(e[a])?e[a].test(n[a]):e[a]===n[a]):!0}function UN(n,e,t={}){return n.find(l=>l.type===e&&$d(Object.fromEntries(Object.keys(t).map(a=>[a,l.attrs[a]])),t))}function tv(n,e,t={}){return!!UN(n,e,t)}function _m(n,e,t){var l;if(!n||!e)return;let a=n.parent.childAfter(n.parentOffset);if((!a.node||!a.node.marks.some(g=>g.type===e))&&(a=n.parent.childBefore(n.parentOffset)),!a.node||!a.node.marks.some(g=>g.type===e)||(t=t||((l=a.node.marks[0])==null?void 0:l.attrs),!UN([...a.node.marks],e,t)))return;let d=a.index,u=n.start()+a.offset,h=d+1,p=u+a.node.nodeSize;for(;d>0&&tv([...n.parent.child(d-1).marks],e,t);)d-=1,u-=n.parent.child(d).nodeSize;for(;h<n.parent.childCount&&tv([...n.parent.child(h).marks],e,t);)p+=n.parent.child(h).nodeSize,h+=1;return{from:u,to:p}}function lr(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}var kA=(n,e={})=>({tr:t,state:l,dispatch:a})=>{const i=lr(n,l.schema),{doc:d,selection:u}=t,{$from:h,from:p,to:g}=u;if(a){const b=_m(h,i,e);if(b&&b.from<=p&&b.to>=g){const y=gt.create(d,b.from,b.to);t.setSelection(y)}}return!0},wA=n=>e=>{const t=typeof n=="function"?n(e):n;for(let l=0;l<t.length;l+=1)if(t[l](e))return!0;return!1};function VN(n){return n instanceof gt}function va(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function qN(n,e=null){if(!e)return null;const t=Et.atStart(n),l=Et.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return l;const a=t.from,i=l.to;return e==="all"?gt.create(n,va(0,a,i),va(n.content.size,a,i)):gt.create(n,va(e,a,i),va(e,a,i))}function SA(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Bm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var jA=(n=null,e={})=>({editor:t,view:l,tr:a,dispatch:i})=>{e={scrollIntoView:!0,...e};const d=()=>{(Bm()||SA())&&l.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(l.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(l.hasFocus()&&n===null||n===!1)return!0;if(i&&n===null&&!VN(t.state.selection))return d(),!0;const u=qN(a.doc,n)||t.state.selection,h=t.state.selection.eq(u);return i&&(h||a.setSelection(u),h&&a.storedMarks&&a.setStoredMarks(a.storedMarks),d()),!0},CA=(n,e)=>t=>n.every((l,a)=>e(l,{...t,index:a})),EA=(n,e)=>({tr:t,commands:l})=>l.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),FN=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const l=e[t];l.nodeType===3&&l.nodeValue&&/^(\n\s\s|\n)$/.test(l.nodeValue)?n.removeChild(l):l.nodeType===1&&FN(l)}return n};function ud(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return FN(t)}function Go(n,e,t){if(n instanceof yl||n instanceof _e)return n;t={slice:!0,parseOptions:{},...t};const l=typeof n=="object"&&n!==null,a=typeof n=="string";if(l)try{if(Array.isArray(n)&&n.length>0)return _e.fromArray(n.map(u=>e.nodeFromJSON(u)));const d=e.nodeFromJSON(n);return t.errorOnInvalidContent&&d.check(),d}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",i),Go("",e,t)}if(a){if(t.errorOnInvalidContent){let d=!1,u="";const h=new M1({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:p=>(d=!0,u=typeof p=="string"?p:p.outerHTML,null)}]}})});if(t.slice?Ao.fromSchema(h).parseSlice(ud(n),t.parseOptions):Ao.fromSchema(h).parse(ud(n),t.parseOptions),t.errorOnInvalidContent&&d)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${u}`)})}const i=Ao.fromSchema(e);return t.slice?i.parseSlice(ud(n),t.parseOptions).content:i.parse(ud(n),t.parseOptions)}return Go("",e,t)}function MA(n,e,t){const l=n.steps.length-1;if(l<e)return;const a=n.steps[l];if(!(a instanceof Kn||a instanceof Yn))return;const i=n.mapping.maps[l];let d=0;i.forEach((u,h,p,g)=>{d===0&&(d=g)}),n.setSelection(Et.near(n.doc.resolve(d),t))}var AA=n=>!("type"in n),TA=(n,e,t)=>({tr:l,dispatch:a,editor:i})=>{var d;if(a){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let u;const h=j=>{i.emit("contentError",{editor:i,error:j,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},p={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Go(e,i.schema,{parseOptions:p,errorOnInvalidContent:!0})}catch(j){h(j)}try{u=Go(e,i.schema,{parseOptions:p,errorOnInvalidContent:(d=t.errorOnInvalidContent)!=null?d:i.options.enableContentCheck})}catch(j){return h(j),!1}let{from:g,to:b}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},y=!0,v=!0;if((AA(u)?u:[u]).forEach(j=>{j.check(),y=y?j.isText&&j.marks.length===0:!1,v=v?j.isBlock:!1}),g===b&&v){const{parent:j}=l.doc.resolve(g);j.isTextblock&&!j.type.spec.code&&!j.childCount&&(g-=1,b+=1)}let S;if(y){if(Array.isArray(e))S=e.map(j=>j.text||"").join("");else if(e instanceof _e){let j="";e.forEach(E=>{E.text&&(j+=E.text)}),S=j}else typeof e=="object"&&e&&e.text?S=e.text:S=e;l.insertText(S,g,b)}else{S=u;const j=l.doc.resolve(g),E=j.node(),D=j.parentOffset===0,_=E.isText||E.isTextblock,H=E.content.size>0;D&&_&&H&&(g=Math.max(0,g-1)),l.replaceWith(g,b,S)}t.updateSelection&&MA(l,l.steps.length-1,-1),t.applyInputRules&&l.setMeta("applyInputRules",{from:g,text:S}),t.applyPasteRules&&l.setMeta("applyPasteRules",{from:g,text:S})}return!0},DA=()=>({state:n,dispatch:e})=>nE(n,e),OA=()=>({state:n,dispatch:e})=>sE(n,e),RA=()=>({state:n,dispatch:e})=>Y1(n,e),IA=()=>({state:n,dispatch:e})=>Z1(n,e),zA=()=>({state:n,dispatch:e,tr:t})=>{try{const l=vu(n.doc,n.selection.$from.pos,-1);return l==null?!1:(t.join(l,2),e&&e(t),!0)}catch{return!1}},LA=()=>({state:n,dispatch:e,tr:t})=>{try{const l=vu(n.doc,n.selection.$from.pos,1);return l==null?!1:(t.join(l,2),e&&e(t),!0)}catch{return!1}},_A=()=>({state:n,dispatch:e})=>eE(n,e),BA=()=>({state:n,dispatch:e})=>tE(n,e);function KN(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function PA(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let l,a,i,d;for(let u=0;u<e.length-1;u+=1){const h=e[u];if(/^(cmd|meta|m)$/i.test(h))d=!0;else if(/^a(lt)?$/i.test(h))l=!0;else if(/^(c|ctrl|control)$/i.test(h))a=!0;else if(/^s(hift)?$/i.test(h))i=!0;else if(/^mod$/i.test(h))Bm()||KN()?d=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${h}`)}return l&&(t=`Alt-${t}`),a&&(t=`Ctrl-${t}`),d&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}var HA=n=>({editor:e,view:t,tr:l,dispatch:a})=>{const i=PA(n).split(/-(?!$)/),d=i.find(p=>!["Alt","Ctrl","Meta","Shift"].includes(p)),u=new KeyboardEvent("keydown",{key:d==="Space"?" ":d,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),h=e.captureTransaction(()=>{t.someProp("handleKeyDown",p=>p(t,u))});return h?.steps.forEach(p=>{const g=p.map(l.mapping);g&&a&&l.maybeStep(g)}),!0};function Gr(n,e,t={}){const{from:l,to:a,empty:i}=n.selection,d=e?Pn(e,n.schema):null,u=[];n.doc.nodesBetween(l,a,(b,y)=>{if(b.isText)return;const v=Math.max(l,y),N=Math.min(a,y+b.nodeSize);u.push({node:b,from:v,to:N})});const h=a-l,p=u.filter(b=>d?d.name===b.node.type.name:!0).filter(b=>$d(b.node.attrs,t,{strict:!1}));return i?!!p.length:p.reduce((b,y)=>b+y.to-y.from,0)>=h}var $A=(n,e={})=>({state:t,dispatch:l})=>{const a=Pn(n,t.schema);return Gr(t,a,e)?lE(t,l):!1},UA=()=>({state:n,dispatch:e})=>nN(n,e),VA=n=>({state:e,dispatch:t})=>{const l=Pn(n,e.schema);return gE(l)(e,t)},qA=()=>({state:n,dispatch:e})=>eN(n,e);function Mu(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function nv(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((l,a)=>(t.includes(a)||(l[a]=n[a]),l),{})}var FA=(n,e)=>({tr:t,state:l,dispatch:a})=>{let i=null,d=null;const u=Mu(typeof n=="string"?n:n.name,l.schema);if(!u)return!1;u==="node"&&(i=Pn(n,l.schema)),u==="mark"&&(d=lr(n,l.schema));let h=!1;return t.selection.ranges.forEach(p=>{l.doc.nodesBetween(p.$from.pos,p.$to.pos,(g,b)=>{i&&i===g.type&&(h=!0,a&&t.setNodeMarkup(b,void 0,nv(g.attrs,e))),d&&g.marks.length&&g.marks.forEach(y=>{d===y.type&&(h=!0,a&&t.addMark(b,b+g.nodeSize,d.create(nv(y.attrs,e))))})})}),h},KA=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),GA=()=>({tr:n,dispatch:e})=>{if(e){const t=new qs(n.doc);n.setSelection(t)}return!0},YA=()=>({state:n,dispatch:e})=>J1(n,e),XA=()=>({state:n,dispatch:e})=>W1(n,e),JA=()=>({state:n,dispatch:e})=>oE(n,e),QA=()=>({state:n,dispatch:e})=>uE(n,e),ZA=()=>({state:n,dispatch:e})=>dE(n,e);function Yp(n,e,t={},l={}){return Go(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:l.errorOnInvalidContent})}var WA=(n,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:l={}}={})=>({editor:a,tr:i,dispatch:d,commands:u})=>{const{doc:h}=i;if(l.preserveWhitespace!=="full"){const p=Yp(n,a.schema,l,{errorOnInvalidContent:e??a.options.enableContentCheck});return d&&i.replaceWith(0,h.content.size,p).setMeta("preventUpdate",!t),!0}return d&&i.setMeta("preventUpdate",!t),u.insertContentAt({from:0,to:h.content.size},n,{parseOptions:l,errorOnInvalidContent:e??a.options.enableContentCheck})};function GN(n,e){const t=lr(e,n.schema),{from:l,to:a,empty:i}=n.selection,d=[];i?(n.storedMarks&&d.push(...n.storedMarks),d.push(...n.selection.$head.marks())):n.doc.nodesBetween(l,a,h=>{d.push(...h.marks)});const u=d.find(h=>h.type.name===t.name);return u?{...u.attrs}:{}}function YN(n,e){const t=new q1(n);return e.forEach(l=>{l.steps.forEach(a=>{t.step(a)})}),t}function eT(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function tT(n,e,t){const l=[];return n.nodesBetween(e.from,e.to,(a,i)=>{t(a)&&l.push({node:a,pos:i})}),l}function nT(n,e){for(let t=n.depth;t>0;t-=1){const l=n.node(t);if(e(l))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:l}}}function Au(n){return e=>nT(e.$from,n)}function it(n,e,t){return n.config[e]===void 0&&n.parent?it(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?it(n.parent,e,t):null}):n.config[e]}function Pm(n){return n.map(e=>{const t={name:e.name,options:e.options,storage:e.storage},l=it(e,"addExtensions",t);return l?[e,...Pm(l())]:e}).flat(10)}function Hm(n,e){const t=Oa.fromSchema(e).serializeFragment(n),a=document.implementation.createHTMLDocument().createElement("div");return a.appendChild(t),a.innerHTML}function XN(n){return typeof n=="function"}function en(n,e=void 0,...t){return XN(n)?e?n.bind(e)(...t):n(...t):n}function sT(n={}){return Object.keys(n).length===0&&n.constructor===Object}function Ci(n){const e=n.filter(a=>a.type==="extension"),t=n.filter(a=>a.type==="node"),l=n.filter(a=>a.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:l}}function JN(n){const e=[],{nodeExtensions:t,markExtensions:l}=Ci(n),a=[...t,...l],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(d=>{const u={name:d.name,options:d.options,storage:d.storage,extensions:a},h=it(d,"addGlobalAttributes",u);if(!h)return;h().forEach(g=>{g.types.forEach(b=>{Object.entries(g.attributes).forEach(([y,v])=>{e.push({type:b,name:y,attribute:{...i,...v}})})})})}),a.forEach(d=>{const u={name:d.name,options:d.options,storage:d.storage},h=it(d,"addAttributes",u);if(!h)return;const p=h();Object.entries(p).forEach(([g,b])=>{const y={...i,...b};typeof y?.default=="function"&&(y.default=y.default()),y?.isRequired&&y?.default===void 0&&delete y.default,e.push({type:d.name,name:g,attribute:y})})}),e}function Hn(...n){return n.filter(e=>!!e).reduce((e,t)=>{const l={...e};return Object.entries(t).forEach(([a,i])=>{if(!l[a]){l[a]=i;return}if(a==="class"){const u=i?String(i).split(" "):[],h=l[a]?l[a].split(" "):[],p=u.filter(g=>!h.includes(g));l[a]=[...h,...p].join(" ")}else if(a==="style"){const u=i?i.split(";").map(g=>g.trim()).filter(Boolean):[],h=l[a]?l[a].split(";").map(g=>g.trim()).filter(Boolean):[],p=new Map;h.forEach(g=>{const[b,y]=g.split(":").map(v=>v.trim());p.set(b,y)}),u.forEach(g=>{const[b,y]=g.split(":").map(v=>v.trim());p.set(b,y)}),l[a]=Array.from(p.entries()).map(([g,b])=>`${g}: ${b}`).join("; ")}else l[a]=i}),l},{})}function Ud(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,l)=>Hn(t,l),{})}function lT(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function sv(n,e){return"style"in n?n:{...n,getAttrs:t=>{const l=n.getAttrs?n.getAttrs(t):n.attrs;if(l===!1)return!1;const a=e.reduce((i,d)=>{const u=d.attribute.parseHTML?d.attribute.parseHTML(t):lT(t.getAttribute(d.name));return u==null?i:{...i,[d.name]:u}},{});return{...l,...a}}}}function lv(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&sT(t)?!1:t!=null))}function rv(n){var e,t;const l={};return!((e=n?.attribute)!=null&&e.isRequired)&&"default"in(n?.attribute||{})&&(l.default=n.attribute.default),((t=n?.attribute)==null?void 0:t.validate)!==void 0&&(l.validate=n.attribute.validate),[n.name,l]}function rT(n,e){var t;const l=JN(n),{nodeExtensions:a,markExtensions:i}=Ci(n),d=(t=a.find(p=>it(p,"topNode")))==null?void 0:t.name,u=Object.fromEntries(a.map(p=>{const g=l.filter(E=>E.type===p.name),b={name:p.name,options:p.options,storage:p.storage,editor:e},y=n.reduce((E,D)=>{const _=it(D,"extendNodeSchema",b);return{...E,..._?_(p):{}}},{}),v=lv({...y,content:en(it(p,"content",b)),marks:en(it(p,"marks",b)),group:en(it(p,"group",b)),inline:en(it(p,"inline",b)),atom:en(it(p,"atom",b)),selectable:en(it(p,"selectable",b)),draggable:en(it(p,"draggable",b)),code:en(it(p,"code",b)),whitespace:en(it(p,"whitespace",b)),linebreakReplacement:en(it(p,"linebreakReplacement",b)),defining:en(it(p,"defining",b)),isolating:en(it(p,"isolating",b)),attrs:Object.fromEntries(g.map(rv))}),N=en(it(p,"parseHTML",b));N&&(v.parseDOM=N.map(E=>sv(E,g)));const S=it(p,"renderHTML",b);S&&(v.toDOM=E=>S({node:E,HTMLAttributes:Ud(E,g)}));const j=it(p,"renderText",b);return j&&(v.toText=j),[p.name,v]})),h=Object.fromEntries(i.map(p=>{const g=l.filter(j=>j.type===p.name),b={name:p.name,options:p.options,storage:p.storage,editor:e},y=n.reduce((j,E)=>{const D=it(E,"extendMarkSchema",b);return{...j,...D?D(p):{}}},{}),v=lv({...y,inclusive:en(it(p,"inclusive",b)),excludes:en(it(p,"excludes",b)),group:en(it(p,"group",b)),spanning:en(it(p,"spanning",b)),code:en(it(p,"code",b)),attrs:Object.fromEntries(g.map(rv))}),N=en(it(p,"parseHTML",b));N&&(v.parseDOM=N.map(j=>sv(j,g)));const S=it(p,"renderHTML",b);return S&&(v.toDOM=j=>S({mark:j,HTMLAttributes:Ud(j,g)})),[p.name,v]}));return new M1({topNode:d,nodes:u,marks:h})}function aT(n){const e=n.filter((t,l)=>n.indexOf(t)!==l);return Array.from(new Set(e))}function $m(n){return n.sort((t,l)=>{const a=it(t,"priority")||100,i=it(l,"priority")||100;return a>i?-1:a<i?1:0})}function QN(n){const e=$m(Pm(n)),t=aT(e.map(l=>l.name));return t.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${t.map(l=>`'${l}'`).join(", ")}]. This can lead to issues.`),e}function ZN(n,e,t){const{from:l,to:a}=e,{blockSeparator:i=`

`,textSerializers:d={}}=t||{};let u="";return n.nodesBetween(l,a,(h,p,g,b)=>{var y;h.isBlock&&p>l&&(u+=i);const v=d?.[h.type.name];if(v)return g&&(u+=v({node:h,pos:p,parent:g,index:b,range:e})),!1;h.isText&&(u+=(y=h?.text)==null?void 0:y.slice(Math.max(l,p)-p,a-p))}),u}function iT(n,e){const t={from:0,to:n.content.size};return ZN(n,t,e)}function WN(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function oT(n,e){const t=Pn(e,n.schema),{from:l,to:a}=n.selection,i=[];n.doc.nodesBetween(l,a,u=>{i.push(u)});const d=i.reverse().find(u=>u.type.name===t.name);return d?{...d.attrs}:{}}function e2(n,e){const t=Mu(typeof e=="string"?e:e.name,n.schema);return t==="node"?oT(n,e):t==="mark"?GN(n,e):{}}function cT(n,e=JSON.stringify){const t={};return n.filter(l=>{const a=e(l);return Object.prototype.hasOwnProperty.call(t,a)?!1:t[a]=!0})}function dT(n){const e=cT(n);return e.length===1?e:e.filter((t,l)=>!e.filter((i,d)=>d!==l).some(i=>t.oldRange.from>=i.oldRange.from&&t.oldRange.to<=i.oldRange.to&&t.newRange.from>=i.newRange.from&&t.newRange.to<=i.newRange.to))}function t2(n){const{mapping:e,steps:t}=n,l=[];return e.maps.forEach((a,i)=>{const d=[];if(a.ranges.length)a.forEach((u,h)=>{d.push({from:u,to:h})});else{const{from:u,to:h}=t[i];if(u===void 0||h===void 0)return;d.push({from:u,to:h})}d.forEach(({from:u,to:h})=>{const p=e.slice(i).map(u,-1),g=e.slice(i).map(h),b=e.invert().map(p,-1),y=e.invert().map(g);l.push({oldRange:{from:b,to:y},newRange:{from:p,to:g}})})}),dT(l)}function Um(n,e,t){const l=[];return n===e?t.resolve(n).marks().forEach(a=>{const i=t.resolve(n),d=_m(i,a.type);d&&l.push({mark:a,...d})}):t.nodesBetween(n,e,(a,i)=>{!a||a?.nodeSize===void 0||l.push(...a.marks.map(d=>({from:i,to:i+a.nodeSize,mark:d})))}),l}var uT=(n,e,t,l=20)=>{const a=n.doc.resolve(t);let i=l,d=null;for(;i>0&&d===null;){const u=a.node(i);u?.type.name===e?d=u:i-=1}return[d,i]};function rp(n,e){return e.nodes[n]||e.marks[n]||null}function wd(n,e,t){return Object.fromEntries(Object.entries(t).filter(([l])=>{const a=n.find(i=>i.type===e&&i.name===l);return a?a.attribute.keepOnSplit:!1}))}var fT=(n,e=500)=>{let t="";const l=n.parentOffset;return n.parent.nodesBetween(Math.max(0,l-e),l,(a,i,d,u)=>{var h,p;const g=((p=(h=a.type.spec).toText)==null?void 0:p.call(h,{node:a,pos:i,parent:d,index:u}))||a.textContent||"%leaf%";t+=a.isAtom&&!a.isText?g:g.slice(0,Math.max(0,l-i))}),t};function Xp(n,e,t={}){const{empty:l,ranges:a}=n.selection,i=e?lr(e,n.schema):null;if(l)return!!(n.storedMarks||n.selection.$from.marks()).filter(b=>i?i.name===b.type.name:!0).find(b=>$d(b.attrs,t,{strict:!1}));let d=0;const u=[];if(a.forEach(({$from:b,$to:y})=>{const v=b.pos,N=y.pos;n.doc.nodesBetween(v,N,(S,j)=>{if(!S.isText&&!S.marks.length)return;const E=Math.max(v,j),D=Math.min(N,j+S.nodeSize),_=D-E;d+=_,u.push(...S.marks.map(H=>({mark:H,from:E,to:D})))})}),d===0)return!1;const h=u.filter(b=>i?i.name===b.mark.type.name:!0).filter(b=>$d(b.mark.attrs,t,{strict:!1})).reduce((b,y)=>b+y.to-y.from,0),p=u.filter(b=>i?b.mark.type!==i&&b.mark.type.excludes(i):!0).reduce((b,y)=>b+y.to-y.from,0);return(h>0?h+p:h)>=d}function hT(n,e,t={}){if(!e)return Gr(n,null,t)||Xp(n,null,t);const l=Mu(e,n.schema);return l==="node"?Gr(n,e,t):l==="mark"?Xp(n,e,t):!1}var pT=(n,e)=>{const{$from:t,$to:l,$anchor:a}=n.selection;if(e){const i=Au(u=>u.type.name===e)(n.selection);if(!i)return!1;const d=n.doc.resolve(i.pos+1);return a.pos+1===d.end()}return!(l.parentOffset<l.parent.nodeSize-2||t.pos!==l.pos)},mT=n=>{const{$from:e,$to:t}=n.selection;return!(e.parentOffset>0||e.pos!==t.pos)};function av(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function iv(n,e){const{nodeExtensions:t}=Ci(e),l=t.find(d=>d.name===n);if(!l)return!1;const a={name:l.name,options:l.options,storage:l.storage},i=en(it(l,"group",a));return typeof i!="string"?!1:i.split(" ").includes("list")}function Tu(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var l;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((l=n.text)!=null?l:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let a=!0;return n.content.forEach(i=>{a!==!1&&(Tu(i,{ignoreWhitespace:t,checkChildren:e})||(a=!1))}),a}return!1}function n2(n){return n instanceof ct}var s2=class l2{constructor(e){this.position=e}static fromJSON(e){return new l2(e.position)}toJSON(){return{position:this.position}}};function gT(n,e){const t=e.mapping.mapResult(n.position);return{position:new s2(t.pos),mapResult:t}}function xT(n){return new s2(n)}function bT(n,e,t){var l;const{selection:a}=e;let i=null;if(VN(a)&&(i=a.$cursor),i){const u=(l=n.storedMarks)!=null?l:i.marks();return i.parent.type.allowsMarkType(t)&&(!!t.isInSet(u)||!u.some(p=>p.type.excludes(t)))}const{ranges:d}=a;return d.some(({$from:u,$to:h})=>{let p=u.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(u.pos,h.pos,(g,b,y)=>{if(p)return!1;if(g.isInline){const v=!y||y.type.allowsMarkType(t),N=!!t.isInSet(g.marks)||!g.marks.some(S=>S.type.excludes(t));p=v&&N}return!p}),p})}var yT=(n,e={})=>({tr:t,state:l,dispatch:a})=>{const{selection:i}=t,{empty:d,ranges:u}=i,h=lr(n,l.schema);if(a)if(d){const p=GN(l,h);t.addStoredMark(h.create({...p,...e}))}else u.forEach(p=>{const g=p.$from.pos,b=p.$to.pos;l.doc.nodesBetween(g,b,(y,v)=>{const N=Math.max(v,g),S=Math.min(v+y.nodeSize,b);y.marks.find(E=>E.type===h)?y.marks.forEach(E=>{h===E.type&&t.addMark(N,S,h.create({...E.attrs,...e}))}):t.addMark(N,S,h.create(e))})});return bT(l,t,h)},vT=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),NT=(n,e={})=>({state:t,dispatch:l,chain:a})=>{const i=Pn(n,t.schema);let d;return t.selection.$anchor.sameParent(t.selection.$head)&&(d=t.selection.$anchor.parent.attrs),i.isTextblock?a().command(({commands:u})=>Ny(i,{...d,...e})(t)?!0:u.clearNodes()).command(({state:u})=>Ny(i,{...d,...e})(u,l)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},kT=n=>({tr:e,dispatch:t})=>{if(t){const{doc:l}=e,a=va(n,0,l.content.size),i=ct.create(l,a);e.setSelection(i)}return!0},wT=(n,e)=>({tr:t,state:l,dispatch:a})=>{const{selection:i}=l;let d,u;return typeof e=="number"?(d=e,u=e):e&&"from"in e&&"to"in e?(d=e.from,u=e.to):(d=i.from,u=i.to),a&&t.doc.nodesBetween(d,u,(h,p)=>{h.isText||t.setNodeMarkup(p,void 0,{...h.attrs,dir:n})}),!0},ST=n=>({tr:e,dispatch:t})=>{if(t){const{doc:l}=e,{from:a,to:i}=typeof n=="number"?{from:n,to:n}:n,d=gt.atStart(l).from,u=gt.atEnd(l).to,h=va(a,d,u),p=va(i,d,u),g=gt.create(l,h,p);e.setSelection(g)}return!0},jT=n=>({state:e,dispatch:t})=>{const l=Pn(n,e.schema);return yE(l)(e,t)};function ov(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const l=t.filter(a=>e?.includes(a.type.name));n.tr.ensureMarks(l)}}var CT=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:l,editor:a})=>{const{selection:i,doc:d}=e,{$from:u,$to:h}=i,p=a.extensionManager.attributes,g=wd(p,u.node().type.name,u.node().attrs);if(i instanceof ct&&i.node.isBlock)return!u.parentOffset||!nr(d,u.pos)?!1:(l&&(n&&ov(t,a.extensionManager.splittableMarks),e.split(u.pos).scrollIntoView()),!0);if(!u.parent.isBlock)return!1;const b=h.parentOffset===h.parent.content.size,y=u.depth===0?void 0:eT(u.node(-1).contentMatchAt(u.indexAfter(-1)));let v=b&&y?[{type:y,attrs:g}]:void 0,N=nr(e.doc,e.mapping.map(u.pos),1,v);if(!v&&!N&&nr(e.doc,e.mapping.map(u.pos),1,y?[{type:y}]:void 0)&&(N=!0,v=y?[{type:y,attrs:g}]:void 0),l){if(N&&(i instanceof gt&&e.deleteSelection(),e.split(e.mapping.map(u.pos),1,v),y&&!b&&!u.parentOffset&&u.parent.type!==y)){const S=e.mapping.map(u.before()),j=e.doc.resolve(S);u.node(-1).canReplaceWith(j.index(),j.index()+1,y)&&e.setNodeMarkup(e.mapping.map(u.before()),y)}n&&ov(t,a.extensionManager.splittableMarks),e.scrollIntoView()}return N},ET=(n,e={})=>({tr:t,state:l,dispatch:a,editor:i})=>{var d;const u=Pn(n,l.schema),{$from:h,$to:p}=l.selection,g=l.selection.node;if(g&&g.isBlock||h.depth<2||!h.sameParent(p))return!1;const b=h.node(-1);if(b.type!==u)return!1;const y=i.extensionManager.attributes;if(h.parent.content.size===0&&h.node(-1).childCount===h.indexAfter(-1)){if(h.depth===2||h.node(-3).type!==u||h.index(-2)!==h.node(-2).childCount-1)return!1;if(a){let E=_e.empty;const D=h.index(-1)?1:h.index(-2)?2:3;for(let X=h.depth-D;X>=h.depth-3;X-=1)E=_e.from(h.node(X).copy(E));const _=h.indexAfter(-1)<h.node(-2).childCount?1:h.indexAfter(-2)<h.node(-3).childCount?2:3,H={...wd(y,h.node().type.name,h.node().attrs),...e},L=((d=u.contentMatch.defaultType)==null?void 0:d.createAndFill(H))||void 0;E=E.append(_e.from(u.createAndFill(null,L)||void 0));const V=h.before(h.depth-(D-1));t.replace(V,h.after(-_),new Ze(E,4-D,0));let G=-1;t.doc.nodesBetween(V,t.doc.content.size,(X,$)=>{if(G>-1)return!1;X.isTextblock&&X.content.size===0&&(G=$+1)}),G>-1&&t.setSelection(gt.near(t.doc.resolve(G))),t.scrollIntoView()}return!0}const v=p.pos===h.end()?b.contentMatchAt(0).defaultType:null,N={...wd(y,b.type.name,b.attrs),...e},S={...wd(y,h.node().type.name,h.node().attrs),...e};t.delete(h.pos,p.pos);const j=v?[{type:u,attrs:N},{type:v,attrs:S}]:[{type:u,attrs:N}];if(!nr(t.doc,h.pos,2))return!1;if(a){const{selection:E,storedMarks:D}=l,{splittableMarks:_}=i.extensionManager,H=D||E.$to.parentOffset&&E.$from.marks();if(t.split(h.pos,2,j).scrollIntoView(),!H||!a)return!0;const L=H.filter(V=>_.includes(V.type.name));t.ensureMarks(L)}return!0},ap=(n,e)=>{const t=Au(d=>d.type===e)(n.selection);if(!t)return!0;const l=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(l===void 0)return!0;const a=n.doc.nodeAt(l);return t.node.type===a?.type&&Xr(n.doc,t.pos)&&n.join(t.pos),!0},ip=(n,e)=>{const t=Au(d=>d.type===e)(n.selection);if(!t)return!0;const l=n.doc.resolve(t.start).after(t.depth);if(l===void 0)return!0;const a=n.doc.nodeAt(l);return t.node.type===a?.type&&Xr(n.doc,l)&&n.join(l),!0},MT=(n,e,t,l={})=>({editor:a,tr:i,state:d,dispatch:u,chain:h,commands:p,can:g})=>{const{extensions:b,splittableMarks:y}=a.extensionManager,v=Pn(n,d.schema),N=Pn(e,d.schema),{selection:S,storedMarks:j}=d,{$from:E,$to:D}=S,_=E.blockRange(D),H=j||S.$to.parentOffset&&S.$from.marks();if(!_)return!1;const L=Au(V=>iv(V.type.name,b))(S);if(_.depth>=1&&L&&_.depth-L.depth<=1){if(L.node.type===v)return p.liftListItem(N);if(iv(L.node.type.name,b)&&v.validContent(L.node.content)&&u)return h().command(()=>(i.setNodeMarkup(L.pos,v),!0)).command(()=>ap(i,v)).command(()=>ip(i,v)).run()}return!t||!H||!u?h().command(()=>g().wrapInList(v,l)?!0:p.clearNodes()).wrapInList(v,l).command(()=>ap(i,v)).command(()=>ip(i,v)).run():h().command(()=>{const V=g().wrapInList(v,l),G=H.filter(X=>y.includes(X.type.name));return i.ensureMarks(G),V?!0:p.clearNodes()}).wrapInList(v,l).command(()=>ap(i,v)).command(()=>ip(i,v)).run()},AT=(n,e={},t={})=>({state:l,commands:a})=>{const{extendEmptyMarkRange:i=!1}=t,d=lr(n,l.schema);return Xp(l,d,e)?a.unsetMark(d,{extendEmptyMarkRange:i}):a.setMark(d,e)},TT=(n,e,t={})=>({state:l,commands:a})=>{const i=Pn(n,l.schema),d=Pn(e,l.schema),u=Gr(l,i,t);let h;return l.selection.$anchor.sameParent(l.selection.$head)&&(h=l.selection.$anchor.parent.attrs),u?a.setNode(d,h):a.setNode(i,{...h,...t})},DT=(n,e={})=>({state:t,commands:l})=>{const a=Pn(n,t.schema);return Gr(t,a,e)?l.lift(a):l.wrapIn(a,e)},OT=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let l=0;l<t.length;l+=1){const a=t[l];let i;if(a.spec.isInputRules&&(i=a.getState(n))){if(e){const d=n.tr,u=i.transform;for(let h=u.steps.length-1;h>=0;h-=1)d.step(u.steps[h].invert(u.docs[h]));if(i.text){const h=d.doc.resolve(i.from).marks();d.replaceWith(i.from,i.to,n.schema.text(i.text,h))}else d.delete(i.from,i.to)}return!0}}return!1},RT=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:l,ranges:a}=t;return l||e&&a.forEach(i=>{n.removeMark(i.$from.pos,i.$to.pos)}),!0},IT=(n,e={})=>({tr:t,state:l,dispatch:a})=>{var i;const{extendEmptyMarkRange:d=!1}=e,{selection:u}=t,h=lr(n,l.schema),{$from:p,empty:g,ranges:b}=u;if(!a)return!0;if(g&&d){let{from:y,to:v}=u;const N=(i=p.marks().find(j=>j.type===h))==null?void 0:i.attrs,S=_m(p,h,N);S&&(y=S.from,v=S.to),t.removeMark(y,v,h)}else b.forEach(y=>{t.removeMark(y.$from.pos,y.$to.pos,h)});return t.removeStoredMark(h),!0},zT=n=>({tr:e,state:t,dispatch:l})=>{const{selection:a}=t;let i,d;return typeof n=="number"?(i=n,d=n):n&&"from"in n&&"to"in n?(i=n.from,d=n.to):(i=a.from,d=a.to),l&&e.doc.nodesBetween(i,d,(u,h)=>{if(u.isText)return;const p={...u.attrs};delete p.dir,e.setNodeMarkup(h,void 0,p)}),!0},LT=(n,e={})=>({tr:t,state:l,dispatch:a})=>{let i=null,d=null;const u=Mu(typeof n=="string"?n:n.name,l.schema);if(!u)return!1;u==="node"&&(i=Pn(n,l.schema)),u==="mark"&&(d=lr(n,l.schema));let h=!1;return t.selection.ranges.forEach(p=>{const g=p.$from.pos,b=p.$to.pos;let y,v,N,S;t.selection.empty?l.doc.nodesBetween(g,b,(j,E)=>{i&&i===j.type&&(h=!0,N=Math.max(E,g),S=Math.min(E+j.nodeSize,b),y=E,v=j)}):l.doc.nodesBetween(g,b,(j,E)=>{E<g&&i&&i===j.type&&(h=!0,N=Math.max(E,g),S=Math.min(E+j.nodeSize,b),y=E,v=j),E>=g&&E<=b&&(i&&i===j.type&&(h=!0,a&&t.setNodeMarkup(E,void 0,{...j.attrs,...e})),d&&j.marks.length&&j.marks.forEach(D=>{if(d===D.type&&(h=!0,a)){const _=Math.max(E,g),H=Math.min(E+j.nodeSize,b);t.addMark(_,H,d.create({...D.attrs,...e}))}}))}),v&&(y!==void 0&&a&&t.setNodeMarkup(y,void 0,{...v.attrs,...e}),d&&v.marks.length&&v.marks.forEach(j=>{d===j.type&&a&&t.addMark(N,S,d.create({...j.attrs,...e}))}))}),h},_T=(n,e={})=>({state:t,dispatch:l})=>{const a=Pn(n,t.schema);return fE(a,e)(t,l)},BT=(n,e={})=>({state:t,dispatch:l})=>{const a=Pn(n,t.schema);return hE(a,e)(t,l)},PT=class{constructor(){this.callbacks={}}on(n,e){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(e),this}emit(n,...e){const t=this.callbacks[n];return t&&t.forEach(l=>l.apply(this,e)),this}off(n,e){const t=this.callbacks[n];return t&&(e?this.callbacks[n]=t.filter(l=>l!==e):delete this.callbacks[n]),this}once(n,e){const t=(...l)=>{this.off(n,t),e.apply(this,l)};return this.on(n,t)}removeAllListeners(){this.callbacks={}}},Du=class{constructor(n){var e;this.find=n.find,this.handler=n.handler,this.undoable=(e=n.undoable)!=null?e:!0}},HT=(n,e)=>{if(Lm(e))return e.exec(n);const t=e(n);if(!t)return null;const l=[t.text];return l.index=t.index,l.input=n,l.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),l.push(t.replaceWith)),l};function fd(n){var e;const{editor:t,from:l,to:a,text:i,rules:d,plugin:u}=n,{view:h}=t;if(h.composing)return!1;const p=h.state.doc.resolve(l);if(p.parent.type.spec.code||(e=p.nodeBefore||p.nodeAfter)!=null&&e.marks.find(y=>y.type.spec.code))return!1;let g=!1;const b=fT(p)+i;return d.forEach(y=>{if(g)return;const v=HT(b,y.find);if(!v)return;const N=h.state.tr,S=Cu({state:h.state,transaction:N}),j={from:l-(v[0].length-i.length),to:a},{commands:E,chain:D,can:_}=new Eu({editor:t,state:S});y.handler({state:S,range:j,match:v,commands:E,chain:D,can:_})===null||!N.steps.length||(y.undoable&&N.setMeta(u,{transform:N,from:l,to:a,text:i}),h.dispatch(N),g=!0)}),g}function $T(n){const{editor:e,rules:t}=n,l=new gn({state:{init(){return null},apply(a,i,d){const u=a.getMeta(l);if(u)return u;const h=a.getMeta("applyInputRules");return!!h&&setTimeout(()=>{let{text:g}=h;typeof g=="string"?g=g:g=Hm(_e.from(g),d.schema);const{from:b}=h,y=b+g.length;fd({editor:e,from:b,to:y,text:g,rules:t,plugin:l})}),a.selectionSet||a.docChanged?null:i}},props:{handleTextInput(a,i,d,u){return fd({editor:e,from:i,to:d,text:u,rules:t,plugin:l})},handleDOMEvents:{compositionend:a=>(setTimeout(()=>{const{$cursor:i}=a.state.selection;i&&fd({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:l})}),!1)},handleKeyDown(a,i){if(i.key!=="Enter")return!1;const{$cursor:d}=a.state.selection;return d?fd({editor:e,from:d.pos,to:d.pos,text:`
`,rules:t,plugin:l}):!1}},isInputRules:!0});return l}function UT(n){return Object.prototype.toString.call(n).slice(8,-1)}function hd(n){return UT(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function r2(n,e){const t={...n};return hd(n)&&hd(e)&&Object.keys(e).forEach(l=>{hd(e[l])&&hd(n[l])?t[l]=r2(n[l],e[l]):t[l]=e[l]}),t}var Vm=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...en(it(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...en(it(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){const e=this.extend({...this.config,addOptions:()=>r2(this.options,n)});return e.name=this.name,e.parent=this.parent,e}extend(n={}){const e=new this.constructor({...this.config,...n});return e.parent=this,this.child=e,e.name="name"in n?n.name:e.parent.name,e}},Ra=class a2 extends Vm{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new a2(t)}static handleExit({editor:e,mark:t}){const{tr:l}=e.state,a=e.state.selection.$from;if(a.pos===a.end()){const d=a.marks();if(!!!d.find(p=>p?.type.name===t.name))return!1;const h=d.find(p=>p?.type.name===t.name);return h&&l.removeStoredMark(h),l.insertText(" ",a.pos),e.view.dispatch(l),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function VT(n){return typeof n=="number"}var qT=class{constructor(n){this.find=n.find,this.handler=n.handler}},FT=(n,e,t)=>{if(Lm(e))return[...n.matchAll(e)];const l=e(n,t);return l?l.map(a=>{const i=[a.text];return i.index=a.index,i.input=n,i.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(a.replaceWith)),i}):[]};function KT(n){const{editor:e,state:t,from:l,to:a,rule:i,pasteEvent:d,dropEvent:u}=n,{commands:h,chain:p,can:g}=new Eu({editor:e,state:t}),b=[];return t.doc.nodesBetween(l,a,(v,N)=>{var S,j,E,D,_;if((j=(S=v.type)==null?void 0:S.spec)!=null&&j.code||!(v.isText||v.isTextblock||v.isInline))return;const H=(_=(D=(E=v.content)==null?void 0:E.size)!=null?D:v.nodeSize)!=null?_:0,L=Math.max(l,N),V=Math.min(a,N+H);if(L>=V)return;const G=v.isText?v.text||"":v.textBetween(L-N,V-N,void 0,"");FT(G,i.find,d).forEach($=>{if($.index===void 0)return;const R=L+$.index+1,A=R+$[0].length,B={from:t.tr.mapping.map(R),to:t.tr.mapping.map(A)},Y=i.handler({state:t,range:B,match:$,commands:h,chain:p,can:g,pasteEvent:d,dropEvent:u});b.push(Y)})}),b.every(v=>v!==null)}var pd=null,GT=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)==null||e.setData("text/html",n),t};function YT(n){const{editor:e,rules:t}=n;let l=null,a=!1,i=!1,d=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,u;try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}const h=({state:g,from:b,to:y,rule:v,pasteEvt:N})=>{const S=g.tr,j=Cu({state:g,transaction:S});if(!(!KT({editor:e,state:j,from:Math.max(b-1,0),to:y.b-1,rule:v,pasteEvent:N,dropEvent:u})||!S.steps.length)){try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}return d=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return t.map(g=>new gn({view(b){const y=N=>{var S;l=(S=b.dom.parentElement)!=null&&S.contains(N.target)?b.dom.parentElement:null,l&&(pd=e)},v=()=>{pd&&(pd=null)};return window.addEventListener("dragstart",y),window.addEventListener("dragend",v),{destroy(){window.removeEventListener("dragstart",y),window.removeEventListener("dragend",v)}}},props:{handleDOMEvents:{drop:(b,y)=>{if(i=l===b.dom.parentElement,u=y,!i){const v=pd;v?.isEditable&&setTimeout(()=>{const N=v.state.selection;N&&v.commands.deleteRange({from:N.from,to:N.to})},10)}return!1},paste:(b,y)=>{var v;const N=(v=y.clipboardData)==null?void 0:v.getData("text/html");return d=y,a=!!N?.includes("data-pm-slice"),!1}}},appendTransaction:(b,y,v)=>{const N=b[0],S=N.getMeta("uiEvent")==="paste"&&!a,j=N.getMeta("uiEvent")==="drop"&&!i,E=N.getMeta("applyPasteRules"),D=!!E;if(!S&&!j&&!D)return;if(D){let{text:L}=E;typeof L=="string"?L=L:L=Hm(_e.from(L),v.schema);const{from:V}=E,G=V+L.length,X=GT(L);return h({rule:g,state:v,from:V,to:{b:G},pasteEvt:X})}const _=y.doc.content.findDiffStart(v.doc.content),H=y.doc.content.findDiffEnd(v.doc.content);if(!(!VT(_)||!H||_===H.b))return h({rule:g,state:v,from:_,to:H,pasteEvt:d})}}))}var Ou=class{constructor(n,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=n,this.extensions=QN(n),this.schema=rT(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((n,e)=>{const t={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:rp(e.name,this.schema)},l=it(e,"addCommands",t);return l?{...n,...l()}:n},{})}get plugins(){const{editor:n}=this;return $m([...this.extensions].reverse()).flatMap(l=>{const a={name:l.name,options:l.options,storage:this.editor.extensionStorage[l.name],editor:n,type:rp(l.name,this.schema)},i=[],d=it(l,"addKeyboardShortcuts",a);let u={};if(l.type==="mark"&&it(l,"exitable",a)&&(u.ArrowRight=()=>Ra.handleExit({editor:n,mark:l})),d){const y=Object.fromEntries(Object.entries(d()).map(([v,N])=>[v,()=>N({editor:n})]));u={...u,...y}}const h=oA(u);i.push(h);const p=it(l,"addInputRules",a);if(av(l,n.options.enableInputRules)&&p){const y=p();if(y&&y.length){const v=$T({editor:n,rules:y}),N=Array.isArray(v)?v:[v];i.push(...N)}}const g=it(l,"addPasteRules",a);if(av(l,n.options.enablePasteRules)&&g){const y=g();if(y&&y.length){const v=YT({editor:n,rules:y});i.push(...v)}}const b=it(l,"addProseMirrorPlugins",a);if(b){const y=b();i.push(...y)}return i})}get attributes(){return JN(this.extensions)}get nodeViews(){const{editor:n}=this,{nodeExtensions:e}=Ci(this.extensions);return Object.fromEntries(e.filter(t=>!!it(t,"addNodeView")).map(t=>{const l=this.attributes.filter(h=>h.type===t.name),a={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:n,type:Pn(t.name,this.schema)},i=it(t,"addNodeView",a);if(!i)return[];const d=i();if(!d)return[];const u=(h,p,g,b,y)=>{const v=Ud(h,l);return d({node:h,view:p,getPos:g,decorations:b,innerDecorations:y,editor:n,extension:t,HTMLAttributes:v})};return[t.name,u]}))}get markViews(){const{editor:n}=this,{markExtensions:e}=Ci(this.extensions);return Object.fromEntries(e.filter(t=>!!it(t,"addMarkView")).map(t=>{const l=this.attributes.filter(u=>u.type===t.name),a={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:n,type:lr(t.name,this.schema)},i=it(t,"addMarkView",a);if(!i)return[];const d=(u,h,p)=>{const g=Ud(u,l);return i()({mark:u,view:h,inline:p,editor:n,extension:t,HTMLAttributes:g,updateAttributes:b=>{o3(u,n,b)}})};return[t.name,d]}))}setupExtensions(){const n=this.extensions;this.editor.extensionStorage=Object.fromEntries(n.map(e=>[e.name,e.storage])),n.forEach(e=>{var t;const l={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:rp(e.name,this.schema)};e.type==="mark"&&((t=en(it(e,"keepOnSplit",l)))==null||t)&&this.splittableMarks.push(e.name);const a=it(e,"onBeforeCreate",l),i=it(e,"onCreate",l),d=it(e,"onUpdate",l),u=it(e,"onSelectionUpdate",l),h=it(e,"onTransaction",l),p=it(e,"onFocus",l),g=it(e,"onBlur",l),b=it(e,"onDestroy",l);a&&this.editor.on("beforeCreate",a),i&&this.editor.on("create",i),d&&this.editor.on("update",d),u&&this.editor.on("selectionUpdate",u),h&&this.editor.on("transaction",h),p&&this.editor.on("focus",p),g&&this.editor.on("blur",g),b&&this.editor.on("destroy",b)})}};Ou.resolve=QN;Ou.sort=$m;Ou.flatten=Pm;var XT={};zm(XT,{ClipboardTextSerializer:()=>o2,Commands:()=>c2,Delete:()=>d2,Drop:()=>u2,Editable:()=>f2,FocusEvents:()=>p2,Keymap:()=>m2,Paste:()=>g2,Tabindex:()=>x2,TextDirection:()=>b2,focusEventsPluginKey:()=>h2});var Dn=class i2 extends Vm{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new i2(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},o2=Dn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new gn({key:new Vn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:l,selection:a}=e,{ranges:i}=a,d=Math.min(...i.map(g=>g.$from.pos)),u=Math.max(...i.map(g=>g.$to.pos)),h=WN(t);return ZN(l,{from:d,to:u},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:h})}}})]}}),c2=Dn.create({name:"commands",addCommands(){return{...$N}}}),d2=Dn.create({name:"delete",onUpdate({transaction:n,appendedTransactions:e}){var t,l,a;const i=()=>{var d,u,h,p;if((p=(h=(u=(d=this.editor.options.coreExtensionOptions)==null?void 0:d.delete)==null?void 0:u.filterTransaction)==null?void 0:h.call(u,n))!=null?p:n.getMeta("y-sync$"))return;const g=YN(n.before,[n,...e]);t2(g).forEach(v=>{g.mapping.mapResult(v.oldRange.from).deletedAfter&&g.mapping.mapResult(v.oldRange.to).deletedBefore&&g.before.nodesBetween(v.oldRange.from,v.oldRange.to,(N,S)=>{const j=S+N.nodeSize-2,E=v.oldRange.from<=S&&j<=v.oldRange.to;this.editor.emit("delete",{type:"node",node:N,from:S,to:j,newFrom:g.mapping.map(S),newTo:g.mapping.map(j),deletedRange:v.oldRange,newRange:v.newRange,partial:!E,editor:this.editor,transaction:n,combinedTransform:g})})});const y=g.mapping;g.steps.forEach((v,N)=>{var S,j;if(v instanceof bl){const E=y.slice(N).map(v.from,-1),D=y.slice(N).map(v.to),_=y.invert().map(E,-1),H=y.invert().map(D),L=(S=g.doc.nodeAt(E-1))==null?void 0:S.marks.some(G=>G.eq(v.mark)),V=(j=g.doc.nodeAt(D))==null?void 0:j.marks.some(G=>G.eq(v.mark));this.editor.emit("delete",{type:"mark",mark:v.mark,from:v.from,to:v.to,deletedRange:{from:_,to:H},newRange:{from:E,to:D},partial:!!(V||L),editor:this.editor,transaction:n,combinedTransform:g})}})};(a=(l=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:l.async)==null||a?setTimeout(i,0):i()}}),u2=Dn.create({name:"drop",addProseMirrorPlugins(){return[new gn({key:new Vn("tiptapDrop"),props:{handleDrop:(n,e,t,l)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:l})}}})]}}),f2=Dn.create({name:"editable",addProseMirrorPlugins(){return[new gn({key:new Vn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),h2=new Vn("focusEvents"),p2=Dn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new gn({key:h2,props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const l=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(l),!1},blur:(e,t)=>{n.isFocused=!1;const l=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(l),!1}}}})]}}),m2=Dn.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:d})=>[()=>d.undoInputRule(),()=>d.command(({tr:u})=>{const{selection:h,doc:p}=u,{empty:g,$anchor:b}=h,{pos:y,parent:v}=b,N=b.parent.isTextblock&&y>0?u.doc.resolve(y-1):b,S=N.parent.type.spec.isolating,j=b.pos-b.parentOffset,E=S&&N.parent.childCount===1?j===b.pos:Et.atStart(p).from===y;return!g||!v.type.isTextblock||v.textContent.length||!E||E&&b.parent.type.name==="paragraph"?!1:d.clearNodes()}),()=>d.deleteSelection(),()=>d.joinBackward(),()=>d.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:d})=>[()=>d.deleteSelection(),()=>d.deleteCurrentNode(),()=>d.joinForward(),()=>d.selectNodeForward()]),l={Enter:()=>this.editor.commands.first(({commands:d})=>[()=>d.newlineInCode(),()=>d.createParagraphNear(),()=>d.liftEmptyBlock(),()=>d.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},a={...l},i={...l,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Bm()||KN()?i:a},addProseMirrorPlugins(){return[new gn({key:new Vn("clearDocument"),appendTransaction:(n,e,t)=>{if(n.some(S=>S.getMeta("composition")))return;const l=n.some(S=>S.docChanged)&&!e.doc.eq(t.doc),a=n.some(S=>S.getMeta("preventClearDocument"));if(!l||a)return;const{empty:i,from:d,to:u}=e.selection,h=Et.atStart(e.doc).from,p=Et.atEnd(e.doc).to;if(i||!(d===h&&u===p)||!Tu(t.doc))return;const y=t.tr,v=Cu({state:t,transaction:y}),{commands:N}=new Eu({editor:this.editor,state:v});if(N.clearNodes(),!!y.steps.length)return y}})]}}),g2=Dn.create({name:"paste",addProseMirrorPlugins(){return[new gn({key:new Vn("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),x2=Dn.create({name:"tabindex",addProseMirrorPlugins(){return[new gn({key:new Vn("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),b2=Dn.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:n}=Ci(this.extensions);return[{types:n.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new gn({key:new Vn("textDirection"),props:{attributes:()=>{const n=this.options.direction;return n?{dir:n}:{}}}})]}}),JT=class gi{constructor(e,t,l=!1,a=null){this.currentNode=null,this.actualDepth=null,this.isBlock=l,this.resolvedPos=e,this.editor=t,this.currentNode=a}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,l=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,l=this.to-1}this.editor.commands.insertContentAt({from:t,to:l},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new gi(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new gi(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new gi(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,l)=>{const a=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,d=this.pos+l+(i?0:1);if(d<0||d>this.resolvedPos.doc.nodeSize-2)return;const u=this.resolvedPos.doc.resolve(d);if(!a&&u.depth<=this.depth)return;const h=new gi(u,this.editor,a,a?t:null);a&&(h.actualDepth=this.depth+1),e.push(new gi(u,this.editor,a,a?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let l=null,a=this.parent;for(;a&&!l;){if(a.node.type.name===e)if(Object.keys(t).length>0){const i=a.node.attrs,d=Object.keys(t);for(let u=0;u<d.length;u+=1){const h=d[u];if(i[h]!==t[h])break}}else l=a;a=a.parent}return l}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},l=!1){let a=[];if(!this.children||this.children.length===0)return a;const i=Object.keys(t);return this.children.forEach(d=>{l&&a.length>0||(d.node.type.name===e&&i.every(h=>t[h]===d.node.attrs[h])&&a.push(d),!(l&&a.length>0)&&(a=a.concat(d.querySelectorAll(e,t,l))))}),a}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}},QT=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function ZT(n,e,t){const l=document.querySelector("style[data-tiptap-style]");if(l!==null)return l;const a=document.createElement("style");return e&&a.setAttribute("nonce",e),a.setAttribute("data-tiptap-style",""),a.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(a),a}var WT=class extends PT{constructor(n={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:l})=>{throw l},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:gT,createMappablePosition:xT},this.setOptions(n),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:l,slice:a,moved:i})=>this.options.onDrop(l,a,i)),this.on("paste",({event:l,slice:a})=>this.options.onPaste(l,a)),this.on("delete",this.options.onDelete);const e=this.createDoc(),t=qN(e,this.options.autofocus);this.editorState=bi.create({doc:e,schema:this.schema,selection:t||void 0}),this.options.element&&this.mount(this.options.element)}mount(n){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(n),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const n=this.editorView.dom;n?.editor&&delete n.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(n){console.warn("Failed to remove CSS element:",n)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=ZT(QT,this.options.injectNonce))}setOptions(n={}){this.options={...this.options,...n},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(n,e=!0){this.setOptions({editable:n}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:n=>{this.editorState=n},dispatch:n=>{this.dispatchTransaction(n)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(n,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in n)return Reflect.get(n,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(n,e){const t=XN(e)?e(n,[...this.state.plugins]):[...this.state.plugins,n],l=this.state.reconfigure({plugins:t});return this.view.updateState(l),l}unregisterPlugin(n){if(this.isDestroyed)return;const e=this.state.plugins;let t=e;if([].concat(n).forEach(a=>{const i=typeof a=="string"?`${a}$`:a.key;t=t.filter(d=>!d.key.startsWith(i))}),e.length===t.length)return;const l=this.state.reconfigure({plugins:t});return this.view.updateState(l),l}createExtensionManager(){var n,e;const l=[...this.options.enableCoreExtensions?[f2,o2.configure({blockSeparator:(e=(n=this.options.coreExtensionOptions)==null?void 0:n.clipboardTextSerializer)==null?void 0:e.blockSeparator}),c2,p2,m2,x2,u2,g2,d2,b2.configure({direction:this.options.textDirection})].filter(a=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[a.name]!==!1:!0):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(a?.type));this.extensionManager=new Ou(l,this)}createCommandManager(){this.commandManager=new Eu({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let n;try{n=Yp(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(t=>t.name!=="collaboration"),this.createExtensionManager()}}),n=Yp(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return n}createView(n){var e;this.editorView=new PN(n,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const t=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(t),this.prependClass(),this.injectCSS();const l=this.view.dom;l.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(n){this.isCapturingTransaction=!0,n(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(n){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=n;return}n.steps.forEach(p=>{var g;return(g=this.capturedTransaction)==null?void 0:g.step(p)});return}const{state:e,transactions:t}=this.state.applyTransaction(n),l=!this.state.selection.eq(e.selection),a=t.includes(n),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:n,nextState:e}),!a)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:n,appendedTransactions:t.slice(1)}),l&&this.emit("selectionUpdate",{editor:this,transaction:n});const d=t.findLast(p=>p.getMeta("focus")||p.getMeta("blur")),u=d?.getMeta("focus"),h=d?.getMeta("blur");u&&this.emit("focus",{editor:this,event:u.event,transaction:d}),h&&this.emit("blur",{editor:this,event:h.event,transaction:d}),!(n.getMeta("preventUpdate")||!t.some(p=>p.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:n,appendedTransactions:t.slice(1)})}getAttributes(n){return e2(this.state,n)}isActive(n,e){const t=typeof n=="string"?n:null,l=typeof n=="string"?e:n;return hT(this.state,t,l)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Hm(this.state.doc.content,this.schema)}getText(n){const{blockSeparator:e=`

`,textSerializers:t={}}=n||{};return iT(this.state.doc,{blockSeparator:e,textSerializers:{...WN(this.schema),...t}})}get isEmpty(){return Tu(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var n,e;return(e=(n=this.editorView)==null?void 0:n.isDestroyed)!=null?e:!0}$node(n,e){var t;return((t=this.$doc)==null?void 0:t.querySelector(n,e))||null}$nodes(n,e){var t;return((t=this.$doc)==null?void 0:t.querySelectorAll(n,e))||null}$pos(n){const e=this.state.doc.resolve(n);return new JT(e,this)}get $doc(){return this.$pos(0)}};function Ei(n){return new Du({find:n.find,handler:({state:e,range:t,match:l})=>{const a=en(n.getAttributes,void 0,l);if(a===!1||a===null)return null;const{tr:i}=e,d=l[l.length-1],u=l[0];if(d){const h=u.search(/\S/),p=t.from+u.indexOf(d),g=p+d.length;if(Um(t.from,t.to,e.doc).filter(v=>v.mark.type.excluded.find(S=>S===n.type&&S!==v.mark.type)).filter(v=>v.to>p).length)return null;g<t.to&&i.delete(g,t.to),p>t.from&&i.delete(t.from+h,p);const y=t.from+h+d.length;i.addMark(t.from+h,y,n.type.create(a||{})),i.removeStoredMark(n.type)}},undoable:n.undoable})}function e3(n){return new Du({find:n.find,handler:({state:e,range:t,match:l})=>{const a=en(n.getAttributes,void 0,l)||{},{tr:i}=e,d=t.from;let u=t.to;const h=n.type.create(a);if(l[1]){const p=l[0].lastIndexOf(l[1]);let g=d+p;g>u?g=u:u=g+l[1].length;const b=l[0][l[0].length-1];i.insertText(b,d+l[0].length-1),i.replaceWith(g,u,h)}else if(l[0]){const p=n.type.isInline?d:d-1;i.insert(p,n.type.create(a)).delete(i.mapping.map(d),i.mapping.map(u))}i.scrollIntoView()},undoable:n.undoable})}function Jp(n){return new Du({find:n.find,handler:({state:e,range:t,match:l})=>{const a=e.doc.resolve(t.from),i=en(n.getAttributes,void 0,l)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,i)},undoable:n.undoable})}function Mi(n){return new Du({find:n.find,handler:({state:e,range:t,match:l,chain:a})=>{const i=en(n.getAttributes,void 0,l)||{},d=e.tr.delete(t.from,t.to),h=d.doc.resolve(t.from).blockRange(),p=h&&ym(h,n.type,i);if(!p)return null;if(d.wrap(h,p),n.keepMarks&&n.editor){const{selection:b,storedMarks:y}=e,{splittableMarks:v}=n.editor.extensionManager,N=y||b.$to.parentOffset&&b.$from.marks();if(N){const S=N.filter(j=>v.includes(j.type.name));d.ensureMarks(S)}}if(n.keepAttributes){const b=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";a().updateAttributes(b,i).run()}const g=d.doc.resolve(t.from-1).nodeBefore;g&&g.type===n.type&&Xr(d.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(l,g))&&d.join(t.from-1)},undoable:n.undoable})}function t3(n,e){const{selection:t}=n,{$from:l}=t;if(t instanceof ct){const i=l.index();return l.parent.canReplaceWith(i,i+1,e)}let a=l.depth;for(;a>=0;){const i=l.index(a);if(l.node(a).contentMatchAt(i).matchType(e))return!0;a-=1}return!1}var n3={};zm(n3,{createAtomBlockMarkdownSpec:()=>s3,createBlockMarkdownSpec:()=>l3,createInlineMarkdownSpec:()=>i3,parseAttributes:()=>qm,parseIndentedBlocks:()=>Qp,renderNestedMarkdownContent:()=>Km,serializeAttributes:()=>Fm});function qm(n){if(!n?.trim())return{};const e={},t=[],l=n.replace(/["']([^"']*)["']/g,p=>(t.push(p),`__QUOTED_${t.length-1}__`)),a=l.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(a){const p=a.map(g=>g.trim().slice(1));e.class=p.join(" ")}const i=l.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const d=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(l.matchAll(d)).forEach(([,p,g])=>{var b;const y=parseInt(((b=g.match(/__QUOTED_(\d+)__/))==null?void 0:b[1])||"0",10),v=t[y];v&&(e[p]=v.slice(1,-1))});const h=l.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return h&&h.split(/\s+/).filter(Boolean).forEach(g=>{g.match(/^[a-zA-Z][\w-]*$/)&&(e[g]=!0)}),e}function Fm(n){if(!n||Object.keys(n).length===0)return"";const e=[];return n.class&&String(n.class).split(/\s+/).filter(Boolean).forEach(l=>e.push(`.${l}`)),n.id&&e.push(`#${n.id}`),Object.entries(n).forEach(([t,l])=>{t==="class"||t==="id"||(l===!0?e.push(t):l!==!1&&l!=null&&e.push(`${t}="${String(l)}"`))}),e.join(" ")}function s3(n){const{nodeName:e,name:t,parseAttributes:l=qm,serializeAttributes:a=Fm,defaultAttributes:i={},requiredAttributes:d=[],allowedAttributes:u}=n,h=t||e,p=g=>{if(!u)return g;const b={};return u.forEach(y=>{y in g&&(b[y]=g[y])}),b};return{parseMarkdown:(g,b)=>{const y={...i,...g.attributes};return b.createNode(e,y,[])},markdownTokenizer:{name:e,level:"block",start(g){var b;const y=new RegExp(`^:::${h}(?:\\s|$)`,"m"),v=(b=g.match(y))==null?void 0:b.index;return v!==void 0?v:-1},tokenize(g,b,y){const v=new RegExp(`^:::${h}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),N=g.match(v);if(!N)return;const S=N[1]||"",j=l(S);if(!d.find(D=>!(D in j)))return{type:e,raw:N[0],attributes:j}}},renderMarkdown:g=>{const b=p(g.attrs||{}),y=a(b),v=y?` {${y}}`:"";return`:::${h}${v} :::`}}}function l3(n){const{nodeName:e,name:t,getContent:l,parseAttributes:a=qm,serializeAttributes:i=Fm,defaultAttributes:d={},content:u="block",allowedAttributes:h}=n,p=t||e,g=b=>{if(!h)return b;const y={};return h.forEach(v=>{v in b&&(y[v]=b[v])}),y};return{parseMarkdown:(b,y)=>{let v;if(l){const S=l(b);v=typeof S=="string"?[{type:"text",text:S}]:S}else u==="block"?v=y.parseChildren(b.tokens||[]):v=y.parseInline(b.tokens||[]);const N={...d,...b.attributes};return y.createNode(e,N,v)},markdownTokenizer:{name:e,level:"block",start(b){var y;const v=new RegExp(`^:::${p}`,"m"),N=(y=b.match(v))==null?void 0:y.index;return N!==void 0?N:-1},tokenize(b,y,v){var N;const S=new RegExp(`^:::${p}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),j=b.match(S);if(!j)return;const[E,D=""]=j,_=a(D);let H=1;const L=E.length;let V="";const G=/^:::([\w-]*)(\s.*)?/gm,X=b.slice(L);for(G.lastIndex=0;;){const $=G.exec(X);if($===null)break;const R=$.index,A=$[1];if(!((N=$[2])!=null&&N.endsWith(":::"))){if(A)H+=1;else if(H-=1,H===0){const B=X.slice(0,R);V=B.trim();const Y=b.slice(0,L+R+$[0].length);let J=[];if(V)if(u==="block")for(J=v.blockTokens(B),J.forEach(de=>{de.text&&(!de.tokens||de.tokens.length===0)&&(de.tokens=v.inlineTokens(de.text))});J.length>0;){const de=J[J.length-1];if(de.type==="paragraph"&&(!de.text||de.text.trim()===""))J.pop();else break}else J=v.inlineTokens(V);return{type:e,raw:Y,attributes:_,content:V,tokens:J}}}}}},renderMarkdown:(b,y)=>{const v=g(b.attrs||{}),N=i(v),S=N?` {${N}}`:"",j=y.renderChildren(b.content||[],`

`);return`:::${p}${S}

${j}

:::`}}}function r3(n){if(!n.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let l=t.exec(n);for(;l!==null;){const[,a,i,d]=l;e[a]=i||d,l=t.exec(n)}return e}function a3(n){return Object.entries(n).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function i3(n){const{nodeName:e,name:t,getContent:l,parseAttributes:a=r3,serializeAttributes:i=a3,defaultAttributes:d={},selfClosing:u=!1,allowedAttributes:h}=n,p=t||e,g=y=>{if(!h)return y;const v={};return h.forEach(N=>{const S=typeof N=="string"?N:N.name,j=typeof N=="string"?void 0:N.skipIfDefault;if(S in y){const E=y[S];if(j!==void 0&&E===j)return;v[S]=E}}),v},b=p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(y,v)=>{const N={...d,...y.attributes};if(u)return v.createNode(e,N);const S=l?l(y):y.content||"";return S?v.createNode(e,N,[v.createTextNode(S)]):v.createNode(e,N,[])},markdownTokenizer:{name:e,level:"inline",start(y){const v=u?new RegExp(`\\[${b}\\s*[^\\]]*\\]`):new RegExp(`\\[${b}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${b}\\]`),N=y.match(v),S=N?.index;return S!==void 0?S:-1},tokenize(y,v,N){const S=u?new RegExp(`^\\[${b}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${b}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${b}\\]`),j=y.match(S);if(!j)return;let E="",D="";if(u){const[,H]=j;D=H}else{const[,H,L]=j;D=H,E=L||""}const _=a(D.trim());return{type:e,raw:j[0],content:E.trim(),attributes:_}}},renderMarkdown:y=>{let v="";l?v=l(y):y.content&&y.content.length>0&&(v=y.content.filter(E=>E.type==="text").map(E=>E.text).join(""));const N=g(y.attrs||{}),S=i(N),j=S?` ${S}`:"";return u?`[${p}${j}]`:`[${p}${j}]${v}[/${p}]`}}}function Qp(n,e,t){var l,a,i,d;const u=n.split(`
`),h=[];let p="",g=0;const b=e.baseIndentSize||2;for(;g<u.length;){const y=u[g],v=y.match(e.itemPattern);if(!v){if(h.length>0)break;if(y.trim()===""){g+=1,p=`${p}${y}
`;continue}else return}const N=e.extractItemData(v),{indentLevel:S,mainContent:j}=N;p=`${p}${y}
`;const E=[j];for(g+=1;g<u.length;){const L=u[g];if(L.trim()===""){const G=u.slice(g+1).findIndex(R=>R.trim()!=="");if(G===-1)break;if((((a=(l=u[g+1+G].match(/^(\s*)/))==null?void 0:l[1])==null?void 0:a.length)||0)>S){E.push(L),p=`${p}${L}
`,g+=1;continue}else break}if((((d=(i=L.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:d.length)||0)>S)E.push(L),p=`${p}${L}
`,g+=1;else break}let D;const _=E.slice(1);if(_.length>0){const L=_.map(V=>V.slice(S+b)).join(`
`);L.trim()&&(e.customNestedParser?D=e.customNestedParser(L):D=t.blockTokens(L))}const H=e.createToken(N,D);h.push(H)}if(h.length!==0)return{items:h,raw:p}}function Km(n,e,t,l){if(!n||!Array.isArray(n.content))return"";const a=typeof t=="function"?t(l):t,[i,...d]=n.content,u=e.renderChildren([i]),h=[`${a}${u}`];return d&&d.length>0&&d.forEach(p=>{const g=e.renderChildren([p]);if(g){const b=g.split(`
`).map(y=>y?e.indent(y):"").join(`
`);h.push(b)}}),h.join(`
`)}function o3(n,e,t={}){const{state:l}=e,{doc:a,tr:i}=l,d=n;a.descendants((u,h)=>{const p=i.mapping.map(h),g=i.mapping.map(h)+u.nodeSize;let b=null;if(u.marks.forEach(v=>{if(v!==d)return!1;b=v}),!b)return;let y=!1;if(Object.keys(t).forEach(v=>{t[v]!==b.attrs[v]&&(y=!0)}),y){const v=n.type.create({...n.attrs,...t});i.removeMark(p,g,n.type),i.addMark(p,g,v)}}),i.docChanged&&e.view.dispatch(i)}var Ks=class y2 extends Vm{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new y2(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function Da(n){return new qT({find:n.find,handler:({state:e,range:t,match:l,pasteEvent:a})=>{const i=en(n.getAttributes,void 0,l,a);if(i===!1||i===null)return null;const{tr:d}=e,u=l[l.length-1],h=l[0];let p=t.to;if(u){const g=h.search(/\S/),b=t.from+h.indexOf(u),y=b+u.length;if(Um(t.from,t.to,e.doc).filter(N=>N.mark.type.excluded.find(j=>j===n.type&&j!==N.mark.type)).filter(N=>N.to>b).length)return null;y<t.to&&d.delete(y,t.to),b>t.from&&d.delete(t.from+g,b),p=t.from+g+u.length,d.addMark(t.from+g,p,n.type.create(i||{})),d.removeStoredMark(n.type)}}})}var c3=Object.getOwnPropertyNames,d3=Object.getOwnPropertySymbols,u3=Object.prototype.hasOwnProperty;function cv(n,e){return function(l,a,i){return n(l,a,i)&&e(l,a,i)}}function md(n){return function(t,l,a){if(!t||!l||typeof t!="object"||typeof l!="object")return n(t,l,a);var i=a.cache,d=i.get(t),u=i.get(l);if(d&&u)return d===l&&u===t;i.set(t,l),i.set(l,t);var h=n(t,l,a);return i.delete(t),i.delete(l),h}}function f3(n){return n?.[Symbol.toStringTag]}function dv(n){return c3(n).concat(d3(n))}var h3=Object.hasOwn||(function(n,e){return u3.call(n,e)});function Ia(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var p3="__v",m3="__o",g3="_owner",uv=Object.getOwnPropertyDescriptor,fv=Object.keys;function x3(n,e,t){var l=n.length;if(e.length!==l)return!1;for(;l-- >0;)if(!t.equals(n[l],e[l],l,l,n,e,t))return!1;return!0}function b3(n,e){return Ia(n.getTime(),e.getTime())}function y3(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function v3(n,e){return n===e}function hv(n,e,t){var l=n.size;if(l!==e.size)return!1;if(!l)return!0;for(var a=new Array(l),i=n.entries(),d,u,h=0;(d=i.next())&&!d.done;){for(var p=e.entries(),g=!1,b=0;(u=p.next())&&!u.done;){if(a[b]){b++;continue}var y=d.value,v=u.value;if(t.equals(y[0],v[0],h,b,n,e,t)&&t.equals(y[1],v[1],y[0],v[0],n,e,t)){g=a[b]=!0;break}b++}if(!g)return!1;h++}return!0}var N3=Ia;function k3(n,e,t){var l=fv(n),a=l.length;if(fv(e).length!==a)return!1;for(;a-- >0;)if(!v2(n,e,t,l[a]))return!1;return!0}function vo(n,e,t){var l=dv(n),a=l.length;if(dv(e).length!==a)return!1;for(var i,d,u;a-- >0;)if(i=l[a],!v2(n,e,t,i)||(d=uv(n,i),u=uv(e,i),(d||u)&&(!d||!u||d.configurable!==u.configurable||d.enumerable!==u.enumerable||d.writable!==u.writable)))return!1;return!0}function w3(n,e){return Ia(n.valueOf(),e.valueOf())}function S3(n,e){return n.source===e.source&&n.flags===e.flags}function pv(n,e,t){var l=n.size;if(l!==e.size)return!1;if(!l)return!0;for(var a=new Array(l),i=n.values(),d,u;(d=i.next())&&!d.done;){for(var h=e.values(),p=!1,g=0;(u=h.next())&&!u.done;){if(!a[g]&&t.equals(d.value,u.value,d.value,u.value,n,e,t)){p=a[g]=!0;break}g++}if(!p)return!1}return!0}function j3(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function C3(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function v2(n,e,t,l){return(l===g3||l===m3||l===p3)&&(n.$$typeof||e.$$typeof)?!0:h3(e,l)&&t.equals(n[l],e[l],l,l,n,e,t)}var E3="[object Arguments]",M3="[object Boolean]",A3="[object Date]",T3="[object Error]",D3="[object Map]",O3="[object Number]",R3="[object Object]",I3="[object RegExp]",z3="[object Set]",L3="[object String]",_3="[object URL]",B3=Array.isArray,mv=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,gv=Object.assign,P3=Object.prototype.toString.call.bind(Object.prototype.toString);function H3(n){var e=n.areArraysEqual,t=n.areDatesEqual,l=n.areErrorsEqual,a=n.areFunctionsEqual,i=n.areMapsEqual,d=n.areNumbersEqual,u=n.areObjectsEqual,h=n.arePrimitiveWrappersEqual,p=n.areRegExpsEqual,g=n.areSetsEqual,b=n.areTypedArraysEqual,y=n.areUrlsEqual,v=n.unknownTagComparators;return function(S,j,E){if(S===j)return!0;if(S==null||j==null)return!1;var D=typeof S;if(D!==typeof j)return!1;if(D!=="object")return D==="number"?d(S,j,E):D==="function"?a(S,j,E):!1;var _=S.constructor;if(_!==j.constructor)return!1;if(_===Object)return u(S,j,E);if(B3(S))return e(S,j,E);if(mv!=null&&mv(S))return b(S,j,E);if(_===Date)return t(S,j,E);if(_===RegExp)return p(S,j,E);if(_===Map)return i(S,j,E);if(_===Set)return g(S,j,E);var H=P3(S);if(H===A3)return t(S,j,E);if(H===I3)return p(S,j,E);if(H===D3)return i(S,j,E);if(H===z3)return g(S,j,E);if(H===R3)return typeof S.then!="function"&&typeof j.then!="function"&&u(S,j,E);if(H===_3)return y(S,j,E);if(H===T3)return l(S,j,E);if(H===E3)return u(S,j,E);if(H===M3||H===O3||H===L3)return h(S,j,E);if(v){var L=v[H];if(!L){var V=f3(S);V&&(L=v[V])}if(L)return L(S,j,E)}return!1}}function $3(n){var e=n.circular,t=n.createCustomConfig,l=n.strict,a={areArraysEqual:l?vo:x3,areDatesEqual:b3,areErrorsEqual:y3,areFunctionsEqual:v3,areMapsEqual:l?cv(hv,vo):hv,areNumbersEqual:N3,areObjectsEqual:l?vo:k3,arePrimitiveWrappersEqual:w3,areRegExpsEqual:S3,areSetsEqual:l?cv(pv,vo):pv,areTypedArraysEqual:l?vo:j3,areUrlsEqual:C3,unknownTagComparators:void 0};if(t&&(a=gv({},a,t(a))),e){var i=md(a.areArraysEqual),d=md(a.areMapsEqual),u=md(a.areObjectsEqual),h=md(a.areSetsEqual);a=gv({},a,{areArraysEqual:i,areMapsEqual:d,areObjectsEqual:u,areSetsEqual:h})}return a}function U3(n){return function(e,t,l,a,i,d,u){return n(e,t,u)}}function V3(n){var e=n.circular,t=n.comparator,l=n.createState,a=n.equals,i=n.strict;if(l)return function(h,p){var g=l(),b=g.cache,y=b===void 0?e?new WeakMap:void 0:b,v=g.meta;return t(h,p,{cache:y,equals:a,meta:v,strict:i})};if(e)return function(h,p){return t(h,p,{cache:new WeakMap,equals:a,meta:void 0,strict:i})};var d={cache:void 0,equals:a,meta:void 0,strict:i};return function(h,p){return t(h,p,d)}}var q3=Qr();Qr({strict:!0});Qr({circular:!0});Qr({circular:!0,strict:!0});Qr({createInternalComparator:function(){return Ia}});Qr({strict:!0,createInternalComparator:function(){return Ia}});Qr({circular:!0,createInternalComparator:function(){return Ia}});Qr({circular:!0,createInternalComparator:function(){return Ia},strict:!0});function Qr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,l=n.createInternalComparator,a=n.createState,i=n.strict,d=i===void 0?!1:i,u=$3(n),h=H3(u),p=l?l(h):U3(h);return V3({circular:t,comparator:h,createState:a,equals:p,strict:d})}var op={exports:{}},cp={};var xv;function F3(){if(xv)return cp;xv=1;var n=Jo(),e=u1();function t(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var l=typeof Object.is=="function"?Object.is:t,a=e.useSyncExternalStore,i=n.useRef,d=n.useEffect,u=n.useMemo,h=n.useDebugValue;return cp.useSyncExternalStoreWithSelector=function(p,g,b,y,v){var N=i(null);if(N.current===null){var S={hasValue:!1,value:null};N.current=S}else S=N.current;N=u(function(){function E(V){if(!D){if(D=!0,_=V,V=y(V),v!==void 0&&S.hasValue){var G=S.value;if(v(G,V))return H=G}return H=V}if(G=H,l(_,V))return G;var X=y(V);return v!==void 0&&v(G,X)?(_=V,G):(_=V,H=X)}var D=!1,_,H,L=b===void 0?null:b;return[function(){return E(g())},L===null?void 0:function(){return E(L())}]},[g,b,y,v]);var j=a(p,N[0],N[1]);return d(function(){S.hasValue=!0,S.value=j},[j]),h(j),j},cp}var bv;function K3(){return bv||(bv=1,op.exports=F3()),op.exports}var G3=K3(),Y3=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},X3=({contentComponent:n})=>{const e=f1.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return o.jsx(o.Fragment,{children:Object.values(e)})};function J3(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,l){e={...e,[t]:sC.createPortal(l.reactElement,l.element,t)},n.forEach(a=>a())},removeRenderer(t){const l={...e};delete l[t],e=l,n.forEach(a=>a())}}}var Q3=class extends ps.Component{constructor(n){var e;super(n),this.editorContentRef=ps.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=n.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const n=this.props.editor;if(n&&!n.isDestroyed&&n.options.element){if(n.contentComponent)return;const e=this.editorContentRef.current;e.append(n.view.dom),n.setOptions({element:e}),n.contentComponent=J3(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=n.contentComponent.subscribe(()=>{this.setState(t=>t.hasContentComponentInitialized?t:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),n.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var n;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((n=e.view.dom)!=null&&n.firstChild))return;const t=document.createElement("div");t.append(e.view.dom),e.setOptions({element:t})}catch{}}}render(){const{editor:n,innerRef:e,...t}=this.props;return o.jsxs(o.Fragment,{children:[o.jsx("div",{ref:Y3(e,this.editorContentRef),...t}),n?.contentComponent&&o.jsx(X3,{contentComponent:n.contentComponent})]})}},Z3=C.forwardRef((n,e)=>{const t=ps.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return ps.createElement(Q3,{key:t,innerRef:e,...n})}),W3=ps.memo(Z3),e4=typeof window<"u"?C.useLayoutEffect:C.useEffect,t4=class{constructor(n){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=n,this.lastSnapshot={editor:n,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(n){return this.subscribers.add(n),()=>{this.subscribers.delete(n)}}watch(n){if(this.editor=n,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(l=>l())},t=this.editor;return t.on("transaction",e),()=>{t.off("transaction",e)}}}};function n4(n){var e;const[t]=C.useState(()=>new t4(n.editor)),l=G3.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!=null?e:q3);return e4(()=>t.watch(n.editor),[n.editor,t]),C.useDebugValue(l),l}var s4=!1,Zp=typeof window>"u",l4=Zp||!!(typeof window<"u"&&window.next),r4=class N2{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Zp||l4?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...l)=>{var a,i;return(i=(a=this.options.current).onBeforeCreate)==null?void 0:i.call(a,...l)},onBlur:(...l)=>{var a,i;return(i=(a=this.options.current).onBlur)==null?void 0:i.call(a,...l)},onCreate:(...l)=>{var a,i;return(i=(a=this.options.current).onCreate)==null?void 0:i.call(a,...l)},onDestroy:(...l)=>{var a,i;return(i=(a=this.options.current).onDestroy)==null?void 0:i.call(a,...l)},onFocus:(...l)=>{var a,i;return(i=(a=this.options.current).onFocus)==null?void 0:i.call(a,...l)},onSelectionUpdate:(...l)=>{var a,i;return(i=(a=this.options.current).onSelectionUpdate)==null?void 0:i.call(a,...l)},onTransaction:(...l)=>{var a,i;return(i=(a=this.options.current).onTransaction)==null?void 0:i.call(a,...l)},onUpdate:(...l)=>{var a,i;return(i=(a=this.options.current).onUpdate)==null?void 0:i.call(a,...l)},onContentError:(...l)=>{var a,i;return(i=(a=this.options.current).onContentError)==null?void 0:i.call(a,...l)},onDrop:(...l)=>{var a,i;return(i=(a=this.options.current).onDrop)==null?void 0:i.call(a,...l)},onPaste:(...l)=>{var a,i;return(i=(a=this.options.current).onPaste)==null?void 0:i.call(a,...l)},onDelete:(...l)=>{var a,i;return(i=(a=this.options.current).onDelete)==null?void 0:i.call(a,...l)}};return new WT(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(l=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(l)?!0:l==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((a,i)=>{var d;return a===((d=t.extensions)==null?void 0:d[i])}):e[l]===t[l])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?N2.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((l,a)=>l===e[a]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function a4(n={},e=[]){const t=C.useRef(n);t.current=n;const[l]=C.useState(()=>new r4(t)),a=f1.useSyncExternalStore(l.subscribe,l.getEditor,l.getServerSnapshot);return C.useDebugValue(a),C.useEffect(l.onRender(e)),n4({editor:a,selector:({transactionNumber:i})=>n.shouldRerenderOnTransaction===!1||n.shouldRerenderOnTransaction===void 0?null:n.immediatelyRender&&i===0?0:i+1}),a}var i4=C.createContext({editor:null});i4.Consumer;var o4=C.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),c4=()=>C.useContext(o4);ps.forwardRef((n,e)=>{const{onDragStart:t}=c4(),l=n.as||"div";return o.jsx(l,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});ps.createContext({markViewContentRef:()=>{}});var Vd=(n,e)=>{if(n==="slot")return 0;if(n instanceof Function)return n(e);const{children:t,...l}=e??{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,l,t]},d4=/^\s*>\s$/,u4=Ks.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return Vd("blockquote",{...Hn(this.options.HTMLAttributes,n),children:Vd("slot",{})})},parseMarkdown:(n,e)=>e.createNode("blockquote",void 0,e.parseChildren(n.tokens||[])),renderMarkdown:(n,e)=>{if(!n.content)return"";const t=">",l=[];return n.content.forEach(a=>{const u=e.renderChildren([a]).split(`
`).map(h=>h.trim()===""?t:`${t} ${h}`);l.push(u.join(`
`))}),l.join(`
${t}
`)},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Mi({find:d4,type:this.type})]}}),f4=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,h4=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,p4=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,m4=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,g4=Ra.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return Vd("strong",{...Hn(this.options.HTMLAttributes,n),children:Vd("slot",{})})},markdownTokenName:"strong",parseMarkdown:(n,e)=>e.applyMark("bold",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`**${e.renderChildren(n)}**`,addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ei({find:f4,type:this.type}),Ei({find:p4,type:this.type})]},addPasteRules(){return[Da({find:h4,type:this.type}),Da({find:m4,type:this.type})]}}),x4=/(^|[^`])`([^`]+)`(?!`)$/,b4=/(^|[^`])`([^`]+)`(?!`)/g,y4=Ra.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",Hn(this.options.HTMLAttributes,n),0]},markdownTokenName:"codespan",parseMarkdown:(n,e)=>e.applyMark("code",[{type:"text",text:n.text||""}]),renderMarkdown:(n,e)=>n.content?`\`${e.renderChildren(n.content)}\``:"",addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ei({find:x4,type:this.type})]},addPasteRules(){return[Da({find:b4,type:this.type})]}}),dp=4,v4=/^```([a-z]+)?[\s\n]$/,N4=/^~~~([a-z]+)?[\s\n]$/,k4=Ks.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:dp,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options;if(!t)return null;const i=[...((e=n.firstElementChild)==null?void 0:e.classList)||[]].filter(d=>d.startsWith(t)).map(d=>d.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",Hn(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(n,e)=>{var t;return((t=n.raw)==null?void 0:t.startsWith("```"))===!1&&n.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:n.lang||null},n.text?[e.createTextNode(n.text)]:[])},renderMarkdown:(n,e)=>{var t;let l="";const a=((t=n.attrs)==null?void 0:t.language)||"";return n.content?l=[`\`\`\`${a}`,e.renderChildren(n.content),"```"].join(`
`):l=`\`\`\`${a}

\`\`\``,l},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:n})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:dp,{state:l}=n,{selection:a}=l,{$from:i,empty:d}=a;if(i.parent.type!==this.type)return!1;const u=" ".repeat(t);return d?n.commands.insertContent(u):n.commands.command(({tr:h})=>{const{from:p,to:g}=a,v=l.doc.textBetween(p,g,`
`,`
`).split(`
`).map(N=>u+N).join(`
`);return h.replaceWith(p,g,l.schema.text(v)),!0})},"Shift-Tab":({editor:n})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:dp,{state:l}=n,{selection:a}=l,{$from:i,empty:d}=a;return i.parent.type!==this.type?!1:d?n.commands.command(({tr:u})=>{var h;const{pos:p}=i,g=i.start(),b=i.end(),v=l.doc.textBetween(g,b,`
`,`
`).split(`
`);let N=0,S=0;const j=p-g;for(let V=0;V<v.length;V+=1){if(S+v[V].length>=j){N=V;break}S+=v[V].length+1}const D=((h=v[N].match(/^ */))==null?void 0:h[0])||"",_=Math.min(D.length,t);if(_===0)return!0;let H=g;for(let V=0;V<N;V+=1)H+=v[V].length+1;return u.delete(H,H+_),p-H<=_&&u.setSelection(gt.create(u.doc,H)),!0}):n.commands.command(({tr:u})=>{const{from:h,to:p}=a,y=l.doc.textBetween(h,p,`
`,`
`).split(`
`).map(v=>{var N;const S=((N=v.match(/^ */))==null?void 0:N[0])||"",j=Math.min(S.length,t);return v.slice(j)}).join(`
`);return u.replaceWith(h,p,l.schema.text(y)),!0})},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:l,empty:a}=t;if(!a||l.parent.type!==this.type)return!1;const i=l.parentOffset===l.parent.nodeSize-2,d=l.parent.textContent.endsWith(`

`);return!i||!d?!1:n.chain().command(({tr:u})=>(u.delete(l.pos-2,l.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:l}=e,{$from:a,empty:i}=t;if(!i||a.parent.type!==this.type||!(a.parentOffset===a.parent.nodeSize-2))return!1;const u=a.after();return u===void 0?!1:l.nodeAt(u)?n.commands.command(({tr:p})=>(p.setSelection(Et.near(l.resolve(u))),!0)):n.commands.exitCode()}}},addInputRules(){return[Jp({find:v4,type:this.type,getAttributes:n=>({language:n[1]})}),Jp({find:N4,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new gn({key:new Vn("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),l=e.clipboardData.getData("vscode-editor-data"),a=l?JSON.parse(l):void 0,i=a?.mode;if(!t||!i)return!1;const{tr:d,schema:u}=n.state,h=u.text(t.replace(/\r\n?/g,`
`));return d.replaceSelectionWith(this.type.create({language:i},h)),d.selection.$from.parent.type!==this.type&&d.setSelection(gt.near(d.doc.resolve(Math.max(0,d.selection.from-2)))),d.setMeta("paste",!0),n.dispatch(d),!0}}})]}}),w4=Ks.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`

`):""}),S4=Ks.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",Hn(this.options.HTMLAttributes,n)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:l})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:a,storedMarks:i}=t;if(a.$from.parent.type.spec.isolating)return!1;const{keepMarks:d}=this.options,{splittableMarks:u}=l.extensionManager,h=i||a.$to.parentOffset&&a.$from.marks();return e().insertContent({type:this.name}).command(({tr:p,dispatch:g})=>{if(g&&h&&d){const b=h.filter(y=>u.includes(y.type.name));p.ensureMarks(b)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),j4=Ks.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,Hn(this.options.HTMLAttributes,e),0]},parseMarkdown:(n,e)=>e.createNode("heading",{level:n.depth||1},e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>{var t;const l=(t=n.attrs)!=null&&t.level?parseInt(n.attrs.level,10):1,a="#".repeat(l);return n.content?`${a} ${e.renderChildren(n.content)}`:""},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>Jp({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}}),C4=Ks.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",Hn(this.options.HTMLAttributes,n)]},markdownTokenName:"hr",parseMarkdown:(n,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{if(!t3(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$to:l}=t,a=n();return n2(t)?a.insertContentAt(l.pos,{type:this.name}):a.insertContent({type:this.name}),a.command(({state:i,tr:d,dispatch:u})=>{if(u){const{$to:h}=d.selection,p=h.end();if(h.nodeAfter)h.nodeAfter.isTextblock?d.setSelection(gt.create(d.doc,h.pos+1)):h.nodeAfter.isBlock?d.setSelection(ct.create(d.doc,h.pos)):d.setSelection(gt.create(d.doc,h.pos));else{const g=i.schema.nodes[this.options.nextNodeType]||h.parent.type.contentMatch.defaultType,b=g?.create();b&&(d.insert(p,b),d.setSelection(gt.create(d.doc,p+1)))}d.scrollIntoView()}return!0}).run()}}},addInputRules(){return[e3({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),E4=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,M4=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,A4=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,T4=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,D4=Ra.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",Hn(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(n,e)=>e.applyMark("italic",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`*${e.renderChildren(n)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ei({find:E4,type:this.type}),Ei({find:A4,type:this.type})]},addPasteRules(){return[Da({find:M4,type:this.type}),Da({find:T4,type:this.type})]}});const O4="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",R4="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Wp="numeric",em="ascii",tm="alpha",Ro="asciinumeric",Eo="alphanumeric",nm="domain",k2="emoji",I4="scheme",z4="slashscheme",up="whitespace";function L4(n,e){return n in e||(e[n]=[]),e[n]}function Na(n,e,t){e[Wp]&&(e[Ro]=!0,e[Eo]=!0),e[em]&&(e[Ro]=!0,e[tm]=!0),e[Ro]&&(e[Eo]=!0),e[tm]&&(e[Eo]=!0),e[Eo]&&(e[nm]=!0),e[k2]&&(e[nm]=!0);for(const l in e){const a=L4(l,t);a.indexOf(n)<0&&a.push(n)}}function _4(n,e){const t={};for(const l in e)e[l].indexOf(n)>=0&&(t[l]=!0);return t}function Ds(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}Ds.groups={};Ds.prototype={accepts(){return!!this.t},go(n){const e=this,t=e.j[n];if(t)return t;for(let l=0;l<e.jr.length;l++){const a=e.jr[l][0],i=e.jr[l][1];if(i&&a.test(n))return i}return e.jd},has(n,e=!1){return e?n in this.j:!!this.go(n)},ta(n,e,t,l){for(let a=0;a<n.length;a++)this.tt(n[a],e,t,l)},tr(n,e,t,l){l=l||Ds.groups;let a;return e&&e.j?a=e:(a=new Ds(e),t&&l&&Na(e,t,l)),this.jr.push([n,a]),a},ts(n,e,t,l){let a=this;const i=n.length;if(!i)return a;for(let d=0;d<i-1;d++)a=a.tt(n[d]);return a.tt(n[i-1],e,t,l)},tt(n,e,t,l){l=l||Ds.groups;const a=this;if(e&&e.j)return a.j[n]=e,e;const i=e;let d,u=a.go(n);if(u?(d=new Ds,Object.assign(d.j,u.j),d.jr.push.apply(d.jr,u.jr),d.jd=u.jd,d.t=u.t):d=new Ds,i){if(l)if(d.t&&typeof d.t=="string"){const h=Object.assign(_4(d.t,l),t);Na(i,h,l)}else t&&Na(i,t,l);d.t=i}return a.j[n]=d,d}};const Ct=(n,e,t,l,a)=>n.ta(e,t,l,a),Sn=(n,e,t,l,a)=>n.tr(e,t,l,a),yv=(n,e,t,l,a)=>n.ts(e,t,l,a),Pe=(n,e,t,l,a)=>n.tt(e,t,l,a),Wl="WORD",sm="UWORD",w2="ASCIINUMERICAL",S2="ALPHANUMERICAL",Yo="LOCALHOST",lm="TLD",rm="UTLD",Sd="SCHEME",xi="SLASH_SCHEME",Gm="NUM",am="WS",Ym="NL",Io="OPENBRACE",zo="CLOSEBRACE",qd="OPENBRACKET",Fd="CLOSEBRACKET",Kd="OPENPAREN",Gd="CLOSEPAREN",Yd="OPENANGLEBRACKET",Xd="CLOSEANGLEBRACKET",Jd="FULLWIDTHLEFTPAREN",Qd="FULLWIDTHRIGHTPAREN",Zd="LEFTCORNERBRACKET",Wd="RIGHTCORNERBRACKET",eu="LEFTWHITECORNERBRACKET",tu="RIGHTWHITECORNERBRACKET",nu="FULLWIDTHLESSTHAN",su="FULLWIDTHGREATERTHAN",lu="AMPERSAND",ru="APOSTROPHE",au="ASTERISK",zr="AT",iu="BACKSLASH",ou="BACKTICK",cu="CARET",Br="COLON",Xm="COMMA",du="DOLLAR",Cl="DOT",uu="EQUALS",Jm="EXCLAMATION",al="HYPHEN",Lo="PERCENT",fu="PIPE",hu="PLUS",pu="POUND",_o="QUERY",Qm="QUOTE",j2="FULLWIDTHMIDDLEDOT",Zm="SEMI",El="SLASH",Bo="TILDE",mu="UNDERSCORE",C2="EMOJI",gu="SYM";var E2=Object.freeze({__proto__:null,ALPHANUMERICAL:S2,AMPERSAND:lu,APOSTROPHE:ru,ASCIINUMERICAL:w2,ASTERISK:au,AT:zr,BACKSLASH:iu,BACKTICK:ou,CARET:cu,CLOSEANGLEBRACKET:Xd,CLOSEBRACE:zo,CLOSEBRACKET:Fd,CLOSEPAREN:Gd,COLON:Br,COMMA:Xm,DOLLAR:du,DOT:Cl,EMOJI:C2,EQUALS:uu,EXCLAMATION:Jm,FULLWIDTHGREATERTHAN:su,FULLWIDTHLEFTPAREN:Jd,FULLWIDTHLESSTHAN:nu,FULLWIDTHMIDDLEDOT:j2,FULLWIDTHRIGHTPAREN:Qd,HYPHEN:al,LEFTCORNERBRACKET:Zd,LEFTWHITECORNERBRACKET:eu,LOCALHOST:Yo,NL:Ym,NUM:Gm,OPENANGLEBRACKET:Yd,OPENBRACE:Io,OPENBRACKET:qd,OPENPAREN:Kd,PERCENT:Lo,PIPE:fu,PLUS:hu,POUND:pu,QUERY:_o,QUOTE:Qm,RIGHTCORNERBRACKET:Wd,RIGHTWHITECORNERBRACKET:tu,SCHEME:Sd,SEMI:Zm,SLASH:El,SLASH_SCHEME:xi,SYM:gu,TILDE:Bo,TLD:lm,UNDERSCORE:mu,UTLD:rm,UWORD:sm,WORD:Wl,WS:am});const Jl=/[a-z]/,No=new RegExp("\\p{L}","u"),fp=new RegExp("\\p{Emoji}","u"),Ql=/\d/,hp=/\s/,vv="\r",pp=`
`,B4="",P4="",mp="";let gd=null,xd=null;function H4(n=[]){const e={};Ds.groups=e;const t=new Ds;gd==null&&(gd=Nv(O4)),xd==null&&(xd=Nv(R4)),Pe(t,"'",ru),Pe(t,"{",Io),Pe(t,"}",zo),Pe(t,"[",qd),Pe(t,"]",Fd),Pe(t,"(",Kd),Pe(t,")",Gd),Pe(t,"<",Yd),Pe(t,">",Xd),Pe(t,"",Jd),Pe(t,"",Qd),Pe(t,"",Zd),Pe(t,"",Wd),Pe(t,"",eu),Pe(t,"",tu),Pe(t,"",nu),Pe(t,"",su),Pe(t,"&",lu),Pe(t,"*",au),Pe(t,"@",zr),Pe(t,"`",ou),Pe(t,"^",cu),Pe(t,":",Br),Pe(t,",",Xm),Pe(t,"$",du),Pe(t,".",Cl),Pe(t,"=",uu),Pe(t,"!",Jm),Pe(t,"-",al),Pe(t,"%",Lo),Pe(t,"|",fu),Pe(t,"+",hu),Pe(t,"#",pu),Pe(t,"?",_o),Pe(t,'"',Qm),Pe(t,"/",El),Pe(t,";",Zm),Pe(t,"~",Bo),Pe(t,"_",mu),Pe(t,"\\",iu),Pe(t,"",j2);const l=Sn(t,Ql,Gm,{[Wp]:!0});Sn(l,Ql,l);const a=Sn(l,Jl,w2,{[Ro]:!0}),i=Sn(l,No,S2,{[Eo]:!0}),d=Sn(t,Jl,Wl,{[em]:!0});Sn(d,Ql,a),Sn(d,Jl,d),Sn(a,Ql,a),Sn(a,Jl,a);const u=Sn(t,No,sm,{[tm]:!0});Sn(u,Jl),Sn(u,Ql,i),Sn(u,No,u),Sn(i,Ql,i),Sn(i,Jl),Sn(i,No,i);const h=Pe(t,pp,Ym,{[up]:!0}),p=Pe(t,vv,am,{[up]:!0}),g=Sn(t,hp,am,{[up]:!0});Pe(t,mp,g),Pe(p,pp,h),Pe(p,mp,g),Sn(p,hp,g),Pe(g,vv),Pe(g,pp),Sn(g,hp,g),Pe(g,mp,g);const b=Sn(t,fp,C2,{[k2]:!0});Pe(b,"#"),Sn(b,fp,b),Pe(b,B4,b);const y=Pe(b,P4);Pe(y,"#"),Sn(y,fp,b);const v=[[Jl,d],[Ql,a]],N=[[Jl,null],[No,u],[Ql,i]];for(let S=0;S<gd.length;S++)Tr(t,gd[S],lm,Wl,v);for(let S=0;S<xd.length;S++)Tr(t,xd[S],rm,sm,N);Na(lm,{tld:!0,ascii:!0},e),Na(rm,{utld:!0,alpha:!0},e),Tr(t,"file",Sd,Wl,v),Tr(t,"mailto",Sd,Wl,v),Tr(t,"http",xi,Wl,v),Tr(t,"https",xi,Wl,v),Tr(t,"ftp",xi,Wl,v),Tr(t,"ftps",xi,Wl,v),Na(Sd,{scheme:!0,ascii:!0},e),Na(xi,{slashscheme:!0,ascii:!0},e),n=n.sort((S,j)=>S[0]>j[0]?1:-1);for(let S=0;S<n.length;S++){const j=n[S][0],D=n[S][1]?{[I4]:!0}:{[z4]:!0};j.indexOf("-")>=0?D[nm]=!0:Jl.test(j)?Ql.test(j)?D[Ro]=!0:D[em]=!0:D[Wp]=!0,yv(t,j,j,D)}return yv(t,"localhost",Yo,{ascii:!0}),t.jd=new Ds(gu),{start:t,tokens:Object.assign({groups:e},E2)}}function M2(n,e){const t=$4(e.replace(/[A-Z]/g,u=>u.toLowerCase())),l=t.length,a=[];let i=0,d=0;for(;d<l;){let u=n,h=null,p=0,g=null,b=-1,y=-1;for(;d<l&&(h=u.go(t[d]));)u=h,u.accepts()?(b=0,y=0,g=u):b>=0&&(b+=t[d].length,y++),p+=t[d].length,i+=t[d].length,d++;i-=b,d-=y,p-=b,a.push({t:g.t,v:e.slice(i-p,i),s:i-p,e:i})}return a}function $4(n){const e=[],t=n.length;let l=0;for(;l<t;){let a=n.charCodeAt(l),i,d=a<55296||a>56319||l+1===t||(i=n.charCodeAt(l+1))<56320||i>57343?n[l]:n.slice(l,l+2);e.push(d),l+=d.length}return e}function Tr(n,e,t,l,a){let i;const d=e.length;for(let u=0;u<d-1;u++){const h=e[u];n.j[h]?i=n.j[h]:(i=new Ds(l),i.jr=a.slice(),n.j[h]=i),n=i}return i=new Ds(t),i.jr=a.slice(),n.j[e[d-1]]=i,i}function Nv(n){const e=[],t=[];let l=0,a="0123456789";for(;l<n.length;){let i=0;for(;a.indexOf(n[l+i])>=0;)i++;if(i>0){e.push(t.join(""));for(let d=parseInt(n.substring(l,l+i),10);d>0;d--)t.pop();l+=i}else t.push(n[l]),l++}return e}const Xo={defaultProtocol:"http",events:null,format:kv,formatHref:kv,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Wm(n,e=null){let t=Object.assign({},Xo);n&&(t=Object.assign(t,n instanceof Wm?n.o:n));const l=t.ignoreTags,a=[];for(let i=0;i<l.length;i++)a.push(l[i].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=a}Wm.prototype={o:Xo,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,e,t){const l=e!=null;let a=this.o[n];return a&&(typeof a=="object"?(a=t.t in a?a[t.t]:Xo[n],typeof a=="function"&&l&&(a=a(e,t))):typeof a=="function"&&l&&(a=a(e,t.t,t)),a)},getObj(n,e,t){let l=this.o[n];return typeof l=="function"&&e!=null&&(l=l(e,t.t,t)),l},render(n){const e=n.render(this);return(this.get("render",null,n)||this.defaultRender)(e,n.t,n)}};function kv(n){return n}function A2(n,e){this.t="token",this.v=n,this.tk=e}A2.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){const e=this.toString(),t=n.get("truncate",e,this),l=n.get("format",e,this);return t&&l.length>t?l.substring(0,t)+"":l},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=Xo.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){const e=this,t=this.toHref(n.get("defaultProtocol")),l=n.get("formatHref",t,this),a=n.get("tagName",t,e),i=this.toFormattedString(n),d={},u=n.get("className",t,e),h=n.get("target",t,e),p=n.get("rel",t,e),g=n.getObj("attributes",t,e),b=n.getObj("events",t,e);return d.href=l,u&&(d.class=u),h&&(d.target=h),p&&(d.rel=p),g&&Object.assign(d,g),{tagName:a,attributes:d,content:i,eventListeners:b}}};function Ru(n,e){class t extends A2{constructor(a,i){super(a,i),this.t=n}}for(const l in e)t.prototype[l]=e[l];return t.t=n,t}const wv=Ru("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Sv=Ru("text"),U4=Ru("nl"),bd=Ru("url",{isLink:!0,toHref(n=Xo.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){const n=this.tk;return n.length>=2&&n[0].t!==Yo&&n[1].t===Br}}),rl=n=>new Ds(n);function V4({groups:n}){const e=n.domain.concat([lu,au,zr,iu,ou,cu,du,uu,al,Gm,Lo,fu,hu,pu,El,gu,Bo,mu]),t=[ru,Br,Xm,Cl,Jm,Lo,_o,Qm,Zm,Yd,Xd,Io,zo,Fd,qd,Kd,Gd,Jd,Qd,Zd,Wd,eu,tu,nu,su],l=[lu,ru,au,iu,ou,cu,du,uu,al,Io,zo,Lo,fu,hu,pu,_o,El,gu,Bo,mu],a=rl(),i=Pe(a,Bo);Ct(i,l,i),Ct(i,n.domain,i);const d=rl(),u=rl(),h=rl();Ct(a,n.domain,d),Ct(a,n.scheme,u),Ct(a,n.slashscheme,h),Ct(d,l,i),Ct(d,n.domain,d);const p=Pe(d,zr);Pe(i,zr,p),Pe(u,zr,p),Pe(h,zr,p);const g=Pe(i,Cl);Ct(g,l,i),Ct(g,n.domain,i);const b=rl();Ct(p,n.domain,b),Ct(b,n.domain,b);const y=Pe(b,Cl);Ct(y,n.domain,b);const v=rl(wv);Ct(y,n.tld,v),Ct(y,n.utld,v),Pe(p,Yo,v);const N=Pe(b,al);Pe(N,al,N),Ct(N,n.domain,b),Ct(v,n.domain,b),Pe(v,Cl,y),Pe(v,al,N);const S=Pe(v,Br);Ct(S,n.numeric,wv);const j=Pe(d,al),E=Pe(d,Cl);Pe(j,al,j),Ct(j,n.domain,d),Ct(E,l,i),Ct(E,n.domain,d);const D=rl(bd);Ct(E,n.tld,D),Ct(E,n.utld,D),Ct(D,n.domain,d),Ct(D,l,i),Pe(D,Cl,E),Pe(D,al,j),Pe(D,zr,p);const _=Pe(D,Br),H=rl(bd);Ct(_,n.numeric,H);const L=rl(bd),V=rl();Ct(L,e,L),Ct(L,t,V),Ct(V,e,L),Ct(V,t,V),Pe(D,El,L),Pe(H,El,L);const G=Pe(u,Br),X=Pe(h,Br),$=Pe(X,El),R=Pe($,El);Ct(u,n.domain,d),Pe(u,Cl,E),Pe(u,al,j),Ct(h,n.domain,d),Pe(h,Cl,E),Pe(h,al,j),Ct(G,n.domain,L),Pe(G,El,L),Pe(G,_o,L),Ct(R,n.domain,L),Ct(R,e,L),Pe(R,El,L);const A=[[Io,zo],[qd,Fd],[Kd,Gd],[Yd,Xd],[Jd,Qd],[Zd,Wd],[eu,tu],[nu,su]];for(let B=0;B<A.length;B++){const[Y,J]=A[B],de=Pe(L,Y);Pe(V,Y,de),Pe(de,J,L);const w=rl(bd);Ct(de,e,w);const T=rl();Ct(de,t),Ct(w,e,w),Ct(w,t,T),Ct(T,e,w),Ct(T,t,T),Pe(w,J,L),Pe(T,J,L)}return Pe(a,Yo,D),Pe(a,Ym,U4),{start:a,tokens:E2}}function q4(n,e,t){let l=t.length,a=0,i=[],d=[];for(;a<l;){let u=n,h=null,p=null,g=0,b=null,y=-1;for(;a<l&&!(h=u.go(t[a].t));)d.push(t[a++]);for(;a<l&&(p=h||u.go(t[a].t));)h=null,u=p,u.accepts()?(y=0,b=u):y>=0&&y++,a++,g++;if(y<0)a-=g,a<l&&(d.push(t[a]),a++);else{d.length>0&&(i.push(gp(Sv,e,d)),d=[]),a-=y,g-=y;const v=b.t,N=t.slice(a-g,a);i.push(gp(v,e,N))}}return d.length>0&&i.push(gp(Sv,e,d)),i}function gp(n,e,t){const l=t[0].s,a=t[t.length-1].e,i=e.slice(l,a);return new n(i,t)}const F4=typeof console<"u"&&console&&console.warn||(()=>{}),K4="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",un={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function G4(){return Ds.groups={},un.scanner=null,un.parser=null,un.tokenQueue=[],un.pluginQueue=[],un.customSchemes=[],un.initialized=!1,un}function jv(n,e=!1){if(un.initialized&&F4(`linkifyjs: already initialized - will not register custom scheme "${n}" ${K4}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(n))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);un.customSchemes.push([n,e])}function Y4(){un.scanner=H4(un.customSchemes);for(let n=0;n<un.tokenQueue.length;n++)un.tokenQueue[n][1]({scanner:un.scanner});un.parser=V4(un.scanner.tokens);for(let n=0;n<un.pluginQueue.length;n++)un.pluginQueue[n][1]({scanner:un.scanner,parser:un.parser});return un.initialized=!0,un}function e0(n){return un.initialized||Y4(),q4(un.parser.start,n,M2(un.scanner.start,n))}e0.scan=M2;function T2(n,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const l=new Wm(t),a=e0(n),i=[];for(let d=0;d<a.length;d++){const u=a[d];u.isLink&&(!e||u.t===e)&&l.check(u)&&i.push(u.toFormattedObject(l))}return i}var t0="[\0- -\u2029]",X4=new RegExp(t0),J4=new RegExp(`${t0}$`),Q4=new RegExp(t0,"g");function Z4(n){return n.length===1?n[0].isLink:n.length===3&&n[1].isLink?["()","[]"].includes(n[0].value+n[2].value):!1}function W4(n){return new gn({key:new Vn("autolink"),appendTransaction:(e,t,l)=>{const a=e.some(p=>p.docChanged)&&!t.doc.eq(l.doc),i=e.some(p=>p.getMeta("preventAutolink"));if(!a||i)return;const{tr:d}=l,u=YN(t.doc,[...e]);if(t2(u).forEach(({newRange:p})=>{const g=tT(l.doc,p,v=>v.isTextblock);let b,y;if(g.length>1)b=g[0],y=l.doc.textBetween(b.pos,b.pos+b.node.nodeSize,void 0," ");else if(g.length){const v=l.doc.textBetween(p.from,p.to," "," ");if(!J4.test(v))return;b=g[0],y=l.doc.textBetween(b.pos,p.to,void 0," ")}if(b&&y){const v=y.split(X4).filter(Boolean);if(v.length<=0)return!1;const N=v[v.length-1],S=b.pos+y.lastIndexOf(N);if(!N)return!1;const j=e0(N).map(E=>E.toObject(n.defaultProtocol));if(!Z4(j))return!1;j.filter(E=>E.isLink).map(E=>({...E,from:S+E.start+1,to:S+E.end+1})).filter(E=>l.schema.marks.code?!l.doc.rangeHasMark(E.from,E.to,l.schema.marks.code):!0).filter(E=>n.validate(E.value)).filter(E=>n.shouldAutoLink(E.value)).forEach(E=>{Um(E.from,E.to,l.doc).some(D=>D.mark.type===n.type)||d.addMark(E.from,E.to,n.type.create({href:E.href}))})}}),!!d.steps.length)return d}})}function eD(n){return new gn({key:new Vn("handleClickLink"),props:{handleClick:(e,t,l)=>{var a,i;if(l.button!==0||!e.editable)return!1;let d=!1;if(n.enableClickSelection&&(d=n.editor.commands.extendMarkRange(n.type.name)),n.openOnClick){let u=null;if(l.target instanceof HTMLAnchorElement)u=l.target;else{let b=l.target;const y=[];for(;b.nodeName!=="DIV";)y.push(b),b=b.parentNode;u=y.find(v=>v.nodeName==="A")}if(!u)return d;const h=e2(e.state,n.type.name),p=(a=u?.href)!=null?a:h.href,g=(i=u?.target)!=null?i:h.target;u&&p&&(window.open(p,g),d=!0)}return d}}})}function tD(n){return new gn({key:new Vn("handlePasteLink"),props:{handlePaste:(e,t,l)=>{const{shouldAutoLink:a}=n,{state:i}=e,{selection:d}=i,{empty:u}=d;if(u)return!1;let h="";l.content.forEach(g=>{h+=g.textContent});const p=T2(h,{defaultProtocol:n.defaultProtocol}).find(g=>g.isLink&&g.value===h);return!h||!p||a!==void 0&&!a(p.href)?!1:n.editor.commands.setMark(n.type,{href:p.href})}}})}function ga(n,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(l=>{const a=typeof l=="string"?l:l.scheme;a&&t.push(a)}),!n||n.replace(Q4,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var nD=Ra.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(n=>{if(typeof n=="string"){jv(n);return}jv(n.scheme,n.optionalSlashes)})},onDestroy(){G4()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(n,e)=>!!ga(n,e.protocols),validate:n=>!!n,shouldAutoLink:n=>!!n}},addAttributes(){return{href:{default:null,parseHTML(n){return n.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:n=>{const e=n.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!ga(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:n}){return this.options.isAllowedUri(n.href,{defaultValidate:e=>!!ga(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Hn(this.options.HTMLAttributes,n),0]:["a",Hn(this.options.HTMLAttributes,{...n,href:""}),0]},markdownTokenName:"link",parseMarkdown:(n,e)=>e.applyMark("link",e.parseInline(n.tokens||[]),{href:n.href,title:n.title||null}),renderMarkdown:(n,e)=>{var t;const l=((t=n.attrs)==null?void 0:t.href)||"";return`[${e.renderChildren(n)}](${l})`},addCommands(){return{setLink:n=>({chain:e})=>{const{href:t}=n;return this.options.isAllowedUri(t,{defaultValidate:l=>!!ga(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,n).setMeta("preventAutolink",!0).run():!1},toggleLink:n=>({chain:e})=>{const{href:t}=n||{};return t&&!this.options.isAllowedUri(t,{defaultValidate:l=>!!ga(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,n,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:n})=>n().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Da({find:n=>{const e=[];if(n){const{protocols:t,defaultProtocol:l}=this.options,a=T2(n).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:d=>!!ga(d,t),protocols:t,defaultProtocol:l}));a.length&&a.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:n=>{var e;return{href:(e=n.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const n=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&n.push(W4({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:l=>this.options.isAllowedUri(l,{defaultValidate:a=>!!ga(a,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),n.push(eD({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&n.push(tD({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),n}}),sD=Object.defineProperty,lD=(n,e)=>{for(var t in e)sD(n,t,{get:e[t],enumerable:!0})},rD="listItem",Cv="textStyle",Ev=/^\s*([-+*])\s$/,D2=Ks.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",Hn(this.options.HTMLAttributes,n),0]},markdownTokenName:"list",parseMarkdown:(n,e)=>n.type!=="list"||n.ordered?[]:{type:"bulletList",content:n.items?e.parseChildren(n.items):[]},renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(rD,this.editor.getAttributes(Cv)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=Mi({find:Ev,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Mi({find:Ev,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Cv),editor:this.editor})),[n]}}),O2=Ks.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",Hn(this.options.HTMLAttributes,n),0]},markdownTokenName:"list_item",parseMarkdown:(n,e)=>{if(n.type!=="list_item")return[];let t=[];if(n.tokens&&n.tokens.length>0)if(n.tokens.some(a=>a.type==="paragraph"))t=e.parseChildren(n.tokens);else{const a=n.tokens[0];if(a&&a.type==="text"&&a.tokens&&a.tokens.length>0){if(t=[{type:"paragraph",content:e.parseInline(a.tokens)}],n.tokens.length>1){const d=n.tokens.slice(1),u=e.parseChildren(d);t.push(...u)}}else t=e.parseChildren(n.tokens)}return t.length===0&&(t=[{type:"paragraph",content:[]}]),{type:"listItem",content:t}},renderMarkdown:(n,e,t)=>Km(n,e,l=>l.parentType==="bulletList"?"- ":l.parentType==="orderedList"?`${l.index+1}. `:"- ",t),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),aD={};lD(aD,{findListItemPos:()=>ec,getNextListDepth:()=>n0,handleBackspace:()=>im,handleDelete:()=>om,hasListBefore:()=>R2,hasListItemAfter:()=>iD,hasListItemBefore:()=>I2,listItemHasSubList:()=>z2,nextListIsDeeper:()=>L2,nextListIsHigher:()=>_2});var ec=(n,e)=>{const{$from:t}=e.selection,l=Pn(n,e.schema);let a=null,i=t.depth,d=t.pos,u=null;for(;i>0&&u===null;)a=t.node(i),a.type===l?u=i:(i-=1,d-=1);return u===null?null:{$pos:e.doc.resolve(d),depth:u}},n0=(n,e)=>{const t=ec(n,e);if(!t)return!1;const[,l]=uT(e,n,t.$pos.pos+4);return l},R2=(n,e,t)=>{const{$anchor:l}=n.selection,a=Math.max(0,l.pos-2),i=n.doc.resolve(a).node();return!(!i||!t.includes(i.type.name))},I2=(n,e)=>{var t;const{$anchor:l}=e.selection,a=e.doc.resolve(l.pos-2);return!(a.index()===0||((t=a.nodeBefore)==null?void 0:t.type.name)!==n)},z2=(n,e,t)=>{if(!t)return!1;const l=Pn(n,e.schema);let a=!1;return t.descendants(i=>{i.type===l&&(a=!0)}),a},im=(n,e,t)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!Gr(n.state,e)&&R2(n.state,e,t)){const{$anchor:u}=n.state.selection,h=n.state.doc.resolve(u.before()-1),p=[];h.node().descendants((y,v)=>{y.type.name===e&&p.push({node:y,pos:v})});const g=p.at(-1);if(!g)return!1;const b=n.state.doc.resolve(h.start()+g.pos+1);return n.chain().cut({from:u.start()-1,to:u.end()+1},b.end()).joinForward().run()}if(!Gr(n.state,e)||!mT(n.state))return!1;const l=ec(e,n.state);if(!l)return!1;const i=n.state.doc.resolve(l.$pos.pos-2).node(l.depth),d=z2(e,n.state,i);return I2(e,n.state)&&!d?n.commands.joinItemBackward():n.chain().liftListItem(e).run()},L2=(n,e)=>{const t=n0(n,e),l=ec(n,e);return!l||!t?!1:t>l.depth},_2=(n,e)=>{const t=n0(n,e),l=ec(n,e);return!l||!t?!1:t<l.depth},om=(n,e)=>{if(!Gr(n.state,e)||!pT(n.state,e))return!1;const{selection:t}=n.state,{$from:l,$to:a}=t;return!t.empty&&l.sameParent(a)?!1:L2(e,n.state)?n.chain().focus(n.state.selection.from+4).lift(e).joinBackward().run():_2(e,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},iD=(n,e)=>{var t;const{$anchor:l}=e.selection,a=e.doc.resolve(l.pos-l.parentOffset-2);return!(a.index()===a.parent.childCount-1||((t=a.nodeAfter)==null?void 0:t.type.name)!==n)},B2=Dn.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{n.state.schema.nodes[t]!==void 0&&om(n,t)&&(e=!0)}),e},"Mod-Delete":({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{n.state.schema.nodes[t]!==void 0&&om(n,t)&&(e=!0)}),e},Backspace:({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:l})=>{n.state.schema.nodes[t]!==void 0&&im(n,t,l)&&(e=!0)}),e},"Mod-Backspace":({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:l})=>{n.state.schema.nodes[t]!==void 0&&im(n,t,l)&&(e=!0)}),e}}}}),Mv=/^(\s*)(\d+)\.\s+(.*)$/,oD=/^\s/;function cD(n){const e=[];let t=0,l=0;for(;t<n.length;){const a=n[t],i=a.match(Mv);if(!i)break;const[,d,u,h]=i,p=d.length;let g=h,b=t+1;const y=[a];for(;b<n.length;){const v=n[b];if(v.match(Mv))break;if(v.trim()==="")y.push(v),g+=`
`,b+=1;else if(v.match(oD))y.push(v),g+=`
${v.slice(p+2)}`,b+=1;else break}e.push({indent:p,number:parseInt(u,10),content:g.trim(),raw:y.join(`
`)}),l=b,t=b}return[e,l]}function P2(n,e,t){var l;const a=[];let i=0;for(;i<n.length;){const d=n[i];if(d.indent===e){const u=d.content.split(`
`),h=((l=u[0])==null?void 0:l.trim())||"",p=[];h&&p.push({type:"paragraph",raw:h,tokens:t.inlineTokens(h)});const g=u.slice(1).join(`
`).trim();if(g){const v=t.blockTokens(g);p.push(...v)}let b=i+1;const y=[];for(;b<n.length&&n[b].indent>e;)y.push(n[b]),b+=1;if(y.length>0){const v=Math.min(...y.map(S=>S.indent)),N=P2(y,v,t);p.push({type:"list",ordered:!0,start:y[0].number,items:N,raw:y.map(S=>S.raw).join(`
`)})}a.push({type:"list_item",raw:d.raw,tokens:p}),i=b}else i+=1}return a}function dD(n,e){return n.map(t=>{if(t.type!=="list_item")return e.parseChildren([t])[0];const l=[];return t.tokens&&t.tokens.length>0&&t.tokens.forEach(a=>{if(a.type==="paragraph"||a.type==="list"||a.type==="blockquote"||a.type==="code")l.push(...e.parseChildren([a]));else if(a.type==="text"&&a.tokens){const i=e.parseChildren([a]);l.push({type:"paragraph",content:i})}else{const i=e.parseChildren([a]);i.length>0&&l.push(...i)}}),{type:"listItem",content:l}})}var uD="listItem",Av="textStyle",Tv=/^(\d+)\.\s$/,H2=Ks.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",Hn(this.options.HTMLAttributes,t),0]:["ol",Hn(this.options.HTMLAttributes,n),0]},markdownTokenName:"list",parseMarkdown:(n,e)=>{if(n.type!=="list"||!n.ordered)return[];const t=n.start||1,l=n.items?dD(n.items,e):[];return t!==1?{type:"orderedList",attrs:{start:t},content:l}:{type:"orderedList",content:l}},renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:n=>{const e=n.match(/^(\s*)(\d+)\.\s+/),t=e?.index;return t!==void 0?t:-1},tokenize:(n,e,t)=>{var l;const a=n.split(`
`),[i,d]=cD(a);if(i.length===0)return;const u=P2(i,0,t);return u.length===0?void 0:{type:"list",ordered:!0,start:((l=i[0])==null?void 0:l.number)||1,items:u,raw:a.slice(0,d).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(uD,this.editor.getAttributes(Av)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=Mi({find:Tv,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Mi({find:Tv,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Av)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),fD=/^\s*(\[([( |x])?\])\s$/,hD=Ks.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const e=n.getAttribute("data-checked");return e===""||e==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:e}){return["li",Hn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(n,e)=>{const t=[];if(n.tokens&&n.tokens.length>0?t.push(e.createNode("paragraph",{},e.parseInline(n.tokens))):n.text?t.push(e.createNode("paragraph",{},[e.createNode("text",{text:n.text})])):t.push(e.createNode("paragraph",{},[])),n.nestedTokens&&n.nestedTokens.length>0){const l=e.parseChildren(n.nestedTokens);t.push(...l)}return e.createNode("taskItem",{checked:n.checked||!1},t)},renderMarkdown:(n,e)=>{var t;const a=`- [${(t=n.attrs)!=null&&t.checked?"x":" "}] `;return Km(n,e,a)},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:e,getPos:t,editor:l})=>{const a=document.createElement("li"),i=document.createElement("label"),d=document.createElement("span"),u=document.createElement("input"),h=document.createElement("div"),p=g=>{var b,y;u.ariaLabel=((y=(b=this.options.a11y)==null?void 0:b.checkboxLabel)==null?void 0:y.call(b,g,u.checked))||`Task item checkbox for ${g.textContent||"empty task item"}`};return p(n),i.contentEditable="false",u.type="checkbox",u.addEventListener("mousedown",g=>g.preventDefault()),u.addEventListener("change",g=>{if(!l.isEditable&&!this.options.onReadOnlyChecked){u.checked=!u.checked;return}const{checked:b}=g.target;l.isEditable&&typeof t=="function"&&l.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:y})=>{const v=t();if(typeof v!="number")return!1;const N=y.doc.nodeAt(v);return y.setNodeMarkup(v,void 0,{...N?.attrs,checked:b}),!0}).run(),!l.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,b)||(u.checked=!u.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([g,b])=>{a.setAttribute(g,b)}),a.dataset.checked=n.attrs.checked,u.checked=n.attrs.checked,i.append(u,d),a.append(i,h),Object.entries(e).forEach(([g,b])=>{a.setAttribute(g,b)}),{dom:a,contentDOM:h,update:g=>g.type!==this.type?!1:(a.dataset.checked=g.attrs.checked,u.checked=g.attrs.checked,p(g),!0)}}},addInputRules(){return[Mi({find:fD,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),pD=Ks.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",Hn(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},parseMarkdown:(n,e)=>e.createNode("taskList",{},e.parseChildren(n.items||[])),renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(n){var e;const t=(e=n.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return t!==void 0?t:-1},tokenize(n,e,t){const l=i=>{const d=Qp(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:u=>({indentLevel:u[1].length,mainContent:u[4],checked:u[3].toLowerCase()==="x"}),createToken:(u,h)=>({type:"taskItem",raw:"",mainContent:u.mainContent,indentLevel:u.indentLevel,checked:u.checked,text:u.mainContent,tokens:t.inlineTokens(u.mainContent),nestedTokens:h}),customNestedParser:l},t);return d?[{type:"taskList",raw:d.raw,items:d.items}]:t.blockTokens(i)},a=Qp(n,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,d)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:t.inlineTokens(i.mainContent),nestedTokens:d}),customNestedParser:l},t);if(a)return{type:"taskList",raw:a.raw,items:a.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Dn.create({name:"listKit",addExtensions(){const n=[];return this.options.bulletList!==!1&&n.push(D2.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(O2.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(B2.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(H2.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(hD.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(pD.configure(this.options.taskList)),n}});var mD=Ks.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",Hn(this.options.HTMLAttributes,n),0]},parseMarkdown:(n,e)=>{const t=n.tokens||[];return t.length===1&&t[0].type==="image"?e.parseChildren([t[0]]):e.createNode("paragraph",void 0,e.parseInline(t))},renderMarkdown:(n,e)=>!n||!Array.isArray(n.content)?"":e.renderChildren(n.content),addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),gD=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,xD=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,bD=Ra.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",Hn(this.options.HTMLAttributes,n),0]},markdownTokenName:"del",parseMarkdown:(n,e)=>e.applyMark("strike",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`~~${e.renderChildren(n)}~~`,addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ei({find:gD,type:this.type})]},addPasteRules(){return[Da({find:xD,type:this.type})]}}),yD=Ks.create({name:"text",group:"inline",parseMarkdown:n=>({type:"text",text:n.text||""}),renderMarkdown:n=>n.text||""}),vD=Ra.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",Hn(this.options.HTMLAttributes,n),0]},parseMarkdown(n,e){return e.applyMark(this.name||"underline",e.parseInline(n.tokens||[]))},renderMarkdown(n,e){return`++${e.renderChildren(n)}++`},markdownTokenizer:{name:"underline",level:"inline",start(n){return n.indexOf("++")},tokenize(n,e,t){const a=/^(\+\+)([\s\S]+?)(\+\+)/.exec(n);if(!a)return;const i=a[2].trim();return{type:"underline",raw:a[0],text:i,tokens:t.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function ND(n={}){return new gn({view(e){return new kD(e,n)}})}class kD{constructor(e,t){var l;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(l=t.width)!==null&&l!==void 0?l:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(a=>{let i=d=>{this[a](d)};return e.dom.addEventListener(a,i),{name:a,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,l,a=this.editorView.dom,i=a.getBoundingClientRect(),d=i.width/a.offsetWidth,u=i.height/a.offsetHeight;if(t){let b=e.nodeBefore,y=e.nodeAfter;if(b||y){let v=this.editorView.nodeDOM(this.cursorPos-(b?b.nodeSize:0));if(v){let N=v.getBoundingClientRect(),S=b?N.bottom:N.top;b&&y&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let j=this.width/2*u;l={left:N.left,right:N.right,top:S-j,bottom:S+j}}}}if(!l){let b=this.editorView.coordsAtPos(this.cursorPos),y=this.width/2*d;l={left:b.left-y,right:b.left+y,top:b.top,bottom:b.bottom}}let h=this.editorView.dom.offsetParent;this.element||(this.element=h.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let p,g;if(!h||h==document.body&&getComputedStyle(h).position=="static")p=-pageXOffset,g=-pageYOffset;else{let b=h.getBoundingClientRect(),y=b.width/h.offsetWidth,v=b.height/h.offsetHeight;p=b.left-h.scrollLeft*y,g=b.top-h.scrollTop*v}this.element.style.left=(l.left-p)/d+"px",this.element.style.top=(l.top-g)/u+"px",this.element.style.width=(l.right-l.left)/d+"px",this.element.style.height=(l.bottom-l.top)/u+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),l=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),a=l&&l.type.spec.disableDropCursor,i=typeof a=="function"?a(this.editorView,t,e):a;if(t&&!i){let d=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let u=P1(this.editorView.state.doc,d,this.editorView.dragging.slice);u!=null&&(d=u)}this.setCursor(d),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class jn extends Et{constructor(e){super(e,e)}map(e,t){let l=e.resolve(t.map(this.head));return jn.valid(l)?new jn(l):Et.near(l)}content(){return Ze.empty}eq(e){return e instanceof jn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new jn(e.resolve(t.pos))}getBookmark(){return new s0(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!wD(e)||!SD(e))return!1;let l=t.type.spec.allowGapCursor;if(l!=null)return l;let a=t.contentMatchAt(e.index()).defaultType;return a&&a.isTextblock}static findGapCursorFrom(e,t,l=!1){e:for(;;){if(!l&&jn.valid(e))return e;let a=e.pos,i=null;for(let d=e.depth;;d--){let u=e.node(d);if(t>0?e.indexAfter(d)<u.childCount:e.index(d)>0){i=u.child(t>0?e.indexAfter(d):e.index(d)-1);break}else if(d==0)return null;a+=t;let h=e.doc.resolve(a);if(jn.valid(h))return h}for(;;){let d=t>0?i.firstChild:i.lastChild;if(!d){if(i.isAtom&&!i.isText&&!ct.isSelectable(i)){e=e.doc.resolve(a+i.nodeSize*t),l=!1;continue e}break}i=d,a+=t;let u=e.doc.resolve(a);if(jn.valid(u))return u}return null}}}jn.prototype.visible=!1;jn.findFrom=jn.findGapCursorFrom;Et.jsonID("gapcursor",jn);class s0{constructor(e){this.pos=e}map(e){return new s0(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return jn.valid(t)?new jn(t):Et.near(t)}}function $2(n){return n.isAtom||n.spec.isolating||n.spec.createGapCursor}function wD(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),l=n.node(e);if(t==0){if(l.type.spec.isolating)return!0;continue}for(let a=l.child(t-1);;a=a.lastChild){if(a.childCount==0&&!a.inlineContent||$2(a.type))return!0;if(a.inlineContent)return!1}}return!0}function SD(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),l=n.node(e);if(t==l.childCount){if(l.type.spec.isolating)return!0;continue}for(let a=l.child(t);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||$2(a.type))return!0;if(a.inlineContent)return!1}}return!0}function jD(){return new gn({props:{decorations:AD,createSelectionBetween(n,e,t){return e.pos==t.pos&&jn.valid(t)?new jn(t):null},handleClick:ED,handleKeyDown:CD,handleDOMEvents:{beforeinput:MD}}})}const CD=HN({ArrowLeft:yd("horiz",-1),ArrowRight:yd("horiz",1),ArrowUp:yd("vert",-1),ArrowDown:yd("vert",1)});function yd(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(l,a,i){let d=l.selection,u=e>0?d.$to:d.$from,h=d.empty;if(d instanceof gt){if(!i.endOfTextblock(t)||u.depth==0)return!1;h=!1,u=l.doc.resolve(e>0?u.after():u.before())}let p=jn.findGapCursorFrom(u,e,h);return p?(a&&a(l.tr.setSelection(new jn(p))),!0):!1}}function ED(n,e,t){if(!n||!n.editable)return!1;let l=n.state.doc.resolve(e);if(!jn.valid(l))return!1;let a=n.posAtCoords({left:t.clientX,top:t.clientY});return a&&a.inside>-1&&ct.isSelectable(n.state.doc.nodeAt(a.inside))?!1:(n.dispatch(n.state.tr.setSelection(new jn(l))),!0)}function MD(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof jn))return!1;let{$from:t}=n.state.selection,l=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!l)return!1;let a=_e.empty;for(let d=l.length-1;d>=0;d--)a=_e.from(l[d].createAndFill(null,a));let i=n.state.tr.replace(t.pos,t.pos,new Ze(a,0,0));return i.setSelection(gt.near(i.doc.resolve(t.pos+1))),n.dispatch(i),!1}function AD(n){if(!(n.selection instanceof jn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",mn.create(n.doc,[vs.widget(n.selection.head,e,{key:"gapcursor"})])}var xu=200,Xn=function(){};Xn.prototype.append=function(e){return e.length?(e=Xn.from(e),!this.length&&e||e.length<xu&&this.leafAppend(e)||this.length<xu&&e.leafPrepend(this)||this.appendInner(e)):this};Xn.prototype.prepend=function(e){return e.length?Xn.from(e).append(this):this};Xn.prototype.appendInner=function(e){return new TD(this,e)};Xn.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Xn.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Xn.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Xn.prototype.forEach=function(e,t,l){t===void 0&&(t=0),l===void 0&&(l=this.length),t<=l?this.forEachInner(e,t,l,0):this.forEachInvertedInner(e,t,l,0)};Xn.prototype.map=function(e,t,l){t===void 0&&(t=0),l===void 0&&(l=this.length);var a=[];return this.forEach(function(i,d){return a.push(e(i,d))},t,l),a};Xn.from=function(e){return e instanceof Xn?e:e&&e.length?new U2(e):Xn.empty};var U2=(function(n){function e(l){n.call(this),this.values=l}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(a,i){return a==0&&i==this.length?this:new e(this.values.slice(a,i))},e.prototype.getInner=function(a){return this.values[a]},e.prototype.forEachInner=function(a,i,d,u){for(var h=i;h<d;h++)if(a(this.values[h],u+h)===!1)return!1},e.prototype.forEachInvertedInner=function(a,i,d,u){for(var h=i-1;h>=d;h--)if(a(this.values[h],u+h)===!1)return!1},e.prototype.leafAppend=function(a){if(this.length+a.length<=xu)return new e(this.values.concat(a.flatten()))},e.prototype.leafPrepend=function(a){if(this.length+a.length<=xu)return new e(a.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(Xn);Xn.empty=new U2([]);var TD=(function(n){function e(t,l){n.call(this),this.left=t,this.right=l,this.length=t.length+l.length,this.depth=Math.max(t.depth,l.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(l){return l<this.left.length?this.left.get(l):this.right.get(l-this.left.length)},e.prototype.forEachInner=function(l,a,i,d){var u=this.left.length;if(a<u&&this.left.forEachInner(l,a,Math.min(i,u),d)===!1||i>u&&this.right.forEachInner(l,Math.max(a-u,0),Math.min(this.length,i)-u,d+u)===!1)return!1},e.prototype.forEachInvertedInner=function(l,a,i,d){var u=this.left.length;if(a>u&&this.right.forEachInvertedInner(l,a-u,Math.max(i,u)-u,d+u)===!1||i<u&&this.left.forEachInvertedInner(l,Math.min(a,u),i,d)===!1)return!1},e.prototype.sliceInner=function(l,a){if(l==0&&a==this.length)return this;var i=this.left.length;return a<=i?this.left.slice(l,a):l>=i?this.right.slice(l-i,a-i):this.left.slice(l,i).append(this.right.slice(0,a-i))},e.prototype.leafAppend=function(l){var a=this.right.leafAppend(l);if(a)return new e(this.left,a)},e.prototype.leafPrepend=function(l){var a=this.left.leafPrepend(l);if(a)return new e(a,this.right)},e.prototype.appendInner=function(l){return this.left.depth>=Math.max(this.right.depth,l.depth)+1?new e(this.left,new e(this.right,l)):new e(this,l)},e})(Xn);const DD=500;class xl{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let l=this.items.length;for(;;l--)if(this.items.get(l-1).selection){--l;break}let a,i;t&&(a=this.remapping(l,this.items.length),i=a.maps.length);let d=e.tr,u,h,p=[],g=[];return this.items.forEach((b,y)=>{if(!b.step){a||(a=this.remapping(l,y+1),i=a.maps.length),i--,g.push(b);return}if(a){g.push(new Ml(b.map));let v=b.step.map(a.slice(i)),N;v&&d.maybeStep(v).doc&&(N=d.mapping.maps[d.mapping.maps.length-1],p.push(new Ml(N,void 0,void 0,p.length+g.length))),i--,N&&a.appendMap(N,i)}else d.maybeStep(b.step);if(b.selection)return u=a?b.selection.map(a.slice(i)):b.selection,h=new xl(this.items.slice(0,l).append(g.reverse().concat(p)),this.eventCount-1),!1},this.items.length,0),{remaining:h,transform:d,selection:u}}addTransform(e,t,l,a){let i=[],d=this.eventCount,u=this.items,h=!a&&u.length?u.get(u.length-1):null;for(let g=0;g<e.steps.length;g++){let b=e.steps[g].invert(e.docs[g]),y=new Ml(e.mapping.maps[g],b,t),v;(v=h&&h.merge(y))&&(y=v,g?i.pop():u=u.slice(0,u.length-1)),i.push(y),t&&(d++,t=void 0),a||(h=y)}let p=d-l.depth;return p>RD&&(u=OD(u,p),d-=p),new xl(u.append(i),d)}remapping(e,t){let l=new Uo;return this.items.forEach((a,i)=>{let d=a.mirrorOffset!=null&&i-a.mirrorOffset>=e?l.maps.length-a.mirrorOffset:void 0;l.appendMap(a.map,d)},e,t),l}addMaps(e){return this.eventCount==0?this:new xl(this.items.append(e.map(t=>new Ml(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let l=[],a=Math.max(0,this.items.length-t),i=e.mapping,d=e.steps.length,u=this.eventCount;this.items.forEach(y=>{y.selection&&u--},a);let h=t;this.items.forEach(y=>{let v=i.getMirror(--h);if(v==null)return;d=Math.min(d,v);let N=i.maps[v];if(y.step){let S=e.steps[v].invert(e.docs[v]),j=y.selection&&y.selection.map(i.slice(h+1,v));j&&u++,l.push(new Ml(N,S,j))}else l.push(new Ml(N))},a);let p=[];for(let y=t;y<d;y++)p.push(new Ml(i.maps[y]));let g=this.items.slice(0,a).append(p).append(l),b=new xl(g,u);return b.emptyItemCount()>DD&&(b=b.compress(this.items.length-l.length)),b}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),l=t.maps.length,a=[],i=0;return this.items.forEach((d,u)=>{if(u>=e)a.push(d),d.selection&&i++;else if(d.step){let h=d.step.map(t.slice(l)),p=h&&h.getMap();if(l--,p&&t.appendMap(p,l),h){let g=d.selection&&d.selection.map(t.slice(l));g&&i++;let b=new Ml(p.invert(),h,g),y,v=a.length-1;(y=a.length&&a[v].merge(b))?a[v]=y:a.push(b)}}else d.map&&l--},this.items.length,0),new xl(Xn.from(a.reverse()),i)}}xl.empty=new xl(Xn.empty,0);function OD(n,e){let t;return n.forEach((l,a)=>{if(l.selection&&e--==0)return t=a,!1}),n.slice(t)}class Ml{constructor(e,t,l,a){this.map=e,this.step=t,this.selection=l,this.mirrorOffset=a}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Ml(t.getMap().invert(),t,this.selection)}}}class Lr{constructor(e,t,l,a,i){this.done=e,this.undone=t,this.prevRanges=l,this.prevTime=a,this.prevComposition=i}}const RD=20;function ID(n,e,t,l){let a=t.getMeta(Ca),i;if(a)return a.historyState;t.getMeta(_D)&&(n=new Lr(n.done,n.undone,null,0,-1));let d=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(d&&d.getMeta(Ca))return d.getMeta(Ca).redo?new Lr(n.done.addTransform(t,void 0,l,jd(e)),n.undone,Dv(t.mapping.maps),n.prevTime,n.prevComposition):new Lr(n.done,n.undone.addTransform(t,void 0,l,jd(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(d&&d.getMeta("addToHistory")===!1)){let u=t.getMeta("composition"),h=n.prevTime==0||!d&&n.prevComposition!=u&&(n.prevTime<(t.time||0)-l.newGroupDelay||!zD(t,n.prevRanges)),p=d?xp(n.prevRanges,t.mapping):Dv(t.mapping.maps);return new Lr(n.done.addTransform(t,h?e.selection.getBookmark():void 0,l,jd(e)),xl.empty,p,t.time,u??n.prevComposition)}else return(i=t.getMeta("rebased"))?new Lr(n.done.rebased(t,i),n.undone.rebased(t,i),xp(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new Lr(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),xp(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function zD(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((l,a)=>{for(let i=0;i<e.length;i+=2)l<=e[i+1]&&a>=e[i]&&(t=!0)}),t}function Dv(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((l,a,i,d)=>e.push(i,d));return e}function xp(n,e){if(!n)return null;let t=[];for(let l=0;l<n.length;l+=2){let a=e.map(n[l],1),i=e.map(n[l+1],-1);a<=i&&t.push(a,i)}return t}function LD(n,e,t){let l=jd(e),a=Ca.get(e).spec.config,i=(t?n.undone:n.done).popEvent(e,l);if(!i)return null;let d=i.selection.resolve(i.transform.doc),u=(t?n.done:n.undone).addTransform(i.transform,e.selection.getBookmark(),a,l),h=new Lr(t?u:i.remaining,t?i.remaining:u,null,0,-1);return i.transform.setSelection(d).setMeta(Ca,{redo:t,historyState:h})}let bp=!1,Ov=null;function jd(n){let e=n.plugins;if(Ov!=e){bp=!1,Ov=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){bp=!0;break}}return bp}const Ca=new Vn("history"),_D=new Vn("closeHistory");function BD(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new gn({key:Ca,state:{init(){return new Lr(xl.empty,xl.empty,null,0,-1)},apply(e,t,l){return ID(t,l,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let l=t.inputType,a=l=="historyUndo"?q2:l=="historyRedo"?F2:null;return!a||!e.editable?!1:(t.preventDefault(),a(e.state,e.dispatch))}}}})}function V2(n,e){return(t,l)=>{let a=Ca.getState(t);if(!a||(n?a.undone:a.done).eventCount==0)return!1;if(l){let i=LD(a,t,n);i&&l(e?i.scrollIntoView():i)}return!0}}const q2=V2(!1,!0),F2=V2(!0,!0);Dn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const e=n?.node||this.editor.state.doc;if((n?.mode||this.options.mode)==="textSize"){const l=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(l)}return e.nodeSize},this.storage.words=n=>{const e=n?.node||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let n=!1;return[new gn({key:new Vn("characterCount"),appendTransaction:(e,t,l)=>{if(n)return;const a=this.options.limit;if(a==null||a===0){n=!0;return}const i=this.storage.characters({node:l.doc});if(i>a){const d=i-a,u=0,h=d;console.warn(`[CharacterCount] Initial content exceeded limit of ${a} characters. Content was automatically trimmed.`);const p=l.tr.deleteRange(u,h);return n=!0,p}n=!0},filterTransaction:(e,t)=>{const l=this.options.limit;if(!e.docChanged||l===0||l===null||l===void 0)return!0;const a=this.storage.characters({node:t.doc}),i=this.storage.characters({node:e.doc});if(i<=l||a>l&&i>l&&i<=a)return!0;if(a>l&&i>l&&i>a||!e.getMeta("paste"))return!1;const u=e.selection.$head.pos,h=i-l,p=u-h,g=u;return e.deleteRange(p,g),!(this.storage.characters({node:e.doc})>l)}})]}});var PD=Dn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[ND(this.options)]}});Dn.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new gn({key:new Vn("focus"),props:{decorations:({doc:n,selection:e})=>{const{isEditable:t,isFocused:l}=this.editor,{anchor:a}=e,i=[];if(!t||!l)return mn.create(n,[]);let d=0;this.options.mode==="deepest"&&n.descendants((h,p)=>{if(h.isText)return;if(!(a>=p&&a<=p+h.nodeSize-1))return!1;d+=1});let u=0;return n.descendants((h,p)=>{if(h.isText||!(a>=p&&a<=p+h.nodeSize-1))return!1;if(u+=1,this.options.mode==="deepest"&&d-u>0||this.options.mode==="shallowest"&&u>1)return this.options.mode==="deepest";i.push(vs.node(p,p+h.nodeSize,{class:this.options.className}))}),mn.create(n,i)}}})]}});var HD=Dn.create({name:"gapCursor",addProseMirrorPlugins(){return[jD()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=en(it(n,"allowGapCursor",t)))!=null?e:null}}});Dn.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new gn({key:new Vn("placeholder"),props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:l}=e,a=[];if(!t)return null;const i=this.editor.isEmpty;return n.descendants((d,u)=>{const h=l>=u&&l<=u+d.nodeSize,p=!d.isLeaf&&Tu(d);if((h||!this.options.showOnlyCurrent)&&p){const g=[this.options.emptyNodeClass];i&&g.push(this.options.emptyEditorClass);const b=vs.node(u,u+d.nodeSize,{class:g.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:d,pos:u,hasAnchor:h}):this.options.placeholder});a.push(b)}return this.options.includeChildren}),mn.create(n,a)}}})]}});Dn.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:e}=this;return[new gn({key:new Vn("selection"),props:{decorations(t){return t.selection.empty||n.isFocused||!n.isEditable||n2(t.selection)||n.view.dragging?null:mn.create(t.doc,[vs.inline(t.selection.from,t.selection.to,{class:e.className})])}}})]}});function Rv({types:n,node:e}){return e&&Array.isArray(n)&&n.includes(e.type)||e?.type===n}var $D=Dn.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var n;const e=new Vn(this.name),t=this.options.node||((n=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:n.name)||"paragraph",l=Object.entries(this.editor.schema.nodes).map(([,a])=>a).filter(a=>(this.options.notAfter||[]).concat(t).includes(a.name));return[new gn({key:e,appendTransaction:(a,i,d)=>{const{doc:u,tr:h,schema:p}=d,g=e.getState(d),b=u.content.size,y=p.nodes[t];if(g)return h.insert(b,y.create())},state:{init:(a,i)=>{const d=i.tr.doc.lastChild;return!Rv({node:d,types:l})},apply:(a,i)=>{if(!a.docChanged||a.getMeta("__uniqueIDTransaction"))return i;const d=a.doc.lastChild;return!Rv({node:d,types:l})}}})]}}),UD=Dn.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>q2(n,e),redo:()=>({state:n,dispatch:e})=>F2(n,e)}},addProseMirrorPlugins(){return[BD(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),VD=Dn.create({name:"starterKit",addExtensions(){var n,e,t,l;const a=[];return this.options.bold!==!1&&a.push(g4.configure(this.options.bold)),this.options.blockquote!==!1&&a.push(u4.configure(this.options.blockquote)),this.options.bulletList!==!1&&a.push(D2.configure(this.options.bulletList)),this.options.code!==!1&&a.push(y4.configure(this.options.code)),this.options.codeBlock!==!1&&a.push(k4.configure(this.options.codeBlock)),this.options.document!==!1&&a.push(w4.configure(this.options.document)),this.options.dropcursor!==!1&&a.push(PD.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&a.push(HD.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&a.push(S4.configure(this.options.hardBreak)),this.options.heading!==!1&&a.push(j4.configure(this.options.heading)),this.options.undoRedo!==!1&&a.push(UD.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&a.push(C4.configure(this.options.horizontalRule)),this.options.italic!==!1&&a.push(D4.configure(this.options.italic)),this.options.listItem!==!1&&a.push(O2.configure(this.options.listItem)),this.options.listKeymap!==!1&&a.push(B2.configure((n=this.options)==null?void 0:n.listKeymap)),this.options.link!==!1&&a.push(nD.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&a.push(H2.configure(this.options.orderedList)),this.options.paragraph!==!1&&a.push(mD.configure(this.options.paragraph)),this.options.strike!==!1&&a.push(bD.configure(this.options.strike)),this.options.text!==!1&&a.push(yD.configure(this.options.text)),this.options.underline!==!1&&a.push(vD.configure((t=this.options)==null?void 0:t.underline)),this.options.trailingNode!==!1&&a.push($D.configure((l=this.options)==null?void 0:l.trailingNode)),a}}),qD=VD;function FD({value:n="",onChange:e,onBlur:t}){const l=a4({extensions:[qD],content:n,editable:!0,onUpdate:({editor:a})=>{e&&e({target:{value:a.getHTML()}})},onBlur:()=>{t&&t()}});return C.useEffect(()=>{l&&!l.isFocused&&setTimeout(()=>{l.commands.focus()},0)},[l]),l?o.jsxs("div",{className:"tiptap-wrapper",children:[o.jsxs("div",{className:"tiptap-toolbar",children:[o.jsx("button",{onClick:()=>l.chain().focus().toggleBold().run(),disabled:!l.can().chain().focus().toggleBold().run(),className:l.isActive("bold")?"is-active":"",title:"Bold",children:o.jsx("strong",{children:"B"})}),o.jsx("button",{onClick:()=>l.chain().focus().toggleItalic().run(),disabled:!l.can().chain().focus().toggleItalic().run(),className:l.isActive("italic")?"is-active":"",title:"Italic",children:o.jsx("em",{children:"I"})}),o.jsx("button",{onClick:()=>l.chain().focus().toggleStrike().run(),disabled:!l.can().chain().focus().toggleStrike().run(),className:l.isActive("strike")?"is-active":"",title:"Strikethrough",children:o.jsx("s",{children:"S"})}),o.jsx("button",{onClick:()=>l.chain().focus().clearNodes().run(),title:"Clear formatting",children:""}),o.jsx("div",{className:"toolbar-divider"}),o.jsx("button",{onClick:()=>l.chain().focus().toggleBulletList().run(),className:l.isActive("bulletList")?"is-active":"",title:"Bullet list",children:""}),o.jsx("button",{onClick:()=>l.chain().focus().toggleOrderedList().run(),className:l.isActive("orderedList")?"is-active":"",title:"Ordered list",children:"1."})]}),o.jsx(W3,{editor:l,className:"tiptap-content"})]}):null}function K2(n){const{value:e="",onChange:t,containerProps:l={},spellCheck:a,lang:i,onBlur:d,onKeyDown:u}=n;return o.jsx(FD,{value:e,onChange:t,onBlur:d})}const Iv={Country:"",Landscape:"",County:"",Municipality:"",Parish:"",Village:"",Building:"",Cemetary:"",default:""},KD={Country:"Land",Landscape:"Landskap",County:"Ln",Municipality:"Kommun",Parish:"Frsamling/socken",Village:"By/Ort",Building:"Byggnad",Cemetary:"Kyrkogrd",default:"Plats"},GD=({type:n,className:e=""})=>{const t=Iv[n]||Iv.default;return o.jsx("span",{className:`${e}`,children:t})},G2=({node:n,level:e,expandedNodes:t,toggleExpand:l,selectedNodeId:a,onSelect:i,onContextMenu:d,onDoubleClick:u,highlightTerm:h})=>{const p=n.children&&n.children.length>0,g=t.has(n.id),b=a===n.id,y=v=>!h||!v?v:v.split(new RegExp(`(${h})`,"gi")).map((S,j)=>S.toLowerCase()===h.toLowerCase()?o.jsx("mark",{className:"bg-amber-700 text-amber-100",children:S},j):S);return o.jsxs("div",{children:[o.jsxs("div",{className:`flex items-center py-1 px-2 cursor-pointer select-none hover:bg-slate-700 transition-colors ${b?"bg-blue-600 border-l-4 border-blue-400":""}`,style:{paddingLeft:`${e*20+8}px`},onClick:()=>i(n),onDoubleClick:()=>u(n),onContextMenu:v=>d(v,n),children:[o.jsx("div",{className:"mr-1 text-slate-500 hover:text-slate-300 transition-colors",onClick:v=>{v.stopPropagation(),p&&l(n.id)},children:p?g?o.jsx("span",{className:"text-sm",children:""}):o.jsx("span",{className:"text-sm",children:""}):o.jsx("span",{className:"w-[14px] inline-block"})}),o.jsx(GD,{type:n.type,className:"mr-2 text-base"}),o.jsx("span",{className:"text-sm text-slate-200",children:y(n.name)})]}),p&&g&&o.jsx("div",{children:n.children.map(v=>o.jsx(G2,{node:v,level:e+1,expandedNodes:t,toggleExpand:l,selectedNodeId:a,onSelect:i,onContextMenu:d,onDoubleClick:u,highlightTerm:h},v.id))})]})},YD=({x:n,y:e,node:t,onClose:l,onAction:a})=>{const i=C.useRef(null);C.useEffect(()=>{const u=h=>{i.current&&!i.current.contains(h.target)&&l()};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[l]);const d=[{label:"Ny plats under",action:"new",icon:""},{label:"Redigera",action:"edit",icon:""},{label:"Radera",action:"delete",icon:""},{label:"---",action:"separator"},{label:"Kopiera ID",action:"copy-id",icon:""},{label:"Kopiera",action:"copy",icon:""},{label:"Klistra in",action:"paste",icon:""},{label:"---",action:"separator"},{label:"Exportera",action:"export",icon:""},{label:"Importera",action:"import",icon:""}];return o.jsx("div",{ref:i,className:"fixed bg-slate-800 border border-slate-700 rounded shadow-lg py-1 z-50",style:{top:e,left:n},children:d.map((u,h)=>u.action==="separator"?o.jsx("div",{className:"border-t border-slate-700 my-1"},h):o.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-slate-200 transition-colors",onClick:()=>{a(u.action,t),l()},children:[o.jsx("span",{children:u.icon}),o.jsx("span",{children:u.label})]},h))})};function cm({catalogState:n,setCatalogState:e,onPick:t,onClose:l,isDrawerMode:a=!1,onLinkPlace:i}){const{recordAudit:d,showStatus:u}=Fs(),[h,p]=C.useState([]),[g,b]=C.useState([]),[y,v]=C.useState(!0),[N,S]=C.useState(null),[j,E]=C.useState(new Set(["root"])),[D,_]=C.useState(null),[H,L]=C.useState([]),[V,G]=C.useState(""),[X,$]=C.useState("name-asc"),[R,A]=C.useState(null),[B,Y]=C.useState(null),[J,de]=C.useState(null),[w,T]=C.useState("info"),[I,Z]=C.useState(""),[pe,O]=C.useState(!1),te=C.useRef(null);C.useEffect(()=>{if(!t)return;const fe=ze=>{ze.key==="Escape"&&l&&l()};return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[t,l]);const ke=(fe,ze,Me)=>fe.map(He=>{if(He.id===ze){const et=[...He.children||[],Me].sort((st,rt)=>st.name.localeCompare(rt.name,"sv"));return{...He,children:et}}return He.children&&He.children.length>0?{...He,children:ke(He.children,ze,Me)}:He});C.useEffect(()=>{U()},[]),C.useEffect(()=>{D&&D.metadata?.id?ge(D.metadata.id):L([])},[D]),C.useEffect(()=>{Z(D?.metadata?.note||"")},[D]);const U=async()=>{v(!0);try{const ze=await(await fetch("http://127.0.0.1:5005/official_places/full_tree")).json(),Me=Ee(ze);p(Me);const He=Ie(Me);b(He)}catch(fe){S(fe.message)}finally{v(!1)}},ge=async fe=>{try{const Me=await(await fetch("http://127.0.0.1:5005/people")).json(),He=[];for(const et of Me)if(et.events&&Array.isArray(et.events))for(const st of et.events)(st.placeId==fe||st.place_id==fe)&&He.push({personId:et.id,personName:`${et.firstName||""} ${et.lastName||""}`.trim(),eventType:st.type,eventDate:st.date||"",eventId:st.id});L(He)}catch(ze){console.error("Kunde inte ladda kopplade personer:",ze),L([])}},Ee=fe=>{if(!fe||!fe.tree)return[];const ze=(He,et="lan")=>{if(!He)return null;let st=[],rt="",ht="";return et==="lan"?(rt=He.lansnamn||"Oknt ln",ht=`lan-${He.lanskod||He.lansnamn}`,Array.isArray(He.children)?st=He.children.map(St=>ze(St,"kommun")).filter(Boolean):He.children&&typeof He.children=="object"&&(st=Object.values(He.children).flat().map(St=>ze(St,"kommun")).filter(Boolean))):et==="kommun"?(rt=He.kommunnamn||"Oknd kommun",ht=`kommun-${He.ommunkod||He.kommunnamn}`,Array.isArray(He.children)?st=He.children.map(St=>ze(St,"forsamling")).filter(Boolean):He.children&&typeof He.children=="object"&&(st=Object.values(He.children).flat().map(St=>ze(St,"forsamling")).filter(Boolean))):et==="forsamling"?(rt=He.sockenstadnamn||"Oknd frsamling",ht=`forsamling-${He.sockenstadkod||He.sockenstadnamn}`,Array.isArray(He.children)?st=He.children.map(St=>ze(St,"ort")).filter(Boolean):He.children&&typeof He.children=="object"&&(st=Object.values(He.children).flat().map(St=>ze(St,"ort")).filter(Boolean))):et==="ort"&&(rt=He.ortnamn||"Oknd ort",ht=`ort-${He.id||He.ortnamn}`,st=[]),{id:ht,name:rt,type:ie(et),children:st,metadata:He}},Me={id:"root",name:"Sverige",type:"Country",children:[],metadata:{}};return Array.isArray(fe.tree)&&(Me.children=fe.tree.map(He=>ze(He,"lan")).filter(Boolean)),[Me]},ie=fe=>({lan:"County",kommun:"Municipality",forsamling:"Parish",ort:"Village"})[fe]||"default",Ie=fe=>{const ze=[],Me=He=>{ze.push(He),He.children&&He.children.forEach(Me)};return fe.forEach(Me),ze},P=(fe,ze)=>{if(!ze)return{filtered:fe,nodesToExpand:new Set};const Me=[],He=ze.toLowerCase(),et=new Set,st=ht=>ht.name.toLowerCase().includes(He),rt=(ht,St=[])=>{const ee=st(ht),oe=ht.children?ht.children.map(xe=>rt(xe,[...St,ht.id])).filter(Boolean):[];return ee||oe.length>0?(ee&&(St.forEach(xe=>et.add(xe)),et.add(ht.id)),{...ht,children:oe}):null};return fe.forEach(ht=>{const St=rt(ht);St&&Me.push(St)}),{filtered:Me,nodesToExpand:et}};C.useEffect(()=>{if(V&&h.length>0){const{nodesToExpand:fe}=P(h,V);fe.size>0&&E(ze=>new Set([...ze,...fe]))}},[V,h]);const we=fe=>{const ze=new Set(j);ze.has(fe)?ze.delete(fe):ze.add(fe),E(ze)},ue=fe=>{_(fe)},Ue=fe=>{Y(fe)},Q=(fe,ze)=>{fe.preventDefault(),A({x:fe.clientX,y:fe.clientY,node:ze})},re=async(fe,ze)=>{switch(fe){case"new":de(ze);break;case"edit":Y(ze);break;case"delete":if(window.confirm(`Vill du verkligen radera "${ze.name}"?`))try{const Me=ze.metadata?.id;if(!Me){u&&u("Kan inte radera: saknar ID.","error");break}if(!(await fetch(`http://127.0.0.1:5005/official_places/${Me}`,{method:"DELETE"})).ok)throw new Error("Delete misslyckades");await U();try{d&&d({type:"delete",entityType:"place",entityId:Me,details:{name:ze.name}})}catch{}u&&u("Plats raderad.")}catch{u&&u("Kunde inte radera plats.","error")}break;case"copy-id":navigator.clipboard.writeText(ze.id);break;case"copy":navigator.clipboard.writeText(JSON.stringify(ze,null,2));break;case"paste":alert("Klistra in plats (kommer snart)");break;case"export":Ye(ze);break;case"import":te.current?.click();break}},Ce=async()=>{if(D?.metadata?.id){O(!0);try{if(!(await fetch(`http://127.0.0.1:5005/official_places/${D.metadata.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:I})})).ok)throw new Error("Kunde inte spara notering");u&&u("Notering sparad."),await U()}catch{u&&u("Kunde inte spara notering.","error")}finally{O(!1)}}},Ye=fe=>{const ze=JSON.stringify(fe,null,2),Me=new Blob([ze],{type:"application/json"}),He=URL.createObjectURL(Me),et=document.createElement("a");et.href=He,et.download=`place-${fe.id}.json`,et.click(),URL.revokeObjectURL(He)},Ve=async fe=>{if(!B||!B.metadata?.id)throw new Error("Ingen plats vald fr redigering");const ze=B.metadata.id;if(!(await fetch(`http://127.0.0.1:5005/official_places/${ze}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ortnamn:fe.ortnamn,sockenstadnamn:fe.sockenstadnamn,sockenstadkod:fe.sockenstadkod,kommunkod:fe.kommunkod,kommunnamn:fe.kommunnamn,lanskod:fe.lanskod,lansnamn:fe.lansnamn,detaljtyp:B.type,latitude:fe.latitude,longitude:fe.longitude,note:fe.note})})).ok)throw new Error("Kunde inte spara plats");await U()},ft=async fe=>{const ze=J||D||h[0],Me=ze?.id||"root",et={id:"new_"+Date.now(),name:fe.name||"Ny plats",type:fe.type||"default",children:[],metadata:{latitude:fe.latitude||null,longitude:fe.longitude||null,note:fe.note||""}};p(rt=>ke(rt,Me,et)),E(rt=>new Set([...rt,Me]));const st={name:fe.name,type:fe.type,latitude:fe.latitude||null,longitude:fe.longitude||null};if(ze){const rt=ze.metadata||{};ze.type==="Parish"?(st.sockenstadkod=rt.sockenstadkod||rt.sockenstadnamn||null,st.sockenstadnamn=rt.sockenstadnamn||null,st.kommunkod=rt.kommunkod||null,st.kommunnamn=rt.kommunnamn||null,st.lanskod=rt.lanskod||null,st.lansnamn=rt.lansnamn||null):ze.type==="Municipality"?(st.kommunkod=rt.kommunkod||rt.kommunnamn||null,st.kommunnamn=rt.kommunnamn||null,st.lanskod=rt.lanskod||null,st.lansnamn=rt.lansnamn||null):ze.type==="County"&&(st.lanskod=rt.lanskod||rt.lansnamn||null,st.lansnamn=rt.lansnamn||null)}try{const rt=await fetch("http://127.0.0.1:5005/official_places",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(st)});if(!rt.ok){const ht=await rt.text();throw new Error(ht||"Kunde inte skapa plats")}await U(),E(ht=>new Set([...ht,Me]))}catch(rt){console.error("Skapa plats misslyckades:",rt)}},dt=async fe=>{const ze=fe.target.files?.[0];if(!ze)return;const Me=await ze.text();try{v(!0);const st=new DOMParser().parseFromString(Me,"text/xml").getElementsByTagName("place"),rt=[];for(let ee=0;ee<st.length;ee++){const oe=st[ee],xe=oe.getElementsByTagName("abbreviation")[0],$e=xe?xe.textContent:"",Xt={id:oe.getAttribute("id"),parentid:oe.getAttribute("parentid"),name:oe.getElementsByTagName("placename")[0]?.textContent||"",type:oe.getElementsByTagName("placetype")[0]?.textContent||"",hierarchy:oe.getElementsByTagName("hierarchy")[0]?.textContent||"",latitude:oe.getElementsByTagName("latitude")[0]?.textContent||"",longitude:oe.getElementsByTagName("longitude")[0]?.textContent||"",abbreviation:$e};rt.push(Xt)}if(rt.length===0){alert("Inga platser hittades i XML-filen."),v(!1),fe.target.value="";return}const ht=await fetch("http://127.0.0.1:5005/official_places/import_xml",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({places:rt})});if(!ht.ok){const ee=await ht.json();throw new Error(ee.error||"Kunde inte importera platser")}const St=await ht.json();alert(`Importerade ${St.imported} platser frn XML!
Laddar om platsregister...`),await U()}catch(He){alert("Kunde inte importera XML-fil: "+He.message),console.error("Import error:",He)}finally{v(!1),fe.target.value=""}},xt=(fe,ze,Me=[])=>{for(const He of fe){if(He.id===ze)return[...Me,He.name];if(He.children){const et=xt(He.children,ze,[...Me,He.name]);if(et)return et}}return null},lt=D?xt(h,D.id):[],bt=fe=>!fe||fe.length===0?fe:[...fe].sort((Me,He)=>X==="name-asc"?Me.name.localeCompare(He.name,"sv"):X==="name-desc"?He.name.localeCompare(Me.name,"sv"):X==="type"?Me.type.localeCompare(He.type):0).map(Me=>({...Me,children:Me.children?bt(Me.children):[]}));let ot=h;if(V){const{filtered:fe}=P(h,V);ot=fe}return ot=bt(ot),o.jsxs("div",{className:"flex flex-col h-full bg-slate-900 overflow-hidden",children:[o.jsxs("div",{className:"bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center gap-2 shadow-sm",children:[o.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-500 font-medium",onClick:()=>de(D||h[0]),children:" Ny"}),o.jsx("button",{className:"px-3 py-1 bg-slate-700 text-slate-300 text-sm rounded hover:bg-slate-600 font-medium",onClick:()=>B?Y(null):D&&Y(D),disabled:!D,children:" Redigera"}),o.jsx("button",{className:"px-3 py-1 bg-red-600 text-red-100 text-sm rounded hover:bg-red-700 font-medium",onClick:()=>alert("Radera (kommer snart)"),disabled:!D,children:" Radera"}),o.jsx("div",{className:"flex-1"}),o.jsx("input",{type:"text",placeholder:"Sk plats...",value:V,onChange:fe=>G(fe.target.value),className:"border border-slate-700 bg-slate-900 text-white rounded px-3 py-1 text-sm w-64 focus:border-blue-500 focus:outline-none"}),o.jsxs("select",{value:X,onChange:fe=>$(fe.target.value),className:"border border-slate-700 bg-slate-900 text-white rounded px-3 py-1 text-sm focus:border-blue-500 focus:outline-none",children:[o.jsx("option",{value:"name-asc",children:"Namn (A-)"}),o.jsx("option",{value:"name-desc",children:"Namn (-A)"}),o.jsx("option",{value:"type",children:"Typ"})]}),o.jsx("button",{className:"px-3 py-1 bg-green-600 text-green-100 text-sm rounded hover:bg-green-500 font-medium",onClick:()=>te.current?.click(),children:" Importera"}),o.jsx("button",{className:"px-3 py-1 bg-blue-600 text-blue-100 text-sm rounded hover:bg-blue-500 font-medium",onClick:()=>D&&Ye(D),disabled:!D,children:" Exportera"}),o.jsx("input",{ref:te,type:"file",accept:".xml",className:"hidden",onChange:dt})]}),o.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[o.jsxs("div",{className:"w-1/3 min-w-[300px] border-r border-slate-700 flex flex-col bg-slate-850",children:[o.jsx("div",{className:"p-2 bg-slate-800 border-b border-slate-700 text-xs font-bold uppercase text-slate-300",children:"Platsstruktur"}),o.jsx("div",{className:"flex-1 overflow-y-auto py-2",children:y?o.jsx("div",{className:"text-center text-slate-500 mt-8",children:"Laddar platser..."}):N?o.jsxs("div",{className:"text-center text-red-500 mt-8",children:["Fel: ",N]}):ot.length===0?o.jsx("div",{className:"text-center text-slate-500 mt-8",children:"Inga platser funna"}):ot.map(fe=>o.jsx(G2,{node:fe,level:0,expandedNodes:j,toggleExpand:we,selectedNodeId:D?.id,onSelect:ue,onContextMenu:Q,onDoubleClick:Ue,highlightTerm:V},fe.id))})]}),o.jsx("div",{className:"flex-1 bg-slate-800 flex flex-col overflow-hidden",children:D?o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[o.jsxs("div",{className:"p-6 pb-0",children:[o.jsx("div",{className:"flex items-start justify-between",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-white mb-1",children:D.name}),o.jsx("p",{className:"text-slate-400 italic",children:KD[D.type]||"Platsinformation saknas"})]})}),o.jsxs("div",{className:"flex border-b mt-4 bg-slate-900 rounded-t-lg shadow-sm",children:[o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${w==="info"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>T("info"),title:"Information",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Info",children:""}),"Info",w==="info"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${w==="images"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>T("images"),title:"Bilder",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Bilder",children:""}),"Bilder",w==="images"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${w==="notes"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>T("notes"),title:"Noteringar",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Noteringar",children:""}),"Noteringar",w==="notes"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${w==="connections"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>T("connections"),title:"Kopplingar",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Kopplingar",children:""}),"Kopplingar",w==="connections"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[w==="info"&&o.jsxs("div",{className:"space-y-6",children:[D.metadata?.latitude&&D.metadata?.longitude&&o.jsxs("div",{children:[o.jsx("h3",{className:"text-sm font-bold text-slate-300 uppercase mb-1",children:"WGS 84 decimal (lat, lon)"}),o.jsxs("p",{className:"font-mono text-slate-200 bg-slate-900 inline-block px-2 py-1 rounded border border-slate-700",children:[D.metadata.latitude,", ",D.metadata.longitude]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[D.metadata?.lansnamn&&o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Ln"}),o.jsx("div",{className:"text-slate-200",children:D.metadata.lansnamn})]}),D.metadata?.kommunnamn&&o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Kommun"}),o.jsx("div",{className:"text-slate-200",children:D.metadata.kommunnamn})]}),D.metadata?.sockenstadnamn&&o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Frsamling"}),o.jsx("div",{className:"text-slate-200",children:D.metadata.sockenstadnamn})]}),D.metadata?.detaljtyp&&o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Detaljtyp"}),o.jsx("div",{className:"text-slate-200",children:D.metadata.detaljtyp})]})]})]}),w==="images"&&o.jsxs("div",{className:"max-w-3xl mx-auto",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200 mb-3",children:"Bilder"}),o.jsx("div",{className:"text-sm text-slate-400 italic bg-slate-900 border border-slate-700 rounded p-4",children:"Inga bilder r kopplade till denna plats nnu."})]}),w==="notes"&&o.jsxs("div",{className:"max-w-3xl mx-auto space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200",children:"Noteringar"}),o.jsx("button",{className:"px-3 py-1 bg-blue-600 text-blue-100 rounded hover:bg-blue-500 font-medium disabled:opacity-60 disabled:cursor-not-allowed",onClick:Ce,disabled:pe,children:pe?"Sparar...":"Spara"})]}),o.jsx(K2,{value:I,onChange:fe=>Z(fe.target.value),containerProps:{style:{minHeight:"200px"}}})]}),w==="connections"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h3",{className:"text-sm font-bold text-slate-300 uppercase",children:"Kopplade Personer"}),o.jsxs("span",{className:"text-xs text-slate-400",children:[H.length," ",H.length===1?"person":"personer"]})]}),o.jsx("div",{className:"bg-slate-900 rounded-md border border-slate-700 overflow-hidden",children:H.length>0?H.map(fe=>o.jsxs("div",{className:"flex items-center p-3 border-b border-slate-700 last:border-0 hover:bg-slate-800 transition-colors cursor-pointer",children:[o.jsx("span",{className:"mr-3 text-slate-500",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"text-sm text-slate-100 font-medium",children:fe.personName}),o.jsxs("div",{className:"text-xs text-slate-400",children:[fe.eventType,fe.eventDate&&` (${fe.eventDate})`]})]})]},`${fe.personId}-${fe.eventId}`)):o.jsx("div",{className:"p-4 text-sm text-slate-400 italic",children:"Inga personer kopplade till denna plats."})})]})]})]}):o.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:"Vlj en plats i listan till vnster fr att se detaljer."})})]}),t?o.jsxs("div",{className:"h-10 bg-slate-800 border-t border-slate-700 flex items-center justify-end gap-2 px-3",children:[o.jsx("button",{className:"px-3 py-1 bg-slate-700 text-slate-100 rounded hover:bg-slate-600 font-medium",onClick:()=>l&&l(),children:"Avbryt"}),o.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-500 font-medium disabled:opacity-50",disabled:!D,onClick:()=>D&&t(D),children:"OK"})]}):a&&i?o.jsx("div",{className:"h-10 bg-slate-800 border-t border-slate-700 flex items-center justify-end gap-2 px-3",children:o.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-500 font-medium disabled:opacity-50 disabled:bg-green-900",disabled:!D,onClick:()=>D&&i(D),children:" Koppla plats"})}):o.jsx("div",{className:"h-8 bg-slate-900 text-slate-300 flex items-center px-4 text-xs border-t border-slate-700",children:lt.length>0?o.jsx("span",{children:lt.join("  ")}):o.jsx("span",{children:"Ingen plats vald"})}),R&&o.jsx(YD,{x:R.x,y:R.y,node:R.node,onClose:()=>A(null),onAction:re}),B&&o.jsx(Vs,{title:`Redigera: ${B.name}`,onClose:()=>Y(null),children:o.jsx(eC,{place:B,onClose:()=>Y(null),onSave:Ve})}),J&&o.jsx(Vs,{title:"Skapa ny plats",onClose:()=>de(null),children:o.jsx(nC,{parentNode:J,onClose:()=>de(null),onCreate:async fe=>{await ft({name:fe.name,type:fe.type,latitude:fe.latitude,longitude:fe.longitude,note:fe.note})}})})]})}function zv(n){if(!n)return"";let e=n;return!n.country&&(n.name||n.plac)&&(e={...n,...Ad(n.name||n.plac)}),[e.specific,e.village,e.parish,e.municipality,e.region,e.country,e.gard,e.by,e.socken,e.lan,e.land,e.name,e.plac].filter(Boolean).join(", ")}function XD({value:n,displayValue:e,allPlaces:t,onChange:l}){const[a,i]=C.useState(!1),[d,u]=C.useState(""),[h,p]=C.useState(!1),[g,b]=C.useState([]),y=C.useRef(null),v=C.useMemo(()=>t.find(D=>D.id===n),[n,t]),N=D=>D?String(D).normalize("NFD").replace(new RegExp("\\p{Diacritic}+","gu"),"").toLowerCase():"",S=C.useMemo(()=>{if(!Array.isArray(t))return[];if(!d)return t;const D=N(d),_=t.filter(H=>{if(!H)return!1;const L=!H.country&&(H.name||H.plac)?{...H,...Ad(H.name||H.plac)}:H;return[L.name,L.plac,L.country,L.region,L.municipality,L.parish,L.village,L.specific,L.land,L.lan,L.socken,L.by,L.gard,L.ortnamn,L.sockenstadnamn,L.kommunnamn,L.lansnamn].filter(Boolean).map(X=>N(X)).some(X=>X.includes(D))?!0:N(zv(L)).includes(D)});if(Array.isArray(g)&&g.length>0){const H=new Set,L=[];for(const V of g){const G=`${V.id}::${V.name}::${V.kommunnamn||""}::${V.lansnamn||""}::${V.sockenstadnamn||""}`;H.has(G)||(H.add(G),L.push(V))}return L}return _},[d,t,g]),j=D=>{const _=D.raw||D,H=_.ortnamn||_.sockenstadnamn||_.kommunnamn||_.lansnamn||D.name||D.plac||"",L=(_.detaljtyp||_.type||"").toLowerCase(),V=[];if(_.sockenstadnamn&&V.push(_.sockenstadnamn),_.kommunnamn&&V.push(_.kommunnamn),_.lansnamn&&V.push(_.lansnamn),V.length===0){const $=!D.country&&(D.name||D.plac)?Ad(D.name||D.plac):{},R=[$.parish,$.municipality,$.region,$.country].filter(Boolean);V.push(...R)}const G=V.filter(Boolean).join("  "),X=L==="parish"?"Frsamling":L==="municipality"?"Kommun":L==="county"?"Ln":L==="village"?"Ort":L==="building"?"Byggnad":L==="cemetary"?"Kyrkogrd":"";return o.jsxs("div",{className:"w-full",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-slate-300 font-medium",children:H}),X&&o.jsx("span",{className:"ml-2 text-[11px] px-2 py-0.5 rounded-full bg-slate-700 text-slate-300 border border-slate-600",children:X})]}),G&&o.jsx("div",{className:"text-[12px] text-slate-400 mt-0.5",children:G})]})};C.useEffect(()=>{let D=!1;return(async()=>{try{const H=d.trim();if(!H||H.length<2){b([]);return}const L=`http://localhost:5005/official_places/search?q=${encodeURIComponent(H)}`,V=await fetch(L);if(!V.ok){b([]);return}const G=await V.json();if(D)return;const X=(Array.isArray(G)?G:[]).map($=>({id:$.id,name:$.ortnamn||$.sockenstadnamn||$.kommunnamn||$.lansnamn||$.name,ortnamn:$.ortnamn,sockenstadnamn:$.sockenstadnamn,kommunnamn:$.kommunnamn,lansnamn:$.lansnamn,raw:$}));b(X)}catch{b([])}})(),()=>{D=!0}},[d]);const E=(D,_)=>{D&&(l(D,_),i(!1),u(""))};return C.useEffect(()=>{function D(_){y.current&&!y.current.contains(_.target)&&i(!1)}return document.addEventListener("mousedown",D),()=>document.removeEventListener("mousedown",D)},[y]),o.jsxs("div",{className:"relative w-full max-w-md",ref:y,children:[o.jsxs("div",{className:"relative flex items-center",children:[o.jsxs("div",{className:"relative flex-1",children:[o.jsx(Fr,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"}),o.jsx("input",{type:"text",className:"w-full bg-slate-900 border border-slate-700 text-slate-200 text-sm rounded-l-md pl-9 pr-8 py-2 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Sk plats...",value:d||e||zv(v),onChange:D=>{u(D.target.value),i(!0)},onFocus:()=>i(!0)}),d&&o.jsx("button",{onClick:()=>{u(""),i(!1)},className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-400",children:o.jsx(ys,{size:14})})]}),o.jsx("button",{className:"bg-slate-700 hover:bg-slate-600 border-y border-r border-slate-700 text-slate-200 p-2 rounded-r-md",title:"ppna platsregister",onClick:()=>p(!0),children:o.jsx(WS,{size:20})})]}),a&&o.jsx("div",{className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-md shadow-xl max-h-64 overflow-y-auto",children:S.length>0?o.jsx("ul",{children:S.map(D=>o.jsx("li",{onMouseDown:_=>{_.preventDefault()},onClick:_=>{_.stopPropagation(),E(D.id,D)},className:"px-4 py-2 hover:bg-slate-700 cursor-pointer flex items-start gap-2 border-b border-slate-700 last:border-0",children:j(D)},D.id))}):o.jsx("div",{className:"p-4 text-center text-slate-400 text-sm italic",children:d&&d.length>=2?g.length===0?"Inga platser hittades (kontrollera anslutning till officiellt register)":"Sker...":"Skriv minst 2 tecken fr att ska"})}),h&&o.jsx("div",{className:"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center",onClick:()=>p(!1),children:o.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl shadow-2xl w-[90vw] h-[85vh] max-w-5xl",onClick:D=>D.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[o.jsx("h3",{className:"font-semibold",children:"Platsregister"}),o.jsx("button",{className:"text-xl text-slate-400 hover:text-white",onClick:()=>p(!1),children:""})]}),o.jsx("div",{className:"h-[calc(100%-40px)]",children:o.jsx(cm,{onPick:D=>{const _=D.metadata?.id||D.id;console.log("PlacePicker modal: Selected node:",D,"ID:",_),_?(l(_),p(!1)):console.warn("PlacePicker modal: No valid ID found on node")},onClose:()=>p(!1)})})]})})]})}function mt({children:n,onClick:e,variant:t="primary",size:l="md",className:a="",disabled:i=!1,...d}){const u="rounded font-medium shadow-sm transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-2 focus:outline-blue-400 focus:outline-offset-2",h={primary:"bg-blue-600 text-white hover:bg-blue-500 active:bg-blue-700",danger:"bg-red-600 text-white hover:bg-red-500 active:bg-red-700",success:"bg-green-600 text-white hover:bg-green-500 active:bg-green-700",secondary:"bg-slate-700 text-slate-300 border border-slate-600 hover:bg-slate-600 active:bg-slate-800",ghost:"bg-transparent text-slate-400 hover:text-slate-200 hover:bg-slate-700/30 border-transparent shadow-none"},p={xs:"px-1 py-0.5 text-[10px]",sm:"px-3 py-1 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},g=`
    ${u} 
    ${h[t]||h.primary} 
    ${p[l]||p.md} 
    ${a}
  `;return o.jsx("button",{className:g.trim(),onClick:e,disabled:i,...d,children:n})}function JD(n){const e=a=>n.events?.find(d=>d.type===a||d.type===(a==="BIRT"?"Fdelse":"Dd"))?.date||"",t=e("BIRT"),l=e("DEAT");return!t&&!l?"":`${t} - ${l}`}function Y2({isOpen:n,onClose:e,people:t,onLink:l,initialPersonId:a,skipEventSelection:i=!1,excludePersonIds:d=[],zIndex:u=1e4}){const[h,p]=C.useState(""),[g,b]=C.useState(null),y=C.useRef(null);C.useEffect(()=>{if(n){p(""),b(null);const N=()=>{y.current&&(y.current.focus(),y.current.click())};requestAnimationFrame(()=>{N(),setTimeout(N,50),setTimeout(N,150),setTimeout(N,300)})}},[n]);const v=C.useMemo(()=>{if(a)return t.filter(S=>S.id===a);if(!h)return[];const N=h.toLowerCase();return t.filter(S=>!d.includes(S.id)).filter(S=>S.firstName&&S.firstName.toLowerCase().includes(N)||S.lastName&&S.lastName.toLowerCase().includes(N)||S.refNumber&&String(S.refNumber).includes(N)).slice(0,20)},[t,h,a,d]);return n?g?o.jsx(Vs,{title:`Vlj Hndelse - ${g.firstName} ${g.lastName}`,onClose:()=>b(null),initialWidth:600,initialHeight:600,zIndex:u,children:o.jsxs("div",{className:"p-4 h-full flex flex-col",children:[o.jsx("div",{className:"mb-3 text-sm text-slate-400",children:"Denna person har ingen hndelse nnu. Du kan:"}),o.jsxs("div",{className:"flex-1 overflow-y-auto border rounded bg-slate-800 border-slate-700 mb-4",children:[(!g.events||g.events.length===0)&&o.jsx("div",{className:"p-4 text-slate-400 text-center italic",children:"Inga hndelser"}),g.events&&g.events.map(N=>o.jsx("div",{className:"border-b border-slate-700 bg-slate-900",children:o.jsx("div",{className:"p-3 cursor-pointer hover:bg-slate-700 flex justify-between items-center",onClick:()=>{l(g.id,N.id),b(null),e()},children:o.jsxs("div",{className:"text-slate-200 text-sm",children:[o.jsx("span",{className:"font-bold",children:N.type}),o.jsx("span",{className:"text-slate-400 ml-2",children:N.date||"-"}),o.jsx("span",{className:"text-slate-500 text-xs ml-2",children:N.place||""})]})})},N.id))]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>b(null),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm font-medium",children:"Tillbaka"}),o.jsx("button",{onClick:()=>{l(g.id,"__create_new_event__"),b(null),e()},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium",children:"+ Lgg till ny hndelse"})]})]})}):o.jsx(Vs,{title:"Vlj Person",onClose:e,initialWidth:600,initialHeight:600,zIndex:u,children:o.jsxs("div",{className:"p-4 h-full flex flex-col",children:[!a&&o.jsx("div",{className:"mb-4",children:o.jsx("input",{ref:y,type:"text",placeholder:"Sk p namn eller REF...",className:"w-full border p-2 rounded shadow-sm focus:ring-2 focus:ring-blue-500 outline-none bg-slate-900 text-slate-200 border-slate-700",value:h,onChange:N=>p(N.target.value),onClick:()=>y.current?.focus(),autoFocus:!0})}),o.jsxs("div",{className:"flex-1 overflow-y-auto border rounded bg-slate-800 border-slate-700",children:[v.length===0&&h&&o.jsx("div",{className:"p-4 text-slate-400 text-center",children:"Inga personer hittades."}),v.map(N=>o.jsx("div",{className:"border-b border-slate-700 bg-slate-900",children:o.jsx("div",{className:"p-3 cursor-pointer hover:bg-slate-700 flex justify-between items-center",onClick:()=>{i?(l(N.id,null),e()):b(N)},children:o.jsxs("div",{className:"font-bold text-slate-200 text-sm",children:[N.firstName," ",N.lastName,o.jsx("span",{className:"text-slate-400 font-normal ml-2",children:JD(N)}),o.jsxs("span",{className:"text-slate-500 font-normal text-xs ml-2",children:["(Ref: ",N.refNumber,")"]})]})})},N.id))]})]})}):null}function X2(n){const e=a=>{const d=n.events?.find(u=>u.type===a||u.type===(a==="BIRT"?"Fdelse":"Dd"))?.date||"????";return d.substring(0,4)==="????"?"????":d.substring(0,4)},t=e("BIRT"),l=e("DEAT");return t==="????"&&l==="????"?"":`${t}-${l}`}const QD=ps.memo(({region:n,idx:e,people:t,onStartEdit:l,onStopEdit:a,onRegionChange:i,onDelete:d,onOpenPerson:u})=>{const[h,p]=C.useState(!1),[g,b]=C.useState(!1),y=C.useRef({x:0,y:0}),v=C.useRef(null),N=C.useRef(null),S=t?.find(L=>L.id===n.personId),j=S?X2(S):"",E=S?`Ref ${S.refNumber} ${S.firstName} ${S.lastName} ${j}`.trim():n.label,D=C.useCallback(()=>{(g||h)&&(a(),b(!1),p(!1))},[g,h,a]),_=C.useCallback(L=>{if(!g&&!h)return;const V=L.clientX-y.current.x,G=L.clientY-y.current.y,X=N.current.parentElement.getBoundingClientRect(),$=V/X.width*100,R=G/X.height*100;let A={...v.current},{x:B,y:Y,w:J,h:de}=v.current;if(g)A.x=Math.max(0,Math.min(100-J,B+$)),A.y=Math.max(0,Math.min(100-de,Y+R));else if(h){let w=B,T=Y,I=J,Z=de;if(h.includes("r")&&(I=Math.max(1,J+$)),h.includes("b")&&(Z=Math.max(1,de+R)),h.includes("l")){const pe=B+$,O=J-$;O>1&&pe>=0?(w=pe,I=O):O<=1&&(I=1)}if(h.includes("t")){const pe=Y+R,O=de-R;O>1&&pe>=0?(T=pe,Z=O):O<=1&&(Z=1)}A={...v.current,x:w,y:T,w:I,h:Z}}i(e,A)},[g,h,i,e]),H=(L,V)=>{L.stopPropagation(),l(e),y.current={x:L.clientX,y:L.clientY},v.current={...n},V==="move"?b(!0):p(V)};return C.useEffect(()=>(g||h?(window.addEventListener("mousemove",_),window.addEventListener("mouseup",D)):(window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",D)),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",D)}),[g,h,_,D]),o.jsxs("div",{ref:N,className:"absolute border-2 border-green-400 group hover:bg-green-400/20 transition-colors",style:{left:`${n.x}%`,top:`${n.y}%`,width:`${n.w}%`,height:`${n.h}%`,cursor:g||h?"grabbing":"move",zIndex:g||h?2:1},onMouseDown:L=>H(L,"move"),title:E,children:[o.jsxs("div",{className:"absolute bottom-full left-0 bg-green-600 text-white text-xs px-2 py-0.5 whitespace-nowrap rounded-t opacity-0 group-hover:opacity-100 flex items-center transition-opacity pointer-events-none group-hover:pointer-events-auto",children:[o.jsx("span",{className:"pointer-events-none",children:E}),o.jsx("button",{onClick:L=>{L.stopPropagation(),d(e)},className:"ml-2 text-red-200 hover:text-white font-bold leading-none pointer-events-auto",title:"Ta bort tagg",children:""})]}),["t","b","l","r","tl","tr","bl","br"].map(L=>o.jsx("div",{className:"absolute bg-green-500 w-2 h-2 rounded-full border border-white opacity-0 group-hover:opacity-100",style:{top:L.includes("t")?"-4px":L.includes("b")?"calc(100% - 4px)":"50%",left:L.includes("l")?"-4px":L.includes("r")?"calc(100% - 4px)":"50%",cursor:`${L.replace("t","n").replace("b","s").replace("l","w").replace("r","e")}-resize`,transform:"translate(-50%, -50%)",pointerEvents:"auto"},onMouseDown:V=>H(V,L)},L))]})});function l0({isOpen:n,onClose:e,imageSrc:t,imageTitle:l,regions:a=[],onSaveRegions:i,people:d,onOpenEditModal:u,onPrev:h,onNext:p,hasPrev:g=!1,hasNext:b=!1}){const[y,v]=C.useState(null),[N,S]=C.useState(!1),[j,E]=C.useState(null),[D,_]=C.useState(1),[H,L]=C.useState({x:0,y:0}),[V,G]=C.useState(!1),X=C.useRef({x:0,y:0}),[$,R]=C.useState(!1),[A,B]=C.useState(!1),[Y,J]=C.useState(null),[de,w]=C.useState(null),[T,I]=C.useState(!1),[Z,pe]=C.useState(null),O=A||V||Z!==null,te=C.useRef(null);C.useEffect(()=>(n&&t&&(S(!0),E(null),_(1),L({x:0,y:0}),t.startsWith("http://")||t.startsWith("https://")?(v(t),S(!1)):window.electronAPI.readFile(t).then(re=>{if(re&&!re.error){const Ce=new Blob([re]),Ye=URL.createObjectURL(Ce);v(Ye),setTimeout(()=>{if(te.current){const Ve=te.current,ft=Ve.parentElement;if(ft){const dt=Ve.naturalWidth,xt=Ve.naturalHeight,lt=ft.clientWidth,bt=ft.clientHeight;if(dt&&xt&&lt&&bt){const ot=lt/dt,fe=bt/xt,ze=Math.min(ot,fe,1);_(ze),L({x:0,y:0})}}}},50)}else E("Kunde inte lsa in bilden.")}).catch(re=>E(re.message)).finally(()=>S(!1))),()=>{y&&!y.startsWith("http")&&URL.revokeObjectURL(y),v(null),R(!1),pe(null)}),[n,t]),C.useEffect(()=>{if(!n)return;const re=Ce=>{Ce.key==="ArrowLeft"&&g&&h&&(Ce.preventDefault(),h()),Ce.key==="ArrowRight"&&b&&p&&(Ce.preventDefault(),p()),Ce.key==="Escape"&&e&&e()};return window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)},[n,g,b,h,p,e]);const ke=re=>{T||re.button!==0||$||Z!==null||D===1||(re.preventDefault(),G(!0),X.current={x:re.clientX,y:re.clientY})},U=re=>{if(T)return;re.preventDefault();const Ce=re.deltaY*-.01,Ye=Math.min(Math.max(1,D+Ce),4);_(Ye)},ge=re=>{if(T||V||Z!==null||!$||re.target!==te.current)return;re.preventDefault();const Ce=te.current.getBoundingClientRect(),Ve=te.current.parentElement.getBoundingClientRect(),ft=(re.clientX-Ve.left-H.x*D)/(Ce.width*D)*100,dt=(re.clientY-Ve.top-H.y*D)/(Ce.height*D)*100,xt=Math.max(0,Math.min(100,ft)),lt=Math.max(0,Math.min(100,dt));J({x:xt,y:lt}),w({x:xt,y:lt,w:0,h:0}),B(!0)},Ee=re=>{if(T)return;if(V){const fe=re.clientX-X.current.x,ze=re.clientY-X.current.y;L(Me=>({x:Me.x+fe/D,y:Me.y+ze/D})),X.current={x:re.clientX,y:re.clientY};return}if(!$||!Y||!te.current||!A)return;const Ce=te.current.getBoundingClientRect(),Ve=te.current.parentElement.getBoundingClientRect(),ft=(re.clientX-Ve.left-H.x*D)/(Ce.width*D)*100,dt=(re.clientY-Ve.top-H.y*D)/(Ce.height*D)*100,xt=Math.max(0,Math.min(100,Math.min(Y.x,ft))),lt=Math.max(0,Math.min(100,Math.min(Y.y,dt))),bt=Math.abs(ft-Y.x),ot=Math.abs(dt-Y.y);w({x:xt,y:lt,w:bt,h:ot})},ie=()=>{if(!T){if(V){G(!1);return}if(Z!==null){pe(null);return}if(!(!$||!A)){if(B(!1),!de||de.w<1||de.h<1){J(null),w(null);return}I(!0)}}},Ie=(re,Ce)=>{if(a.some(dt=>dt.personId===re)){alert("Denna person r redan taggad p bilden!"),I(!1),w(null),J(null);return}const Ye=d.find(dt=>dt.id===re);if(!Ye)return;const Ve={...de,personId:Ye.id,label:`${Ye.firstName} ${Ye.lastName}`,refNumber:Ye.refNumber},ft=[...a,Ve];i(ft),I(!1),w(null),J(null)},P=re=>{if(confirm("Ta bort tagg?")){const Ce=a.filter((Ye,Ve)=>Ve!==re);i(Ce)}},we=(re,Ce)=>{const Ye=a.map((Ve,ft)=>ft===re?Ce:Ve);i(Ye)},ue=re=>{pe(re),R(!1)},Ue=()=>{pe(null)},Q=a.map(re=>{const Ce=d.find(Ye=>Ye.id===re.personId);return Ce?{...Ce,lifeRange:X2(Ce),region:re}:null}).filter(Boolean);return n?o.jsxs(o.Fragment,{children:[o.jsx(Y2,{isOpen:T,onClose:()=>{I(!1),w(null)},people:d,onLink:Ie,skipEventSelection:!0,excludePersonIds:a.map(re=>re.personId).filter(Boolean),zIndex:6e3}),o.jsx(Vs,{title:l||"Bildvisare",onClose:e,initialWidth:1e3,initialHeight:800,children:o.jsxs("div",{className:"flex flex-col h-full bg-slate-900 relative",children:[o.jsxs("div",{className:"flex-1 flex overflow-hidden relative",onMouseUp:ie,onMouseMove:Ee,children:[o.jsxs("div",{className:`flex-1 flex items-center justify-center overflow-hidden p-4 relative ${O?"cursor-grabbing":""}`,onWheel:U,children:[N&&o.jsx("span",{className:"text-white animate-pulse",children:"Laddar bild..."}),j&&o.jsxs("div",{className:"text-red-400 font-bold",children:["Fel: ",j]}),y&&!N&&o.jsxs("div",{className:"relative inline-block",style:{cursor:$?"crosshair":D>1&&Z===null?V?"grabbing":"grab":"default",transform:`scale(${D}) translate(${H.x}px, ${H.y}px)`,transition:V?"none":"transform 0.1s ease-out",transformOrigin:"center center",maxWidth:"100%",maxHeight:"100%"},onMouseDown:ke,children:[o.jsx("img",{ref:te,src:y,alt:l,className:"max-w-full max-h-full block select-none pointer-events-auto",onMouseDown:ge,onDragStart:re=>re.preventDefault()}),a.map((re,Ce)=>o.jsx(QD,{region:re,idx:Ce,people:d,onStartEdit:ue,onStopEdit:Ue,onRegionChange:we,onDelete:P,onOpenPerson:u},re.personId+Ce)),de&&o.jsx("div",{className:"absolute border-2 border-blue-400 bg-blue-400/20",style:{left:`${de.x}%`,top:`${de.y}%`,width:`${de.w}%`,height:`${de.h}%`}})]})]}),Q.length>0&&o.jsxs("div",{className:"w-64 bg-slate-800 p-4 shrink-0 overflow-y-auto text-white border-l border-slate-700",children:[o.jsxs("h4",{className:"text-sm font-bold border-b border-slate-700 pb-2 mb-2",children:["Taggade personer (",Q.length,")"]}),o.jsx("ul",{className:"space-y-3 text-xs",children:Q.map((re,Ce)=>o.jsxs("li",{className:"pb-3 border-b border-slate-700",children:[o.jsxs("div",{className:"text-slate-400",children:["Ref ",re.refNumber]}),o.jsxs("button",{className:"text-blue-300 hover:text-blue-100 hover:underline font-bold text-left block",onClick:()=>u&&u(re.id),title:`ppna redigering fr ${re.firstName} ${re.lastName}`,children:[re.firstName," ",re.lastName]}),o.jsx("div",{className:"text-slate-400",children:re.lifeRange})]},Ce))})]})]}),o.jsxs("div",{className:"bg-slate-800 p-3 border-t border-slate-700 flex justify-between items-center shrink-0",children:[o.jsxs("div",{className:"text-slate-400 text-xs flex gap-4",children:[$?"Klicka och dra en ruta fr att tagga en person.":`${a.length} personer taggade.`,D>1&&o.jsxs("span",{className:"text-sm text-white",children:["Zoom: ",Math.round(D*100),"%"]})]}),o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsx(mt,{onClick:()=>R(re=>!re),variant:$?"danger":"primary",size:"sm",disabled:Z!==null,children:$?"Avbryt Taggning":" Tagga ansikten"}),o.jsx(mt,{onClick:()=>_(1),disabled:D===1,variant:"secondary",size:"sm",children:"terstll zoom"}),o.jsx(mt,{onClick:h,disabled:!g,variant:"secondary",size:"sm",children:""}),o.jsx(mt,{onClick:p,disabled:!b,variant:"secondary",size:"sm",children:""}),o.jsx(mt,{onClick:e,variant:"danger",size:"sm",children:"Avbryt"}),o.jsx(mt,{onClick:e,variant:"primary",size:"sm",children:"OK"})]})]})]})})]}):null}const yp={parent:["Biologisk","Adoptiv","Fosterfrlder","Styvfrlder"],partner:["Gift","Sambo","Frlovad","Skild","Oknd"],child:["Biologiskt","Adoptivbarn","Fosterbarn","Styvbarn"]},vp=[{level:0,label:"Ingen prio",color:"text-slate-400"},{level:1,label:"Lg prio",color:"text-green-400"},{level:2,label:"Mellan prio",color:"text-yellow-400"},{level:3,label:"Hg prio",color:"text-orange-400"},{level:4,label:"Mycket hg prio",color:"text-red-400"},{level:5,label:"Extremt hg prio",color:"text-red-600 font-bold"}],hi=[{value:"Adoption",label:"Adoption",icon:"",unique:!1},{value:"Alternativt namn",label:"Alternativt namn",icon:"",unique:!1},{value:"Annulering av vigsel",label:"Annulering av vigsel",icon:"",unique:!1},{value:"Antal barn",label:"Antal barn",icon:"",unique:!1},{value:"Antal ktenskap",label:"Antal ktenskap",icon:"",unique:!1},{value:"Arkivering av skilsmssa",label:"Arkivering av skilsmssa",icon:"",unique:!1},{value:"Bar mitzvah",label:"Bar mitzvah",icon:"",unique:!0},{value:"Begravning",label:"Begravning",icon:"",unique:!0},{value:"Bosatt",label:"Bosatt",icon:"",unique:!1},{value:"Bouppteckning",label:"Bouppteckning",icon:"",unique:!1},{value:"Dop",label:"Dop",icon:"",unique:!0},{value:"Dop som vuxen",label:"Dop som vuxen",icon:"",unique:!0},{value:"Dd",label:"Dd",icon:"",unique:!0},{value:"Egen hndelse",label:"Egen hndelse",icon:"",unique:!1},{value:"Egendom",label:"Egendom",icon:"",unique:!1},{value:"Emigration",label:"Emigration",icon:"",unique:!1},{value:"Examen",label:"Examen",icon:"",unique:!1},{value:"Faktauppgift",label:"Faktauppgift",icon:"",unique:!1},{value:"Folkrkning",label:"Folkrkning",icon:"",unique:!1},{value:"Fysisk status",label:"Fysisk status",icon:"",unique:!1},{value:"Fdelse",label:"Fdelse",icon:"",unique:!0},{value:"Frlovning",label:"Frlovning",icon:"",unique:!1},{value:"Frsta nattvarden",label:"Frsta nattvarden",icon:"",unique:!0},{value:"Immigration",label:"Immigration",icon:"",unique:!1},{value:"Kast",label:"Kast",icon:"",unique:!1},{value:"Konfirmation",label:"Konfirmation",icon:"",unique:!0},{value:"Kremering",label:"Kremering",icon:"",unique:!0},{value:"Lysning",label:"Lysning",icon:"",unique:!1},{value:"Militrtjnst",label:"Militrtjnst",icon:"",unique:!1},{value:"Nationalitet",label:"Nationalitet",icon:"",unique:!1},{value:"Naturalisering",label:"Naturalisering",icon:"",unique:!1},{value:"Notering",label:"Notering",icon:"",unique:!1},{value:"Pensionering",label:"Pensionering",icon:"",unique:!1},{value:"Personnummer",label:"Personnummer",icon:"",unique:!1},{value:"Prstvigling",label:"Prstvigling",icon:"",unique:!1},{value:"Religionstillhrighet",label:"Religionstillhrighet",icon:"",unique:!1},{value:"Samlevnad",label:"Samlevnad",icon:"",unique:!1},{value:"Samvetsktenskap",label:"Samvetsktenskap",icon:"",unique:!1},{value:"Skilsmssa",label:"Skilsmssa",icon:"",unique:!1},{value:"Socialfrskringsnummer",label:"Socialfrskringsnummer",icon:"",unique:!1},{value:"Testamente",label:"Testamente",icon:"",unique:!1},{value:"Titel",label:"Titel",icon:"",unique:!1},{value:"Troendedop",label:"Troendedop",icon:"",unique:!0},{value:"Utbildning",label:"Utbildning",icon:"",unique:!1},{value:"Vigsel",label:"Vigsel",icon:"",unique:!1},{value:"Vlsignelse",label:"Vlsignelse",icon:"",unique:!1},{value:"Yrke",label:"Yrke",icon:"",unique:!1}],ZD=n=>{if(!n||!n.trim())return"";const e=n.trim();let t="",l=e;const a=e.match(/^(frn|omkring|ca|c|till|fre|efter|mellan)\s+/i);if(a){const i=a[1].toLowerCase();i==="frn"?t="frn ":i==="omkring"||i==="ca"||i==="c"?t="ca ":i==="till"||i==="fre"?t="fre ":i==="efter"?t="efter ":i==="mellan"&&(t="mellan "),l=e.substring(a[0].length)}if(l.includes("-")&&!l.match(/^\d{4}-\d{2}-\d{2}$/)){const i=l.split("-").map(d=>d.trim());if(i.length===2)return`${Np(i[0])} - ${Np(i[1])}`}return t+Np(l)},Np=n=>{if(!n)return"";const e=n.trim();if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(/^\d{8}$/.test(e)){const d=e.substring(0,4),u=e.substring(4,6),h=e.substring(6,8);return`${d}-${u}-${h}`}const t={jan:"01",januari:"01",feb:"02",februari:"02",mar:"03",mars:"03",apr:"04",april:"04",maj:"05",may:"05",jun:"06",juni:"06",jul:"07",juli:"07",aug:"08",augusti:"08",sep:"09",september:"09",okt:"10",oktober:"10",nov:"11",november:"11",dec:"12",december:"12"},l=e.match(/(\d{1,2})\s+([a-z-]+)\s+(\d{4})/i);if(l){const d=l[1].padStart(2,"0"),u=l[2].toLowerCase(),h=l[3],p=t[u];if(p)return`${h}-${p}-${d}`}const a=e.match(/(\d{1,2})[\/\.\-\s](\d{1,2})[\/\.\-\s](\d{4})/);if(a){const d=a[1].padStart(2,"0"),u=a[2].padStart(2,"0");return`${a[3]}-${u}-${d}`}const i=e.match(/(\d{4})[\/\.\-](\d{1,2})[\/\.\-](\d{1,2})/);if(i){const d=i[1],u=i[2].padStart(2,"0"),h=i[3].padStart(2,"0");return`${d}-${u}-${h}`}return/^\d{4}$/.test(e)?e:n},Lv=()=>o.jsxs("div",{className:"flex gap-1 bg-slate-800 p-1 rounded-t border-b border-slate-700 mb-0",children:[["B","I","U"].map(n=>o.jsx("button",{className:"w-6 h-6 flex items-center justify-center hover:bg-slate-700 rounded text-xs font-bold text-slate-300",children:n},n)),o.jsx("div",{className:"w-px h-4 bg-slate-600 mx-1 self-center"}),o.jsx("button",{className:"px-2 h-6 flex items-center justify-center hover:bg-slate-700 rounded text-xs text-slate-300",children:"H1"}),o.jsx("button",{className:"px-2 h-6 flex items-center justify-center hover:bg-slate-700 rounded text-xs text-slate-300",children:"Lista"})]}),WD=({isOpen:n,onClose:e,onAdd:t,eventType:l})=>{const[a,i]=C.useState({type:"Arkiv",title:"",author:"",year:"",citation:"",url:""}),[d,u]=C.useState({x:window.innerWidth/2-250,y:100}),[h,p]=C.useState(!1),[g,b]=C.useState({x:0,y:0}),y=C.useRef(null),v=E=>{if(E.target.closest(".modal-header")){p(!0);const D=y.current.getBoundingClientRect();b({x:E.clientX-D.left,y:E.clientY-D.top})}},N=E=>{h&&u({x:E.clientX-g.x,y:E.clientY-g.y})},S=()=>{p(!1)};C.useEffect(()=>{if(h)return document.addEventListener("mousemove",N),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",S)}},[h,g]);const j=()=>{a.title.trim()&&(t(a),i({type:"Arkiv",title:"",author:"",year:"",citation:"",url:""}),e())};return n?o.jsx("div",{className:"fixed inset-0 z-[4100] flex items-center justify-center bg-black/30",children:o.jsxs("div",{ref:y,className:"bg-slate-800 border border-slate-700 rounded-lg shadow-2xl w-full max-w-md p-0 overflow-hidden",style:{position:"fixed",left:`${d.x}px`,top:`${d.y}px`,maxWidth:"500px"},onMouseDown:v,children:[o.jsxs("div",{className:"modal-header bg-slate-900 p-4 border-b border-slate-700 flex justify-between items-center cursor-move",children:[o.jsx("h3",{className:"font-bold text-white",children:"Lgg till klla"}),o.jsx("button",{onClick:e,className:"text-slate-400 hover:text-white",children:o.jsx(ys,{size:20})})]}),o.jsxs("div",{className:"p-6 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Klltyp"}),o.jsxs("select",{value:a.type,onChange:E=>i({...a,type:E.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white focus:border-blue-500 focus:outline-none",children:[o.jsx("option",{children:"Arkiv"}),o.jsx("option",{children:"Bok"}),o.jsx("option",{children:"Artikel"}),o.jsx("option",{children:"Webb"}),o.jsx("option",{children:"Familjebok"}),o.jsx("option",{children:"vrigt"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Titel"}),o.jsx("input",{type:"text",value:a.title,onChange:E=>i({...a,title:E.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white focus:border-blue-500 focus:outline-none",placeholder:"Kllans titel"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Frfattare"}),o.jsx("input",{type:"text",value:a.author,onChange:E=>i({...a,author:E.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white focus:border-blue-500 focus:outline-none",placeholder:"Namn"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"r"}),o.jsx("input",{type:"text",value:a.year,onChange:E=>i({...a,year:E.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-200 focus:border-blue-500 focus:outline-none",placeholder:""})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Citat/Referens"}),o.jsx("textarea",{value:a.citation,onChange:E=>i({...a,citation:E.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-200 focus:border-blue-500 focus:outline-none resize-none",rows:"3",placeholder:"Relevanta citat eller sidnummer"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"URL (valfritt)"}),o.jsx("input",{type:"url",value:a.url,onChange:E=>i({...a,url:E.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-200 focus:border-blue-500 focus:outline-none",placeholder:"https://..."})]})]}),o.jsxs("div",{className:"bg-slate-900 p-4 border-t border-slate-700 flex justify-end gap-3",children:[o.jsx("button",{onClick:e,className:"px-4 py-2 text-sm text-slate-400 hover:text-white",children:"Avbryt"}),o.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-medium transition-colors",children:"Lgg till klla"})]})]})}):null};function eO({person:n,allPlaces:e,onSave:t,onClose:l,onOpenSourceDrawer:a,allSources:i,allPeople:d,onOpenEditModal:u}){const[h,p]=C.useState("info"),[g,b]=C.useState(null),[y,v]=C.useState(!1),[N,S]=C.useState({x:50,y:50}),[j,E]=C.useState(!1),[D,_]=C.useState({x:0,y:0});C.useRef(null);const H=ee=>{if(!ee||!ee.events)return{birthYear:null,deathYear:null,lifeSpan:null};const oe=ee.events.find(_t=>_t.type==="Fdelse"),xe=ee.events.find(_t=>_t.type==="Dd"),$e=oe&&oe.date?oe.date.substring(0,4):null,Xt=xe&&xe.date?xe.date.substring(0,4):null;let Ot=null;return $e&&Xt&&(Ot=parseInt(Xt)-parseInt($e)),{birthYear:$e,deathYear:Xt,lifeSpan:Ot}},L=(ee,oe)=>{if(!ee||!oe)return null;const xe=parseInt(ee.substring(0,4)),$e=parseInt(oe.substring(0,4));return isNaN(xe)||isNaN($e)?null:$e-xe},V=()=>R.events?[...R.events].sort((ee,oe)=>{const xe=ee.date||"",$e=oe.date||"";return xe.localeCompare($e)}):[],G=ee=>{let oe=ee?.placeData;if(!oe&&ee?.placeId&&e&&(oe=e.find($e=>$e.id===ee.placeId)),!oe)return ee?.place||"";const xe=[oe.gard,oe.by,oe.specific,oe.village,oe.socken,oe.sockenstadnamn,oe.parish,oe.kommunnamn,oe.municipality,oe.lansnamn,oe.region,oe.land,oe.country].filter(Boolean);return xe.length>0?xe.join(", "):oe.name||oe.ortnamn||""},X=ee=>{j&&S({x:ee.clientX-D.x,y:ee.clientY-D.y})},$=()=>{E(!1)};C.useEffect(()=>{if(j)return document.addEventListener("mousemove",X),document.addEventListener("mouseup",$),()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",$)}},[j,D]);const[R,A]=C.useState(()=>{const ee=n||{id:"I_new",refId:"",firstName:"",lastName:"",sex:"U",birthDate:"",deathDate:"",birthPlace:"",deathPlace:"",tags:[],events:[],relations:{parents:[],partners:[],children:[]},research:[],media:[],notes:[]};return Array.isArray(ee.events)||(ee.events=[]),ee}),[B,Y]=C.useState(!1),[J,de]=C.useState(!1),[w,T]=C.useState(null),[I,Z]=C.useState({x:window.innerWidth/2-300,y:100}),[pe,O]=C.useState(!1),[te,ke]=C.useState({x:0,y:0});C.useRef(null);const[U,ge]=C.useState(!1),[Ee,ie]=C.useState(""),[Ie,P]=C.useState(0),we=C.useRef(null),[ue,Ue]=C.useState({id:`evt_${Date.now()}`,type:"Fdelse",date:"",place:"",placeId:"",sources:[],images:0,notes:""}),[Q,re]=C.useState(""),[Ce,Ye]=C.useState(null),[Ve,ft]=C.useState(0);C.useEffect(()=>{ft(ee=>ee+1)},[i]);const dt=ee=>{const oe=hi.find(xe=>xe.value===ee);return!oe||!oe.unique?!0:!R.events?.some(xe=>xe.type===ee)},xt=ee=>{if((ee.key==="Enter"||ee.key===",")&&Q.trim()){ee.preventDefault();const oe=Q.replace(",","").trim();R.tags.includes(oe)||A({...R,tags:[...R.tags,oe]}),re("")}},lt=ee=>{A({...R,tags:R.tags.filter(oe=>oe!==ee)})},bt=()=>{T(null),Ue({id:`evt_${Date.now()}`,type:"Fdelse",date:"",place:"",placeId:"",placeData:null,sources:[],images:0,notes:""}),Y(!0)},ot=ee=>{T(ee),Ue(R.events[ee]),Y(!0)},fe=()=>{if(w===null&&hi.find(oe=>oe.value===ue.type)?.unique&&R.events?.some(oe=>oe.type===ue.type)){alert(`Hndelsen "${ue.type}" finns redan och kan bara lggas till en gng.`);return}if(w!==null){const ee=R.events.map((oe,xe)=>xe===w?ue:oe);A({...R,events:ee})}else A({...R,events:[...R.events,ue]});Y(!1),T(null),Ue({id:`evt_${Date.now()}`,type:"Fdelse",date:"",place:"",placeId:"",placeData:null,sources:[],images:0,notes:""})},ze=ee=>{A({...R,events:R.events.filter((oe,xe)=>xe!==ee)})},Me=ee=>{const oe={...ue,sources:[...ue.sources||[],{id:`src_${Date.now()}`,...ee}]};Ue(oe)},He=ee=>{pe&&Z({x:ee.clientX-te.x,y:ee.clientY-te.y})},et=()=>{O(!1)};C.useEffect(()=>{if(pe)return document.addEventListener("mousemove",He),document.addEventListener("mouseup",et),()=>{document.removeEventListener("mousemove",He),document.removeEventListener("mouseup",et)}},[pe,te]);const st=()=>{if(!Ee)return hi;const ee=Ee.toLowerCase();return hi.filter(oe=>oe.label.toLowerCase().includes(ee))},rt=ee=>{const oe=st();if(ee.key==="ArrowDown")ee.preventDefault(),P(xe=>Math.min(xe+1,oe.length-1));else if(ee.key==="ArrowUp")ee.preventDefault(),P(xe=>Math.max(xe-1,0));else if(ee.key==="Enter"){if(ee.preventDefault(),oe[Ie]){const xe=oe[Ie];(w!==null||dt(xe.value))&&(Ue({...ue,type:xe.value}),ge(!1),ie(""),P(0))}}else ee.key==="Escape"&&(ge(!1),ie(""),P(0))},ht=ee=>{(w!==null||dt(ee))&&(Ue({...ue,type:ee}),ge(!1),ie(""),P(0))};C.useEffect(()=>{Ee!==""&&P(0)},[Ee]),C.useEffect(()=>{const ee=oe=>{we.current&&!we.current.contains(oe.target)&&(ge(!1),ie(""),P(0))};if(U)return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[U]),C.useEffect(()=>{const ee=oe=>{if(h!=="media")return;const xe=oe.clipboardData.items;for(let $e=0;$e<xe.length;$e++)if(xe[$e].type.indexOf("image")!==-1){const Xt=xe[$e].getAsFile(),Ot=URL.createObjectURL(Xt);A(_t=>({..._t,media:[..._t.media,{id:`img_${Date.now()}`,url:Ot,name:"Urklipp.png",type:"image"}]}))}};return window.addEventListener("paste",ee),()=>window.removeEventListener("paste",ee)},[h]);const St=async()=>{try{t&&await t(R),l&&l()}catch(ee){console.error("Error saving person:",ee)}};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"w-full h-full bg-slate-800 flex flex-col overflow-hidden",children:["        ",o.jsxs("div",{className:"modal-header h-16 bg-slate-700 border-b border-slate-600 flex items-center justify-between px-6 shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-4 select-none",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-600 overflow-hidden border-2 border-slate-500 pointer-events-none",children:R.media?.length>0?o.jsx("img",{src:R.media[0].url,alt:"Profil",className:"w-full h-full object-cover"}):o.jsx(Rr,{className:"w-full h-full p-1 text-slate-400"})}),o.jsxs("div",{children:[o.jsxs("h1",{className:"text-lg font-bold text-slate-200 leading-tight",children:[R.firstName," ",R.lastName]}),o.jsx("p",{className:"text-xs text-slate-400",children:(()=>{const{birthYear:ee,deathYear:oe,lifeSpan:xe}=H(R);return ee&&oe&&xe!==null?`${ee}  ${oe} (ca. ${xe} r)`:ee&&oe?`${ee}  ${oe}`:ee?`${ee}  Levande`:"?  ?"})()})]})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("nav",{className:"flex gap-1",children:[{id:"info",icon:Rr,label:"Info"},{id:"relations",icon:bu,label:"Relationer"},{id:"media",icon:Or,label:"Media"},{id:"notes",icon:wo,label:"Noteringar"},{id:"research",icon:Hh,label:"Forskning"},{id:"tags",icon:i1,label:"Taggar"}].map(ee=>o.jsxs("button",{onClick:()=>p(ee.id),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium transition-all relative ${h===ee.id?"bg-slate-900 text-blue-400 border-b-2 border-blue-500":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50 border-b-2 border-transparent"}`,children:[o.jsx(ee.icon,{size:16}),o.jsx("span",{children:ee.label})]},ee.id))})})]}),o.jsx("div",{className:"flex-1 overflow-hidden flex bg-slate-900 relative",children:o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",children:[h==="info"&&o.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[o.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[o.jsx("div",{className:"col-span-2",children:o.jsxs("div",{className:"aspect-[3/4] bg-slate-700 rounded-lg border border-slate-600 flex items-center justify-center relative group cursor-pointer overflow-hidden",children:[R.media?.length>0?o.jsx("img",{src:R.media[0].url,alt:"Profil",className:"w-full h-full object-cover"}):o.jsx(Rr,{size:40,className:"text-slate-400"}),o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(Mp,{size:20,className:"text-white"})})]})}),o.jsxs("div",{className:"col-span-10 grid grid-cols-2 gap-4 content-start",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs uppercase font-bold text-slate-300",children:"Frnamn"}),o.jsx("input",{type:"text",value:R.firstName,onChange:ee=>A({...R,firstName:ee.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-slate-200 focus:border-blue-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs uppercase font-bold text-slate-300",children:"Efternamn"}),o.jsx("input",{type:"text",value:R.lastName,onChange:ee=>A({...R,lastName:ee.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-slate-200 focus:border-blue-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs uppercase font-bold text-slate-300",children:"Kn"}),o.jsxs("select",{value:R.sex,onChange:ee=>A({...R,sex:ee.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-slate-200 focus:border-blue-500 focus:outline-none",children:[o.jsx("option",{value:"M",children:"Man"}),o.jsx("option",{value:"K",children:"Kvinna"}),o.jsx("option",{value:"U",children:"Oknd"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs uppercase font-bold text-slate-300",children:"Ref Nr"}),o.jsx("input",{type:"text",value:R.refId,onChange:ee=>A({...R,refId:ee.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-slate-200 focus:border-blue-500 focus:outline-none"})]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h3",{className:"text-md font-bold text-slate-200 uppercase tracking-wide flex items-center gap-2",children:[o.jsx(Hh,{size:16,className:"text-blue-600"})," Livshndelser"]}),o.jsxs("button",{onClick:bt,className:"flex items-center gap-1 text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded transition-colors",children:[o.jsx(gl,{size:14})," Lgg till hndelse"]})]}),o.jsx("div",{className:"bg-slate-900 rounded-lg border border-slate-700 overflow-hidden",children:o.jsxs("table",{className:"w-full text-sm text-left",children:[o.jsx("thead",{className:"bg-slate-800 text-slate-300 text-xs uppercase",children:o.jsxs("tr",{children:[o.jsx("th",{className:"p-3",children:"lder"}),o.jsx("th",{className:"p-3",children:"Typ"}),o.jsx("th",{className:"p-3",children:"Datum"}),o.jsx("th",{className:"p-3",children:"Plats"}),o.jsx("th",{className:"p-3 text-center",children:"Info"}),o.jsx("th",{className:"p-3 text-right"})]})}),o.jsxs("tbody",{className:"divide-y divide-gray-200",children:[V().map((ee,oe)=>{const xe=L(R.events?.find($e=>$e.type==="Fdelse")?.date,ee.date);return o.jsxs("tr",{onClick:()=>{console.log("Livshndelse clicked:",{editingEventIndex:w,selectedEventIndex:Ce,idx:oe}),w===null&&Ye(Ce===oe?null:oe)},className:`hover:bg-slate-800 transition-colors group cursor-pointer ${Ce===oe&&w===null?"bg-blue-900/30 border-l-4 border-blue-500":""}`,children:[o.jsx("td",{className:"p-3 text-slate-300",children:xe!==null?`${xe} r`:"-"}),o.jsx("td",{className:"p-3 font-medium text-slate-200",children:ee.type}),o.jsx("td",{className:"p-3 font-mono text-slate-300",children:ee.date||"-"}),o.jsxs("td",{className:"p-3 text-blue-600 hover:underline cursor-pointer flex items-center gap-1",title:G(ee),children:[o.jsx(Ni,{size:12})," ",ee.place||"-"]}),o.jsx("td",{className:"p-3",children:o.jsxs("div",{className:"flex justify-center gap-3 text-xs text-slate-400",children:[o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${ee.sources?.length>0?"text-slate-200":""}`,onClick:$e=>{$e.stopPropagation(),Ye(oe)},children:[o.jsx(Po,{size:12})," ",ee.sources?.length||0]}),o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${ee.notes?"text-slate-200":""}`,onClick:$e=>{$e.stopPropagation()},title:ee.notes||"",children:[o.jsx(wo,{size:12})," ",ee.notes?1:0]}),o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${ee.images>0?"text-slate-200":""}`,onClick:$e=>{$e.stopPropagation()},children:[o.jsx(Or,{size:12})," ",ee.images||0]})]})}),o.jsxs("td",{className:"p-3 text-right flex gap-2 justify-end",children:[o.jsx("button",{onClick:$e=>{$e.stopPropagation(),ot(oe)},className:"text-slate-400 hover:text-slate-300 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(Xb,{size:14})}),o.jsx("button",{onClick:$e=>{$e.stopPropagation(),ze(oe)},className:"text-slate-400 hover:text-red-600 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(ol,{size:14})})]})]},ee.id||oe)}),(!R.events||R.events.length===0)&&o.jsx("tr",{children:o.jsx("td",{colSpan:"5",className:"p-4 text-center text-slate-400 text-sm",children:"Inga hndelser tillagda n"})})]})]})})]})]}),h==="relations"&&o.jsxs("div",{className:"space-y-8 animate-in fade-in duration-300",children:[o.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700",children:[o.jsxs("div",{className:"flex justify-between mb-2",children:[o.jsx("h4",{className:"text-sm font-bold text-slate-200 uppercase",children:"Frldrar"}),o.jsxs("button",{className:"text-blue-600 hover:text-blue-800 text-xs flex items-center gap-1",children:[o.jsx(gl,{size:12})," Lgg till"]})]}),R.relations?.parents?.length>0?R.relations.parents.map((ee,oe)=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded mb-2 border border-slate-600",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-slate-400",children:o.jsx(Rr,{size:16})}),o.jsx("span",{className:"text-slate-200 font-medium",children:ee.name})]}),o.jsx("select",{className:"bg-slate-900 border border-slate-600 text-xs rounded px-2 py-1 text-slate-200",children:yp.parent.map(xe=>o.jsx("option",{children:xe},xe))})]},oe)):o.jsx("p",{className:"text-xs text-slate-400",children:"Ingen frlder tillagd"})]}),o.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700",children:[o.jsxs("div",{className:"flex justify-between mb-2",children:[o.jsx("h4",{className:"text-sm font-bold text-slate-200 uppercase",children:"Partner"}),o.jsxs("button",{className:"text-blue-600 hover:text-blue-800 text-xs flex items-center gap-1",children:[o.jsx(gl,{size:12})," Lgg till"]})]}),R.relations?.partners?.length>0?R.relations.partners.map((ee,oe)=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded mb-2 border border-slate-600",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-slate-400",children:o.jsx(Rr,{size:16})}),o.jsx("span",{className:"text-slate-200 font-medium",children:ee.name})]}),o.jsx("select",{className:"bg-slate-900 border border-slate-600 text-xs rounded px-2 py-1 text-slate-200",children:yp.partner.map(xe=>o.jsx("option",{children:xe},xe))})]},oe)):o.jsx("p",{className:"text-xs text-slate-400",children:"Ingen partner tillagd"})]}),o.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700",children:[o.jsxs("div",{className:"flex justify-between mb-2",children:[o.jsx("h4",{className:"text-sm font-bold text-slate-200 uppercase",children:"Barn"}),o.jsxs("button",{className:"text-blue-600 hover:text-blue-800 text-xs flex items-center gap-1",children:[o.jsx(gl,{size:12})," Lgg till"]})]}),R.relations?.children?.length>0?R.relations.children.map((ee,oe)=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-900 p-2 rounded mb-2 border border-slate-700",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-slate-400",children:o.jsx(Rr,{size:16})}),o.jsx("span",{className:"text-slate-200 font-medium",children:ee.name})]}),o.jsx("select",{className:"bg-slate-900 border border-slate-600 text-xs rounded px-2 py-1 text-slate-200",children:yp.child.map(xe=>o.jsx("option",{children:xe},xe))})]},oe)):o.jsx("p",{className:"text-xs text-slate-400",children:"Inget barn tillagd"})]})]}),h==="media"&&o.jsxs("div",{className:"animate-in fade-in duration-300 h-full flex gap-4",children:[o.jsxs("div",{className:"w-48 flex flex-col gap-2",children:[o.jsx("p",{className:"text-xs text-slate-400",children:"Bilder"}),o.jsxs("div",{className:"flex-1 flex flex-col gap-3 overflow-y-auto",children:[R.media?.map((ee,oe)=>o.jsxs("div",{onClick:()=>b(oe),className:`group relative cursor-pointer rounded border-2 transition-all ${g===oe?"border-blue-500 ring-2 ring-blue-500/50":"border-slate-600 hover:border-slate-500"}`,children:[o.jsxs("div",{className:"aspect-square bg-slate-700 rounded overflow-hidden relative",children:[o.jsx("img",{src:ee.url,alt:ee.name,className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2 transition-opacity",children:o.jsx("button",{className:"p-1 bg-slate-600 rounded hover:bg-red-600 text-white",children:o.jsx(ol,{size:12})})})]}),o.jsx("p",{className:"text-xs text-center mt-1 truncate text-slate-300 px-1",children:ee.name})]},ee.id)),o.jsxs("div",{className:"aspect-square flex flex-col items-center justify-center border-2 border-slate-600 border-dashed rounded hover:border-slate-500 hover:bg-slate-700 transition-colors cursor-pointer text-slate-400 hover:text-slate-300",children:[o.jsx(gl,{size:24}),o.jsx("span",{className:"text-xs mt-2",children:"Lgg till"})]})]})]}),o.jsx("div",{className:"flex-1 flex flex-col gap-2",children:g!==null&&R.media?.[g]?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("p",{className:"text-sm text-slate-300 font-medium",children:R.media[g].name}),o.jsxs("button",{onClick:()=>v(!0),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded flex items-center gap-2 transition-colors",children:[o.jsx(Mp,{size:16}),"Ansiktstagga"]})]}),o.jsx("div",{className:"flex-1 border-2 border-slate-600 rounded-lg bg-slate-900 flex items-center justify-center overflow-hidden",children:o.jsx("img",{src:R.media[g].url,alt:R.media[g].name,className:"max-w-full max-h-full object-contain"})})]}):o.jsx("div",{className:"flex-1 border-2 border-dashed border-slate-600 rounded-lg bg-slate-800 flex items-center justify-center text-slate-400",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Or,{size:48,className:"mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"Vlj eller lgg till en bild"}),o.jsx("p",{className:"text-xs mt-1",children:"Dra och slpp eller klistra in (Ctrl+V)"})]})})}),o.jsx(l0,{isOpen:y,onClose:()=>v(!1),imageSrc:g!==null&&R.media?.[g]?.url,imageTitle:g!==null&&R.media?.[g]?.name,regions:g!==null&&R.media?.[g]?.regions||[],onSaveRegions:ee=>{if(g!==null){const oe=[...R.media];oe[g]={...oe[g],regions:ee},A({...R,media:oe})}},people:d,onOpenEditModal:u})]}),h==="research"&&o.jsxs("div",{className:"animate-in fade-in duration-300",children:[o.jsxs("div",{className:"flex justify-between mb-4",children:[o.jsx("h3",{className:"text-md font-bold text-slate-200 uppercase",children:"Forskningsuppgifter"}),o.jsxs("button",{className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1",children:[o.jsx(gl,{size:14})," Ny uppgift"]})]}),o.jsx("div",{className:"space-y-3",children:R.research?.map((ee,oe)=>{const xe=vp.find($e=>$e.level===ee.priority)||vp[0];return o.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 hover:border-slate-600 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"text",defaultValue:ee.task,className:"bg-transparent font-medium text-slate-200 w-full focus:outline-none focus:border-b border-blue-500"})}),o.jsxs("div",{className:"flex gap-2 ml-4",children:[o.jsx("select",{className:`bg-slate-900 border border-slate-700 text-xs rounded px-2 py-1 text-slate-200 ${xe.color}`,defaultValue:ee.priority,children:vp.map($e=>o.jsxs("option",{value:$e.level,children:[$e.level," - ",$e.label]},$e.level))}),o.jsx("button",{className:"text-slate-400 hover:text-red-600",children:o.jsx(ol,{size:16})})]})]}),o.jsxs("div",{className:"bg-slate-800 rounded border border-slate-700 mt-2",children:[o.jsx(Lv,{}),o.jsx("textarea",{className:"w-full bg-transparent text-sm text-slate-200 p-2 focus:outline-none min-h-[60px] resize-y",defaultValue:ee.notes})]})]},oe)})})]}),h==="tags"&&o.jsxs("div",{className:"animate-in fade-in duration-300",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-2",children:"Hantera Taggar"}),o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx("input",{type:"text",className:"bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-slate-200 w-64 focus:outline-none focus:border-blue-500",placeholder:"Skriv tagg och tryck Enter...",value:Q,onChange:ee=>re(ee.target.value),onKeyDown:xt}),o.jsx("p",{className:"text-xs text-slate-400",children:"Separera med komma eller enter."})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:R.tags?.map(ee=>o.jsxs("span",{className:"flex items-center gap-1 bg-green-100 border border-green-300 text-green-800 px-3 py-1 rounded-full text-sm",children:[ee,o.jsx("button",{onClick:()=>lt(ee),className:"hover:text-green-900",children:o.jsx(ys,{size:14})})]},ee))})]}),h==="notes"&&o.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[o.jsx("div",{className:"flex justify-end",children:o.jsxs("button",{className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1",children:[o.jsx(gl,{size:14})," Ny notering"]})}),R.notes?.map((ee,oe)=>o.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"bg-slate-800 p-2 border-b border-slate-700 flex justify-between items-center",children:[o.jsx("input",{type:"text",defaultValue:ee.title,className:"bg-transparent font-bold text-sm text-slate-200 focus:outline-none"}),o.jsx("div",{className:"flex gap-2",children:o.jsx("button",{className:"text-slate-400 hover:text-red-600",children:o.jsx(ol,{size:14})})})]}),o.jsx(Lv,{}),o.jsx("textarea",{className:"w-full bg-slate-800 text-sm text-slate-200 p-3 focus:outline-none min-h-[150px] resize-y",defaultValue:ee.content})]},oe))]})]})}),Ce!==null&&w===null&&R.events?.[Ce]&&o.jsxs("div",{className:"bg-slate-800 border-t border-slate-700 p-4 max-h-40 overflow-y-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-slate-700",children:[o.jsxs("h4",{className:"text-sm font-bold text-slate-200",children:[R.events[Ce].type,R.events[Ce].date&&` - ${R.events[Ce].date}`]}),o.jsxs("div",{className:"flex gap-3 text-xs text-slate-400",children:[o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${R.events[Ce].sources?.length>0?"text-slate-200":""}`,children:[o.jsx(Po,{size:12})," ",R.events[Ce].sources?.length||0]}),o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${R.events[Ce].notes?"text-slate-200":""}`,title:R.events[Ce].notes||"",children:[o.jsx(wo,{size:12})," ",R.events[Ce].notes?1:0]}),o.jsxs("span",{className:`flex items-center gap-1 cursor-pointer hover:text-blue-600 ${R.events[Ce].images>0?"text-slate-200":""}`,children:[o.jsx(Or,{size:12})," ",R.events[Ce].images||0]})]})]}),R.events[Ce].sources&&R.events[Ce].sources.length>0?o.jsx("div",{className:"space-y-2",children:R.events[Ce].sources.map(ee=>{let oe=i?.find($e=>$e.id===ee);if(!oe)return null;const xe={...oe,year:oe.date||oe.year,image:oe.imagePage||oe.image,credibility:oe.trust||oe.credibility};return console.log(" SOURCE FOR DISPLAY (mapped):",{sourceId:ee,title:xe.title,volume:xe.volume,year:xe.year,image:xe.image,page:xe.page,credibility:xe.credibility,allSourcesLength:i?.length}),o.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 flex items-start gap-3",children:[o.jsx("div",{className:"flex gap-1 items-start",children:xe.images&&xe.images.length>0?xe.images.slice(0,3).map(($e,Xt)=>o.jsxs("div",{className:"relative group",children:[o.jsx("img",{src:$e.url||$e.thumbnail||$e,alt:"Thumbnail",className:"h-8 w-8 object-cover rounded cursor-pointer border border-slate-600 hover:border-blue-500",onClick:()=>{const Ot=$e.url||$e;window.open(Ot,"_blank")}}),o.jsx("div",{className:"absolute hidden group-hover:block z-50 bg-slate-900 border border-slate-600 rounded shadow-lg p-1 left-0 top-10",children:o.jsx("img",{src:$e.url||$e,alt:"Preview",className:"h-32 w-32 object-cover rounded"})})]},Xt)):o.jsx("div",{className:"h-8 w-8 bg-slate-700 rounded flex items-center justify-center text-slate-400",children:o.jsx(Or,{size:12})})}),o.jsxs("div",{className:"flex-1 text-xs",children:[o.jsxs("div",{className:"font-semibold text-slate-200 mb-1",children:[xe.title||"Ingen titel",xe.location&&` (${xe.location})`,xe.volume&&` vol. ${xe.volume}`,xe.year&&` (${xe.year})`,xe.image&&` Bild ${xe.image}`,xe.page&&` / Sida ${xe.page}`]}),o.jsxs("div",{className:"flex gap-0.5 mt-1 items-center",children:[o.jsx("span",{className:"text-xs text-slate-400 mr-1",children:"Trovrdighet:"}),[...Array(5)].map(($e,Xt)=>o.jsx("span",{className:Xt<(xe.credibility||0)?"text-yellow-500":"text-slate-600",children:""},Xt)),xe.credibilityLabel&&o.jsx("span",{className:"ml-1 text-slate-300 text-xs",children:xe.credibilityLabel})]}),o.jsxs("div",{className:"flex gap-2 mt-1",children:[o.jsx("button",{className:`px-2 py-0.5 rounded text-xs font-semibold ${xe.aid?"bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer":"bg-slate-700 text-slate-500 cursor-default"}`,title:xe.aid?`AID: ${xe.aid}`:"Inte lnkat till Arkivdigital",onClick:()=>xe.aid&&window.open(`https://sok.riksarkivet.se/bildvisning/${xe.aid}`,"_blank"),children:"AD"}),o.jsx("button",{className:`px-2 py-0.5 rounded text-xs font-semibold ${xe.bildId?"bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer":"bg-slate-700 text-slate-500 cursor-default"}`,title:xe.bildId?`BILDID: ${xe.bildId}`:"Inte lnkat till Riksarkivet",onClick:()=>xe.bildId&&window.open(`https://www.riksarkivet.se/bildvisning/${xe.bildId}`,"_blank"),children:"RA"}),o.jsx("button",{className:`px-2 py-0.5 rounded text-xs font-semibold ${xe.nad?"bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer":"bg-slate-700 text-slate-500 cursor-default"}`,title:xe.nad?`NAD: ${xe.nad}`:"Inte lnkat till NAD",onClick:()=>xe.nad&&window.open(`https://nad.ra.se/${xe.nad}`,"_blank"),children:"NAD"})]}),xe.notes&&o.jsx("div",{className:"mt-1 text-slate-400 text-xs italic line-clamp-1",children:xe.notes})]}),o.jsxs("div",{className:"flex gap-1 ml-2 items-center text-xs",children:[xe.notes&&o.jsxs("div",{className:"relative group",children:[o.jsxs("button",{className:"text-slate-400 hover:text-blue-600 p-1 flex items-center gap-0.5",title:"Noter",children:[o.jsx(wo,{size:12}),o.jsx("span",{className:"text-slate-400",children:"1"})]}),o.jsxs("div",{className:"absolute hidden group-hover:block z-50 bg-slate-900 text-white text-xs rounded shadow-lg p-2 right-0 top-6 min-w-max max-w-xs whitespace-normal",children:[xe.notes,o.jsx("div",{className:"absolute top-0 right-2 transform -translate-y-1 w-2 h-2 bg-slate-900 rotate-45"})]})]}),xe.images&&xe.images.length>0&&o.jsxs("button",{className:"text-slate-400 hover:text-blue-600 p-1 flex items-center gap-0.5",title:`${xe.images.length} bilder`,children:[o.jsx(Or,{size:12}),o.jsx("span",{className:"text-slate-400",children:xe.images.length})]}),o.jsx("button",{onClick:()=>{a&&(a(R.id,null),console.log("Opening source drawer to edit source:",ee))},className:"text-slate-400 hover:text-blue-600 p-1",title:"Redigera klla",children:o.jsx(Xb,{size:14})}),o.jsx("button",{onClick:()=>{const $e=R.events[Ce].sources.filter(Ot=>Ot!==ee),Xt=R.events.map((Ot,_t)=>_t===Ce?{...Ot,sources:$e}:Ot);A({...R,events:Xt})},className:"text-slate-400 hover:text-red-600 p-1",title:"Ta bort klla",children:o.jsx(ol,{size:14})})]})]},ee)})},`sources-${Ve}`):o.jsx("p",{className:"text-xs text-slate-400",children:"Ingen klla kopplad till denna hndelse"})]}),o.jsxs("div",{className:"h-16 bg-slate-900 border-t border-slate-700 flex items-center justify-between px-6 shrink-0",children:[o.jsxs("div",{className:"text-xs text-slate-400",children:["Senast ndrad: ",new Date().toISOString().split("T")[0]]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-slate-400 hover:text-white transition-colors",children:"Avbryt"}),o.jsxs("button",{onClick:St,className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded font-medium shadow-lg transition-all transform hover:scale-[1.02]",children:[o.jsx(a1,{size:18})," Spara ndringar"]})]})]})]}),B&&o.jsx(Vs,{title:`${w!==null?"Redigera":"Lgg till"} hndelse`,icon:Hh,initialWidth:600,initialHeight:650,onClose:()=>{Y(!1),T(null)},children:o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"p-6 space-y-4 flex-1 overflow-y-auto",children:[o.jsxs("div",{ref:we,className:"relative",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Hndelsetyp"}),o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"text",value:U?Ee:hi.find(ee=>ee.value===ue.type)?.label||"",onChange:ee=>{ie(ee.target.value),U||ge(!0)},onFocus:()=>{ge(!0),ie("")},onKeyDown:rt,placeholder:"Sk hndelsetyp...",className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-200 focus:border-blue-500 focus:outline-none"}),U&&o.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-slate-900 border border-slate-600 rounded shadow-lg max-h-60 overflow-y-auto",children:[st().map((ee,oe)=>{const xe=ee.unique&&w===null&&!dt(ee.value),$e=oe===Ie;return o.jsxs("div",{onClick:()=>!xe&&ht(ee.value),className:`px-3 py-2 cursor-pointer flex items-center gap-2 ${$e?"bg-blue-500 text-white":"hover:bg-slate-800 text-slate-200"} ${xe?"opacity-50 cursor-not-allowed":""}`,children:[o.jsx("span",{children:ee.icon}),o.jsx("span",{children:ee.label}),xe&&o.jsx("span",{className:"text-xs ml-auto",children:"(finns redan)"})]},ee.value)}),st().length===0&&o.jsx("div",{className:"px-3 py-2 text-slate-400 text-sm",children:"Inga matchande hndelsetyper"})]})]}),ue.type&&hi.find(ee=>ee.value===ue.type)?.unique&&w===null&&!dt(ue.type)&&o.jsx("p",{className:"text-xs text-amber-600 mt-1",children:" Denna hndelse kan bara lggas till en gng"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Datum"}),o.jsxs("div",{className:"relative",children:[o.jsx(e1,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),o.jsx("input",{type:"text",placeholder:"t.ex. 21 nov 1980, frn 1950, ca 1920",value:ue.date,onChange:ee=>Ue({...ue,date:ee.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded pl-9 p-2 text-slate-200 focus:border-blue-500 focus:outline-none",onBlur:ee=>Ue({...ue,date:ZD(ee.target.value)})})]}),o.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Format: -MM-DD, eller skriv naturligt"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Plats"}),o.jsx(XD,{value:ue.placeId||"",displayValue:ue.place||"",allPlaces:e||[],onChange:(ee,oe)=>{const xe=oe&&(oe.name||oe.ortnamn||oe.sockenstadnamn)||"";Ue({...ue,placeId:ee,place:xe,placeData:oe})}})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Kllor"}),o.jsxs("button",{onClick:()=>{a?(window.__addSourceToEvent=ee=>{Ue(oe=>({...oe,sources:oe.sources.includes(ee)?oe.sources:[...oe.sources,ee]}))},a(R.id,"__editing__")):de(!0)},className:"text-xs bg-slate-700 hover:bg-slate-600 text-blue-400 px-2 py-1 rounded flex items-center gap-1",children:[o.jsx(gl,{size:12})," Lgg till klla"]})]}),ue.sources&&ue.sources.length>0?o.jsx("div",{className:"space-y-2",children:ue.sources.map((ee,oe)=>{const xe=i?.find($e=>$e.id===ee);return xe?o.jsxs("div",{className:"bg-slate-800 p-3 rounded text-sm border border-slate-700 flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("p",{className:"font-semibold text-slate-200 mb-1",children:[xe.title||"Ingen titel",xe.location&&` / ${xe.location}`,xe.volume&&` vol. ${xe.volume}`,xe.year&&` (${xe.year})`]}),xe.aid&&o.jsxs("a",{href:`https://sok.riksarkivet.se/bildvisning/${xe.aid}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline text-xs",onClick:$e=>$e.stopPropagation(),children:["AID: ",xe.aid]})]}),o.jsx("div",{className:"flex gap-2 ml-3",children:o.jsx("button",{onClick:()=>Ue({...ue,sources:ue.sources.filter($e=>$e!==ee)}),className:"text-slate-400 hover:text-red-600 p-1",title:"Ta bort klla",children:o.jsx(ol,{size:14})})})]},ee):null})}):o.jsx("p",{className:"text-xs text-slate-400",children:"Ingen klla tillagd"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Noteringar"}),o.jsx("textarea",{value:ue.notes,onChange:ee=>Ue({...ue,notes:ee.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-200 focus:border-blue-500 focus:outline-none text-sm resize-none",rows:"3",placeholder:"Lgg till noter fr denna hndelse..."})]})]}),o.jsxs("div",{className:"bg-slate-800 p-4 border-t border-slate-700 flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>{Y(!1),T(null)},className:"px-4 py-2 text-sm text-slate-400 hover:text-white",children:"Avbryt"}),o.jsxs("button",{onClick:fe,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-bold",children:[w!==null?"Uppdatera":"Lgg till"," hndelse"]})]})]})}),o.jsx(WD,{isOpen:J,onClose:()=>de(!1),onAdd:Me,eventType:ue.type}),o.jsx("style",{jsx:!0,global:!0,children:`
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f3f4f6; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; border: 2px solid #f3f4f6; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
      `})]})}function J2({value:n,onChange:e,placeholder:t="Taggar..."}){const[l,a]=C.useState(""),i=C.useMemo(()=>n?n.split(",").map(h=>h.trim()).filter(h=>h.length>0):[],[n]),d=h=>{if(h.key==="Enter"||h.key===","){h.preventDefault();const p=l.trim();if(p&&!i.includes(p)){const g=[...i,p];e(g.join(", ")),a("")}}else if(h.key==="Backspace"&&!l&&i.length>0){const p=i.slice(0,-1);e(p.join(", "))}},u=h=>{const p=i.filter(g=>g!==h);e(p.join(", "))};return o.jsxs("div",{className:"flex flex-wrap items-center gap-1 border border-slate-600 rounded px-2 py-1 bg-slate-900 w-full focus-within:ring-1 focus-within:ring-blue-500 min-h-[30px]",children:[i.map((h,p)=>o.jsxs("span",{className:"flex items-center gap-1 bg-green-700 text-green-100 text-xs font-semibold px-2 py-0.5 rounded-full border border-green-600",children:[h,o.jsx("button",{onClick:g=>{g.stopPropagation(),u(h)},className:"hover:text-green-200 focus:outline-none font-bold leading-none ml-0.5 text-green-300",title:"Ta bort tagg",children:""})]},p)),o.jsx("input",{type:"text",value:l,onChange:h=>a(h.target.value),onKeyDown:d,onBlur:()=>{if(l.trim()){const h=l.trim();i.includes(h)||e([...i,h].join(", ")),a("")}},placeholder:i.length===0?t:"",className:"flex-1 min-w-[60px] text-sm outline-none bg-transparent text-slate-200"})]})}const tO=n=>{if(!n||typeof n!="string")return"";const e=n.trim().toUpperCase().replace(/[\/\.]/g," "),t={JAN:"01",FEB:"02",MAR:"03",APR:"04",MAJ:"05",JUN:"06",JUL:"07",MN:"07",AUG:"08",SEP:"09",OKT:"10",NOV:"11",DEC:"12"},l=e.match(/^(\d{1,2})\s+(\w{3,4})\s+(\d{4})$/);if(l){const i=l[1],d=l[2].substring(0,3),u=l[3],h=t[d]||null;if(i&&h&&u)return`${u}-${h}-${i.padStart(2,"0")}`}const a=n.match(/^(\d{4})[-\/\s]?(\d{1,2})[-\/\/\s]?(\d{1,2})/);return a?`${a[1]}-${a[2].padStart(2,"0")}-${a[3].padStart(2,"0")}`:n};function Q2({source:n,onEditSource:e,people:t,onOpenEditModal:l}){const[a,i]=C.useState(null),[d,u]=C.useState(!1),[h,p]=C.useState(!1),[g,b]=C.useState({}),[y,v]=C.useState(!1),N=n?.images||[];C.useEffect(()=>{let A=!0;const B=async()=>{for(const Y of N)if(!g[Y.src])try{const J=await window.electronAPI.readFile(Y.src);if(J&&!J.error&&A){const de=new Blob([J]),w=URL.createObjectURL(de);b(T=>({...T,[Y.src]:w}))}}catch{console.warn("Kunde inte ladda preview:",Y.src)}};return N.length>0&&B(),()=>{A=!1}},[N]);const S=async A=>{if(!A||A.length===0)return;p(!0);const B=[];for(const Y of A)try{const J=await Y.arrayBuffer(),de=new Uint8Array(J),w=Y.name.replace(/[^a-zA-Z0-9._-]/g,"_"),T=`diverse/${Date.now()}_${w}`,I=await window.electronAPI.saveFile(T,de);I&&I.success?B.push({src:T,title:Y.name.split(".")[0],date:"",note:"",tags:"",format:Y.type.split("/")[1]||"jpg",regions:[]}):alert(`Kunde inte spara ${Y.name}: ${I?.error}`)}catch(J){console.error("Fel vid filhantering:",J)}if(B.length>0){const Y=[...n.images||[],...B];e({images:Y}),i((n.images||[]).length)}p(!1)},j=A=>{A.preventDefault(),u(!0)},E=A=>{A.preventDefault(),u(!1)},D=A=>{A.preventDefault(),u(!1),A.dataTransfer.files&&A.dataTransfer.files.length>0&&S(A.dataTransfer.files)},_=A=>{if(A.clipboardData&&A.clipboardData.files.length>0)S(A.clipboardData.files);else if(A.clipboardData&&A.clipboardData.items){const Y=Array.from(A.clipboardData.items).find(J=>J.type.indexOf("image")!==-1);if(Y){const J=Y.getAsFile();if(J){const de=new File([J],`clipboard_image_${Date.now()}.${J.type.split("/")[1]||"png"}`,{type:J.type});S([de])}}}},H=(A,B)=>{if(a===null||a>=N.length)return;const Y=[...N];Y[a]={...Y[a],[A]:B},e({images:Y})},L=A=>{if(a===null||a>=N.length)return;const B=A.target.value,Y=tO(B);Y!==B&&H("date",Y)},V=()=>{if(a!==null&&confirm("Ta bort bildlnken?")){const A=N.filter((B,Y)=>Y!==a);e({images:A}),i(null)}},G=()=>{a!==null&&v(!0)},X=()=>{i(A=>A===null?A:Math.max(0,A-1))},$=()=>{i(A=>A===null?A:Math.min(N.length-1,A+1))},R=a!==null?N[a]:null;return o.jsxs("div",{className:"flex h-full gap-4 outline-none",onPaste:_,tabIndex:"0",children:[o.jsx(l0,{isOpen:y,onClose:()=>v(!1),imageSrc:R?.src,imageTitle:R?.title,regions:R?.regions||[],onSaveRegions:A=>H("regions",A),people:t,onOpenEditModal:l,onPrev:X,onNext:$,hasPrev:a>0,hasNext:a!==null&&a<N.length-1}),o.jsxs("div",{className:`flex-1 border-2 border-dashed rounded-lg overflow-y-auto p-4 transition-colors relative min-h-[300px] ${d?"border-blue-500 bg-blue-900":"border-slate-600 bg-slate-800"}`,onDragOver:j,onDragLeave:E,onDrop:D,children:[N.length===0&&!h&&o.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-400 pointer-events-none",children:[o.jsx("p",{className:"text-lg font-semibold",children:"Dra och slpp bilder hr"}),o.jsx("p",{className:"text-sm",children:"eller klistra in (Ctrl+V)"})]}),h&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80 z-10",children:o.jsx("p",{className:"text-blue-400 font-bold animate-pulse",children:"Sparar bilder..."})}),o.jsxs("div",{className:"flex flex-col gap-3",children:[N.map((A,B)=>{const Y=Array.isArray(A.regions)&&t?A.regions.map(J=>{const de=t.find(pe=>pe.id===J.personId);if(!de)return null;const w=pe=>{const O=de.events?.find(te=>te.type===pe||te.type===(pe==="BIRT"?"Fdelse":"Dd"));return O?.date?O.date.substring(0,10):""},T=w("BIRT"),I=w("DEAT"),Z=T||I?`(${T}-${I})`:"";return{...de,life:Z}}).filter(Boolean):[];return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{onClick:()=>i(B),onDoubleClick:G,className:`cursor-pointer rounded border-2 overflow-hidden relative group bg-slate-900 shadow-sm aspect-square w-32 h-32 flex-shrink-0 flex items-center justify-center ${a===B?"border-blue-600 ring-2 ring-blue-600":"border-transparent hover:border-slate-600"}`,children:[g[A.src]?o.jsx("img",{src:g[A.src],alt:typeof A.title=="string"?A.title:"",className:"w-full h-full object-cover"}):o.jsxs("div",{className:"text-slate-400 text-xs p-2 text-center break-all",children:[o.jsx("span",{className:"text-2xl block mb-1",children:""}),typeof A.src=="string"?A.src.split("/").pop():""]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] p-1 truncate text-center",children:typeof A.title=="string"?A.title:"Namnls"})]}),o.jsx("div",{className:"flex flex-wrap gap-1 items-center min-h-[2rem]",children:Y.length>0?Y.map(J=>o.jsxs("span",{className:"bg-green-600 hover:bg-green-700 text-white text-xs rounded-full px-3 py-0.5 font-semibold shadow flex items-center",title:`REF: ${J.refNumber} ${J.firstName} ${J.lastName} ${J.life}`,style:{pointerEvents:"none"},children:["REF: ",J.refNumber," ",J.firstName," ",J.lastName," ",J.life]},J.id)):o.jsx("span",{className:"text-slate-400 text-xs italic",children:"Ingen person taggad"})})]},B)}),o.jsxs("label",{className:"cursor-pointer border-2 border-dashed border-slate-600 rounded flex flex-col items-center justify-center aspect-square w-32 h-32 hover:bg-slate-700 hover:border-blue-400 transition-colors bg-slate-800 mt-2",children:[o.jsx("span",{className:"text-3xl text-slate-300 mb-1",children:"+"}),o.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"+ lgg till"}),o.jsx("span",{className:"text-xs text-slate-400 mt-1",children:"ctrl+v"}),o.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:A=>S(A.target.files)})]})]})]}),R?o.jsxs("div",{className:"w-1/3 bg-slate-800 border-l border-slate-700 pl-4 flex flex-col gap-3 overflow-y-auto",children:[o.jsx("h3",{className:"font-bold text-slate-300 text-sm border-b border-slate-700 pb-2",children:"Bildinformation"}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Titel"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200",value:R.title||"",onChange:A=>H("title",A.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Datum"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200",placeholder:"-MM-DD",value:R.date||"",onChange:A=>H("date",A.target.value),onBlur:L})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase mb-1",children:"Taggar"}),o.jsx(J2,{value:R.tags||"",onChange:A=>H("tags",A),placeholder:"Semester, Brllop..."})]}),o.jsxs("div",{className:"flex-1 min-h-[100px]",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Notering"}),o.jsx("textarea",{className:"w-full border rounded px-2 py-1 text-sm h-full resize-none bg-slate-900 border-slate-700 text-slate-200 focus:bg-slate-800",value:R.note||"",onChange:A=>H("note",A.target.value)})]}),Array.isArray(R.regions)&&R.regions.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("div",{className:"text-xs font-bold text-slate-300 uppercase mb-1",children:"Taggade personer"}),o.jsx("ul",{className:"space-y-1",children:R.regions.map((A,B)=>{const Y=t?.find(J=>J.id===A.personId);return Y?o.jsxs("li",{className:"text-sm text-slate-300 flex items-center gap-2",children:[o.jsxs("span",{className:"font-semibold",children:[Y.firstName," ",Y.lastName]}),o.jsxs("span",{className:"text-xs text-slate-400",children:["(REF: ",Y.refNumber,")"]})]},A.personId+"-"+B):null})})]}),o.jsxs("div",{className:"pt-2 border-t flex flex-col gap-2",children:[o.jsx(mt,{onClick:G,variant:"primary",size:"sm",className:"w-full",children:"ppna & Tagga"}),o.jsx(mt,{onClick:V,variant:"ghost_danger",size:"sm",className:"w-full",children:"Ta bort bild"})]})]}):o.jsx("div",{className:"w-1/3 flex items-center justify-center text-slate-400 text-xs italic border-l border-slate-700 bg-slate-800",children:"Vlj en bild fr att redigera detaljer"})]})}function nO(n){const e={};for(const t of n){if(!t||!t.id)continue;let l=t.archiveTop;if(l||(t.archive==="Arkiv Digital"?l="Arkiv Digital":t.archive==="Riksarkivet"?l="Riksarkivet":l="vrigt"),e[l]||(e[l]={}),l==="Arkiv Digital"||l==="Riksarkivet"){let a=t.title||"Oknd Titel";e[l][a]||(e[l][a]={});const i=t.volume||"Oknd volym",d=t.date?` [${t.date}]`:"";let u=i+d;e[l][a][u]||(e[l][a][u]=[]);let h="";const p=[];if(t.imagePage){const g=/^\d+$/.test(t.imagePage);p.push(g?`Bild ${t.imagePage}`:t.imagePage)}if(t.page){const g=/^\d+$/.test(t.page);p.push(g?`Sid ${t.page}`:t.page)}p.length>0?h=p.join(" / "):h=t.aid||t.bildid||"Utan referens",e[l][a][u].push({...t,label:h})}else{let a=t.title||"Namnls klla";e[l][a]||(e[l][a]=[]);let i=t.page||t.aid||t.imagePage||t.bildid;i||(t.images&&t.images.length>0?i="Bild":i="Klla (Allmn)"),e[l][a].push({...t,label:i})}}return e}function sO({value:n,onChange:e}){return o.jsxs("select",{className:"border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:n||0,onChange:t=>e(Number(t.target.value)),children:[o.jsx("option",{value:0,children:" Ingen info"}),o.jsx("option",{value:1,children:" Oplitlig"}),o.jsx("option",{value:2,children:" Tvivelaktig"}),o.jsx("option",{value:3,children:" Andrahand"}),o.jsx("option",{value:4,children:" Frstahand"})]})}function _v({sources:n,people:e,places:t=[],onDeleteSource:l,onEditSource:a,catalogState:i,setCatalogState:d,onCreateNewPerson:u,onOpenEditModal:h,isDrawerMode:p,onLinkSource:g,onNavigateToPlace:b,onAddSource:y,onOpenLinkPersonModal:v,onUnlinkSourceFromEvent:N,alreadyLinkedIds:S=[]}){const{selectedSourceId:j,expanded:E,searchTerm:D,sortOrder:_="name_asc"}=i,[H,L]=C.useState(""),V=C.useRef(null),[G,X]=C.useState("info"),$=()=>{if(!H||!H.trim())return;const P=H.trim();let we={trust:4};const ue=P.toUpperCase();if(ue.includes("AID:")){we.archiveTop="Arkiv Digital",we.archive="Arkiv Digital";const re=P.match(/AID:\s*([a-zA-Z0-9\.]+)/i);re&&(we.aid=re[1]);const Ce=P.match(/NAD:\s*([a-zA-Z0-9\/]+)/i)||P.match(/SE\/[A-Z0-9\/]+/);Ce&&(we.nad=Ce[0].replace(/NAD:\s*/i,""));const Ye=P.match(/Bild\s*(\d+)/i);Ye&&(we.imagePage=Ye[1]);const Ve=P.match(/sid\s*(\d+)/i);Ve&&(we.page=Ve[1]);const ft=P.match(/([A-Z]+\s*[A-Z]*:[a-z0-9]+)/i);ft&&(we.volume=ft[1]);let dt=null;if(t&&t.length>0)for(const xt of t)xt&&xt.name&&P.startsWith(xt.name)&&(!dt||xt.name.length>dt.name.length)&&(dt=xt);if(dt)we.title=dt.name;else{const xt=P.indexOf(we.volume||"(");xt>0?we.title=P.substring(0,xt).trim():we.title="Oknd Titel"}}else if(ue.includes("BILDID:")){we.archiveTop="Riksarkivet",we.archive="Riksarkivet";const re=P.match(/bildid:\s*([A-Z0-9_]+)/i);re&&(we.bildid=re[1]);const Ce=P.match(/(SE\/[\w]+\/\d+)/);Ce&&(we.nad=Ce[1]);const Ye=P.match(/SE\/[\w]+\/\d+\/([^(,]+)/);Ye&&(we.volume=Ye[1].trim());const Ve=P.match(/_(\d+)$/);Ve&&(we.imagePage=Ve[1]);const ft=P.split(",");ft.length>0&&(we.title=ft[0].trim())}const Ue=P.match(/\((\d{4}[-]\d{4})\)/)||P.match(/\((\d{4})\)/);Ue&&(we.date=Ue[1]),we.note="";const Q={...T,...we,title:we.title||T.title||"",archive:we.archive||T.archive||"",archiveTop:we.archiveTop||T.archiveTop||"vrigt",volume:we.volume||T.volume||"",page:we.page||T.page||"",aid:we.aid||T.aid||"",nad:we.nad||T.nad||"",bildid:we.bildid||T.bildid||"",imagePage:we.imagePage||T.imagePage||"",date:we.date||T.date||"",note:we.note,tags:we.tags||T.tags||""};T&&(a(Q),L(""))},R=C.useMemo(()=>{const P=[...n];switch(_){case"name_asc":return P.sort((we,ue)=>(we.title||we.archive||"").localeCompare(ue.title||ue.archive||"","sv"));case"name_desc":return P.sort((we,ue)=>(ue.title||ue.archive||"").localeCompare(we.title||we.archive||"","sv"));case"date_desc":return P.sort((we,ue)=>new Date(ue.dateModified||ue.dateAdded||0)-new Date(we.dateModified||we.dateAdded||0));case"date_asc":return P.sort((we,ue)=>new Date(we.dateModified||we.dateAdded||0)-new Date(ue.dateModified||ue.dateAdded||0));default:return P}},[n,_]),A=C.useMemo(()=>{if(!D)return R;const P=D.toLowerCase();return R.filter(we=>we.title&&we.title.toLowerCase().includes(P)||we.archive&&we.archive.toLowerCase().includes(P)||we.page&&we.page.toLowerCase().includes(P)||we.id&&we.id.toLowerCase().includes(P))},[R,D]),B=C.useMemo(()=>nO(A),[A]);C.useLayoutEffect(()=>{if(D){const P={...E};let we=!1;const ue=(Ue,Q)=>{Array.isArray(Ue)||Object.keys(Ue).forEach(re=>{const Ce=Q+re;P[Ce]||(P[Ce]=!0,we=!0),ue(Ue[re],Ce)})};ue(B,""),we&&d(Ue=>({...Ue,expanded:P}))}},[D,B]),C.useLayoutEffect(()=>{if(!j)return;let P=[];const we=(Q,re)=>{if(Array.isArray(Q))return!!Q.some(Ce=>Ce.id===j);for(const Ce in Q)if(we(Q[Ce],[...re,Ce]))return P=[...re,Ce],!0;return!1};if(we(B,[]),P.length>0){let Q="",re={...E},Ce=!1;for(const Ye of P)Q+=Ye,re[Q]||(re[Q]=!0,Ce=!0);if(Ce){d(Ye=>({...Ye,expanded:re}));return}}const ue=document.getElementById(`source-item-${j}`),Ue=V.current;if(ue&&Ue){const Q=ue.offsetTop,re=Ue.clientHeight,Ce=ue.clientHeight;Ue.scrollTop=Q-re/2+Ce/2,ue.style.backgroundColor="#fef08a",setTimeout(()=>{ue&&(ue.style.transition="background-color 1s",ue.style.backgroundColor="")},1e3)}},[j,B,E]);const Y=P=>d(we=>({...we,selectedSourceId:P})),J=P=>d(we=>({...we,expanded:{...we.expanded,[P]:!we.expanded[P]}})),de=P=>d(we=>({...we,searchTerm:P.target.value})),w=P=>d(we=>({...we,sortOrder:P.target.value})),T=n.find(P=>P.id===j),I=P=>{a({...T,...P})},Z=C.useMemo(()=>{if(!j||!e)return[];const we=n.find(Ue=>Ue.id===j)?.images||[],ue=new Map;return e.forEach(Ue=>{let Q=[],re=!1;Ue.events&&Ue.events.forEach(Ce=>{Ce.sources&&Ce.sources.includes(j)&&Q.push(Ce)}),we.length>0&&we.some(Ye=>Ye.regions&&Ye.regions.some(Ve=>Ve.personId===Ue.id))&&(re=!0,Q.some(Ye=>Ye.type==="Bild")||Q.push({type:"Bild",id:"img_"+Ue.id})),Q.length>0&&ue.set(Ue.id,{person:Ue,events:Q,isLinkedToImageRegion:re,family:O(Ue,e,j)})}),Array.from(ue.values())},[j,e,n]);function pe(P,we){return!P||!P.events?!1:P.events.some(ue=>ue.sources&&ue.sources.includes(we))}function O(P,we,ue){const Ue=[],Q=P.relations||{},re=(Ce,Ye)=>{const Ve=we.find(ft=>ft.id===Ce);Ve&&!pe(Ve,ue)&&Ue.push({person:Ve,role:Ye})};return(Q.parents||[]).forEach(Ce=>re(Ce,"Frlder")),Q.spouseId&&re(Q.spouseId,"Partner"),(Q.children||[]).forEach(Ce=>re(Ce,"Barn")),(Q.siblings||[]).forEach(Ce=>re(Ce,"Syskon")),Ue}const te=P=>{const we=Q=>{const re=P.events?.find(Ce=>Ce.type===Q||Ce.type===(Q==="BIRT"?"Fdelse":"Dd"));return re?.date?re.date.substring(0,4):""},ue=we("BIRT"),Ue=we("DEAT");return!ue&&!Ue?"":`(${ue}-${Ue})`};function ke(P){return{BIRT:"Fdelse",DEAT:"Dd",CHR:"Dop",BURI:"Begravning",MARR:"Vigsel",DIV:"Skilsmssa",OCCU:"Yrke",RESI:"Bosatt",EDUC:"Utbildning",CONF:"Konfirmation",PROB:"Bouppteckning",CENS:"Husfrhr",EMIG:"Utvandring",IMMI:"Invandring"}[P]||P}const ge=T?(P=>P?P.notes&&Array.isArray(P.notes)?P.notes:P.note?[{id:"legacy",text:P.note}]:[]:[])(T):[],Ee=T?.images?.length||0,ie=ge.length,Ie=(P,we)=>Array.isArray(P)?o.jsx("div",{className:"ml-5 border-l-2 border-slate-700 pl-1",children:P.map(ue=>{const Ue=S.includes(ue.id);return o.jsxs("div",{id:`source-item-${ue.id}`,onClick:()=>Y(ue.id),onDoubleClick:()=>{p&&g&&g(ue.id)},className:`
                        cursor-pointer text-xs py-1 px-2 rounded truncate transition-colors duration-200 flex justify-between items-center group
                        ${j===ue.id?"bg-blue-600 text-blue-100 font-medium border-l-2 border-blue-400 shadow-sm":"text-slate-400 hover:bg-slate-700"}
                        ${Ue?"bg-green-900 text-green-200 border-l-2 border-green-500":""}
                      `,title:`${ue.label} (Dubbelklicka fr att koppla)`,children:[o.jsx("span",{className:"truncate flex-1",children:ue.label}),o.jsxs("div",{className:"flex gap-1 items-center ml-2 shrink-0",children:[o.jsx(mt,{onClick:Q=>{Q.stopPropagation(),ue.aid&&window.open(`http://www.arkivdigital.se/aid/show/${ue.aid}`,"_blank")},variant:ue.aid?"success":"ghost",size:"xs",title:ue.aid?"ppna AID":"Ingen AID",className:ue.aid?"":"opacity-50 border border-slate-600",children:"AD"}),o.jsx(mt,{onClick:Q=>{Q.stopPropagation(),ue.bildid&&window.open(`https://sok.riksarkivet.se/bildvisning/${ue.bildid}`,"_blank")},variant:ue.bildid?"success":"ghost",size:"xs",title:ue.bildid?"ppna RA":"Ingen RA-lnk",className:ue.bildid?"":"opacity-50 border border-slate-600",children:"RA"}),o.jsx(mt,{onClick:Q=>{Q.stopPropagation(),ue.nad&&window.open(`https://sok.riksarkivet.se/?postid=ArkisRef%20${ue.nad}`,"_blank")},variant:ue.nad?"success":"ghost",size:"xs",title:ue.nad?"ppna NAD":"Ingen NAD-lnk",className:ue.nad?"":"opacity-50 border border-slate-600",children:"NAD"})]}),Ue&&o.jsx("span",{className:"text-green-400 font-bold ml-1 text-xs",children:""})]},ue.id)})}):Object.keys(P).sort().map(ue=>{const Ue=we+ue,Q=E[Ue];return o.jsxs("div",{className:"mb-1 ml-2",children:[o.jsxs("div",{className:"flex items-center cursor-pointer hover:bg-slate-700 py-1 px-1 rounded font-semibold text-slate-100 text-sm transition-colors",onClick:()=>J(Ue),children:[o.jsx("span",{className:"w-4 text-center text-xs text-slate-500 mr-1",children:Q?"":""}),ue]}),Q&&Ie(P[ue],Ue)]},ue)});return C.useEffect(()=>{const P=we=>{we.key==="Delete"&&j&&n.find(Ue=>Ue.id===j)&&l&&confirm("Ta bort klla?")&&l(j)};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[j,n,l]),o.jsxs("div",{className:"flex w-full h-full bg-slate-800 overflow-hidden",children:[o.jsxs("aside",{className:"w-80 border-r border-slate-700 bg-slate-800 flex flex-col h-full shrink-0",children:[o.jsxs("div",{className:"p-2 border-b border-slate-700 bg-slate-900 space-y-2 shrink-0",children:[o.jsx("input",{type:"text",placeholder:"Sk...",className:"w-full px-2 py-1 text-sm border border-slate-600 rounded bg-slate-900 text-slate-200 placeholder-slate-500 focus:border-blue-500 focus:outline-none shadow-sm",value:D||"",onChange:de}),o.jsxs("select",{className:"w-full px-2 py-1 text-xs border border-slate-600 rounded bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:_,onChange:w,children:[o.jsx("option",{value:"name_asc",children:"Namn (A-)"}),o.jsx("option",{value:"name_desc",children:"Namn (-A)"}),o.jsx("option",{value:"date_desc",children:"Senast ndrad (Nyast)"}),o.jsx("option",{value:"date_asc",children:"Senast ndrad (ldst)"})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-2 relative",ref:V,children:[Object.keys(B).sort().map(P=>o.jsxs("div",{className:"mb-1",children:[o.jsxs("div",{className:"flex items-center cursor-pointer hover:bg-slate-700 py-1 px-1 rounded font-bold text-blue-300 transition-colors",onClick:()=>J(P),children:[o.jsx("span",{className:"w-4 text-center text-xs text-slate-500 mr-1",children:E[P]?"":""}),P]}),E[P]&&Ie(B[P],P)]},P)),Object.keys(B).length===0&&o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 text-sm mt-10",children:[o.jsx("p",{children:"Inga kilder hittades."}),y&&o.jsx(mt,{onClick:y,variant:"primary",size:"sm",children:"Skapa ny klla"})]})]})]}),o.jsx("main",{className:"flex-1 h-full bg-slate-800 flex flex-col",children:T?o.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[o.jsxs("div",{className:"p-6 pb-0 shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Redigera Klla"}),o.jsxs("div",{className:"text-xs text-slate-400",children:["ID: ",T.id]})]}),o.jsxs("div",{className:"flex gap-2",children:[y&&o.jsx(mt,{onClick:y,variant:"primary",size:"sm",children:"Ny klla"}),p&&g&&o.jsx(mt,{onClick:()=>g(T.id),variant:"success",size:"sm",children:" Koppla klla"}),o.jsx(mt,{onClick:()=>{confirm("Ta bort klla?")&&l(T.id)},variant:"danger",size:"sm",children:"Ta bort klla"})]})]}),o.jsxs("div",{className:"mb-4 p-3 bg-slate-800 border border-slate-700 rounded",children:[o.jsx("label",{className:"block text-xs font-bold text-blue-300 uppercase mb-1",children:"Snabb-import (AD/RA)"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("textarea",{className:"flex-1 border border-slate-600 rounded p-1 text-xs h-8 resize-none focus:h-16 transition-all bg-slate-900 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Klistra in klltext...",value:H,onChange:P=>L(P.target.value)}),o.jsx(mt,{onClick:$,disabled:!H,variant:"primary",size:"sm",children:"Tolka"})]})]}),o.jsxs("div",{className:"flex border-b mt-4 bg-slate-900 rounded-t-lg shadow-sm",children:[o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${G==="info"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>X("info"),title:"Kllinformation",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Info",children:""}),"Info",G==="info"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${G==="images"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>X("images"),title:"Bilder",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Bilder",children:""}),"Bilder",Ee>0&&o.jsx("span",{className:"ml-1 bg-green-900 text-green-200 text-xs font-bold px-2 py-0.5 rounded-full shadow-sm",children:Ee}),G==="images"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${G==="notes"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>X("notes"),title:"Noteringar",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Noteringar",children:""}),"Noteringar",ie>0&&o.jsx("span",{className:"ml-1 bg-green-900 text-green-200 text-xs font-bold px-2 py-0.5 rounded-full shadow-sm",children:ie}),G==="notes"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]}),o.jsxs("button",{className:`relative px-5 py-2 text-sm font-semibold flex items-center gap-2 border-b-2 transition-colors duration-150 focus:outline-none ${G==="connections"?"border-blue-500 text-blue-300 bg-slate-800 shadow -mb-px":"border-transparent text-slate-400 hover:text-blue-400 hover:bg-slate-700"}`,onClick:()=>X("connections"),title:"Kopplingar",children:[o.jsx("span",{className:"text-lg",role:"img","aria-label":"Kopplingar",children:""}),"Kopplingar",G==="connections"&&o.jsx("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"})]})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[G==="info"&&o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Arkiv (Top)"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.archiveTop||"",onChange:P=>I({archiveTop:P.target.value})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Titel / Ort"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 font-semibold bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",list:"places-datalist",value:T.title||"",onChange:P=>I({title:P.target.value})}),o.jsx("datalist",{id:"places-datalist",children:t.map(P=>o.jsx("option",{value:P.name},P.id))})]})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Volym"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.volume||"",onChange:P=>I({volume:P.target.value})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"r"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.date||"",onChange:P=>I({date:P.target.value})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Bild"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.imagePage||"",onChange:P=>I({imagePage:P.target.value})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"Sida/Klldetalj"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.page||"",onChange:P=>I({page:P.target.value})})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 bg-slate-900 p-3 rounded border border-slate-700",children:[o.jsxs("div",{className:"flex items-end gap-1",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"AID (AD)"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 font-mono text-xs bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.aid||"",onChange:P=>I({aid:P.target.value})})]}),T.aid&&o.jsx(mt,{onClick:()=>window.open(`http://www.arkivdigital.se/aid/show/${T.aid}`,"_blank"),variant:"success",size:"xs",children:"AD"})]}),o.jsxs("div",{className:"flex items-end gap-1",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"BildID (RA)"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 font-mono text-xs bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.bildid||"",onChange:P=>I({bildid:P.target.value})})]}),T.bildid&&o.jsx(mt,{onClick:()=>window.open(`https://sok.riksarkivet.se/bildvisning/${T.bildid}`,"_blank"),variant:"success",size:"xs",children:"RA"})]}),o.jsxs("div",{className:"flex items-end gap-1",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 uppercase",children:"NAD"}),o.jsx("input",{className:"w-full border border-slate-600 rounded px-2 py-1 font-mono text-xs bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",value:T.nad||"",onChange:P=>I({nad:P.target.value})})]}),T.nad&&o.jsx(mt,{onClick:()=>window.open(`https://sok.riksarkivet.se/?postid=ArkisRef%20${T.nad}`,"_blank"),variant:"success",size:"xs",children:"NAD"})]})]}),o.jsxs("div",{className:"mt-4 flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-xs font-bold text-slate-300 uppercase",children:"Trovrdighet:"}),o.jsx(sO,{value:T.trust,onChange:P=>I({trust:P})})]}),o.jsx(J2,{value:T.tags||"",onChange:P=>I({tags:P})})]})]}),G==="images"&&o.jsx("div",{children:o.jsx(Q2,{source:T,onEditSource:I,people:e,onOpenEditModal:h})}),G==="notes"&&o.jsxs("div",{className:"max-w-3xl mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"font-bold text-slate-200",children:"Anteckningar"}),o.jsx(mt,{onClick:()=>{const P={id:`note_${Date.now()}`,text:"",created:new Date().toISOString()},we=[...ge,P];I({notes:we})},variant:"primary",size:"sm",children:"+ Ny anteckning"})]}),o.jsxs("div",{className:"space-y-4",children:[ge.map((P,we)=>o.jsxs("div",{className:"border border-slate-700 rounded bg-slate-900 shadow-sm p-3",children:[o.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[o.jsx("span",{children:P.created?new Date(P.created).toLocaleDateString():"Importerad"}),o.jsx(mt,{onClick:()=>{if(confirm("Ta bort anteckning?")){const ue=ge.filter((Ue,Q)=>Q!==we);I({notes:ue})}},variant:"danger",size:"xs",children:"Ta bort"})]}),o.jsx(K2,{value:P.text||"",onChange:ue=>{const Ue=[...ge];Ue[we]={...P,text:ue.target.value},I({notes:Ue})},containerProps:{style:{minHeight:"100px"}}})]},P.id||we)),ge.length===0&&o.jsx("div",{className:"text-center text-slate-400 italic py-10",children:"Inga anteckningar n."})]})]}),G==="connections"&&o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200",children:"Kopplade Mnniskor & Hndelser"}),v&&o.jsxs(mt,{onClick:()=>v(null),variant:"primary",size:"sm",children:[o.jsx("span",{children:"+"})," Koppla person"]})]}),Z.length===0?o.jsx("p",{className:"text-slate-400 text-sm italic text-center py-4",children:"Inga personer r kopplade till denna klla n."}):o.jsx("div",{className:"space-y-6",children:Z.map((P,we)=>o.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-md overflow-hidden",children:[o.jsxs("div",{className:"flex items-center p-3 bg-slate-800 border-b border-slate-700 hover:bg-slate-700 transition-colors",children:[P.isLinkedToImageRegion&&o.jsx("span",{className:"text-green-600 mr-2",title:"Personen r taggad i en bild frn denna klla",children:""}),o.jsxs("div",{className:"w-12 text-xs font-mono text-slate-500",children:["#",P.person.refNumber]}),o.jsxs("div",{className:"flex-1 font-bold text-blue-400 cursor-pointer hover:underline",onClick:()=>h&&h(P.person.id),children:[P.person.firstName," ",P.person.lastName,o.jsx("span",{className:"font-normal text-slate-400 ml-2 text-xs",children:te(P.person)})]}),o.jsx("div",{className:"w-48 text-sm font-medium px-2 bg-slate-700 rounded py-0.5 mr-4 flex flex-wrap gap-2 justify-end",children:P.events.map(ue=>o.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-200 text-green-900 rounded text-xs font-semibold",children:[ke(ue.type),N&&o.jsx("button",{onClick:()=>{confirm("Ta bort koppling?")&&N(P.person.id,ue.id,T.id)},className:"ml-1 text-green-900 hover:text-white hover:bg-green-600 rounded-full w-4 h-4 flex items-center justify-center transition-colors",title:`Ta bort koppling till ${ke(ue.type)}`,style:{lineHeight:1,fontSize:"13px",padding:0,border:"none",background:"none",cursor:"pointer"},children:""})]},ue.id||ue.type))})]}),P.family&&P.family.length>0&&o.jsxs("div",{className:"bg-slate-900 p-2 pl-12 border-t border-dashed border-slate-700",children:[o.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase mb-2",children:"Relaterade familjemedlemmar (Tips)"}),o.jsx("div",{className:"grid grid-cols-1 gap-1",children:P.family.map((ue,Ue)=>o.jsxs("div",{className:"flex items-center justify-between group hover:bg-slate-800 p-1 rounded",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-400 w-16 text-right",children:[ue.role,":"]}),o.jsxs("span",{className:"text-slate-300 cursor-pointer hover:text-blue-400",onClick:()=>h&&h(ue.person.id),children:[ue.person.firstName," ",ue.person.lastName]}),o.jsx("span",{className:"text-xs text-slate-500",children:te(ue.person)})]}),v&&o.jsx("button",{onClick:()=>v(ue.person.id),className:"opacity-0 group-hover:opacity-100 bg-blue-600 text-blue-100 px-2 py-0.5 rounded text-xs font-semibold hover:bg-blue-500 transition-opacity",children:"Koppla"})]},Ue))})]})]},we))})]})]})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[o.jsx("p",{className:"mb-2",children:" Vlj en klla i listan"}),y&&o.jsx(mt,{onClick:y,variant:"primary",size:"md",children:"Skapa ny klla"})]})})]})}function lO({allSources:n,allPeople:e,onAttach:t,onCreateNew:l,onClose:a,onEditSource:i}){const d=E=>{let D=E.yearRange,_=E.pageNumber,H=E.otherInfo;if(E.sourceString){const L=E.sourceString.match(/\((\d{4}-\d{4})\)/)||E.sourceString.match(/(\d{4}-\d{4})/);L&&(D=L[1]);const V=E.sourceString.match(/sid\s*(\d+)/i)||E.sourceString.match(/sida\s*(\d+)/i);V&&(_=V[1]);const G=E.sourceString.match(/AID:\s*([\w\.]+)/i);G&&(H=`AID: ${G[1]}`)}if(!E.archive||!E.volume||!E.imagePage||!H){const L=Ep(E.sourceString);E.archive||(E.archive=L.archive),E.volume||(E.volume=L.volume),E.imagePage||(E.imagePage=L.imagePage),H||(H=L.otherInfo)}return{yearRange:D,pageNumber:_,aid:H}},[u,h]=C.useState([]),[p,g]=C.useState([]),[b,y]=C.useState(""),v=E=>{h(D=>D.includes(E)?D.filter(_=>_!==E):[...D,E])},N=n.filter(E=>{const D=b.toLowerCase();return D?E.sourceString?.toLowerCase().includes(D)||E.archive?.toLowerCase().includes(D)||E.volume?.toLowerCase().includes(D):!0});C.useEffect(()=>{N.length===1&&N[0].sourceString.toLowerCase()===b.toLowerCase()?h([N[0].id]):u.length>0&&!N.find(E=>E.id===u[0])&&h([])},[b,N]);const{getPersonRelations:S}=Fs(),j=(()=>{if(!window.sourcingEventInfo||!window.sourcingEventInfo.personId)return[];const E=window.sourcingEventInfo.personId;if(!e.find(R=>R.id===E))return[];const _=S(E)||[],H=_.filter(R=>!R._archived&&(R.type||"").toString().toLowerCase()==="parent").map(R=>R.fromPersonId===E?R.toPersonId:R.fromPersonId).filter(Boolean),L=_.filter(R=>!R._archived&&(R.type||"").toString().toLowerCase()==="child").map(R=>R.fromPersonId===E?R.toPersonId:R.fromPersonId).filter(Boolean),V=_.filter(R=>!R._archived&&["spouse","partner"].includes((R.type||"").toString().toLowerCase())).map(R=>R.fromPersonId===E?R.toPersonId:R.fromPersonId).filter(Boolean),G=e.filter(R=>R.id===E?!1:(S(R.id)||[]).filter(Y=>!Y._archived&&(Y.type||"").toString().toLowerCase()==="parent").map(Y=>Y.fromPersonId===R.id?Y.toPersonId:Y.fromPersonId).filter(Boolean).some(Y=>H.includes(Y))).map(R=>R.id),X=[...H,...L,...V,...G],$=Array.from(new Set(X));return e.filter(R=>$.includes(R.id))})();return o.jsx("div",{className:"modal",style:{display:"block"},children:o.jsxs("div",{className:"modal-content card bg-slate-800 border border-slate-700 p-6 rounded-xl max-w-3xl text-slate-200",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-slate-200",children:"Koppla Klla till Hndelser"}),o.jsx("input",{type:"text",placeholder:"Sk i kllkatalogen...",value:b,onChange:E=>y(E.target.value),className:"w-full p-2 border border-slate-600 bg-slate-900 text-slate-200 rounded mb-4"}),o.jsxs("div",{className:"flex gap-6",children:[o.jsxs("div",{className:"w-1/2",children:[o.jsx("h4",{className:"font-semibold mb-2 text-slate-200",children:"Vlj klla"}),o.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto border border-slate-700 bg-slate-800 rounded p-2 mb-4",children:N.length===0?o.jsx("p",{className:"text-slate-400 italic p-4 text-center",children:"Inga kllor finns i kllkatalogen."}):N.map(E=>{const{yearRange:D,pageNumber:_,aid:H}=d(E);return o.jsxs("div",{className:`p-2 rounded flex gap-3 items-center cursor-pointer ${u.includes(E.id)?"bg-blue-900":"hover:bg-slate-700"}`,children:[o.jsx(Q2,{source:E,onEditSource:i}),o.jsxs("div",{onClick:()=>v(E.id),className:"flex-grow",children:[o.jsxs("div",{className:"font-bold text-slate-200 text-sm",children:[E.archive," ",E.volume,D?` (${D})`:""]}),o.jsxs("div",{className:"text-xs text-slate-400",children:[E.imagePage,_?`/sid ${_}`:"",H?` (${H})`:""]})]}),o.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs bg-slate-700 text-slate-200 rounded hover:bg-slate-600",onClick:L=>{L.stopPropagation(),i&&i(E.id)},children:"Redigera"})]},E.id)})}),o.jsx("button",{type:"button",onClick:()=>l(b),className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Skapa ny klla..."})]}),o.jsxs("div",{className:"w-1/2",children:[o.jsx("h4",{className:"font-semibold mb-2 text-slate-200",children:"Vlj hndelser"}),o.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto border border-slate-700 bg-slate-800 rounded p-2 mb-4",children:j.map(E=>o.jsxs("div",{children:[o.jsxs("div",{className:"font-bold text-slate-300 text-xs mb-1",children:["REF: ",E.refNumber," ",E.firstName," ",E.lastName]}),E.events?.map(D=>o.jsxs("label",{className:"flex items-center gap-2 text-xs mb-1",children:[o.jsx("input",{type:"checkbox",checked:p.includes(D.id),onChange:()=>g(_=>_.includes(D.id)?_.filter(H=>H!==D.id):[..._,D.id])}),o.jsxs("span",{children:[D.type," ",D.date?`(${D.date})`:""]})]},D.id))]},E.id))})]})]}),o.jsxs("div",{className:"flex justify-end items-center mt-6 gap-2",children:[o.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-slate-600 rounded hover:bg-slate-700",children:"Avbryt"}),o.jsx("button",{type:"button",onClick:()=>t(u,p),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:u.length===0||p.length===0,children:"Koppla valda"})]})]})})}function rO({isVisible:n,message:e,onUndo:t,duration:l=1e4}){const[a,i]=C.useState(l/1e3);return C.useEffect(()=>{if(n){i(l/1e3);const d=setInterval(()=>{i(u=>u<=1?(clearInterval(d),0):u-1)},1e3);return()=>clearInterval(d)}},[n,l]),n?o.jsxs("div",{className:"fixed bottom-5 left-1/2 -translate-x-1/2 z-[2000] bg-red-700 text-white rounded-lg shadow-2xl flex items-center justify-between p-4 min-w-[350px]",children:[o.jsx("span",{children:e}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("button",{onClick:t,className:"ml-4 px-3 py-1 bg-slate-200/20 hover:bg-slate-200/40 rounded font-bold text-sm",children:"ngra"}),o.jsx("span",{className:"ml-4 font-mono text-lg w-6 text-center",children:a})]})]}):null}function aO({isVisible:n,message:e,severity:t="info"}){if(!n)return null;let l="bg-blue-600";return t==="success"&&(l="bg-green-600"),t==="warn"&&(l="bg-yellow-600"),t==="error"&&(l="bg-red-600"),o.jsx("div",{className:`fixed bottom-5 left-1/2 -translate-x-1/2 z-[1900] ${l} text-white rounded-lg shadow-xl flex items-center p-3`,children:o.jsx("span",{children:e})})}function iO({isOpen:n,warnings:e=[],onClose:t}){const{handleTabChange:l,showStatus:a}=Fs();return n?o.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/40",children:o.jsxs("div",{className:"w-11/12 max-w-2xl bg-slate-800 border border-slate-700 rounded-lg shadow-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h4",{className:"text-lg font-semibold",children:"Varningar frn automatisk import"}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("button",{onClick:()=>{t()},className:"px-3 py-1 text-sm border rounded",children:"Stng"})})]}),o.jsx("div",{className:"mb-3 text-sm text-slate-200",children:"Fljande varningar upptcktes nr relationer freslogs frn kllor. Dessa relationer har inte lagts till."}),o.jsx("ul",{className:"list-disc pl-5 mb-4 max-h-64 overflow-auto text-sm",children:e.map((i,d)=>o.jsx("li",{className:"mb-2 text-red-700",children:i},d))}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{onClick:()=>{try{l("audit"),t()}catch{a("Kunde inte ppna historiken.")}},className:"px-3 py-2 bg-blue-600 text-white rounded",children:"ppna historiken"}),o.jsx("button",{onClick:()=>{t()},className:"px-3 py-2 border rounded",children:"Stng"})]})]})}):null}const ko=280,oO=320,$s=130,kp=160,cO=60,Bv=160,dO=340,uO=n=>{const e=[];if(!n.birthDate)return e;const t=new Date(n.birthDate);return n.deathDate&&new Date(n.deathDate)<t&&e.push("Datafel: Dd fre fdelse"),e},fO=(n,e,t)=>{const{x:l,y:a}=n,{x:i,y:d}=e;return t==="child-fork"?`M ${l} ${a} L ${l} ${d-25} Q ${l} ${d} ${l+25} ${d} L ${i} ${d}`:t==="parent"?`M ${l} ${a} C ${l} ${a-80}, ${i} ${d+80}, ${i} ${d}`:`M ${l} ${a} L ${i} ${d}`},hO=n=>{if(!n)return null;const e=n.events?.find(l=>l.type==="BIRT"||l.type==="Fdelse"),t=n.events?.find(l=>l.type==="DEAT"||l.type==="Dd");return{id:n.id,firstName:n.firstName||"Oknd",lastName:n.lastName||"",gender:n.gender||"unknown",birthDate:e?.date||"",birthPlace:e?.place||"",deathDate:t?.date||"",deathPlace:t?.place||"",title:n.occupation||"",photoUrl:n.photoUrl||"",hasExtendedFamily:n.relations?.children?.length>0||n.relations?.parents?.length>0,isBookmarked:n.isBookmarked||!1,refNumber:n.refNumber||n.id}},pO=({person:n,onClose:e,onSave:t})=>n?o.jsx("div",{className:"fixed inset-0 z-[200] bg-black/50 flex items-center justify-center",children:o.jsxs("div",{className:"bg-white p-6 rounded shadow-lg max-w-md w-full animate-in fade-in zoom-in duration-200",children:[o.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Redigera ",n.firstName," ",n.lastName]}),o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Frnamn"}),o.jsx("input",{type:"text",defaultValue:n.firstName,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Efternamn"}),o.jsx("input",{type:"text",defaultValue:n.lastName,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2"})]}),n.parent1&&o.jsxs("p",{className:"text-sm text-blue-600",children:["Kopplar som barn till ID: ",n.parent1]}),n.parent2&&o.jsxs("p",{className:"text-sm text-blue-600",children:["Kopplar som barn till ID: ",n.parent2]})]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(mt,{variant:"secondary",onClick:e,children:"Avbryt"}),o.jsx(mt,{variant:"primary",onClick:()=>{t&&t(n),e()},children:"Spara"})]})]})}):null,Pv=({onClose:n,people:e,focusId:t,onNavigate:l,onEdit:a,onAddParent:i,onAddSibling:d,onAddPartner:u,onAddChild:h,onDelete:p,onToggleMain:g,onToggleBookmark:b})=>{const[y,v]=C.useState(""),[N,S]=C.useState([]),[j,E]=C.useState(null);C.useEffect(()=>{const L=e.filter(V=>{const G=`${V.firstName} ${V.lastName}`.toLowerCase(),X=y.toLowerCase();return G.includes(X)||V.birthPlace&&V.birthPlace.toLowerCase().includes(X)});S(L)},[y,e]);const D=(L,V)=>V===t?{text:"Huvudperson",color:"text-yellow-400"}:(L.relations?.parents||[]).map($=>typeof $=="object"?$.id:$).includes(V)?{text:"Frlder",color:"text-blue-300"}:L.relations?.spouseId===V?{text:"Partner",color:"text-pink-300"}:(L.relations?.children||[]).map($=>typeof $=="object"?$.id:$).includes(V)?{text:"Barn",color:"text-indigo-300"}:{text:"-",color:"text-slate-600"},_=(L,V)=>{L.preventDefault();const G=Math.min(L.clientX,window.innerWidth-220),X=Math.min(L.clientY,window.innerHeight-300);E({x:G,y:X,person:V})};C.useEffect(()=>{const L=()=>E(null);return window.addEventListener("click",L),()=>window.removeEventListener("click",L)},[]);const H=({icon:L,label:V,onClick:G,color:X="text-slate-300",shortcut:$})=>o.jsxs("button",{className:`w-full text-left px-3 py-2 hover:bg-blue-600/20 hover:text-blue-100 flex items-center justify-between text-sm transition-colors group ${X}`,onClick:R=>{R.stopPropagation(),G(),E(null)},children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(L,{size:16,className:"opacity-70 group-hover:opacity-100"}),o.jsx("span",{children:V})]}),$&&o.jsx("span",{className:"text-xs opacity-30 font-mono",children:$})]});return o.jsxs(Vs,{title:"Personregister & Sk",onClose:n,icon:mm,initialWidth:1e3,initialHeight:650,children:[o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("div",{className:"px-4 py-2 bg-slate-800/50 border-b border-slate-700 flex items-center justify-between",children:o.jsxs("span",{className:"text-slate-400 text-sm",children:[N.length," personer"]})}),o.jsx("div",{className:"p-3 border-b border-slate-700 bg-slate-800/50",children:o.jsxs("div",{className:"relative",children:[o.jsx(Fr,{className:"absolute left-3 top-2.5 text-slate-500",size:18}),o.jsx("input",{type:"text",autoFocus:!0,placeholder:"Sk p namn, plats...",className:"w-full bg-slate-900 border border-slate-600 text-white pl-10 pr-4 py-2 rounded focus:ring-1 focus:ring-blue-500 outline-none text-sm placeholder-slate-500",value:y,onChange:L=>v(L.target.value)}),y&&o.jsx("button",{onClick:()=>v(""),className:"absolute right-3 top-2.5 text-slate-500 hover:text-white",children:o.jsx(ys,{size:16})})]})}),o.jsxs("div",{className:"grid grid-cols-12 gap-2 text-[11px] uppercase tracking-wider text-slate-500 font-bold px-4 py-2 border-b border-slate-700 bg-slate-800/30",children:[o.jsx("div",{className:"col-span-4 pl-8",children:"Namn & Titel"}),o.jsx("div",{className:"col-span-2",children:"Relation"}),o.jsx("div",{className:"col-span-3",children:"Fdd"}),o.jsx("div",{className:"col-span-2",children:"Dd"}),o.jsx("div",{className:"col-span-1 text-center",children:"Info"})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[N.map((L,V)=>{const G=e.find($=>$.id===t),X=D(G||{},L.id);return o.jsxs("div",{className:`grid grid-cols-12 gap-2 px-4 py-2 border-b border-slate-800 hover:bg-blue-900/20 transition-colors items-center cursor-default group ${V%2===0?"bg-slate-900":"bg-slate-900/50"}`,onDoubleClick:()=>a(L),onContextMenu:$=>_($,L),children:[o.jsxs("div",{className:"col-span-4 font-medium text-slate-200 flex items-center gap-3 overflow-hidden",children:[o.jsxs("div",{className:"w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center shrink-0 text-xs font-bold border border-slate-600 relative",children:[L.gender==="M"?o.jsx("span",{className:"text-blue-300",children:"M"}):o.jsx("span",{className:"text-rose-300",children:"K"}),L.isBookmarked&&o.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-yellow-500 rounded-full shadow-sm"})]}),o.jsxs("div",{className:"truncate",children:[o.jsxs("span",{className:L.id===t?"text-yellow-400 font-bold":"",children:[L.firstName," ",L.lastName]}),L.title&&o.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:L.title})]})]}),o.jsxs("div",{className:`col-span-2 text-xs font-medium flex items-center gap-1.5 ${X.color}`,children:[X.text!=="-"&&o.jsx(Po,{size:10,className:"opacity-50"}),X.text]}),o.jsxs("div",{className:"col-span-3 text-sm text-slate-400 truncate hover:text-blue-400 cursor-pointer flex flex-col justify-center",onClick:$=>{$.stopPropagation(),L.birthPlace&&alert(`Navigerar till platsregistret: ${L.birthPlace}`)},children:[o.jsx("span",{children:L.birthDate}),L.birthPlace&&o.jsxs("span",{className:"text-[10px] opacity-60 flex items-center gap-1",children:[o.jsx(Ni,{size:8})," ",L.birthPlace]})]}),o.jsxs("div",{className:"col-span-2 text-sm text-slate-400 truncate hover:text-blue-400 cursor-pointer flex flex-col justify-center",onClick:$=>{$.stopPropagation(),L.deathPlace&&alert(`Navigerar till platsregistret: ${L.deathPlace}`)},children:[o.jsx("span",{children:L.deathDate}),L.deathPlace&&o.jsxs("span",{className:"text-[10px] opacity-60 flex items-center gap-1",children:[o.jsx(Ni,{size:8})," ",L.deathPlace]})]}),o.jsx("div",{className:"col-span-1 flex justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx("button",{onClick:$=>{$.stopPropagation(),l(L.id),n()},title:"Visa i trd",className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-white",children:o.jsx(Md,{size:14})})})]},L.id)}),N.length===0&&o.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500 gap-2",children:[o.jsx(Fr,{size:32,className:"opacity-20"}),o.jsx("span",{children:"Inga personer matchade din skning."})]})]})]}),j&&o.jsxs("div",{className:"fixed z-[2000] bg-slate-800 border border-slate-600 rounded-lg shadow-2xl w-64 py-1 overflow-hidden animate-in fade-in zoom-in-95 duration-100 ring-1 ring-black/50",style:{left:j.x,top:j.y},children:[o.jsxs("div",{className:"px-3 py-2 border-b border-slate-700 bg-slate-800/50",children:[o.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wider mb-0.5",children:"Vald person"}),o.jsxs("div",{className:"font-medium text-slate-200 truncate",children:[j.person.firstName," ",j.person.lastName]})]}),o.jsxs("div",{className:"py-1",children:[o.jsx(H,{icon:gm,label:"Redigera",onClick:()=>a(j.person),color:"text-blue-300"}),o.jsx(H,{icon:c1,label:"Skapa ny (Oberoende)",onClick:()=>a({firstName:"Ny",lastName:"Person"})})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsxs("div",{className:"py-1",children:[o.jsx(H,{icon:bu,label:"Skapa frlder",onClick:()=>i(j.person)}),o.jsx(H,{icon:t1,label:"Skapa syskon",onClick:()=>d(j.person)}),o.jsx(H,{icon:Zv,label:"Skapa barn",onClick:()=>h(j.person)}),o.jsx(H,{icon:Ed,label:"Skapa partner",onClick:()=>u(j.person)})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsxs("div",{className:"py-1",children:[o.jsx(H,{icon:Dp,label:"Gr till Huvudperson",onClick:()=>g(j.person),color:j.person.id===t?"text-yellow-400":"text-slate-300"}),o.jsx(H,{icon:Wv,label:"Bokmrke",onClick:()=>b(j.person),color:j.person.isBookmarked?"text-blue-400":"text-slate-300"}),o.jsx(H,{icon:Md,label:"Visa i Trdvy",onClick:()=>{l(j.person.id),n()},color:"text-green-400"})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsx("div",{className:"py-1",children:o.jsx(H,{icon:ol,label:"Radera person",onClick:()=>p(j.person),color:"text-red-400"})})]})]})},mO=({partners:n,onSelect:e,onClose:t,people:l})=>o.jsx("div",{className:"fixed inset-0 z-[3000] bg-black/70 flex items-center justify-center p-4 animate-in fade-in duration-200",children:o.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-sm w-full shadow-2xl relative",children:[o.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-slate-500 hover:text-white",children:o.jsx(ys,{size:20})}),o.jsxs("div",{className:"flex items-center gap-3 mb-4 text-blue-400",children:[o.jsx(bu,{size:24}),o.jsx("h3",{className:"text-lg font-bold text-white",children:"Vlj andra frldern"})]}),o.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Den valda personen har flera partners. Vem ska barnet kopplas till?"}),o.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[n.map(a=>{const i=l[a.id];return i?o.jsxs("button",{onClick:()=>e(a.id),className:"w-full flex items-center p-3 rounded bg-slate-700/50 hover:bg-blue-600/20 hover:border-blue-500/50 border border-transparent transition-all group",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-600 flex items-center justify-center shrink-0 mr-3 text-slate-300 group-hover:bg-blue-600 group-hover:text-white transition-colors",children:o.jsx(Rr,{size:18})}),o.jsxs("div",{className:"text-left",children:[o.jsxs("div",{className:"text-slate-200 font-medium group-hover:text-blue-200",children:[i.firstName," ",i.lastName]}),o.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1",children:[o.jsx(Ed,{size:10})," ",a.type==="married"?"Gift":"Partner"]})]})]},a.id):null}),o.jsxs("button",{onClick:()=>e(null),className:"w-full flex items-center p-3 rounded bg-slate-700/30 hover:bg-slate-700 border border-dashed border-slate-600 text-slate-400 hover:text-white transition-colors",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center shrink-0 mr-3 border border-slate-600",children:o.jsx(o1,{size:16})}),o.jsxs("div",{className:"text-left",children:[o.jsx("div",{className:"font-medium",children:"Oknd / Ingen av ovan"}),o.jsx("div",{className:"text-xs opacity-60",children:"Koppla endast till en frlder"})]})]})]})]})});function gO({allPeople:n=[],focusPersonId:e,onSetFocus:t,onOpenEditModal:l,onCreatePersonAndLink:a,onDeletePerson:i}){const d=n.map(hO).filter(Boolean),u={};d.forEach(Q=>{u[Q.id]=Q});const h=d.find(Q=>Q.id===e),g={focusId:e,people:u,relationships:(()=>{if(!h)return{focusPerson:null,parents:[],grandparents:[],siblings:[],partners:[],children:[],grandchildren:[]};const Q=n.find(lt=>lt.id===e);if(!Q)return{focusPerson:null,parents:[],grandparents:[],siblings:[],partners:[],children:[],grandchildren:[]};const re=(Q.relations?.parents||[]).map(lt=>typeof lt=="object"?lt.id:lt).filter(Boolean);let Ce=[];re.forEach(lt=>{const bt=n.find(ot=>ot.id===lt);if(bt&&bt.relations?.parents){const ot=(bt.relations.parents||[]).map(fe=>typeof fe=="object"?fe.id:fe).filter(Boolean);Ce=Ce.concat(ot)}}),Ce=[...new Set(Ce)];const Ye=[];n.forEach(lt=>{if(lt.id===e)return;const bt=(lt.relations?.parents||[]).map(ot=>typeof ot=="object"?ot.id:ot);bt.length&&re.some(ot=>bt.includes(ot))&&Ye.push(lt.id)});const Ve=[];if(Q.relations?.spouseId&&n.find(bt=>bt.id===Q.relations.spouseId)){const bt=n.filter(ot=>{const fe=(ot.relations?.parents||[]).map(ze=>typeof ze=="object"?ze.id:ze);return fe.includes(e)&&fe.includes(Q.relations.spouseId)}).map(ot=>ot.id);Ve.push({id:Q.relations.spouseId,children:bt,type:"married",isPartner:!0})}const ft=n.filter(lt=>{const bt=(lt.relations?.parents||[]).map(ot=>typeof ot=="object"?ot.id:ot);return bt.includes(e)&&bt.length===1}).map(lt=>lt.id);ft.length>0&&Ve.push({id:null,children:ft,type:"single",isPartner:!1});const dt=n.filter(lt=>(lt.relations?.parents||[]).map(ot=>typeof ot=="object"?ot.id:ot).includes(e)).map(lt=>lt.id);let xt=[];return dt.forEach(lt=>{const bt=n.find(ot=>ot.id===lt);if(bt&&bt.relations?.children){const ot=(bt.relations.children||[]).map(fe=>typeof fe=="object"?fe.id:fe).filter(Boolean);xt=xt.concat(ot)}}),xt=[...new Set(xt)],{focusPerson:e,parents:re,grandparents:Ce,siblings:Ye,partners:Ve,children:dt,grandchildren:xt}})()},[b,y]=C.useState({x:0,y:0,scale:.8}),v=C.useRef(null),[N,S]=C.useState(!1),[j,E]=C.useState({x:0,y:0}),[D,_]=C.useState(!1),[H,L]=C.useState(null),[V,G]=C.useState(null),[X,$]=C.useState([]),[R,A]=C.useState([e]),[B,Y]=C.useState(0),[J,de]=C.useState(null),w=Q=>{if(Q===g.focusId)return;const re=R.slice(0,B+1);re.push(Q),A(re),Y(re.length-1),t&&t(Q)};C.useEffect(()=>{const Q=()=>de(null);return window.addEventListener("click",Q),()=>window.removeEventListener("click",Q)},[]);const T=(Q,re)=>{Q.preventDefault(),Q.stopPropagation();const Ce=Math.min(Q.clientX,window.innerWidth-280),Ye=Math.min(Q.clientY,window.innerHeight-400);de({x:Ce,y:Ye,person:re})},I=Q=>{l?l(Q.id):L(Q)},Z=Q=>{const re=g.relationships.partners||[];re.length>1?G({parentId:Q.id,partners:re}):re.length===1?pe(Q.id,re[0].id):pe(Q.id,null)},pe=(Q,re)=>{G(null),a?a(Q,"child"):L({firstName:"Nytt",lastName:"Barn",parent1:Q,parent2:re,isNew:!0})},O=Q=>{a?a(Q.id,"parent"):L({firstName:"Ny",lastName:"Frlder",childId:Q.id,isNew:!0})},te=Q=>{a?a(Q.id,"sibling"):L({firstName:"Nytt",lastName:"Syskon",siblingId:Q.id,isNew:!0})},ke=Q=>{a?a(Q.id,"spouse"):L({firstName:"Ny",lastName:"Partner",partnerTo:Q.id,isNew:!0})},U=Q=>{confirm(`r du sker p att du vill radera ${Q.firstName} ${Q.lastName}?`)&&(i?i(Q.id):alert("Person raderad (Mock)"))},ge=Q=>{w(Q.id)},Ee=Q=>{alert("Bokmrke funktion ej implementerad n")},ie=()=>{const Q=[],re=[],Ce=g.people[g.focusId];Ce&&Q.push({...Ce,x:0,y:0,isFocus:!0});const Ye=g.relationships.grandparents||[],Ve=-520,ft=260,dt=-((Ye.length-1)*ft)/2;Ye.forEach((ht,St)=>{const ee=g.people[ht];if(!ee)return;const oe=dt+St*ft;Q.push({...ee,x:oe,y:Ve}),(g.relationships.parents||[]).forEach(xe=>{const $e=g.people[xe];$e&&re.push({from:{x:oe,y:Ve+$s/2-20},to:{x:$e.x||0,y:-260+$s/2-20},type:"grandparent"})})});const xt=g.relationships.parents||[],lt=-260,bt=340,ot=-((xt.length-1)*bt)/2;xt.forEach((ht,St)=>{const ee=g.people[ht];if(!ee)return;const oe=ot+St*bt;Q.push({...ee,x:oe,y:lt}),re.push({from:{x:0,y:-60},to:{x:oe,y:lt+$s/2-20},type:"parent"}),ee.x=oe}),(g.relationships.siblings||[]).forEach((ht,St)=>{const ee=g.people[ht];if(!ee)return;const oe=-260-ko/2-St*dO;Q.push({...ee,x:oe,y:0}),re.push({from:{x:-150,y:0},to:{x:oe+ko/2-10,y:0},type:"sibling"})});let ze=kp/2+60,Me=kp/2-10;(g.relationships.partners||[]).forEach((ht,St)=>{const ee=g.people[ht.id];if(!ee&&ht.id!==null)return;if(ee){const xe=ze+$s/2;Q.push({...ee,x:0,y:xe,isPartner:!0}),re.push({from:{x:0,y:Me},to:{x:0,y:xe-$s/2+10},type:"straight-down",midPoint:{x:0,y:(Me+xe-$s/2)/2},styleType:ht.type}),Me=xe+$s/2-10}const oe=ht.children||[];if(oe.length>0){const $e=Me;ze=Me+70,oe.forEach(Ot=>{const _t=g.people[Ot];if(!_t)return;const xn=cO+ko/2,bn=ze+$s/2;Q.push({..._t,x:xn,y:bn}),re.push({from:{x:0,y:$e},to:{x:xn-ko/2+10,y:bn},type:"child-fork"}),ze+=Bv});const Xt=ze-Bv+$s/2+50;re.push({from:{x:0,y:Me},to:{x:0,y:Xt},type:"straight-down"}),Me=Xt,ze+=50}else ze+=$s+60,Me=ze-70});const He=g.relationships.grandchildren||[],et=ze+180,st=220,rt=-((He.length-1)*st)/2;return He.forEach((ht,St)=>{const ee=g.people[ht];if(!ee)return;const oe=rt+St*st;Q.push({...ee,x:oe,y:et}),(g.relationships.children||[]).forEach(xe=>{const $e=g.people[xe];$e&&re.push({from:{x:oe,y:et-$s/2+20},to:{x:$e.x||0,y:($e.y||0)+$s/2-20},type:"grandchild"})})}),{nodes:Q,edges:re}},{nodes:Ie,edges:P}=ie(),we=Q=>{Q.preventDefault(),y(re=>({...re,scale:Math.min(Math.max(re.scale+-Q.deltaY*.001,.1),3)}))},ue=Q=>{Q.button===0&&(S(!0),E({x:Q.clientX,y:Q.clientY}))},Ue=Q=>{N&&(y(re=>({...re,x:re.x+(Q.clientX-j.x),y:re.y+(Q.clientY-j.y)})),E({x:Q.clientX,y:Q.clientY}))};return C.useEffect(()=>{if(v.current){const{width:Q,height:re}=v.current.getBoundingClientRect();y(Ce=>({...Ce,x:Q/2,y:re/2-100}))}},[]),h?o.jsxs("div",{className:"w-full h-screen bg-slate-950 overflow-hidden relative font-sans text-slate-800 select-none",onContextMenu:Q=>Q.preventDefault(),children:[o.jsxs("div",{className:"absolute top-4 left-4 z-50 flex gap-2",children:[o.jsxs("div",{className:"flex bg-slate-800 rounded shadow border border-slate-600",children:[o.jsx("button",{onClick:()=>{const Q=Math.max(0,B-1);Y(Q),t&&t(R[Q])},disabled:B===0,className:"p-2 text-slate-300 hover:bg-slate-700 disabled:opacity-30",children:o.jsx(Qv,{size:20})}),o.jsx("div",{className:"w-px bg-slate-600"}),o.jsx("button",{onClick:()=>{const Q=Math.min(R.length-1,B+1);Y(Q),t&&t(R[Q])},disabled:B>=R.length-1,className:"p-2 text-slate-300 hover:bg-slate-700 disabled:opacity-30",children:o.jsx(AS,{size:20})})]}),o.jsxs("div",{className:"relative group",children:[o.jsxs("div",{className:"flex items-center bg-slate-800 border border-slate-600 rounded shadow px-3 py-2 w-64 focus-within:ring-2 focus-within:ring-blue-500 transition-all",children:[o.jsx(Fr,{size:16,className:"text-slate-400 mr-2"}),o.jsx("input",{type:"text",placeholder:"Snabb sk...",className:"bg-transparent border-none outline-none text-slate-200 text-sm w-full placeholder-slate-500",onChange:Q=>{const re=Q.target.value.toLowerCase();$(re.length>1?d.filter(Ce=>(Ce.firstName+" "+Ce.lastName).toLowerCase().includes(re)):[])}})]}),X.length>0&&o.jsx("div",{className:"absolute top-full left-0 mt-1 w-full bg-slate-800 border border-slate-600 rounded shadow-xl z-50",children:X.map(Q=>o.jsxs("div",{className:"px-3 py-2 hover:bg-slate-700 cursor-pointer text-slate-200 text-sm",onClick:()=>{w(Q.id),$([])},children:[Q.firstName," ",Q.lastName]},Q.id))})]})]}),o.jsxs("div",{className:"absolute top-4 right-4 z-50 flex items-start gap-3",children:[o.jsxs(mt,{variant:"primary",size:"md",onClick:()=>_(!0),children:[o.jsx(mm,{size:18}),o.jsx("span",{className:"hidden sm:inline",children:"Avancerad sk"})]}),o.jsxs("div",{className:"flex flex-col gap-2 bg-slate-800/80 p-2 rounded border border-slate-700 shadow-lg backdrop-blur-sm",children:[o.jsx("button",{onClick:()=>y(Q=>({...Q,scale:Q.scale+.1})),className:"p-2 bg-slate-700 rounded hover:bg-slate-600 text-slate-200",children:o.jsx(gl,{size:20})}),o.jsx("button",{onClick:()=>y(Q=>({...Q,scale:Q.scale-.1})),className:"p-2 bg-slate-700 rounded hover:bg-slate-600 text-slate-200",children:o.jsx(r1,{size:20})}),o.jsx("button",{onClick:()=>y(Q=>({x:window.innerWidth/2,y:window.innerHeight/2-100,scale:.8})),className:"p-2 bg-slate-700 rounded hover:bg-slate-600 text-slate-200",children:o.jsx(rj,{size:20})})]})]}),D&&o.jsx(Pv,{onClose:()=>_(!1),people:d,focusId:g.focusId,onNavigate:w,onEdit:I,onAddParent:O,onAddSibling:te,onAddChild:Z,onAddPartner:ke,onDelete:U,onToggleMain:ge,onToggleBookmark:Ee}),H&&o.jsx(pO,{person:H,onClose:()=>L(null)}),V&&o.jsx(mO,{partners:V.partners,people:g.people,onClose:()=>G(null),onSelect:Q=>pe(V.parentId,Q)}),o.jsx("div",{ref:v,className:"w-full h-full cursor-grab active:cursor-grabbing",onWheel:we,onMouseDown:ue,onMouseMove:Ue,onMouseUp:()=>S(!1),onMouseLeave:()=>S(!1),children:o.jsxs("div",{style:{transform:`translate(${b.x}px, ${b.y}px) scale(${b.scale})`,transformOrigin:"0 0",position:"absolute",top:0,left:0},children:[o.jsx("svg",{style:{position:"absolute",top:-5e4,left:-5e4,width:1e5,height:1e5,pointerEvents:"none",zIndex:0},viewBox:"-50000 -50000 100000 100000",children:P.map((Q,re)=>o.jsxs("g",{children:[o.jsx("path",{d:fO(Q.from,Q.to,Q.type),stroke:"#475569",strokeWidth:3,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:Q.styleType==="divorced"?"6,6":"0"}),Q.midPoint&&Q.type==="straight-down"&&o.jsx("foreignObject",{x:Q.midPoint.x-12,y:Q.midPoint.y-12,width:"24",height:"24",children:o.jsx("div",{className:"w-6 h-6 bg-slate-800 rounded-full flex items-center justify-center border-2 border-slate-600 z-10 shadow-lg",children:Q.styleType==="divorced"?o.jsx(nj,{size:12,className:"text-red-400 opacity-75"}):o.jsx(Ed,{size:12,className:"text-rose-500"})})})]},re))}),Ie.map(Q=>{const re=uO(Q),Ce=Q.isFocus?oO:ko,Ye=Q.isFocus?kp:$s;return o.jsxs("div",{className:`absolute flex flex-col shadow-2xl rounded-lg overflow-hidden border-2 transition-all duration-300 hover:scale-105 hover:z-50 
                            ${Q.gender==="M"?"bg-blue-50 border-blue-200":Q.gender==="K"?"bg-rose-50 border-rose-200":"bg-gray-50 border-gray-200"} 
                            ${Q.isFocus?"ring-4 ring-yellow-400 z-40":"z-10"}`,style:{left:Q.x-Ce/2,top:Q.y-Ye/2,width:Ce,height:Ye},onDoubleClick:()=>w(Q.id),onContextMenu:Ve=>T(Ve,Q),children:[o.jsxs("div",{className:`${Q.gender==="M"?"bg-blue-600":Q.gender==="K"?"bg-rose-500":"bg-gray-500"} text-white px-3 py-1.5 flex items-center gap-2 shadow-sm`,children:[o.jsxs("span",{className:"font-bold truncate text-sm flex-1",children:[Q.firstName," ",Q.lastName]}),Q.isBookmarked&&o.jsx(Dp,{size:12,className:"fill-yellow-300 text-yellow-300"}),re.length>0&&o.jsx(o1,{size:14,className:"text-yellow-300 animate-pulse"}),Q.deathDate&&o.jsx("span",{className:"text-xs opacity-70",children:""}),Q.isPartner&&o.jsx("button",{title:"Visa trd fr denna person",className:"ml-2 p-1 rounded hover:bg-blue-700/30",onClick:Ve=>{Ve.stopPropagation(),w(Q.id)},children:o.jsx(Md,{size:16,className:"text-blue-200"})})]}),o.jsxs("div",{className:"flex flex-1 p-2 gap-3 relative group",children:[o.jsx("div",{className:"flex flex-col items-center gap-0.5",children:o.jsx("div",{className:"w-16 h-16 bg-gray-300 rounded overflow-hidden border border-gray-400 flex-shrink-0 shadow-inner",children:o.jsx(Rr,{className:"w-full h-full p-2 text-gray-500"})})}),o.jsxs("div",{className:"flex-1 flex flex-col text-xs space-y-1 justify-center text-slate-700",children:[Q.birthDate&&o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"opacity-70 flex items-center gap-1 font-semibold text-[10px] uppercase tracking-wide",children:"Fdd"}),o.jsx("span",{className:"font-medium truncate",children:Q.birthDate})]}),Q.deathDate&&o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"opacity-70 flex items-center gap-1 font-semibold text-[10px] uppercase tracking-wide",children:"Dd"}),o.jsx("span",{className:"font-medium truncate",children:Q.deathDate})]})]})]})]},Q.id)})]})}),J&&o.jsxs("div",{className:"fixed z-[6000] bg-slate-800 border border-slate-600 rounded-lg shadow-2xl w-64 py-1 overflow-hidden animate-in fade-in zoom-in-95 duration-100 ring-1 ring-black/50",style:{left:J.x,top:J.y},onClick:Q=>Q.stopPropagation(),children:[o.jsxs("div",{className:"px-3 py-2 border-b border-slate-700 bg-slate-800/50",children:[o.jsx("div",{className:"text-xs text-slate-500 font-bold uppercase tracking-wider mb-0.5",children:"Vald person"}),o.jsxs("div",{className:"font-medium text-slate-200 truncate",children:[J.person.firstName," ",J.person.lastName]})]}),o.jsxs("div",{className:"py-1",children:[o.jsx(Zl,{icon:gm,label:"Redigera",onClick:()=>{de(null),I(J.person)},color:"text-blue-300"}),o.jsx(Zl,{icon:c1,label:"Skapa ny (Oberoende)",onClick:()=>{de(null),I({firstName:"Ny",lastName:"Person"})}})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsxs("div",{className:"py-1",children:[o.jsx(Zl,{icon:bu,label:"Skapa frlder",onClick:()=>{de(null),O(J.person)}}),o.jsx(Zl,{icon:t1,label:"Skapa syskon",onClick:()=>{de(null),te(J.person)}}),o.jsx(Zl,{icon:Zv,label:"Skapa barn",onClick:()=>{de(null),Z(J.person)}}),o.jsx(Zl,{icon:Ed,label:"Skapa partner",onClick:()=>{de(null),ke(J.person)}})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsxs("div",{className:"py-1",children:[o.jsx(Zl,{icon:Dp,label:"Gr till Huvudperson",onClick:()=>{de(null),ge(J.person)},color:J.person.id===g.focusId?"text-yellow-400":"text-slate-300"}),o.jsx(Zl,{icon:Wv,label:"Bokmrke",onClick:()=>{de(null),Ee(J.person)},color:J.person.isBookmarked?"text-blue-400":"text-slate-300"})]}),o.jsx("div",{className:"h-px bg-slate-700 mx-2"}),o.jsx("div",{className:"py-1",children:o.jsx(Zl,{icon:ol,label:"Radera person",onClick:()=>{de(null),U(J.person)},color:"text-red-400"})})]})]}):o.jsxs("div",{className:"w-full h-screen bg-slate-950 overflow-hidden flex items-center justify-center",children:[o.jsxs("div",{className:"text-slate-400 text-center",children:[o.jsx(Md,{size:64,className:"mx-auto mb-4 opacity-20"}),o.jsx("p",{children:"Vlj en person att fokusera p fr att visa slkttrdet."}),o.jsxs(mt,{variant:"primary",className:"mt-4",onClick:()=>_(!0),children:[o.jsx(Fr,{size:16}),"Sk person"]})]}),D&&o.jsx(Pv,{onClose:()=>_(!1),people:d,focusId:g.focusId,onNavigate:w,onEdit:I,onAddParent:O,onAddSibling:te,onAddChild:Z,onAddPartner:ke,onDelete:U,onToggleMain:ge,onToggleBookmark:Ee})]})}const Zl=({icon:n,label:e,onClick:t,color:l="text-slate-300",shortcut:a})=>o.jsxs("button",{className:`w-full text-left px-3 py-2 hover:bg-blue-600/20 hover:text-blue-100 flex items-center justify-between text-sm transition-colors group ${l}`,onClick:i=>{i.stopPropagation(),t()},children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(n,{size:16,className:"opacity-70 group-hover:opacity-100"}),o.jsx("span",{children:e})]}),a&&o.jsx("span",{className:"text-xs opacity-30 font-mono",children:a})]}),xO="WestFamilyTreeImages",Yr="images";function r0(){return new Promise((n,e)=>{const t=indexedDB.open(xO,1);t.onupgradeneeded=l=>{const a=l.target.result;a.objectStoreNames.contains(Yr)||a.createObjectStore(Yr,{keyPath:"id"})},t.onsuccess=()=>n(t.result),t.onerror=()=>e(t.error)})}async function bO(n,e){const t=await r0();return new Promise((l,a)=>{const i=t.transaction(Yr,"readwrite");i.objectStore(Yr).put({id:n,base64:e}),i.oncomplete=()=>l(),i.onerror=()=>a(i.error)})}async function yO(n){const e=await r0();return new Promise((t,l)=>{const d=e.transaction(Yr,"readonly").objectStore(Yr).get(n);d.onsuccess=()=>t(d.result?d.result.base64:null),d.onerror=()=>l(d.error)})}async function vO(n){const e=await r0();return new Promise((t,l)=>{const a=e.transaction(Yr,"readwrite");a.objectStore(Yr).delete(n),a.oncomplete=()=>t(),a.onerror=()=>l(a.error)})}const NO={default:{icon:"",label:"Landomrde / vrig plats"},industry:{icon:"",label:"Bruk / fabrik / kvarn / gruva"},village_town:{icon:"",label:"By / samhlle"},court_district:{icon:"",label:"Domsaga"},prison:{icon:"",label:"Fngelse / anstalt"},parish_church:{icon:"",label:"Frsamling / socken / kyrka"},street_block:{icon:"",label:"Gata / kvarter / stadsdel"},estate:{icon:"",label:"Gods / steri"},farm_manor:{icon:"",label:"Grd / herrgrd / hemman"},harbor:{icon:"",label:"Hamn"},hundred:{icon:"",label:"Hrad / tingslag"},municipality:{icon:"",label:"Kommun"},cemetery:{icon:"",label:"Kyrkogrd / gravplats"},country:{icon:"",label:"Land"},landscape:{icon:"",label:"Landskap"},county:{icon:"",label:"Ln / fylke / amt"},military:{icon:"",label:"Militrfrlggning"},pastorate:{icon:"",label:"Pastorat"},province:{icon:"",label:"Provins / region"},rote:{icon:"",label:"Rote"},hospital:{icon:"",label:"Sjukhus / behandlingshem"},lake_river:{icon:"",label:"Sj / vattendrag"},castle:{icon:"",label:"Slott"},city:{icon:"",label:"Stad"},state:{icon:"",label:"Stat"},diocese:{icon:"",label:"Stift"},cottage:{icon:"",label:"Stuga / torp"},university:{icon:"",label:"Universitet / lroverk"}};function Hv(n){if(n==null)return"";try{return String(n).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/[.,\/()\-\u2013\u2014]/g," ").replace(/\s+/g," ").trim().toLowerCase()}catch{return String(n).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[.,\/()\-\u2013\u2014]/g," ").replace(/\s+/g," ").trim().toLowerCase()}}function kO(n,e){if(!n.length)return;const t=["Frnamn","Efternamn","Hndelsetyp","Datum","Beskrivning"],l=n.map(({person:h,event:p})=>[h.firstName,h.lastName,p.type,p.date||"",p.description?p.description.replace(/\n/g," "):""]),a=[t,...l].map(h=>h.map(p=>'"'+(p||"").replace(/"/g,'""')+'"').join(",")).join(`\r
`),i=new Blob([a],{type:"text/csv"}),d=URL.createObjectURL(i),u=document.createElement("a");u.href=d,u.download=`${e||"boendelista"}.csv`,document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u),URL.revokeObjectURL(d)},100)}function wO({places:n,people:e,allSources:t=[],onSavePlace:l=()=>{},onOpenPerson:a=()=>{},onViewInFamilyTree:i=()=>{},onNavigateToSource:d=()=>{},onOpenSourceDrawer:u=()=>{},onNavigateToPlace:h=()=>{},onOpenPlaceDrawer:p=()=>{},onOpenSourceInDrawer:g=()=>{}}){function b(U){return!U.sources||!Array.isArray(U.sources)?[]:U.sources.map(ge=>t.find(Ee=>Ee.id===ge)).filter(Boolean)}const y=["farm_manor","cottage"],v=C.useMemo(()=>(n||[]).filter(U=>y.includes(U.placeType)),[n]),[N,S]=C.useState(null),j=v.find(U=>U.id===N),[E,D]=C.useState(null),[_,H]=C.useState(""),[L,V]=C.useState(null),[G,X]=C.useState(""),[$,R]=C.useState(""),[A,B]=C.useState(""),Y=C.useRef(null),{getPersonRelations:J}=Fs(),de=C.useMemo(()=>{if(!j)return[];const U=[];return(e||[]).forEach(ge=>{(ge.events||[]).forEach(Ee=>{const Ie=["Bosatt","Inflyttning","Utflyttning","Fdd","Fdelse","Dd","Begravning","Begravd"].includes((Ee.type||"").toString()),P=Ee.placeId===j.id,we=(Ee.place||"")+"",ue=Hv(we),Ue=[j.specific,j.village,j.parish,j.municipality,j.region,j.country].filter(Boolean).map(re=>Hv(re)),Q=ue&&Ue.some(re=>re&&(ue.includes(re)||re.includes(ue)));Ie&&(P||Q)&&U.push({person:ge,event:Ee})})}),U.sort((ge,Ee)=>(ge.event.date||"").localeCompare(Ee.event.date||""))},[j,e]),w=C.useMemo(()=>de.filter(({person:U,event:ge})=>!(G&&!(U.lastName||"").toLowerCase().includes(G.toLowerCase())||$&&!(ge.date||"").includes($)||A&&ge.type!==A)),[de,G,$,A]),T=C.useMemo(()=>{const U={};return w.forEach(({person:ge})=>{U[ge.id]=ge}),U},[w]),I=C.useMemo(()=>{const U={},ge=Object.keys(T),Ee={};return ge.forEach(ie=>{const Ie=J?J(ie)||[]:[];Ee[ie]=Ie.filter(P=>!P._archived&&(P.type||"").toString().toLowerCase()==="parent").map(P=>P.fromPersonId===ie?P.toPersonId:P.fromPersonId).filter(Boolean)}),ge.forEach(ie=>{const Ie=(Ee[ie]||[]).filter(ue=>ge.includes(ue)).map(ue=>T[ue]),P=ge.filter(ue=>(Ee[ue]||[]).includes(ie)).map(ue=>T[ue]),we=ge.filter(ue=>ue!==ie&&(Ee[ue]||[]).some(Ue=>(Ee[ie]||[]).includes(Ue))).map(ue=>T[ue]);U[ie]={parents:Ie,children:P,siblings:we}}),U},[T,J]),Z=C.useMemo(()=>{const U=new Set;return de.forEach(({event:ge})=>{const Ee=(ge.date||"").match(/\d{4}/);Ee&&U.add(Ee[0])}),Array.from(U).sort()},[de]),pe=U=>{if(!Y.current)return;const ge=Y.current.querySelector(`[data-year='${U}']`);ge&&ge.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})};C.useEffect(()=>{let U=!1;async function ge(){if(!j){D(null),H("");return}H(j.note||"");try{const Ee=await yO(`place-image-${j.id}`);U||D(Ee)}catch(Ee){console.warn("Failed loading farm image",Ee)}}return ge(),()=>{U=!0}},[j]);const O=async U=>{if(!U||!j)return;const ge=new FileReader;ge.onload=async Ee=>{const ie=Ee.target.result;try{await bO(`place-image-${j.id}`,ie),D(ie)}catch(Ie){console.error(Ie)}},ge.readAsDataURL(U)},te=async()=>{if(j)try{await vO(`place-image-${j.id}`),D(null)}catch(U){console.error(U)}},ke=async()=>{if(!j)return;const U={...j,note:_};l(U)};return o.jsxs("div",{className:"flex h-full",children:[o.jsxs("aside",{className:"w-80 border-r border-slate-700 bg-slate-800 p-2 overflow-y-auto",children:[o.jsx("h2",{className:"font-bold text-lg mb-2 text-slate-200",children:"Grdsarkivet"}),o.jsx("ul",{children:v.map(U=>o.jsxs("li",{className:"flex items-center justify-between",children:[o.jsx("button",{className:`flex-1 text-left px-2 py-1 rounded hover:bg-blue-100 ${U.id===N?"bg-blue-200 font-bold":""}`,onClick:()=>S(U.id),children:U.specific||U.village||U.parish||U.country}),o.jsx("button",{title:"ppna i Platsregistret",className:"ml-2 p-1 text-sm text-blue-600 hover:bg-blue-50 rounded",onClick:()=>{typeof h=="function"&&h(U.id),typeof p=="function"&&p(U.id)},children:""})]},U.id))})]}),o.jsx("main",{className:"flex-1 p-6 overflow-y-auto",children:j?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[o.jsx("div",{className:"w-48 h-36 bg-slate-700 rounded border border-slate-600 flex items-center justify-center overflow-hidden",children:E?o.jsx("img",{src:E,alt:"Grdsbild",className:"object-cover w-full h-full"}):o.jsx("div",{className:"text-sm text-slate-400 p-2",children:"Ingen bild"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-xl font-bold",children:j.specific||j.village||j.parish||j.country}),o.jsxs("div",{className:"mb-2 text-slate-400",children:["Platskategori: ",NO[j.placeType]?.label||(j.placeType||"").replace(/_/g," ")]}),o.jsxs("div",{className:"mb-2 text-sm text-slate-400",children:["ID: ",j.id]}),o.jsxs("div",{className:"flex gap-2 mt-2",children:[o.jsxs("label",{className:"p-2 bg-slate-700 rounded cursor-pointer text-sm text-slate-200",children:["Ladda upp bild",o.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:U=>O(U.target.files?.[0])})]}),E&&o.jsx("button",{className:"px-3 py-1 bg-red-100 text-red-700 rounded text-sm",onClick:te,children:"Ta bort bild"})]})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-xs font-bold text-slate-300 mb-1",children:"Grdsanteckning"}),o.jsx("textarea",{value:_,onChange:U=>H(U.target.value),className:"w-full p-2 border border-slate-600 rounded h-24 bg-slate-900 text-slate-200",placeholder:"Skriv anteckningar eller berttelser om grden..."}),o.jsx("div",{className:"mt-2 text-right",children:o.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ke,children:"Spara anteckning"})})]}),L&&o.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-black opacity-30",onClick:()=>V(null)}),o.jsxs("div",{className:"bg-slate-800 rounded shadow-lg p-4 z-10 w-96 border border-slate-700",children:[o.jsxs("div",{className:"font-bold mb-3 text-slate-200",children:["Vad vill du gra med ",L.firstName," ",L.lastName,"?"]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{className:"px-3 py-2 bg-slate-700 rounded text-slate-200 hover:bg-slate-600",onClick:()=>V(null),children:"Avbryt"}),o.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>{i(L.id),V(null)},children:"Visa i slkttrd"}),o.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded",onClick:()=>{a(L.id),V(null)},children:"Redigera personen"})]})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 items-end",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Filtrera efternamn"}),o.jsx("input",{type:"text",value:G,onChange:U=>X(U.target.value),className:"p-2 border rounded w-32",placeholder:"Efternamn..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Filtrera rtal"}),o.jsx("input",{type:"text",value:$,onChange:U=>R(U.target.value),className:"p-2 border rounded w-24",placeholder:"rtal..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Hndelsetyp"}),o.jsxs("select",{value:A,onChange:U=>B(U.target.value),className:"p-2 border rounded w-32",children:[o.jsx("option",{value:"",children:"Alla"}),o.jsx("option",{value:"Fdd",children:"Fdd"}),o.jsx("option",{value:"Dd",children:"Dd"}),o.jsx("option",{value:"Bosatt",children:"Bosatt"}),o.jsx("option",{value:"Inflyttning",children:"Inflyttning"}),o.jsx("option",{value:"Utflyttning",children:"Utflyttning"})]})]}),Z.length>0&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Hoppa till r"}),o.jsx("div",{className:"flex gap-1 flex-wrap",children:Z.map(U=>o.jsx("button",{className:"px-2 py-1 text-xs bg-slate-700 rounded hover:bg-blue-600 text-slate-300",onClick:()=>{R(U),pe(U)},children:U},U))})]}),o.jsx("div",{className:"flex-1 flex justify-end",children:o.jsx("button",{className:"px-4 py-2 bg-green-600 text-white font-bold rounded hover:bg-green-700",onClick:()=>kO(w,j.specific||j.village||j.parish||j.country),disabled:w.length===0,title:"Exportera boendelista som CSV",children:"Exportera CSV"})})]}),o.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 items-end",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Filtrera efternamn"}),o.jsx("input",{type:"text",value:G,onChange:U=>X(U.target.value),className:"p-2 border rounded w-32",placeholder:"Efternamn..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Filtrera rtal"}),o.jsx("input",{type:"text",value:$,onChange:U=>R(U.target.value),className:"p-2 border rounded w-24",placeholder:"rtal..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Hndelsetyp"}),o.jsxs("select",{value:A,onChange:U=>B(U.target.value),className:"p-2 border rounded w-32",children:[o.jsx("option",{value:"",children:"Alla"}),o.jsx("option",{value:"Fdd",children:"Fdd"}),o.jsx("option",{value:"Dd",children:"Dd"}),o.jsx("option",{value:"Bosatt",children:"Bosatt"}),o.jsx("option",{value:"Inflyttning",children:"Inflyttning"}),o.jsx("option",{value:"Utflyttning",children:"Utflyttning"})]})]}),Z.length>0&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"Hoppa till r"}),o.jsx("div",{className:"flex gap-1 flex-wrap",children:Z.map(U=>o.jsx("button",{className:"px-2 py-1 text-xs bg-slate-700 rounded hover:bg-blue-600 text-slate-300",onClick:()=>{R(U),pe(U)},children:U},U))})]})]}),o.jsx("div",{className:"overflow-x-auto mb-8",ref:Y,style:{whiteSpace:"nowrap"},children:w.length>0?o.jsx("div",{className:"flex gap-6",children:w.map(({person:U,event:ge},Ee)=>{const ie=(ge.date||"").match(/\d{4}/)?.[0]||"";return o.jsxs("div",{className:"min-w-[220px] max-w-xs bg-blue-50 border border-blue-200 rounded-lg p-3 flex-shrink-0 relative","data-year":ie,children:[o.jsxs("button",{className:"font-semibold text-blue-900 text-left",onClick:()=>V(U),children:[U.firstName," ",U.lastName]}),o.jsxs("div",{className:"text-xs text-slate-400 mb-1",children:[ge.type," ",ge.date?"("+ge.date+")":""]}),ge.description&&o.jsx("div",{className:"text-xs text-slate-500 mb-1",children:ge.description}),b(ge).length>0&&o.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Kllor: ",b(ge).map(Ie=>o.jsxs("span",{className:"mr-3",children:[o.jsx("span",{className:"cursor-pointer underline hover:text-blue-900",title:Ie.sourceString||Ie.archive,onClick:()=>{g(Ie.id,U.id,ge.id)},children:Cd(Ie).split(`
`)[0]}),Ie.aid&&o.jsx("a",{href:`https://www.arkivdigital.se/aid/show/${encodeURIComponent(Ie.aid)}`,target:"_blank",rel:"noopener noreferrer",className:"ml-1 text-blue-600 hover:underline",onClick:P=>P.stopPropagation(),title:`ppna AID ${Ie.aid} p ArkivDigital`,children:"(AID)"})]},Ie.id))]}),I[U.id]&&o.jsxs("div",{className:"text-xs text-slate-300 mt-2",children:[I[U.id].parents.length>0&&o.jsxs("div",{children:["Frlder: ",I[U.id].parents.map(Ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>V(Ie),children:[Ie.firstName," ",Ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(Ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},Ie.id))]}),I[U.id].children.length>0&&o.jsxs("div",{children:["Barn: ",I[U.id].children.map(Ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>V(Ie),children:[Ie.firstName," ",Ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(Ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},Ie.id))]}),I[U.id].siblings.length>0&&o.jsxs("div",{children:["Syskon: ",I[U.id].siblings.map(Ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>V(Ie),children:[Ie.firstName," ",Ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(Ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},Ie.id))]})]}),o.jsx("div",{className:"absolute top-2 right-2 text-xs text-slate-500",children:ie})]},U.id+ge.id)})}):o.jsx("div",{className:"text-slate-400 italic",children:"Ingen boendehndelse matchar filtren."})}),o.jsx("h4",{className:"font-bold mb-2",children:"Boende (lista):"}),w.length===0&&o.jsx("div",{className:"text-slate-400 italic",children:"Ingen boendehndelse registrerad."}),o.jsx("ul",{className:"space-y-2",children:w.map(({person:U,event:ge},Ee)=>o.jsxs("li",{className:"border-b pb-2",children:[o.jsx("div",{className:"font-semibold",children:o.jsxs("button",{className:"text-left",onClick:()=>V(U),children:[U.firstName," ",U.lastName]})}),o.jsxs("div",{className:"text-sm text-slate-400",children:[ge.type," ",ge.date?"("+ge.date+")":""]}),ge.description&&o.jsx("div",{className:"text-xs text-slate-500",children:ge.description}),b(ge).length>0&&o.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Kllor: ",b(ge).map(ie=>o.jsxs("span",{className:"mr-3",children:[o.jsx("span",{className:"font-medium cursor-pointer underline hover:text-blue-900",title:ie.sourceString||ie.archive,onClick:()=>{g(ie.id,U.id,ge.id)},children:Cd(ie).split(`
`)[0]}),ie.aid&&o.jsx("a",{href:`https://www.arkivdigital.se/aid/show/${encodeURIComponent(ie.aid)}`,target:"_blank",rel:"noopener noreferrer",className:"ml-1 text-blue-600 hover:underline",onClick:Ie=>Ie.stopPropagation(),title:`ppna AID ${ie.aid} p ArkivDigital`,children:"(AID)"})]},ie.id))]}),I[U.id]&&o.jsxs("div",{className:"text-xs text-slate-300 mt-1",children:[I[U.id].parents.length>0&&o.jsxs("div",{children:["Frlder: ",I[U.id].parents.map(ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>a(ie.id),children:[ie.firstName," ",ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},ie.id))]}),I[U.id].children.length>0&&o.jsxs("div",{children:["Barn: ",I[U.id].children.map(ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>a(ie.id),children:[ie.firstName," ",ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},ie.id))]}),I[U.id].siblings.length>0&&o.jsxs("div",{children:["Syskon: ",I[U.id].siblings.map(ie=>o.jsxs("span",{className:"inline-flex items-center mr-2",children:[o.jsxs("button",{className:"underline text-blue-700 hover:text-blue-900 mr-1 text-xs",onClick:()=>a(ie.id),children:[ie.firstName," ",ie.lastName]}),o.jsx("button",{title:"Visa i slkttrd",className:"w-5 h-5 flex items-center justify-center text-blue-500 hover:text-blue-700",onClick:()=>i(ie.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:o.jsx("path",{d:"M10 2a1 1 0 00-1 1v3H6a1 1 0 00-1 1v2H3a1 1 0 000 2h2v2a1 1 0 001 1h2v3a1 1 0 002 0v-3h2a1 1 0 001-1v-2h2a1 1 0 000-2h-2V7a1 1 0 00-1-1h-3V3a1 1 0 00-1-1z"})})})]},ie.id))]})]})]},U.id+ge.id))})]}):o.jsx("div",{className:"text-slate-400 italic mt-32",children:"Vlj en grd/torp till vnster fr att se tidslinjen."})})]})}function SO({people:n=[],allSources:e=[],onOpenPerson:t=()=>{},onViewInFamilyTree:l=()=>{}}){const{getPersonRelations:a,restorePerson:i,deletePersonPermanently:d,showStatus:u}=Fs(),[h,p]=C.useState(""),[g,b]=C.useState(""),[y,v]=C.useState(!1),[N,S]=C.useState(!0),[j,E]=C.useState(new Set),[D,_]=C.useState(null),H=C.useMemo(()=>(n||[]).filter(R=>{if(N&&!R._archived||!N&&R._archived)return!1;if(h){const A=h.toLowerCase();if(!`${R.firstName||""} ${R.lastName||""}`.toLowerCase().includes(A))return!1}if(g&&!(R.events||[]).some(B=>(B.date||"").includes(g)))return!1;if(y){const B=(a&&a(R.id)||[]).some(J=>!J._archived),Y=(R.events||[]).length>0;if(B||Y)return!1}return!0}).sort((R,A)=>(A._archived?1:0)-(R._archived?1:0)||(R.lastName||"").localeCompare(A.lastName||"")),[n,h,g,y,N,a]);C.useEffect(()=>{E(R=>new Set(Array.from(R).filter(B=>H.find(Y=>Y.id===B))))},[H]);const L=R=>E(A=>{const B=new Set(A);return B.has(R)?B.delete(R):B.add(R),B}),V=()=>E(new Set(H.map(R=>R.id))),G=()=>E(new Set),X=C.useCallback(R=>{R.forEach(A=>{try{i(A)}catch{}}),u(`terstllde ${R.length} personer.`),G()},[i,u]),$=C.useCallback(R=>{R.forEach(A=>{try{d(A)}catch{}}),u(`Raderade ${R.length} personer.`),G()},[d,u]);return C.useEffect(()=>{const R=A=>{if(A.key==="Delete"&&j.size>0&&_({type:"mass-delete",ids:Array.from(j)}),A.key==="Enter"&&j.size===1){const B=Array.from(j)[0];t(B)}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[j,t]),o.jsxs("div",{className:"flex h-full",children:[o.jsxs("aside",{className:"w-80 border-r border-slate-700 bg-slate-800 p-3 overflow-y-auto",children:[o.jsx("h2",{className:"font-bold text-lg mb-3 text-slate-200",children:"Orphan-arkivet"}),o.jsxs("div",{className:"mb-3",children:[o.jsx("label",{className:"text-xs text-slate-400",children:"Sk namn"}),o.jsx("input",{"aria-label":"Sk namn",className:"w-full p-2 border border-slate-600 bg-slate-900 text-slate-200 rounded mt-1",value:h,onChange:R=>p(R.target.value),placeholder:"Frnamn eller efternamn"})]}),o.jsxs("div",{className:"mb-3",children:[o.jsx("label",{className:"text-xs text-slate-400",children:"Filtrera r"}),o.jsx("input",{"aria-label":"Filtrera r",className:"w-full p-2 border border-slate-600 bg-slate-900 text-slate-200 rounded mt-1",value:g,onChange:R=>b(R.target.value),placeholder:"t.ex. 1880"})]}),o.jsx("div",{className:"flex items-center gap-2 mb-3",children:o.jsxs("label",{className:"text-sm text-slate-200 flex items-center gap-2",title:"Visa bara personer utan relationer eller hndelser",children:[o.jsx("input",{"aria-label":"Endast utan relationer/hndelser",type:"checkbox",checked:y,onChange:R=>v(R.target.checked),className:"w-4 h-4"}),o.jsx("span",{className:"text-xs",children:"Endast utan relationer/hndelser"})]})}),o.jsx("div",{className:"flex items-center gap-2 mb-3",children:o.jsxs("label",{className:"text-sm text-slate-200 flex items-center gap-2",title:"Visa endast personer som r markerade som arkiverade",children:[o.jsx("input",{"aria-label":"Visa endast arkiverade",type:"checkbox",checked:N,onChange:R=>S(R.target.checked),className:"w-4 h-4"}),o.jsx("span",{className:"ml-2 text-xs",children:"Visa endast arkiverade"})]})}),o.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:["Visar ",H.length," personer"]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{className:"px-2 py-1 bg-slate-700 rounded text-xs text-slate-200 hover:bg-slate-600",onClick:V,title:"Markera alla",children:"Markera alla"}),o.jsx("button",{className:"px-2 py-1 bg-slate-700 rounded text-xs text-slate-200 hover:bg-slate-600",onClick:G,title:"Rensa markering",children:"Rensa"})]})]}),o.jsxs("main",{className:"flex-1 p-4 overflow-y-auto",children:[o.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded text-sm",title:"terstll valda",onClick:()=>_({type:"mass-restore",ids:Array.from(j)}),disabled:j.size===0,children:"terstll valda"}),o.jsx("button",{className:"px-3 py-1 bg-red-700 text-white rounded text-sm",title:"Radera valda permanent",onClick:()=>_({type:"mass-delete",ids:Array.from(j)}),disabled:j.size===0,children:"Radera valda"})]}),o.jsxs("div",{className:"text-xs text-slate-400",children:["Valda: ",j.size]})]}),H.length===0?o.jsx("div",{className:"text-slate-500",children:"Inga matchande personer."}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:H.map(R=>{const A=(a&&a(R.id)||[]).filter(Y=>!Y._archived).length,B=j.has(R.id);return o.jsxs("div",{tabIndex:0,onKeyDown:Y=>{Y.key==="Enter"&&t(R.id),Y.key==="Delete"&&_({type:"delete",ids:[R.id]})},className:`p-3 bg-slate-900 border border-slate-700 rounded flex items-start justify-between hover:bg-slate-800 transition-colors ${B?"ring-2 ring-blue-500":""}`,children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("input",{"aria-label":`Vlj ${R.firstName} ${R.lastName}`,type:"checkbox",checked:B,onChange:()=>L(R.id),className:"mt-1 w-4 h-4"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-slate-200",children:[R.firstName," ",R.lastName," ",o.jsxs("span",{className:"text-xs text-slate-500",children:["(",R.id,")"]})]}),R.archiveReason&&o.jsxs("div",{className:"text-xs text-slate-400",children:["Orsak: ",R.archiveReason]}),o.jsxs("div",{className:"text-xs text-slate-400",children:["Hndelser: ",(R.events||[]).length,"  Relationer: ",A]})]})]}),o.jsxs("div",{className:"mt-1 flex flex-col items-end gap-2",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded text-sm",title:`terstll ${R.firstName} ${R.lastName}`,onClick:()=>_({type:"restore",ids:[R.id]}),children:"terstll"}),o.jsx("button",{className:"px-3 py-1 bg-red-700 text-white rounded text-sm",title:`Radera ${R.firstName} ${R.lastName} permanent`,onClick:()=>_({type:"delete",ids:[R.id]}),children:"Radera"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{className:"px-3 py-1 border border-slate-600 bg-slate-800 text-slate-200 rounded text-sm hover:bg-slate-700",title:"Redigera personen",onClick:()=>t(R.id),children:"Redigera"}),o.jsx("button",{className:"px-3 py-1 border border-slate-600 bg-slate-800 text-slate-200 rounded text-sm hover:bg-slate-700",title:"Visa personen i slkttrdet",onClick:()=>l(R.id),children:"Visa i trd"})]})]})]},R.id)})}),D&&o.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-black opacity-30",onClick:()=>_(null)}),o.jsxs("div",{className:"bg-slate-800 rounded shadow-lg p-6 z-10 w-96 border border-slate-700",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"font-semibold mb-2",children:"Bekrfta tgrd"}),o.jsxs("div",{className:"text-sm text-slate-300 mb-4",children:[D.type==="delete"&&"Radera personen permanent? Detta kan ngras med ngra-knappen.",D.type==="mass-delete"&&`Radera ${D.ids.length} personer permanent? Detta kan ngras med ngra-knappen.`,D.type==="restore"&&"terstll personen till datasetet?",D.type==="mass-restore"&&`terstll ${D.ids.length} personer till datasetet?`]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{className:"px-3 py-1 border border-slate-600 bg-slate-700 text-slate-200 rounded hover:bg-slate-600",onClick:()=>_(null),children:"Avbryt"}),o.jsx("button",{className:"px-3 py-1 bg-blue-600 rounded text-white hover:bg-blue-700",onClick:()=>{_(null),D.type==="restore"&&X(D.ids),D.type==="mass-restore"&&X(D.ids),D.type==="delete"&&$(D.ids),D.type==="mass-delete"&&$(D.ids)},children:"Bekrfta"})]})]})]})]})]})}function $v(n,e){if(!n)return"";if(n.relation){const t=n.relation,l=e.people?.find(d=>d.id===t.fromPersonId),a=e.people?.find(d=>d.id===t.toPersonId);return{...t,fromLabel:l?`${l.firstName} ${l.lastName}`:t.fromPersonId,toLabel:a?`${a.firstName} ${a.lastName}`:t.toPersonId}}return n}function jO(){const{dbData:n,setDbData:e,handleOpenEditModal:t,handleNavigateToSource:l,handleNavigateToPlace:a,handleViewInFamilyTree:i,showStatus:d,deletePersonPermanently:u,restorePerson:h,archivePerson:p,recordAudit:g,handleEditFormChange:b,setIsDirty:y}=Fs(),v=n?.meta&&Array.isArray(n.meta.audit)?n.meta.audit.slice().reverse():[],[N,S]=C.useState(""),[j,E]=C.useState(""),[D,_]=C.useState(""),[H,L]=C.useState(()=>new Set),V=C.useMemo(()=>Array.from(new Set((n?.meta?.audit||[]).map(w=>w.type))).filter(Boolean),[n?.meta]),G=C.useMemo(()=>Array.from(new Set((n?.meta?.audit||[]).map(w=>w.entityType))).filter(Boolean),[n?.meta]),X=w=>{try{const T=[];T.push(A(w.type)||w.type||""),T.push(B(w.entityType)||w.entityType||""),w.actor&&T.push(w.actor),w.entityId&&T.push(w.entityId);try{if(w.entityType==="person"){const I=w.entityId?n.people?.find(Z=>Z.id===w.entityId):null;if(I&&(I.firstName||I.lastName)&&T.push(`${I.firstName||""} ${I.lastName||""}`.trim()),w.details){typeof w.details.name=="string"&&T.push(w.details.name);const Z=w.details.person||w.details.snapshot||w.details.createdPerson||w.details.newPerson||null;Z&&(Z.firstName||Z.lastName)&&T.push(`${Z.firstName||""} ${Z.lastName||""}`.trim())}}else{const I=de(w);I&&T.push(I)}}catch{}try{if(w.entityType==="person"){let I="";const Z=w.entityId?n.people?.find(O=>O.id===w.entityId):null;Z&&(Z.refNumber||Z.refNumber===0)&&(I=String(Z.refNumber)),!I&&w.details&&(w.details.refNumber||w.details.refNumber===0)&&(I=String(w.details.refNumber));const pe=w.details&&(w.details.person||w.details.snapshot||w.details.createdPerson||w.details.newPerson)||null;!I&&pe&&(pe.refNumber||pe.refNumber===0)&&(I=String(pe.refNumber)),I&&T.push(I)}}catch{}try{const I=$v(w.details,n);I&&T.push(typeof I=="string"?I:JSON.stringify(I))}catch{}return w.details&&T.push(JSON.stringify(w.details)),w.timestamp&&T.push(new Date(w.timestamp).toLocaleString()),T.filter(Boolean).join(" ").toLowerCase()}catch{return(w.type||"")+" "+(w.entityType||"")+" "+(w.entityId||"")+" "+(w.details?JSON.stringify(w.details):"")}},$=v.filter(w=>{if(j&&w.type!==j||D&&w.entityType!==D)return!1;if(N){const T=N.toLowerCase().trim();if(!T)return!0;if(!X(w).includes(T))return!1}return!0}),R=w=>{L(T=>{const I=new Set(T);return I.has(w)?I.delete(w):I.add(w),I})},A=w=>{switch((w||"").toString()){case"create":return"Skapad";case"edit":return"Redigerad";case"delete":return"Raderad";case"archive":return"Arkiverad";case"restore":return"terstlld";case"link":return"Lnkad";case"merge":return"Sammanslagen";default:return w||""}},B=w=>{switch((w||"").toString()){case"person":return"Person";case"source":return"Klla";case"place":return"Plats";case"relation":return"Relation";case"merge":return"Sammanfogning";case"unknown":return"Oknd";default:return w||""}},Y=async w=>{if(!w||w.entityType!=="person"||!w.entityId){d("ngra ej std fr denna post.");return}const T=w.entityId;try{if(w.type==="create")confirm("ngra skapandet? Detta tar bort personen permanent.")&&u(T);else if(w.type==="archive")h(T);else if(w.type==="restore")p(T,"ngrad via historik");else if(w.type==="edit"){const I=w?.details?.before;if(!I||typeof I!="object"){d("Ingen fregende version att terstlla.");return}if(!confirm("terstll personens flt till tidigare vrden? Detta skapar en terstllningspost i historiken."))return;e(Z=>{const pe=Array.isArray(Z.people)?Z.people.slice():[],O=pe.findIndex(ge=>ge.id===T);if(O===-1)return Z;const ke={...pe[O]||{},...I,id:T};pe[O]=ke;const U={...Z,people:pe};try{localStorage.setItem("wft_last_db",JSON.stringify(U))}catch{}return U});try{y&&y(!0)}catch{}try{g&&g({type:"revert",entityType:"person",entityId:T,actor:"user",timestamp:Date.now(),details:{revertedFromAuditId:w.id,before:w.details.before,after:w.details.after}})}catch(Z){console.debug("recordAudit (revert) failed",Z)}d("Person terstlld till tidigare version.")}else d("ngra ej automatiskt stdd fr denna tgrd.")}catch(I){console.debug("handleUndoAudit failed",I),d("ngra misslyckades.")}},J=w=>{try{if(w.entityType==="person"&&w.entityId)return t(w.entityId);if(w.entityType==="relation"&&w.details&&w.details.relation){const T=w.details.relation;if(T.fromPersonId)return i(T.fromPersonId);if(T.toPersonId)return i(T.toPersonId)}if(w.entityType==="source"){let T=w.entityId;if(!T&&w.details){const I=w.details;T=I.source?.id||I.createdSource?.id||I.newSource?.id||I.id||null}if(T)return!!n.sources?.find(Z=>Z.id===T)||d("Kunde inte hitta kllan i databas  frsker nd ppna."),l(T);d("Ingen klla att ppna fr denna audit-post.");return}if(w.entityType==="place"){let T=w.entityId;if(!T&&w.details){const I=w.details;T=I.place?.id||I.createdPlace?.id||I.newPlace?.id||I.id||null}if(T)return!!n.places?.find(Z=>Z.id===T)||d("Kunde inte hitta platsen i databas  frsker nd ppna."),a(T);d("Ingen plats att ppna fr denna audit-post.");return}}catch{}},de=w=>{if(!w)return"";const{entityType:T,entityId:I}=w;if(!I)return T;if(T==="person"){const Z=n.people?.find(pe=>pe.id===I);return Z?`${Z.firstName} ${Z.lastName}`:`${T} (${I})`}if(T==="source"){const Z=n.sources?.find(pe=>pe.id===I);return Z?Z.sourceString||`${Z.archive||""} ${Z.volume||""}`.trim():`${T} (${I})`}if(T==="place"){const Z=n.places?.find(pe=>pe.id===I);return Z?[Z.specific,Z.village,Z.parish,Z.municipality].filter(Boolean).join(", "):`${T} (${I})`}return`${T} (${I})`};return o.jsx("div",{className:"tab-content max-w-6xl mx-auto w-full",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl shadow p-4 border border-slate-700",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200",children:"Audit / Historik"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{value:N,onChange:w=>S(w.target.value),placeholder:"Sk...",className:"px-2 py-1 border border-slate-600 rounded bg-slate-900 text-slate-200"}),o.jsxs("select",{value:j,onChange:w=>E(w.target.value),className:"px-2 py-1 border border-slate-600 rounded bg-slate-900 text-slate-200",children:[o.jsx("option",{value:"",children:"Alla typer"}),V.map(w=>o.jsx("option",{value:w,children:A(w)},w))]}),o.jsxs("select",{value:D,onChange:w=>_(w.target.value),className:"px-2 py-1 border border-slate-600 rounded bg-slate-900 text-slate-200",children:[o.jsx("option",{value:"",children:"Alla enheter"}),G.map(w=>o.jsx("option",{value:w,children:B(w)},w))]}),o.jsx("button",{type:"button",onClick:()=>{j==="warning"&&D==="relation-validation"?(E(""),_(""),S("")):(E("warning"),_("relation-validation"),S(""))},className:"px-2 py-1 text-xs border border-slate-600 rounded bg-slate-700 text-slate-200 hover:bg-slate-600",children:"Visa relation-validering"}),o.jsx("button",{type:"button",onClick:async()=>{try{const w=n?.meta?.audit||[],T=JSON.stringify(w,null,2);if(navigator.clipboard&&navigator.clipboard.writeText&&(await navigator.clipboard.writeText(T),d("Audit kopierad till urklipp.")),window.electronAPI&&typeof window.electronAPI.saveAuditBackup=="function"){const I=await window.electronAPI.saveAuditBackup("audit_export.json",T,n?.meta?.auditBackupDir||null);I&&I.success?d("Audit sparad till disk."):d("Export misslyckades att spara till disk.")}}catch(w){console.debug("export audit error",w),d("Export misslyckades.")}},className:"px-2 py-1 text-xs border border-slate-600 rounded bg-slate-700 text-slate-200 hover:bg-slate-600",children:"Exportera audit"}),o.jsx("button",{type:"button",onClick:async()=>{try{if(!window.electronAPI||typeof window.electronAPI.openFileDialog!="function"){d("Import krver Electron (inte tillgngligt i denna milj).");return}const w=await window.electronAPI.openFileDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["json"]}]});if(!w||w.canceled||!Array.isArray(w.filePaths)||w.filePaths.length===0){d("Import avbrts.");return}const T=w.filePaths[0],I=await window.electronAPI.readFile(T);let Z=null;if(typeof I=="string"?Z=I:I&&I.buffer?Z=new TextDecoder().decode(new Uint8Array(I.buffer)):I instanceof Uint8Array?Z=new TextDecoder().decode(I):I&&I.length&&(Z=new TextDecoder().decode(new Uint8Array(I))),!Z){d("Kunde inte lsa filen.");return}const pe=JSON.parse(Z);if(!Array.isArray(pe)){d("Importfilen innehller inte en giltig audit-array.");return}e(O=>({...O,meta:{...O.meta||{},audit:pe}}));try{localStorage.setItem("wft_audit_backup",JSON.stringify(pe))}catch{}d("Audit importerad.")}catch(w){console.debug("import audit error",w),d("Import misslyckades.")}},className:"px-2 py-1 text-xs border border-slate-600 rounded bg-slate-700 text-slate-200 hover:bg-slate-600",children:"Importera audit"}),o.jsx("button",{type:"button",onClick:async()=>{try{if(window.electronAPI&&typeof window.electronAPI.openAuditBackupFolder=="function"){const w=n?.meta?.auditBackupDir||null,T=await window.electronAPI.openAuditBackupFolder(w);T&&T.success?d("ppnade backup-mapp."):(d("Kunde inte ppna backup-mapp."),console.debug("openAuditBackupFolder failed",T))}else d("Backup-mapp kan inte ppnas i denna milj.")}catch(w){console.debug("openAuditBackupFolder error",w),d("Fel vid ppning av backup-mapp.")}},className:"px-2 py-1 text-xs border border-slate-600 rounded bg-slate-700 text-slate-200 hover:bg-slate-600",children:"ppna backup-mapp"})]})]}),o.jsxs("div",{className:"text-sm text-slate-400 mb-4",children:["Visar ",$.length," av ",(v||[]).length," poster"]}),o.jsx("div",{className:"overflow-y-auto max-h-[60vh] border border-slate-700 rounded bg-slate-800",children:o.jsxs("table",{className:"w-full text-left text-slate-200",children:[o.jsx("thead",{className:"bg-slate-900 sticky top-0",children:o.jsxs("tr",{children:[o.jsx("th",{className:"p-2 text-xs text-slate-300",children:"Tid"}),o.jsx("th",{className:"p-2 text-xs text-slate-300",children:"Typ"}),o.jsx("th",{className:"p-2 text-xs text-slate-300",children:"Namn"}),o.jsx("th",{className:"p-2 text-xs text-slate-300",children:"Ref"}),o.jsx("th",{className:"p-2 text-xs text-slate-300",children:"tgrd"})]})}),o.jsxs("tbody",{children:[$.map(w=>{const T=H.has(w.id),I=$v(w.details,n);return o.jsxs(ps.Fragment,{children:[o.jsxs("tr",{className:"border-b border-slate-700 hover:bg-slate-700",children:[o.jsx("td",{className:"p-2 align-top text-xs text-slate-400",children:new Date(w.timestamp).toLocaleString()}),o.jsx("td",{className:"p-2 align-top text-sm font-medium text-slate-300",children:A(w.type)}),o.jsxs("td",{className:"p-2 align-top text-sm",children:[w.entityType==="person"?(()=>{const Z=w.entityId;if(Z){const pe=n.people?.find(O=>O.id===Z)||null;if(pe&&(pe.firstName||pe.lastName)){const O=`${pe.firstName||""} ${pe.lastName||""}`.trim();return o.jsx("button",{onClick:()=>J(w),className:"text-left px-0 py-0 text-sm text-blue-600 hover:underline",children:O})}}if(w.details&&typeof w.details.name=="string"&&w.details.name.trim())return o.jsx("span",{className:"text-sm text-slate-200",children:w.details.name});if(w.details&&typeof w.details=="object"){const pe=w.details,O=pe.person||pe.snapshot||pe.createdPerson||pe.newPerson||null;if(O&&(O.firstName||O.lastName)){const te=`${O.firstName||""} ${O.lastName||""}`.trim();return o.jsx("span",{className:"text-sm text-slate-200",children:te})}}return o.jsx("span",{className:"text-sm text-slate-400",children:"(oknd)"})})():(()=>{const Z=de(w);return w.entityId?o.jsx("button",{onClick:()=>J(w),className:"text-left px-0 py-0 text-sm text-blue-600 hover:underline",children:Z}):o.jsx("span",{className:"text-sm text-slate-200",children:Z})})(),w.details&&w.details.svMessage&&o.jsx("div",{className:"mt-1 text-sm text-red-700 font-medium",children:w.details.svMessage})]}),o.jsx("td",{className:"p-2 align-top text-sm",children:(()=>{if(w.entityType!=="person")return"";let Z="",pe=null;if(w.entityId){const O=n.people?.find(te=>te.id===w.entityId)||null;O&&(O.refNumber||O.refNumber===0)&&(Z=O.refNumber,pe="live")}if(!pe&&w.details&&(w.details.refNumber||w.details.refNumber===0)&&(Z=w.details.refNumber,pe="details"),!pe&&w.details&&typeof w.details=="object"){const O=w.details,te=O.person||O.snapshot||O.createdPerson||O.newPerson||null;te&&(te.refNumber||te.refNumber===0)&&(Z=te.refNumber,pe="snapshot")}return pe?pe==="live"?o.jsx("button",{onClick:()=>J(w),className:"text-left px-0 py-0 text-sm text-blue-600 hover:underline",children:Z}):o.jsx("span",{className:"text-sm text-slate-500 italic",children:Z}):""})()}),o.jsx("td",{className:"p-2 align-top",children:o.jsxs("div",{className:"flex gap-2",children:[w.entityType==="person"?o.jsx(o.Fragment,{children:o.jsx("button",{onClick:()=>Y(w),className:"px-2 py-1 text-xs bg-amber-700 text-amber-100 border border-amber-600 rounded hover:bg-amber-600",children:"ngra"})}):o.jsx(o.Fragment,{children:o.jsx("button",{onClick:()=>J(w),className:"px-2 py-1 text-xs bg-blue-700 text-blue-100 border border-blue-600 rounded hover:bg-blue-600",children:"ppna"})}),o.jsx("button",{onClick:()=>R(w.id),className:"px-2 py-1 text-xs border border-slate-600 bg-slate-700 text-slate-200 rounded hover:bg-slate-600",children:T?"Dlj":"Visa"})]})})]}),T&&o.jsx("tr",{className:"bg-slate-900",children:o.jsxs("td",{colSpan:5,className:"p-3",children:[o.jsx("div",{className:"text-xs font-medium mb-2 text-slate-300",children:"Detaljer"}),o.jsx("pre",{className:"text-xs overflow-auto p-2 bg-slate-950 border border-slate-700 rounded text-slate-200",style:{maxHeight:280},children:typeof I=="string"?I:JSON.stringify(I,null,2)})]})})]},w.id)}),$.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"p-4 text-center text-sm text-slate-500",children:"Inga poster matchar filtren."})})]})]})})]})})}function CO({isOpen:n,onClose:e}){const{dbData:t,mergePersons:l,getPersonRelations:a}=Fs(),i=t.people||[],[d,u]=C.useState(""),[h,p]=C.useState([]),[g,b]=C.useState(!0),[y,v]=C.useState(!0),[N,S]=C.useState(!1),[j,E]=C.useState(!1),D=C.useMemo(()=>i.filter(X=>!X._archived).slice(0,200),[i]),_=X=>{p($=>$.includes(X)?$.filter(R=>R!==X):[...$,X])},[H,L]=C.useState(""),V=!d||h.length===0?null:pm(t,d,h),G=()=>{if(!d||h.length===0)return alert("Vlj ett ml och minst en klla att sl ihop.");const X=i.find(A=>A.id===d)||{},$=X.refNumber?String(X.refNumber):"";if($&&H.trim()!==$)return alert("Fel REF angivet. Skriv mlpersonens REF fr att bekrfta.");const R=l({targetId:d,sourceIds:h,createdBy:t?.meta?.currentUser||"local"});e&&e(R)};return n?o.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-40",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 w-full max-w-3xl border border-slate-700",children:[o.jsx("h3",{className:"text-xl font-bold mb-3",children:"Sammansl personer"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-slate-300 mb-2",children:"Mlperson"}),o.jsxs("select",{className:"w-full p-2 border rounded",value:d,onChange:X=>u(X.target.value),children:[o.jsx("option",{value:"",children:"-- Vlj mlperson --"}),D.map(X=>o.jsxs("option",{value:X.id,children:[X.firstName," ",X.lastName," ",X._isPlaceholder?"(placeholder)":""]},X.id))]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-slate-300 mb-2",children:"Kllor att sl ihop (vlj flera)"}),o.jsx("div",{className:"max-h-48 overflow-y-auto border rounded p-2",children:D.filter(X=>X.id!==d).map(X=>o.jsxs("label",{className:"flex items-center gap-2 text-sm p-1",children:[o.jsx("input",{type:"checkbox",checked:h.includes(X.id),onChange:()=>_(X.id)}),o.jsxs("span",{children:[X.firstName," ",X.lastName]})]},X.id))})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("div",{className:"text-sm font-semibold",children:"Frhandsvisning"}),!V&&o.jsx("div",{className:"text-xs text-slate-500",children:"Vlj ml och kllor fr att se vad som flyttas."}),V&&o.jsxs("div",{className:"mt-2 text-sm",children:[o.jsxs("div",{children:["Totalt hndelser att flytta: ",o.jsx("strong",{children:V.totalEvents})]}),o.jsxs("div",{className:"mt-1",children:["Relationer: ",o.jsx("strong",{children:(V.keptList||[]).length})," behlls, ",o.jsx("strong",{children:(V.archivedList||[]).length})," arkiveras"]}),o.jsxs("div",{className:"mt-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"text-xs font-semibold",children:"Behllna relationer"}),o.jsx("div",{className:"text-xs text-slate-400",children:(V.keptList||[]).length})]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("button",{onClick:()=>b(X=>!X),className:"text-xs text-blue-600 mb-2",children:g?"Dlj":"Visa"}),g&&o.jsxs(o.Fragment,{children:[(V.keptList||[]).length===0&&o.jsx("div",{className:"text-xs text-slate-500",children:"Inga relationer kommer att behllas."}),(V.keptList||[]).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("ul",{className:"mt-1 list-disc pl-5 text-xs",children:((N?V.keptList:V.keptList.slice(0,8))||[]).map(X=>o.jsxs("li",{children:[X.type||"relation",": ",X.from,"  ",X.to," ",o.jsxs("span",{className:"text-slate-500",children:["(",X.id,")"]})]},X.id))}),V.keptList.length>8&&o.jsx("div",{className:"mt-1",children:o.jsx("button",{onClick:()=>S(X=>!X),className:"text-xs text-blue-600",children:N?"Visa frre":`Visa fler (${V.keptList.length-8} fler)`})})]})]})]})]}),o.jsxs("div",{className:"mt-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"text-xs font-semibold",children:"Relationer som arkiveras"}),o.jsx("div",{className:"text-xs text-slate-400",children:(V.archivedList||[]).length})]}),o.jsxs("div",{className:"mt-1",children:[o.jsx("button",{onClick:()=>v(X=>!X),className:"text-xs text-blue-600 mb-2",children:y?"Dlj":"Visa"}),y&&o.jsxs(o.Fragment,{children:[(V.archivedList||[]).length===0&&o.jsx("div",{className:"text-xs text-slate-500",children:"Inga relationer kommer att arkiveras."}),(V.archivedList||[]).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("ul",{className:"mt-1 list-disc pl-5 text-xs",children:((j?V.archivedList:V.archivedList.slice(0,8))||[]).map(X=>o.jsxs("li",{children:[X.type||"relation",": ",X.from,"  ",X.to,"  ",o.jsx("em",{children:X.reason})," ",o.jsxs("span",{className:"text-slate-500",children:["(",X.id,")"]})]},X.id))}),V.archivedList.length>8&&o.jsx("div",{className:"mt-1",children:o.jsx("button",{onClick:()=>E(X=>!X),className:"text-xs text-blue-600",children:j?"Visa frre":`Visa fler (${V.archivedList.length-8} fler)`})})]})]})]})]})]})]}),o.jsxs("div",{className:"mt-4",children:[V&&(()=>{const X=i.find(R=>R.id===d)||{},$=X.refNumber?String(X.refNumber):"";return o.jsxs("div",{className:"mb-3",children:[$&&o.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Fr skerhets skull, skriv mlpersonens REF (",o.jsx("strong",{children:$}),") fr att bekrfta sammanslagningen."]}),$&&o.jsx("input",{value:H,onChange:R=>L(R.target.value),placeholder:$,className:"p-2 border rounded w-full text-sm mb-2"})]})})(),o.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[o.jsx("button",{onClick:()=>e&&e(null),className:"px-4 py-2 border rounded",children:"Avbryt"}),o.jsx("button",{onClick:G,disabled:!(d&&h.length>0&&(!(i.find(X=>X.id===d)||{}).refNumber||String((i.find(X=>X.id===d)||{}).refNumber)===H.trim())),className:`px-4 py-2 rounded ${d&&h.length>0&&(!(i.find(X=>X.id===d)||{}).refNumber||String((i.find(X=>X.id===d)||{}).refNumber)===H.trim())?"bg-red-600 text-white hover:bg-red-700":"bg-slate-700 text-slate-400 cursor-not-allowed"}`,children:"Sl ihop"})]})]})]})}):null}function EO({isOpen:n,onClose:e}){const{dbData:t,undoMerge:l,showStatus:a}=Fs(),[i,d]=C.useState(null),[u,h]=C.useState("");if(!n)return null;const p=(t?.meta?.merges||[]).slice().reverse(),g=v=>{d(v),h("")},b=()=>{d(null),h("")},y=async v=>{if(v)try{const S=(t?.meta?.merges||[]).find(_=>_.id===v)?.mergedIntoId,j=t.people.find(_=>_.id===S),E=j?String(j.refNumber||""):"";if(E&&u.trim()!==E){a("Fel REF angivet. Avbryter terstllning.");return}const D=await l(v);a(D?"Merge terstlld.":"Kunde inte terstlla merge. Kontrollera konsolen.")}catch(N){console.error("undoMerge failed",N),a("Ett fel uppstod vid terstllning. Se konsolen.")}finally{d(null),h(""),e&&e()}};return o.jsx("div",{className:"fixed inset-0 z-60 flex items-start justify-center bg-black bg-opacity-40 p-6",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 w-full max-w-2xl border border-slate-700",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"text-lg font-bold",children:"Historik: Merges"}),o.jsx("button",{onClick:()=>e&&e(),className:"text-slate-400 hover:text-slate-300",children:"Stng"})]}),o.jsxs("div",{className:"max-h-72 overflow-y-auto text-sm",children:[p.length===0&&o.jsx("div",{className:"text-slate-400",children:"Inga merges registrerade."}),p.map(v=>{const N=t.people.find(j=>j.id===v.mergedIntoId)||null,S=N?String(N.refNumber||""):"";return o.jsxs("div",{className:"p-3 border-b last:border-b-0",children:[o.jsxs("div",{className:"flex justify-between items-start gap-3",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold",children:v.id}),o.jsxs("div",{className:"text-xs text-slate-300",children:["Mergade in i: ",v.mergedIntoId," ",N?`(${N.firstName} ${N.lastName})`:""," | ",v.originalPersonIds.join(", ")]}),o.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[new Date(v.createdAt).toLocaleString()," av ",v.createdBy||"system"]})]}),o.jsx("div",{className:"flex flex-col gap-2",children:!i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>g(v.id),className:"px-3 py-1 bg-yellow-500 text-white rounded text-sm",children:"ngra"}),o.jsx("button",{onClick:()=>navigator.clipboard&&navigator.clipboard.writeText(JSON.stringify(v)),className:"px-3 py-1 border rounded text-sm",children:"Kopiera snapshot"})]})})]}),i===v.id&&o.jsxs("div",{className:"mt-3 bg-yellow-50 p-3 rounded",children:[o.jsx("div",{className:"text-sm text-slate-300 mb-2",children:"Skriv REF-nummer fr mlpersonen fr att bekrfta terstllning"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{value:u,onChange:j=>h(j.target.value),className:"p-2 border rounded flex-1",placeholder:S?`REF fr ${N?`${N.firstName} ${N.lastName}`:v.mergedIntoId}`:"Ingen REF finns"}),o.jsx("button",{onClick:()=>y(v.id),className:"px-3 py-1 bg-red-600 text-white rounded",children:"Bekrfta"}),o.jsx("button",{onClick:b,className:"px-3 py-1 border rounded",children:"Avbryt"})]}),S&&o.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["Frvntat REF: ",o.jsx("strong",{children:S})]})]})]},v.id)})]})]})})}function MO(n="",e=""){n=n||"",e=e||"";const t=n.length,l=e.length;if(t===0)return l;if(l===0)return t;const a=new Array(l+1),i=new Array(l+1);for(let d=0;d<=l;d++)a[d]=d;for(let d=0;d<t;d++){i[0]=d+1;for(let u=0;u<l;u++){const h=n[d]===e[u]?0:1;i[u+1]=Math.min(i[u]+1,a[u+1]+1,a[u]+h)}for(let u=0;u<=l;u++)a[u]=i[u]}return i[l]}function wp(n="",e=""){if(!n&&!e)return 1;if(!n||!e)return 0;const t=n.toString().toLowerCase(),l=e.toString().toLowerCase(),a=MO(t,l),i=Math.max(t.length,l.length);return i===0?1:1-a/i}function dm(n){const e=(n.firstName||"").toString().toLowerCase().replace(/[^a-z0-9\s]/g," ").trim(),t=(n.lastName||"").toString().toLowerCase().replace(/[^a-z0-9]/g,"").trim(),l=e.split(/\s+/).filter(Boolean);return{firstFull:l.join(" "),firstTokens:l,surname:t}}function um(n){try{const e=(n.events||[]).find(l=>l.type&&/fdel|birth/i.test(l.type))||(n.events||[]).find(l=>l.type&&/fdel|birth/i.test(l.type));if(!e||!e.date)return null;const t=e.date.toString().match(/(\d{4})/);return t?Number(t[1]):null}catch{return null}}function fm(n){try{const e=(n.events||[]).find(l=>l.type&&/dd|death/i.test(l.type));if(!e||!e.date)return null;const t=e.date.toString().match(/(\d{4})/);return t?Number(t[1]):null}catch{return null}}function Sp(n){const e=[];try{for(const t of n.events||[]){if(!t.place)continue;let l=t.place.toString().toLowerCase().trim();l=l.replace(/[.,]/g,""),l=l.replace(/frsamling|fr|socken|kommun|stad|ln/g,"").trim(),l&&e.push(l)}}catch{}return Array.from(new Set(e))}function AO(n,e){if(!n||!e)return 0;const t=n.filter(a=>e.includes(a));if(t.length===0)return 0;const l=new Set([...n,...e]).size;return t.length/l}function TO(n,e){const t=um(n),l=fm(n),a=um(e),i=fm(e);if(t&&l&&a&&i){const d=t,u=l,h=a,p=i,g=Math.max(0,Math.min(u,p)-Math.max(d,h)),b=Math.max(u,p)-Math.min(d,h);return b>0?g/b:0}if(t&&a){const d=Math.abs(t-a);return d<=3?1:d<=10?.8:d<=20?.5:.2}return .2}function DO(n,e){const t=(n.sources||[]).map(i=>i.id||i).filter(Boolean),l=(e.sources||[]).map(i=>i.id||i).filter(Boolean);if(t.length===0||l.length===0)return 0;const a=t.filter(i=>l.includes(i)).length;return Math.min(1,a/3)}function OO(n,e,t){try{const l=t&&t.relations?t.relations:[],a=l.filter(u=>!u._archived&&(u.type||"").toString().toLowerCase().includes("parent")&&(u.fromPersonId===n.id||u.toPersonId===n.id)).map(u=>u.fromPersonId===n.id?u.toPersonId:u.fromPersonId),i=l.filter(u=>!u._archived&&(u.type||"").toString().toLowerCase().includes("parent")&&(u.fromPersonId===e.id||u.toPersonId===e.id)).map(u=>u.fromPersonId===e.id?u.toPersonId:u.fromPersonId);return a.filter(u=>i.includes(u)).length>0?.9:0}catch{return 0}}function RO(n,e){const t=dm(n),l=dm(e);if(t.surname&&l.surname&&t.surname===l.surname){const d=wp(t.firstFull,l.firstFull);return Math.max(.6,.6+.4*d)}const a=wp(t.surname,l.surname),i=wp(t.firstFull,l.firstFull);return Math.max(0,.3*a+.7*i)}function IO(n=[],e={},t={}){const l=Object.assign({name:.45,life:.2,place:.12,sources:.15,sibling:.08},t.weights||{}),a=t.maxResults||60,i=n.map(b=>({id:b.id,person:b,nameTokens:dm(b),birth:um(b),death:fm(b),places:Sp(b),sources:(b.sources||[]).map(y=>y.id||y).filter(Boolean)})),d=[],u=new Set,h=new Map;for(const b of i){const y=(b.nameTokens.surname||"").toString(),v=`${b.birth||"x"}::${y}`;h.has(v)||h.set(v,[]),h.get(v).push(b);const N=y||"id:"+b.id;h.has(N)||h.set(N,[]),h.get(N).push(b)}const p=Array.from(h.values());for(const b of p)if(!(b.length<2))for(let y=0;y<b.length;y++)for(let v=y+1;v<b.length;v++){const N=b[y].person,S=b[v].person,j=[N.id,S.id].sort().join("::");u.has(j)||(u.add(j),d.push([N,S]))}if(d.length===0&&n.length<=200)for(let b=0;b<n.length;b++)for(let y=b+1;y<n.length;y++)d.push([n[b],n[y]]);const g=d.map(b=>{const y=b[0],v=b[1],N=RO(y,v),S=TO(y,v),j=AO(Sp(y),Sp(v)),E=DO(y,v),D=OO(y,v,e),_=l.name*N+l.life*S+l.place*j+l.sources*E+l.sibling*D;return{pair:[y,v],score:Math.min(1,Math.max(0,_)),breakdown:{name:N,life:S,place:j,sources:E,sibling:D}}});return g.sort((b,y)=>y.score-b.score),g.slice(0,a)}function zO({allPeople:n=[],onOpenPair:e}){const{dbData:t}=Fs(),l=C.useMemo(()=>{try{return IO(n,t||{},{maxResults:60}).map(i=>({pair:i.pair,score:i.score,breakdown:i.breakdown}))}catch{return[]}},[n,t]);return o.jsxs("div",{className:"card p-3 bg-slate-800 border border-slate-700",style:{minHeight:220},children:[o.jsx("div",{className:"font-medium mb-2 text-slate-200",children:"Frslag"}),o.jsx("div",{className:"text-xs text-slate-400 mb-2",children:"Automatch baserat p namn, fdelser och efternamn"}),o.jsxs("div",{style:{maxHeight:440,overflow:"auto"},children:[l.length===0&&o.jsx("div",{className:"text-sm text-slate-400",children:"Inga frslag"}),l.map((a,i)=>o.jsx("div",{className:"p-2 border-b border-slate-600 hover:bg-slate-700 cursor-pointer",onClick:()=>e&&e(a.pair),children:o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-slate-200",children:[a.pair[0].firstName," ",a.pair[0].lastName,"  ",a.pair[1].firstName," ",a.pair[1].lastName]}),o.jsxs("div",{className:"text-xs text-slate-400",children:["REF: ",a.pair[0].refNumber,"  ",a.pair[1].refNumber]}),a.breakdown&&o.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Namn: ",Math.round(a.breakdown.name*100),"%  Liv: ",Math.round(a.breakdown.life*100),"%  Plats: ",Math.round(a.breakdown.place*100),"%  Kllor: ",Math.round(a.breakdown.sources*100),"%"]})]}),o.jsxs("div",{className:"text-sm text-slate-300",children:[Math.round(a.score*100),"%"]})]})},i))]})]})}function LO(n){if(!n)return{year:null,month:null,day:null};const e=n.toString().trim(),t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(t)return{year:Number(t[1]),month:Number(t[2]),day:Number(t[3])};const l=e.match(/^(\d{4})-(\d{1,2})$/);if(l)return{year:Number(l[1]),month:Number(l[2]),day:null};const a=e.match(/^(\d{4})$/);if(a)return{year:Number(a[1]),month:null,day:null};const i=e.match(/(\d{4})/);return i?{year:Number(i[1]),month:null,day:null}:{year:null,month:null,day:null}}function Uv(n){return LO(n).year}function Vv(n){return n?n.toString().toLowerCase().replace(/[.,]/g," ").replace(/|/g,"a").replace(//g,"o").replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(Boolean).filter(e=>e.length>1).join(" "):""}function _O(n,e){if(!n||!e)return 0;const t=Vv(n).split(" "),l=Vv(e).split(" ");if(t.length===0||l.length===0)return 0;const a=new Set(l);let i=0;for(const u of t)a.has(u)&&i++;const d=i/Math.max(t.length,l.length);return Math.min(1,Math.max(0,d))}function Z2(n=[],e=[],t={}){const l=d=>d&&d.type?d.type.toString().toLowerCase():"",a=[],i=new Set;for(const d of n){let u=null,h=0;for(const p of e){if(i.has(p.id))continue;let g=0;const b=l(d),y=l(p);if(b&&y&&b===y&&(g+=.4),(d.date||"")===(p.date||""))g+=.45;else{const N=Uv(d.date),S=Uv(p.date);N&&S&&N===S&&(g+=.25)}const v=_O(d.place,p.place);g+=.15*v,g>h&&(h=g,u=p)}u&&h>=(t.threshold||.35)?(a.push({a:d,b:u,score:h}),i.add(u.id)):a.push({a:d,b:null,score:0})}for(const d of e)i.has(d.id)||a.push({a:null,b:d,score:0});return a}function BO({selectedPair:n,targetIsA:e,choices:t,setChoices:l}){const a=n[0],i=n[1],d=Array.isArray(a.events)?a.events:[],u=Array.isArray(i.events)?i.events:[],h=Z2(d,u,{threshold:.35});return o.jsxs("div",{style:{border:"1px solid #475569",padding:8,borderRadius:6,marginBottom:12,backgroundColor:"#1e293b"},children:[o.jsx("div",{style:{fontWeight:700,marginBottom:8,color:"#e2e8f0"},children:"Hndelse-sammanslagning"}),o.jsx("div",{style:{maxHeight:220,overflow:"auto"},children:h.map((p,g)=>o.jsx("div",{style:{padding:8,borderBottom:"1px solid #334155"},children:o.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#e2e8f0"},children:p.a?p.a.type||"Hndelse":p.b?p.b.type:"Hndelse"}),o.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:p.a?`${p.a.date||""} ${p.a.place||""}`:""})]}),o.jsxs("div",{style:{width:340,display:"flex",gap:8,alignItems:"center"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",name:`evt_${g}`,checked:t[p.a?.id]==="keep-target",onChange:()=>l(b=>({...b,[p.a?.id||p.b?.id]:"keep-target"}))})," Behll ml"]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",name:`evt_${g}`,checked:t[p.a?.id]==="keep-source",onChange:()=>l(b=>({...b,[p.a?.id||p.b?.id]:"keep-source"}))})," Behll klla"]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",name:`evt_${g}`,checked:t[p.a?.id]==="merge",onChange:()=>l(b=>({...b,[p.a?.id||p.b?.id]:"merge"}))})," Sl ihop"]})]})]})},g))}),o.jsxs("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end",gap:8},children:[o.jsx("button",{onClick:()=>l({}),className:"px-3 py-1 border border-slate-600 bg-slate-700 text-slate-200 rounded hover:bg-slate-600",children:"terstll"}),o.jsx("button",{onClick:()=>{},className:"px-3 py-1 bg-blue-700 text-white rounded hover:bg-blue-600",children:"Spara event-val"})]})]})}function PO({selectedPair:n,targetIsA:e,choices:t,setChoices:l}){const a=n[0],i=n[1],d=[{key:"firstName",label:"Frnamn"},{key:"lastName",label:"Efternamn"},{key:"gender",label:"Kn"},{key:"notes",label:"Anteckningar"}],u=h=>{const p=(h.events||[]).find(g=>g.type&&g.type.toString().toLowerCase().includes("fdel"))||(h.events||[]).find(g=>g.type&&g.type.toString().toLowerCase().includes("birth"));return p&&p.date||""};return o.jsxs("div",{style:{border:"1px solid #475569",padding:8,borderRadius:6,marginBottom:12,backgroundColor:"#1e293b"},children:[o.jsx("div",{style:{fontWeight:700,marginBottom:8,color:"#e2e8f0"},children:"Fltnivval"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px 120px",gap:8,alignItems:"center"},children:[o.jsx("div",{}),o.jsxs("div",{style:{fontWeight:700,textAlign:"center",color:"#e2e8f0"},children:[a.firstName," ",a.lastName]}),o.jsxs("div",{style:{fontWeight:700,textAlign:"center",color:"#e2e8f0"},children:[i.firstName," ",i.lastName]}),d.map(h=>o.jsxs(ps.Fragment,{children:[o.jsx("div",{style:{padding:6,color:"#cbd5e1"},children:h.label}),o.jsx("div",{style:{textAlign:"center"},children:o.jsxs("label",{style:{color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",name:h.key,checked:t[h.key]==="a",onChange:()=>l(p=>({...p,[h.key]:"a"}))})," ",o.jsx("div",{style:{fontSize:12,color:"#cbd5e1"},children:a[h.key]||""})]})}),o.jsx("div",{style:{textAlign:"center"},children:o.jsxs("label",{style:{color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",name:h.key,checked:t[h.key]==="b",onChange:()=>l(p=>({...p,[h.key]:"b"}))})," ",o.jsx("div",{style:{fontSize:12,color:"#cbd5e1"},children:i[h.key]||""})]})})]},h.key)),o.jsx("div",{style:{padding:6,color:"#cbd5e1"},children:"Fdelsedatum"}),o.jsx("div",{style:{textAlign:"center"},children:o.jsxs("label",{children:[o.jsx("input",{type:"radio",name:"birth",checked:t.birth==="a",onChange:()=>l(h=>({...h,birth:"a"}))})," ",o.jsx("div",{style:{fontSize:12,color:"#cbd5e1"},children:u(a)||""})]})}),o.jsx("div",{style:{textAlign:"center"},children:o.jsxs("label",{children:[o.jsx("input",{type:"radio",name:"birth",checked:t.birth==="b",onChange:()=>l(h=>({...h,birth:"b"}))})," ",o.jsx("div",{style:{fontSize:12,color:"#cbd5e1"},children:u(i)||""})]})})]}),o.jsxs("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end",gap:8},children:[o.jsx("button",{onClick:()=>l({}),className:"px-3 py-1 border border-slate-600 bg-slate-700 text-slate-200 rounded hover:bg-slate-600",children:"terstll"}),o.jsx("button",{onClick:()=>{},className:"px-3 py-1 bg-blue-700 text-white rounded hover:bg-blue-600",children:"Spara val till ml"})]})]})}function HO({selectedPair:n,targetIsA:e,fieldChoices:t,eventChoices:l,dbData:a,setDbData:i,mergePersons:d,onClose:u,setShowSummary:h,showStatus:p,undoMerge:g,showUndoToast:b}){if(!n)return null;const y=n[0],v=n[1],N=e?y:v,S=e?v:y,j=N.id,E=[S.id],D=Array.isArray(y.events)?y.events:[],_=Array.isArray(v.events)?v.events:[],H=Z2(D,_,{threshold:.35}),[L,V]=C.useState({}),[G,X]=C.useState(()=>({...N,events:Array.isArray(N.events)?N.events.map(B=>({...B})):[]})),$=B=>B?/^\d{4}(-\d{2}(-\d{2})?)?$/.test(B.toString().trim()):!0,R=B=>B?$(B.date):!0,A=()=>{if(Object.values(L||{}).some(I=>!R(I))){try{p("Korrigera ogiltiga datum innan bekrftelse.")}catch{}return}const Y=(a.people||[]).map(I=>({...I,events:Array.isArray(I.events)?I.events.map(Z=>({...Z})):[]})),J=Y.findIndex(I=>I.id===j),de=Y.findIndex(I=>I.id===S.id);if(J===-1||de===-1)return;const w=Y[J],T=Y[de];for(const I of["firstName","lastName","gender","notes"])w[I]=G[I];for(const I of H){const Z=I.a?I.a.id:I.b?I.b.id:null,pe=l[Z];if(pe){if(pe==="keep-target")I.b&&(T.events=(T.events||[]).filter(O=>O.id!==I.b.id));else if(pe==="keep-source")I.a&&(w.events=(w.events||[]).filter(O=>O.id!==I.a.id));else if(pe==="merge"){const O=I.a||{},te=I.b||{},ke=O.id||te.id||`ev_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,U=L[ke]||{},ge={id:U.id||ke,type:U.type||O.type||te.type||"Hndelse",date:U.date||O.date||te.date||"",place:U.place||O.place||te.place,note:U.note||""};O.id&&(w.events=(w.events||[]).filter(ie=>ie.id!==O.id)),te.id&&(T.events=(T.events||[]).filter(ie=>ie.id!==te.id)),w.events=w.events||[];let Ee=ge.id;for(;w.events.find(ie=>ie.id===Ee);)Ee=`${Ee}_${Math.random().toString(36).slice(2,4)}`;ge.id=Ee,w.events.push(ge)}}}i(I=>({...I,people:Y}));try{const I=d({targetId:j,sourceIds:E,createdBy:"ui"});if(I){try{p&&p("Sammanfogning genomfrd.")}catch{}try{b&&g&&b("Sammanfogning genomfrd. ngra?",()=>g(I))}catch{}h(!1),u()}}catch{}};return o.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center",style:{background:"rgba(0,0,0,0.35)"},children:o.jsxs("div",{className:"bg-slate-800 rounded shadow-lg border border-slate-700",style:{width:"min(900px, 94%)",maxHeight:"80vh",overflow:"auto"},children:[o.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-900 flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-lg font-semibold text-slate-200",children:"Sammanfognings-sammanfattning"}),o.jsx("div",{className:"text-sm text-slate-400",children:"Granska ndringar innan du bekrftar."})]}),o.jsx("div",{children:o.jsx("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-slate-200 text-2xl px-2 py-1","aria-label":"Stng",children:""})})]}),o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"mb-3 text-slate-200",children:[o.jsx("b",{children:"Ml:"})," ",N.firstName," ",N.lastName," (",N.id,")"]}),o.jsxs("div",{className:"mb-3 text-slate-200",children:[o.jsx("b",{children:"Klla:"})," ",S.firstName," ",S.lastName," (",S.id,")"]}),o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"font-medium text-slate-200",children:"Fltndringar (justera i frhandsgranskning)"}),o.jsx("div",{className:"p-3 border border-slate-700 rounded bg-slate-900 mt-2",children:o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-slate-400",children:"Frnamn"}),o.jsx("input",{value:G.firstName||"",onChange:B=>X(Y=>({...Y,firstName:B.target.value})),className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-slate-400",children:"Efternamn"}),o.jsx("input",{value:G.lastName||"",onChange:B=>X(Y=>({...Y,lastName:B.target.value})),className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-slate-400",children:"Kn"}),o.jsxs("select",{value:G.gender||"",onChange:B=>X(Y=>({...Y,gender:B.target.value})),className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none",children:[o.jsx("option",{value:"",children:"(oknt)"}),o.jsx("option",{value:"M",children:"M"}),o.jsx("option",{value:"K",children:"K"})]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-slate-400",children:"Anteckningar"}),o.jsx("input",{value:G.notes||"",onChange:B=>X(Y=>({...Y,notes:B.target.value})),className:"w-full border border-slate-600 rounded px-2 py-1 text-sm bg-slate-900 text-slate-200"})]}),o.jsxs("div",{className:"col-span-2",children:[o.jsx("div",{className:"text-xs text-slate-400",children:"Fdelsedatum (YYYY eller YYYY-MM-DD)"}),o.jsx("input",{value:(G.events||[]).find(B=>B.type&&B.type.toString().toLowerCase().includes("fdel"))?.date||"",onChange:B=>{const Y=B.target.value;X(J=>{const de={...J,events:Array.isArray(J.events)?J.events.map(T=>({...T})):[]},w=de.events.findIndex(T=>T.type&&T.type.toString().toLowerCase().includes("fdel"));return w>=0?de.events[w].date=Y:Y&&de.events.push({id:`ev_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,type:"Fdelse",date:Y}),de})},className:`w-full border rounded px-2 py-1 text-sm bg-slate-900 text-slate-200 focus:border-blue-500 focus:outline-none ${/\d{4}(-\d{2}(-\d{2})?)?/.test((G.events||[]).find(B=>B.type&&B.type.toString().toLowerCase().includes("fdel"))?.date||"")?"border-slate-600":"border-red-600 bg-red-900 bg-opacity-20"}`})]})]})})]}),o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"font-medium text-slate-200",children:"Hndelser"}),o.jsxs("div",{className:"text-sm text-slate-300",children:["Antal par att vervga: ",H.length]})]}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{onClick:()=>h(!1),className:"px-3 py-1 border border-slate-600 bg-slate-700 text-slate-200 rounded hover:bg-slate-600",children:"Avbryt"}),o.jsx("button",{onClick:A,className:"px-3 py-1 bg-red-700 text-white rounded hover:bg-red-600",children:"Bekrfta och sl ihop"})]}),o.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"Obs: efter genomfrd sammanfogning kan du ngra via toastens ngra-knapp."})]})]})]})})}function $O({allPeople:n=[],onClose:e,initialPair:t=null}){const{dbData:l,mergePersons:a,setDbData:i,showStatus:d,undoMerge:u,showUndoToast:h}=Fs(),[p,g]=C.useState(null),[b,y]=C.useState(!0),[v,N]=C.useState({}),[S,j]=C.useState({}),[E,D]=C.useState(!1),_=C.useMemo(()=>{const G=new Map;for(const $ of n){const R=`${($.firstName||"").toString().toLowerCase().replace(/[^a-z0-9]/g,"")} ${($.lastName||"").toString().toLowerCase().replace(/[^a-z0-9]/g,"")}`.trim();G.has(R)||G.set(R,[]),G.get(R).push($)}const X=[];for(const $ of Array.from(G.values()).filter(R=>R.length>1))for(let R=0;R<$.length;R++)for(let A=R+1;A<$.length;A++)X.push([$[R],$[A]]);return X.map($=>({pair:$,score:.9})).slice(0,120)},[n]),H=C.useMemo(()=>{if(!p)return null;const G=p[0],X=p[1],$=b?G.id:X.id,R=b?[X.id]:[G.id];try{return pm(l,$,R)||null}catch{return null}},[p,b,l]);C.useEffect(()=>{t&&Array.isArray(t)&&t.length===2&&(g(t),y(!0))},[t]);const L=()=>{p&&D(!0)},V=o.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-start justify-center",style:{paddingTop:64},children:[o.jsxs("div",{className:"bg-slate-800 rounded shadow-lg border border-slate-700",style:{width:"94%",maxWidth:1100,maxHeight:"84vh",overflow:"auto"},children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700 bg-slate-900",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-lg font-semibold text-slate-200",children:"Freslagna dubbletter"}),o.jsx("div",{className:"text-sm text-slate-400",children:"Grupperade efter normaliserat namn och fdelseear"})]}),o.jsx("div",{children:o.jsx("button",{onClick:e,className:"text-slate-400 hover:text-slate-200 text-2xl px-2 py-1","aria-label":"Stng",children:""})})]}),o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsxs("div",{style:{width:360,borderRight:"1px solid #475569",padding:12},children:[o.jsxs("div",{style:{marginBottom:8},className:"text-sm font-medium text-slate-200",children:["Frslag (",_.length,")"]}),o.jsx("div",{style:{maxHeight:"64vh",overflow:"auto"},children:_.map((G,X)=>{const $=G.pair;return o.jsxs("div",{style:{padding:8,borderBottom:"1px solid #334155",cursor:"pointer",background:p&&p[0].id===$[0].id&&p[1].id===$[1].id?"#334155":"transparent"},onClick:()=>{g($),y(!0)},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{style:{fontWeight:700,color:"#e2e8f0"},children:[$[0].firstName," ",$[0].lastName]}),o.jsxs("div",{style:{fontSize:12,color:"#cbd5e1"},children:[Math.round((G.score||0)*100),"%"]})]}),o.jsxs("div",{style:{color:"#cbd5e1"},children:[$[1].firstName," ",$[1].lastName]})]},`${$[0].id}-${$[1].id}`)})})]}),o.jsxs("div",{style:{flex:1,padding:12},children:[!p&&o.jsx("div",{className:"text-sm text-slate-300",children:"Vlj ett par till vnster fr att se en frhandsgranskning av sammanslagning."}),p&&o.jsxs("div",{children:[o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm font-medium text-slate-200",children:"Valt par"}),o.jsxs("div",{style:{display:"flex",gap:12,marginTop:8},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",checked:b,onChange:()=>y(!0)})," ",p[0].firstName," ",p[0].lastName]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,color:"#cbd5e1"},children:[o.jsx("input",{type:"radio",checked:!b,onChange:()=>y(!1)})," ",p[1].firstName," ",p[1].lastName]})]})]}),o.jsx(PO,{selectedPair:p,targetIsA:b,choices:v,setChoices:N}),o.jsx(BO,{selectedPair:p,targetIsA:b,choices:S,setChoices:j}),o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm font-medium text-slate-200",children:"Preview"}),!H&&o.jsx("div",{className:"text-sm text-slate-400",children:"Ingen frhandsgranskning tillgnglig."}),H&&o.jsxs("div",{style:{marginTop:8},children:[o.jsxs("div",{className:"text-sm text-slate-200",children:["Total events i kllor: ",H.totalEvents]}),o.jsxs("div",{className:"text-sm text-slate-200",children:["Behllna relationer: ",H.keptList.length]}),o.jsxs("div",{className:"text-sm text-slate-200",children:["Arkiverade relationer: ",H.archivedList.length]})]})]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{onClick:()=>g(null),className:"px-3 py-1 border border-slate-600 rounded bg-slate-700 text-slate-200 hover:bg-slate-600",children:"Avmarkera"}),o.jsx("button",{onClick:L,className:"px-3 py-1 bg-red-700 text-white rounded hover:bg-red-600",children:"Sammanfoga"})]})]})]})]})]}),E&&o.jsx(HO,{selectedPair:p,targetIsA:b,fieldChoices:v,eventChoices:S,dbData:l,setDbData:i,mergePersons:a,onClose:e,setShowSummary:D,showStatus:d,undoMerge:u,showUndoToast:h})]});try{return d1.createPortal(V,document.body)}catch{return V}}function UO(){try{const n=window.localStorage.getItem("relationEngineConfig");return n?JSON.parse(n):null}catch{return null}}function VO(n){try{return window.localStorage.setItem("relationEngineConfig",JSON.stringify(n)),!0}catch(e){return console.error("Failed to save relationEngineConfig",e),!1}}function qO({onClose:n,inline:e=!1}){const t={PARENT_MIN_YEARS:15,PARENT_MAX_YEARS:60,PARENT_LOOSE_MIN:11,LARGE_AGE_GAP:50,SIBLING_LARGE_GAP:10,SPOUSAL_LARGE_GAP:30,POSTHUMOUS_TOLERANCE:1},l=UO(),a={...t,...l||{}},[i,d]=ps.useState(a);function u(g,b){d(y=>({...y,[g]:Number(b||0)}))}function h(){VO(i),n&&n()}const p=o.jsxs("div",{className:e?"":"bg-slate-800 border border-slate-700 rounded p-6 w-[520px] max-h-[80vh] overflow-y-auto",children:[o.jsx("h3",{className:"text-lg font-bold mb-4",children:"Instllningar fr relationsfrslag"}),o.jsx("div",{className:"space-y-3 text-sm",children:o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("label",{children:"Min ldersdiff (frlder)"}),o.jsx("input",{value:i.PARENT_MIN_YEARS??"",onChange:g=>u("PARENT_MIN_YEARS",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Max ldersdiff (frlder)"}),o.jsx("input",{value:i.PARENT_MAX_YEARS??"",onChange:g=>u("PARENT_MAX_YEARS",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Loose min (lgfrtroende, r)"}),o.jsx("input",{value:i.PARENT_LOOSE_MIN??"",onChange:g=>u("PARENT_LOOSE_MIN",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Stor frldra-gap (flagga)"}),o.jsx("input",{value:i.LARGE_AGE_GAP??"",onChange:g=>u("LARGE_AGE_GAP",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Stor syskon-gap (flagga)"}),o.jsx("input",{value:i.SIBLING_LARGE_GAP??"",onChange:g=>u("SIBLING_LARGE_GAP",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Stor makal-gap (flagga)"}),o.jsx("input",{value:i.SPOUSAL_LARGE_GAP??"",onChange:g=>u("SPOUSAL_LARGE_GAP",g.target.value),className:"border p-1 rounded"}),o.jsx("label",{children:"Posthumous tolerance (r)"}),o.jsx("input",{value:i.POSTHUMOUS_TOLERANCE??"",onChange:g=>u("POSTHUMOUS_TOLERANCE",g.target.value),className:"border p-1 rounded"})]})}),o.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[o.jsx("button",{onClick:n,className:"px-3 py-1 border rounded",children:"Avbryt"}),o.jsx("button",{onClick:h,className:"px-4 py-1 bg-blue-600 text-white rounded",children:"Spara"})]})]});return e?p:o.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-40",children:p})}const qv=n=>{if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n)||/^\d{4}$/.test(n))return n;const e={JAN:"01",FEB:"02",MAR:"03",APR:"04",MAY:"05",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OCT:"10",NOV:"11",DEC:"12",OKT:"10",MAJ:"05"},t=n.toUpperCase().split(" ");if(t.length===3){const l=t[0].padStart(2,"0"),a=e[t[1]],i=t[2];if(l&&a&&i)return`${i}-${a}-${l}`}if(t.length===2){const l=e[t[0]],a=t[1];if(l&&a)return`${a}-${l}`}return n},FO=n=>{const e=n.split(/\r?\n/),t=[];let l=[];e.forEach(A=>{const B=A.trim();if(!B)return;const Y=B.match(/^(\d+)\s+(@\w+@|\w+)(\s+(.*))?$/);if(!Y)return;const J=parseInt(Y[1],10),de=Y[2],w=Y[4]||"";let T=de,I=null;de.startsWith("@")&&(I=de,T=w);const Z={tag:T,value:w,id:I,children:[]};if(J===0)t.push(Z),l=[Z];else{for(;l.length>J;)l.pop();l.length>0&&(l[l.length-1].children.push(Z),l.push(Z))}});const a=(A,B)=>A.children.find(Y=>Y.tag===B),i=(A,B)=>A.children.filter(Y=>Y.tag===B),d=(A,B)=>{const Y=a(A,B);return Y?Y.value:""},u=A=>{if(!A)return"";let B=A.value||"";return A.children.forEach(Y=>{Y.tag==="CONC"&&(B+=Y.value),Y.tag==="CONT"&&(B+=`
${Y.value}`)}),B},h=A=>{if(!A)return"";let B=A.value||"";return A.children.forEach(Y=>{Y.tag==="CONC"&&(B+=Y.value),Y.tag==="CONT"&&(B+=" "+Y.value)}),B.trim()},p=[],g=[],b=[],y=[],v=[],N=[],S=[],j=new Set,E=new Map;let D=1;const _=A=>{if(!A)return null;const B=A.trim();if(E.has(B))return E.get(B).id;const Y=`p${Date.now()}_${D++}`;return E.set(B,{id:Y,name:B}),Y},H=new Map;t.filter(A=>A.tag==="SOUR").forEach(A=>{let B="";const Y=a(A,"DATA");if(Y){const w=a(Y,"TEXT");w&&(B=u(w))}B||(B=u(a(A,"NOTE")));let J=h(a(A,"TITL"));J||(J=d(A,"ABBR")),J||(J=d(A,"AUTH")),J||(J=`Namnls klla (${A.id||"?"})`);const de={id:A.id?A.id.replace(/@/g,""):`ms_${Math.random()}`,title:J,archiveTop:"vrigt",archive:d(A,"REPO").replace(/@/g,""),note:B,publ:d(A,"PUBL"),author:d(A,"AUTH")};H.set(de.id,de)});const L=new Map,V=(A,B,Y,J)=>{if(!A)return null;const de=`${A}|${B||""}|${Y||""}`;if(L.has(de))return L.get(de);const w=H.get(A);if(!w)return null;const T=`src_imp_${b.length+1}_${Date.now()}`;let I=w.note||"";Y&&(I+=(I?`

--- Avskrift ---
`:"")+Y);let Z="",pe=B||"";if(pe.includes("AID:")){const ke=pe.match(/AID:\s*([a-zA-Z0-9\.]+)/i);ke&&(Z=ke[1])}else if(pe.includes("http")&&pe.includes("arkivdigital")){const ke=pe.match(/aid\/show\/([a-zA-Z0-9\.]+)/);ke&&(Z=ke[1])}let O=0;J==="3"?O=4:J==="2"?O=3:J==="1"?O=2:J==="0"&&(O=1);const te={...w,id:T,page:pe,aid:Z,note:I,trust:O};return b.push(te),L.set(de,T),T};t.forEach(A=>{if(A.tag==="INDI"){const B=a(A,"NAME"),Y=B?B.value.replace(/\//g,""):"Namnls";let J=d(A,"SEX").toUpperCase(),de=["F","FEMALE","K","KVINNA"].includes(J)?"K":["M","MALE","MAN"].includes(J)?"M":"";const w=A.id?A.id.replace(/@/g,""):"Unknown",T=w.startsWith("I")?w.substring(1):w,I=[],Z=["BIRT","DEAT","CHR","BURI","OCCU","RESI","PROB","MARR","DIV","BAPM","EDUC","CONF"];A.children.forEach(U=>{if(Z.includes(U.tag)){let ge=d(U,"DATE"),Ee=d(U,"PLAC"),ie=u(a(U,"NOTE")),Ie=U.tag;(Ie==="OCCU"||Ie==="EDUC")&&U.value&&(ie=U.value+(ie?`
${ie}`:""));const P=d(U,"ADDR");Ee&&(/^[\d\s]+$/.test(Ee)||Ee.length<2)?(ie=(ie?ie+`
`:"")+`Platskod: ${Ee}`,P&&P.length>2?Ee=P:Ee=""):!Ee&&P&&P.length>2&&(Ee=P),Ee&&j.add(Ee);const we=Ee?_(Ee):null,ue=[];i(U,"SOUR").forEach(Q=>{let re=Q.value?Q.value.replace(/@/g,""):"";if(re){const Ce=d(Q,"PAGE"),Ye=d(Q,"QUAY");let Ve="";const ft=a(Q,"DATA");if(ft){const lt=a(ft,"TEXT");lt&&(Ve=u(lt))}const dt=u(a(Q,"NOTE"));dt&&(Ve=(Ve?Ve+`
`:"")+dt);const xt=V(re,Ce,Ve,Ye);xt&&ue.push(xt)}});let Ue={id:`evt_${Math.random().toString(36).substr(2,9)}`,type:Ie,date:qv(ge),place:Ee,placeId:we,description:Ie==="OCCU"||Ie==="EDUC"?U.value:"",note:ie,sources:ue};if(U.tag==="DEAT"){const Q=a(U,"CAUS");Q&&(Ue.cause=Q.value)}I.push(Ue)}});const pe=i(A,"OBJE").map(U=>({src:d(U,"FILE"),title:d(U,"TITL"),format:d(U,"FORM")})),O=i(A,"FAMS").map(U=>U.value.replace(/@/g,"")),te=i(A,"FAMC").map(U=>U.value.replace(/@/g,"")),ke={email:d(A,"EMAIL"),phone:d(A,"PHON"),www:d(A,"WWW")};p.push({id:w,refNumber:T,name:Y,firstName:d(B,"GIVN"),lastName:d(B,"SURN"),gender:de,sex:de,events:I,images:pe,fams:O,famc:te,contacts:ke,changeDate:d(a(A,"CHAN"),"DATE")})}else if(A.tag==="FAM"){const B=[];["MARR","DIV"].forEach(Y=>{a(A,"MARR"),i(A,Y).forEach(de=>{let w=d(de,"PLAC"),T=w?_(w):null;const I=[];i(de,"SOUR").forEach(Z=>{let pe=Z.value.replace(/@/g,"");if(pe){const O=d(Z,"PAGE"),te=d(Z,"QUAY");let ke="";const U=a(Z,"DATA");if(U){const ie=a(U,"TEXT");ie&&(ke=u(ie))}const ge=u(a(Z,"NOTE"));ge&&(ke=(ke?ke+`
`:"")+ge);const Ee=V(pe,O,ke,te);Ee&&I.push(Ee)}}),B.push({type:Y,date:qv(d(de,"DATE")),place:w,placeId:T,note:u(a(de,"NOTE")),sources:I})})}),g.push({id:A.id.replace(/@/g,""),husb:d(A,"HUSB").replace(/@/g,""),wife:d(A,"WIFE").replace(/@/g,""),children:i(A,"CHIL").map(Y=>Y.value.replace(/@/g,"")),events:B})}else A.tag==="REPO"?y.push({id:A.id.replace(/@/g,""),name:d(A,"NAME"),addr:u(a(A,"ADDR"))}):A.tag==="NOTE"?v.push({id:A.id.replace(/@/g,""),text:u(A)}):A.tag==="OBJE"?N.push({id:A.id.replace(/@/g,""),file:d(A,"FILE"),title:d(A,"TITL")}):A.tag==="SUBM"&&S.push({id:A.id.replace(/@/g,""),name:d(A,"NAME")})}),H.forEach(A=>{b.push(A)});const G=A=>{if(A&&A.startsWith("@")&&A.endsWith("@")){const B=A.replace(/@/g,""),Y=v.find(J=>J.id===B);return Y?Y.text:A}return A};p.forEach(A=>A.events.forEach(B=>B.note=G(B.note))),b.forEach(A=>A.note=G(A.note));const X=Array.from(E.values()).map(A=>({...Ad(A.name),id:A.id,name:A.name,fullString:A.name})),$=new Map(p.map(A=>[A.id,A]));p.forEach(A=>{A.relations={parents:[],children:[],spouseId:null}});function R(A,B,Y){let J="biologisk";if(A&&B){const de=i(A,"FAMC").concat(i(A,"FAMS"));for(const w of de)if(w.value&&w.value.replace(/@/g,"")===B){const T=a(w,"PEDI");if(T){const Z=(T.value||"").toLowerCase();Z.includes("adopt")?J="adopterad":Z.includes("fost")?J="fosterbarn":Z.includes("step")?J="styvbarn":Z.includes("birth")?J="biologisk":J=Z}const I=w.children.map(Z=>Z.tag.toLowerCase());I.includes("adop")&&(J="adopterad"),I.includes("fost")&&(J="fosterbarn"),I.includes("step")&&(J="styvbarn")}}return J}return g.forEach(A=>{const{husb:B,wife:Y,children:J,id:de}=A;J.forEach(w=>{const T=$.get(w);if(T){const I=t.find(Z=>Z.tag==="INDI"&&Z.id&&Z.id.replace(/@/g,"")===w);B&&$.has(B)&&!T.relations.parents.some(Z=>Z.id===B)&&T.relations.parents.push({id:B,status:R(I,de)}),Y&&$.has(Y)&&!T.relations.parents.some(Z=>Z.id===Y)&&T.relations.parents.push({id:Y,status:R(I,de)})}}),[B,Y].forEach(w=>{const T=$.get(w);T&&J.forEach(I=>{if($.has(I)&&!T.relations.children.some(Z=>Z.id===I)){const Z=t.find(pe=>pe.tag==="INDI"&&pe.id&&pe.id.replace(/@/g,"")===I);T.relations.children.push({id:I,status:R(Z,de)})}})}),B&&Y&&$.has(B)&&$.has(Y)&&($.get(B).relations.spouseId||($.get(B).relations.spouseId=Y),$.get(Y).relations.spouseId||($.get(Y).relations.spouseId=B))}),{individuals:p,families:g,sources:b,repositories:y,sharedNotes:v,sharedMedia:N,submitters:S,places:X}},KO=n=>{const[e,t]=C.useState(null),[l,a]=C.useState(!1),i=u=>{const h=u.target.files[0];if(!h)return;a(!0);const p=new FileReader;p.readAsText(h,"UTF-8"),p.onload=g=>{const b=g.target.result,y=FO(b);t(y),a(!1)}},d=async()=>{if(e)try{if(a(!0),e.places&&e.places.length>0)for(const h of e.places)try{await fetch("http://127.0.0.1:5005/place",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})}catch(p){console.error("Kunde inte spara plats:",h,p)}console.log("Skickar data till Electron...",e);const u=await window.electronAPI.importGedcom(e);u.success?(alert(` Importen lyckades!
${e.individuals.length} personer tillagda.`),n.onImport?n.onImport(e):window.location.reload(),t(null)):alert(" Fel vid sparning: "+u.message)}catch(u){console.error(u),alert("Ett fel uppstod: "+u.message)}finally{a(!1)}};return e?o.jsxs("div",{className:"p-4 h-screen flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-4",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold",children:"Import-granskning"}),o.jsxs("div",{className:"text-sm text-slate-400 flex gap-4",children:[o.jsxs("span",{children:[" ",e.individuals.length," Personer"]}),o.jsxs("span",{children:[" ",e.places.length," Platser"]}),o.jsxs("span",{children:[" ",e.sources.length," Kllor"]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>t(null),className:"px-4 py-2 border border-slate-600 rounded text-slate-300 hover:bg-slate-700",children:"Ny fil"}),o.jsx("button",{onClick:d,className:"px-6 py-2 bg-green-600 text-white font-bold rounded shadow hover:bg-green-700 flex items-center gap-2",children:o.jsx("span",{children:"Importera Allt"})})]})]}),o.jsxs("div",{className:"flex gap-4 flex-1 overflow-hidden",children:[o.jsxs("div",{className:"w-1/3 bg-slate-800 shadow rounded p-4 overflow-y-auto",children:[o.jsx("h3",{className:"font-bold border-b pb-2 sticky top-0 bg-slate-800 text-slate-200",children:"Personer"}),o.jsx("ul",{className:"mt-2",children:e.individuals.slice(0,50).map(u=>o.jsxs("li",{className:"py-2 border-b hover:bg-slate-700 text-sm border-slate-700",children:[o.jsx("div",{className:"font-semibold text-slate-200",children:u.name}),o.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[o.jsx("span",{children:u.gender==="K"?"Kvinna":"Man"}),o.jsxs("span",{children:["Ref: ",u.refNumber]})]})]},u.id))})]}),o.jsx("div",{className:"w-2/3 bg-slate-900 p-4 text-center text-slate-400",children:"Frhandsgranskning av platser och kllor dljs hr."})]})]}):o.jsxs("div",{className:"p-10 border-2 border-dashed text-center rounded-lg bg-slate-800 border-slate-600 m-4",children:[o.jsx("h2",{className:"text-xl font-bold mb-4",children:"Ladda upp GEDCOM"}),o.jsx("input",{type:"file",accept:".ged",onChange:i,className:"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),l&&o.jsx("p",{className:"mt-2 text-blue-600",children:"Bearbetar..."})]})},GO=""+new URL("silhouette_unknown-B17APLOR.png",import.meta.url).href,jp=[{id:1,ref:"A1",lastName:"Andersson",firstName:"Anna",birth:{date:"1980-01-01",place:"Lderup"},death:{date:"2020-05-10",place:"Svenstorp"},image:null},{id:2,ref:"B2",lastName:"Bengtsson",firstName:"Bertil",birth:{date:"1975-03-15",place:"Ystad"},death:{date:"-",place:"-"},image:null}];function YO({x:n,y:e,onClose:t,onPersonSelect:l}){const[a,i]=C.useState(""),[d,u]=C.useState(jp),h=C.useRef();return C.useEffect(()=>{function p(b){h.current&&!h.current.contains(b.target)&&t()}function g(b){b.key==="Escape"&&t()}return document.addEventListener("mousedown",p),document.addEventListener("keydown",g),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("keydown",g)}},[t]),C.useEffect(()=>{u(a?jp.filter(p=>p.lastName.toLowerCase().includes(a.toLowerCase())||p.firstName.toLowerCase().includes(a.toLowerCase())):jp)},[a]),o.jsxs("div",{ref:h,style:{position:"absolute",left:n,top:e,zIndex:1e3,background:"#222",borderRadius:8,boxShadow:"0 4px 24px #0008",padding:12,minWidth:320,color:"#fff"},children:[o.jsx("input",{autoFocus:!0,type:"text",value:a,onChange:p=>i(p.target.value),placeholder:"Sk person...",style:{width:"100%",marginBottom:10,padding:6,borderRadius:4,border:"none"}}),o.jsxs("div",{children:[d.map(p=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:6,borderRadius:6,cursor:"pointer",background:"#333",marginBottom:4},title:`(${p.ref}) ${p.lastName}, ${p.firstName}
* ${p.birth.date}, ${p.birth.place}
+ ${p.death.date}, ${p.death.place}`,onClick:()=>{l&&l(p.id),t()},children:[o.jsx("img",{src:p.image||GO,alt:"Profil",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover",background:"#444"}}),o.jsxs("div",{children:[o.jsxs("div",{style:{fontWeight:600},children:["(",p.ref,") ",p.lastName,", ",p.firstName]}),o.jsxs("div",{style:{fontSize:13,color:"#ccc"},children:["* ",p.birth.date,", ",p.birth.place]}),o.jsxs("div",{style:{fontSize:13,color:"#ccc"},children:["+ ",p.death.date,", ",p.death.place]})]})]},p.id)),d.length===0&&o.jsx("div",{style:{color:"#aaa",padding:8},children:"Inga trffar"})]})]})}const XO=[{id:1,ref:"A1",lastName:"Andersson",firstName:"Anna"},{id:2,ref:"B2",lastName:"Bengtsson",firstName:"Bertil"}];function JO({tags:n,setTags:e,activeTagId:t,setActiveTagId:l,isTaggingMode:a,containerRef:i,scale:d=1,rotation:u=0,position:h={x:0,y:0},flipH:p=!1,flipV:g=!1,image:b=null}){const[y,v]=C.useState("IDLE"),[N,S]=C.useState({x:0,y:0}),[j,E]=C.useState(null),[D,_]=C.useState(null);C.useEffect(()=>{const A=B=>{console.log("[FaceTagOverlay] handleKeyDown",B.key,{activeTagId:t}),(B.key==="Delete"||B.key==="Backspace")&&t!==null&&(e(Y=>Y.filter(J=>J.id!==t)),l(null))};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[t,e,l]);const H=(A,B)=>{if(!i.current||!b)return{x:0,y:0};const Y=i.current,J=Y.clientWidth/2+h.x,de=Y.clientHeight/2+h.y,w=A-J,T=B-de,I=-(u*Math.PI)/180,Z=Math.cos(I),pe=Math.sin(I),O=w*Z-T*pe,te=w*pe+T*Z,ke=d*(p?-1:1),U=d*(g?-1:1),ge=O/ke+b.width/2,Ee=te/U+b.height/2;return{x:ge,y:Ee}},L=A=>{const B=i.current.getBoundingClientRect();return{x:A.clientX-B.left,y:A.clientY-B.top}},V=A=>{if(console.log("[FaceTagOverlay] handleMouseDownOverlay",{isTaggingMode:a,button:A.button,target:A.target===A.currentTarget}),!a||A.button!==0||A.target!==A.currentTarget)return;A.preventDefault();const B=L(A),Y=H(B.x,B.y),J={id:Date.now()+Math.random(),x:Y.x,y:Y.y,w:0,h:0,status:"new",note:"",personId:null};e(de=>[...de,J]),E(J.id),l(J.id),v("DRAWING"),S(Y)},G=(A,B)=>{if(console.log("[FaceTagOverlay] handleMouseDownBox",{isTaggingMode:a,id:B,button:A.button}),!a||A.button!==0)return;A.stopPropagation(),l(B),E(B),v("MOVING");const Y=n.find(w=>w.id===B),J=L(A),de=H(J.x,J.y);S({x:de.x-Y.x,y:de.y-Y.y})},X=(A,B)=>{console.log("[FaceTagOverlay] handleMouseDownResize",{isTaggingMode:a,id:B,button:A.button}),!(!a||A.button!==0)&&(A.stopPropagation(),E(B),v("RESIZING"),S(L(A)))},$=A=>{if(y!=="IDLE"&&console.log("[FaceTagOverlay] handleMouseMove",{action:y,activeBoxId:j}),y==="IDLE")return;const B=L(A),Y=n.findIndex(w=>w.id===j);if(Y===-1)return;const J=n[Y],de=[...n];if(y==="DRAWING"){const w=H(B.x,B.y),T=w.x-N.x,I=w.y-N.y;de[Y]={...J,x:T>0?N.x:w.x,y:I>0?N.y:w.y,w:Math.abs(T),h:Math.abs(I)}}else if(y==="MOVING"){const w=H(B.x,B.y);let T=w.x-N.x,I=w.y-N.y;b&&(T=Math.max(0,Math.min(T,b.width-J.w)),I=Math.max(0,Math.min(I,b.height-J.h))),de[Y]={...J,x:T,y:I}}else if(y==="RESIZING"){const w=H(B.x,B.y),T=Math.max(10,w.x-J.x),I=Math.max(10,w.y-J.y);de[Y]={...J,w:T,h:I}}e(de)},R=()=>{if(console.log("[FaceTagOverlay] handleMouseUp",{action:y,activeBoxId:j}),y==="DRAWING"){const A=n.findIndex(B=>B.id===j);if(A!==-1){const B=n[A];(B.w<5||B.h<5)&&e(Y=>Y.filter(J=>J.id!==B.id))}}v("IDLE"),E(null)};return C.useEffect(()=>(console.log("[FaceTagOverlay] useEffect action",{action:y}),y!=="IDLE"&&(window.addEventListener("mousemove",$),window.addEventListener("mouseup",R)),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",R)}),[y,n,j,N]),o.jsxs(o.Fragment,{children:[n.map(A=>{const B=A.id===t;let Y=i.current?i.current.clientWidth/2:0,J=i.current?i.current.clientHeight/2:0,de=A.x+A.w/2-(b?b.width/2:0),w=A.y+A.h/2-(b?b.height/2:0),T=d*(p?-1:1),I=d*(g?-1:1),Z=u*Math.PI/180,pe=de*Math.cos(Z)-w*Math.sin(Z),O=de*Math.sin(Z)+w*Math.cos(Z),te=Y+h.x+pe*T-A.w*Math.abs(T)/2,ke=J+h.y+O*I-A.h*Math.abs(I)/2,U=A.w*Math.abs(T),ge=A.h*Math.abs(I),Ee=null;if(A.personId){const ie=XO.find(Ie=>Ie.id===A.personId);ie&&(Ee=`(${ie.ref}) ${ie.lastName}, ${ie.firstName}`)}return o.jsx("div",{className:`absolute border-2 ${B?"border-amber-400":"border-blue-400"} bg-blue-400/10 cursor-move`,style:{left:te,top:ke,width:U,height:ge,zIndex:B?10:1,transform:`rotate(${u}deg)`},onMouseDown:ie=>{a&&ie.button===0&&G(ie,A.id)},onContextMenu:ie=>{if(a){ie.preventDefault(),l(A.id);const Ie=i.current.getBoundingClientRect(),P=ie.clientX-Ie.left,we=ie.clientY-Ie.top;_({x:P,y:we,tagId:A.id})}},children:a&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"absolute right-0 top-0 bg-red-700 text-white text-xs rounded px-1 py-0.5",style:{transform:"translateY(-100%)",pointerEvents:"auto"},onClick:ie=>{ie.stopPropagation(),e(Ie=>Ie.filter(P=>P.id!==A.id)),l(null)},title:"Ta bort box",children:""}),o.jsx("div",{className:"absolute w-4 h-4 bg-blue-400 border border-white rounded cursor-nwse-resize",style:{right:-8,bottom:-8,pointerEvents:"auto"},onMouseDown:ie=>X(ie,A.id)}),o.jsx("div",{className:"absolute left-0 top-full bg-slate-800 text-xs text-white px-2 py-1 rounded shadow",children:Ee||"Ansikte"})]})},A.id)}),D&&o.jsx(YO,{x:D.x,y:D.y,onClose:()=>_(null),onPersonSelect:A=>{e(B=>B.map(Y=>Y.id===D.tagId?{...Y,personId:A}:Y)),_(null)}}),o.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:a&&y==="IDLE"?"auto":"none",background:"transparent"},onMouseDown:V})]})}const QO=({isOpen:n,onClose:e,imageUrl:t,imageName:l,onSave:a,onPrev:i,onNext:d,hasPrev:u=!1,hasNext:h=!1,onDelete:p,isConfirmingDelete:g=!1,enableSaveCopy:b=!0})=>{const y=C.useRef(null),v=C.useRef(null),[N,S]=C.useState(null),[j,E]=C.useState(!1),[D,_]=C.useState(1),[H,L]=C.useState(0),[V,G]=C.useState(0),[X,$]=C.useState({x:0,y:0}),[R,A]=C.useState(1),[B,Y]=C.useState(1),[J,de]=C.useState(!1),[w,T]=C.useState(!1),[I,Z]=C.useState(!1),[pe,O]=C.useState(!1),[te,ke]=C.useState(null),[U,ge]=C.useState(!1),Ee=C.useRef(null),[ie,Ie]=C.useState(!1),[P,we]=C.useState([]),[ue,Ue]=C.useState(null),[Q,re]=C.useState(!1),[Ce,Ye]=C.useState([]),[Ve,ft]=C.useState(-1),dt=C.useRef(-1),[xt,lt]=C.useState(!1),bt=C.useRef({x:0,y:0}),ot=()=>({scale:D,rotation:H,fineRotation:V,position:X,brightness:R,contrastLevel:B,flipH:J,flipV:w}),fe=Re=>{Re&&(_(Re.scale),L(Re.rotation),G(Re.fineRotation),$(Re.position),A(Re.brightness),Y(Re.contrastLevel),de(Re.flipH),T(Re.flipV))},ze=(Re=ot())=>{Ye(Le=>{const Gt=[...Le.slice(0,dt.current+1),Re],Yt=Gt.length-1;return dt.current=Yt,ft(Yt),Gt})},Me=()=>{const Re=ot();Ye([Re]),ft(0),dt.current=0},He=()=>{Ye(Re=>{if(dt.current<=0)return Re;const Le=dt.current-1;return dt.current=Le,ft(Le),fe(Re[Le]),Re})},et=()=>{Ye(Re=>{if(dt.current<0||dt.current>=Re.length-1)return Re;const Le=dt.current+1;return dt.current=Le,ft(Le),fe(Re[Le]),Re})};C.useEffect(()=>{if(!n)return;const Re=()=>st();return window.addEventListener("resize",Re),()=>window.removeEventListener("resize",Re)},[n]),C.useEffect(()=>{!N||!y.current||rt()},[N,D,H,V,X,R,B,J,w,I]);const st=(Re=N)=>{if(!Re||!v.current)return;const Le=v.current,Jt=Le.clientWidth,Gt=Le.clientHeight,Yt=Jt/Re.width,yn=Gt/Re.height,$n=Math.min(Yt,yn,1)*.9;_($n),$({x:0,y:0})},rt=()=>{const Re=y.current;if(!Re||!N)return;const Le=Re.getContext("2d");if(Re.width=v.current.clientWidth,Re.height=v.current.clientHeight,Re.width===0||Re.height===0)return;Le.clearRect(0,0,Re.width,Re.height);const Jt=Re.width/2+X.x,Gt=Re.height/2+X.y;Le.save(),Le.translate(Jt,Gt),Le.rotate((H+V)*Math.PI/180);const Yt=D*(J?-1:1),yn=D*(w?-1:1);if(Le.scale(Yt,yn),Le.filter=`brightness(${R}) contrast(${B})`,Le.drawImage(N,-N.width/2,-N.height/2),I){Le.lineWidth=.5,Le.strokeStyle="rgba(255,255,255,0.25)";for(let Qt=-N.width;Qt<=N.width;Qt+=100)Le.beginPath(),Le.moveTo(Qt,-N.height),Le.lineTo(Qt,N.height),Le.stroke();for(let Qt=-N.height;Qt<=N.height;Qt+=100)Le.beginPath(),Le.moveTo(-N.width,Qt),Le.lineTo(N.width,Qt),Le.stroke();Le.strokeStyle="rgba(0,255,0,0.35)",Le.beginPath(),Le.moveTo(-N.width,0),Le.lineTo(N.width,0),Le.moveTo(0,-N.height),Le.lineTo(0,N.height),Le.stroke()}Le.restore()},ht=Re=>{Re.preventDefault();const Le=Re.deltaY>0?.9:1.1;ze(),_(Jt=>Math.max(.1,Math.min(10,Jt*Le)))},St=Re=>{if(Re.button===0)if(pe){ge(!0);const Le=v.current.getBoundingClientRect(),Jt=Re.clientX-Le.left,Gt=Re.clientY-Le.top;Ee.current={x:Jt,y:Gt},ke({x1:Jt,y1:Gt,x2:Jt,y2:Gt})}else lt(!0),bt.current={x:Re.clientX-X.x,y:Re.clientY-X.y}},ee=Re=>{if(U){const Le=v.current.getBoundingClientRect(),Jt=Re.clientX-Le.left,Gt=Re.clientY-Le.top;ke(Yt=>Yt?{...Yt,x2:Jt,y2:Gt}:{x1:Jt,y1:Gt,x2:Jt,y2:Gt});return}xt&&$({x:Re.clientX-bt.current.x,y:Re.clientY-bt.current.y})},oe=()=>{if(U){ge(!1);return}lt(!1)},xe=Re=>{const Le=y.current.getBoundingClientRect(),Jt=Re.clientX-Le.left-Le.width/2,Gt=Re.clientY-Le.top-Le.height/2;ze(),_(Yt=>Math.min(10,Yt*1.5)),$(Yt=>({x:Yt.x-Jt*.2,y:Yt.y-Gt*.2}))},$e=Re=>{ze(),L(Le=>(Le+Re)%360)},Xt=()=>$e(90),Ot=()=>{ze(),_(Re=>Math.min(10,Re*1.2))},_t=()=>{ze(),_(Re=>Math.max(.1,Re/1.2))},xn=()=>{st()},bn=()=>{ze(),st(),L(0),G(0),$({x:0,y:0}),A(1),Y(1),de(!1),T(!1)};C.useEffect(()=>{if(!n||!t)return;const Re=new Image;Re.onload=()=>{S(Re),st(Re),bn(),Me()},Re.src=t},[n,t]);const Cn=()=>{O(Re=>!Re),ke(null)},ss=(Re,Le)=>{if(!y.current||!N)return{x:0,y:0};const Jt=y.current,Gt=Jt.width/2+X.x,Yt=Jt.height/2+X.y,yn=Re-Gt,$n=Le-Yt,Qt=-((H+V)*Math.PI)/180,ws=Math.cos(Qt),En=Math.sin(Qt),Ys=yn*ws-$n*En,ls=yn*En+$n*ws,zt=D*(J?-1:1),F=D*(w?-1:1),ye=Ys/zt+N.width/2,be=ls/F+N.height/2;return{x:Math.max(0,Math.min(N.width,ye)),y:Math.max(0,Math.min(N.height,be))}},Gs=()=>{if(!te||!N)return;const Re=ss(te.x1,te.y1),Le=ss(te.x2,te.y2),Jt=Math.min(Re.x,Le.x),Gt=Math.min(Re.y,Le.y),Yt=Math.max(10,Math.abs(Le.x-Re.x)),yn=Math.max(10,Math.abs(Le.y-Re.y)),$n=document.createElement("canvas");$n.width=Yt,$n.height=yn,$n.getContext("2d").drawImage(N,-Jt,-Gt);const ws=$n.toDataURL("image/jpeg",.95),En=new Image;En.onload=()=>{ze({scale:1,rotation:0,fineRotation:0,position:{x:0,y:0},brightness:1,contrastLevel:1,flipH:!1,flipV:!1}),S(En),ke(null),O(!1),_(1),L(0),G(0),$({x:0,y:0}),A(1),Y(1),de(!1),T(!1),st(En),Me()},En.src=ws};return C.useEffect(()=>{if(!n)return;const Re=Le=>{Le.key==="ArrowLeft"&&u&&i&&(Le.preventDefault(),i()),Le.key==="ArrowRight"&&h&&d&&(Le.preventDefault(),d()),Le.key==="Escape"&&e&&(Le.preventDefault(),e()),Le.ctrlKey&&Le.key.toLowerCase()==="r"&&(Le.preventDefault(),$e(90)),Le.ctrlKey&&Le.key.toLowerCase()==="f"&&(Le.preventDefault(),xn()),Le.ctrlKey&&Le.key.toLowerCase()==="z"&&(Le.preventDefault(),Ot()),Le.ctrlKey&&Le.key.toLowerCase()==="x"&&(Le.preventDefault(),_t()),Le.ctrlKey&&Le.key.toLowerCase()==="c"&&(Le.preventDefault(),Cn()),Le.key==="Delete"&&p&&(Le.preventDefault(),p()),Le.ctrlKey&&Le.key.toLowerCase()==="h"&&(Le.preventDefault(),bn()),Le.ctrlKey&&Le.key.toLowerCase()==="z"&&(Le.preventDefault(),He()),Le.ctrlKey&&Le.key.toLowerCase()==="y"&&(Le.preventDefault(),et())};return window.addEventListener("keydown",Re),()=>window.removeEventListener("keydown",Re)},[n]),n?o.jsx(Vs,{title:`Redigera: ${l}`,icon:Or,onClose:e,initialWidth:Math.min(1400,window.innerWidth*.9),initialHeight:Math.min(900,window.innerHeight*.9),children:o.jsxs("div",{className:"flex flex-col h-full bg-slate-900 select-none",children:[o.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-800 shrink-0 select-none",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[o.jsx("button",{className:`p-2 ${ie?"bg-amber-700 hover:bg-amber-800":"bg-slate-700 hover:bg-slate-600"} text-white rounded transition-colors flex items-center gap-1`,title:"Face-tagging",onClick:()=>Ie(Re=>!Re),children:o.jsx(Tp,{size:18})}),o.jsx("button",{onClick:Ot,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Zooma in (Z)",children:o.jsx(Yj,{size:18})}),o.jsx("button",{onClick:_t,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Zooma ut (X)",children:o.jsx(Jj,{size:18})}),o.jsx("button",{onClick:xn,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Anpassa till fnster (F)",children:o.jsx(l1,{size:18})}),o.jsx("button",{onClick:Xt,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Rotera 90 (R)",children:o.jsx(Ap,{size:18})}),o.jsx("button",{onClick:()=>{ze(),de(Re=>!Re)},className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Spegla horisontellt",children:o.jsx(FS,{size:18})}),o.jsx("button",{onClick:()=>{ze(),T(Re=>!Re)},className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Spegla vertikalt",children:o.jsx(GS,{size:18})}),o.jsx("button",{onClick:Cn,className:`p-2 rounded transition-colors text-white ${pe?"bg-amber-700 hover:bg-amber-800":"bg-slate-700 hover:bg-slate-600"}`,title:"Beskr (C)",children:o.jsx(Yb,{size:18})}),o.jsx("button",{onClick:()=>Z(Re=>!Re),className:`p-2 rounded transition-colors text-white ${I?"bg-green-700 hover:bg-green-800":"bg-slate-700 hover:bg-slate-600"}`,title:"Rutnt",children:o.jsx(n1,{size:18})}),o.jsx("button",{onClick:bn,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"terstll (H)",children:o.jsx(Cj,{size:18})}),o.jsx("button",{onClick:He,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"ngra (Ctrl+Z)",children:o.jsx(Mj,{size:18})}),o.jsx("button",{onClick:et,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",title:"Gr om (Ctrl+Y)",children:o.jsx(Ap,{size:18})})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[o.jsx("span",{children:"Finvinkel"}),o.jsx("input",{type:"range",min:-5,max:5,step:.1,value:V,onChange:Re=>{ze(),G(parseFloat(Re.target.value))},className:"w-32"}),o.jsxs("span",{className:"w-10 text-right",children:[V.toFixed(1),""]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[o.jsx(Pj,{size:14}),o.jsx("input",{type:"range",min:.5,max:1.5,step:.05,value:R,onChange:Re=>{ze(),A(parseFloat(Re.target.value))},className:"w-24"}),o.jsxs("span",{className:"w-10 text-right",children:[Math.round(R*100),"%"]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[o.jsx(_S,{size:14}),o.jsx("input",{type:"range",min:.5,max:1.5,step:.05,value:B,onChange:Re=>{ze(),Y(parseFloat(Re.target.value))},className:"w-24"}),o.jsxs("span",{className:"w-10 text-right",children:[Math.round(B*100),"%"]})]})]})]}),o.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-slate-700 bg-slate-800 shrink-0 select-none text-slate-300 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("span",{children:["Zoom: ",Math.round(D*100),"%"]}),o.jsxs("span",{children:["Rotation: ",(H+V).toFixed(1),""]}),pe&&o.jsxs("button",{onClick:Gs,className:"px-3 py-1 bg-amber-700 hover:bg-amber-800 text-white rounded transition-colors text-sm flex items-center gap-1",children:[o.jsx(Yb,{size:14})," Tillmpa beskrning"]}),te&&!pe&&o.jsx("span",{className:"text-amber-400",children:"Beskrningsruta finns  aktivera beskrning fr att redigera"})]}),o.jsx("div",{className:"flex items-center gap-3",children:o.jsx("button",{onClick:()=>i&&i(),disabled:!u,className:"flex items-center gap-2 px-3 py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 text-white rounded transition-colors font-medium",title:"Fregende (vnsterpil)",children:o.jsx(Qv,{size:16})})})]}),o.jsxs("div",{ref:v,className:"flex-1 overflow-hidden bg-slate-950 relative cursor-move flex items-center justify-center select-none",style:{cursor:pe||ie?"crosshair":"move"},onWheel:ht,onMouseDown:ie?void 0:St,onMouseMove:ie?void 0:ee,onMouseUp:ie?void 0:oe,onDoubleClick:xe,children:[o.jsx("canvas",{ref:y,className:"max-w-full max-h-full"}),pe&&te&&o.jsx("div",{className:"absolute border-2 border-amber-400 bg-amber-400/10 pointer-events-none",style:{left:Math.min(te.x1,te.x2),top:Math.min(te.y1,te.y2),width:Math.abs(te.x2-te.x1),height:Math.abs(te.y2-te.y1)}}),ie&&o.jsx(JO,{tags:P,setTags:we,activeTagId:ue,setActiveTagId:Ue,isTaggingMode:ie,containerRef:v,scale:D,rotation:H+V,position:X,flipH:J,flipV:w,image:N})]}),o.jsx("div",{className:"px-4 py-2 border-t border-slate-700 bg-slate-800 text-slate-400 text-xs shrink-0",children:"Tips: Scrolla fr zoom, dubbelklick fr zoom in, dra fr att flytta. Kortkommandon: Z/X zoom, R 90, F fit, C beskr, H reset, Del ta bort, Ctrl+Z/Y ngra/gr om."})]})}):null},Cp=[{id:"all",label:"Alla bilder",icon:s1,type:"system"},{id:"gallery",label:"Personligt Galleri",icon:Or,type:"system"},{id:"places",label:"Platsregister",icon:Ni,type:"system"},{id:"sources",label:"Kllmaterial",icon:wo,type:"system"}],Fv=[{id:1,url:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop",filePath:"kallor/portrtt_1910.jpg",name:"Portrtt 1910.jpg",date:"1910-05-20",libraryId:"gallery",isProfile:!0,description:"Portrtt taget hos fotografen i stan. Anders har p sig sin finkostym.",connections:{people:[{id:"I1",name:"Anders Nilsson",ref:"I1234",dates:"1885-1962"}],places:[{id:"P1",name:"Vstra Vram",type:"Socken"}],sources:[]},tags:["Portrtt","Atelj"],faces:[{x:40,y:30,width:20,height:20,personId:"I1"}],transcription:""},{id:2,url:"https://images.unsplash.com/photo-1583324113626-70df0f4deaab?w=400&h=300&fit=crop",name:"Husfrhrslngd 1890.jpg",date:"1890",libraryId:"sources",isProfile:!1,description:"Sida 14 i husfrhrslngden.",connections:{people:[{id:"I1",name:"Anders Nilsson",ref:"I1234",dates:"1885-1962"},{id:"I2",name:"Anna Persdotter",ref:"I1235",dates:"1890-1970"}],places:[{id:"P1",name:"Vstra Vram",type:"Socken"}],sources:[{id:"S1",name:"Vstra Vram AI:14 (1885-1894) Bild 18 / sid 14",ref:"AD"}]},tags:["Kyrkbok","Klla"],faces:[],transcription:"Fdd d. 12 April, dpt d. 14. Fader: Torpare Nils..."},{id:3,url:"https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=400&h=300&fit=crop",name:"Grden i dimma.jpg",date:"1950-11-02",libraryId:"places",isProfile:!1,description:"",connections:{people:[],places:[{id:"P2",name:"Norra Vram 4:2",type:"Grd"}],sources:[]},tags:["Landskap","Grd"],faces:[],transcription:""}],ZO=({isOpen:n,onClose:e,onMove:t,libraries:l})=>n?o.jsx("div",{className:"absolute inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:o.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-xl w-80 overflow-hidden",children:[o.jsxs("div",{className:"p-3 border-b border-slate-700 bg-slate-900 font-bold text-white flex justify-between items-center",children:[o.jsx("span",{children:"Flytta till..."}),o.jsx("button",{onClick:e,children:o.jsx(ys,{size:16,className:"text-slate-400 hover:text-white"})})]}),o.jsx("div",{className:"max-h-64 overflow-y-auto p-2 custom-scrollbar",children:l.filter(a=>a.id!=="all").map(a=>o.jsxs("button",{onClick:()=>t(a.id),className:"w-full text-left px-3 py-2 hover:bg-slate-700 rounded flex items-center gap-2 text-slate-300 group transition-colors",children:[o.jsx(a.icon,{size:16,className:"text-slate-500 group-hover:text-blue-400"}),a.label]},a.id))})]})}):null,WO=({isOpen:n,onClose:e,onSave:t,count:l})=>{const[a,i]=C.useState(""),[d,u]=C.useState("");return n?o.jsx("div",{className:"absolute inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:o.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-xl w-96 overflow-hidden",children:[o.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-900 font-bold text-white flex justify-between items-center",children:[o.jsxs("span",{children:["Redigera ",l," objekt"]}),o.jsx("button",{onClick:e,children:o.jsx(ys,{size:18,className:"text-slate-400 hover:text-white"})})]}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Stt gemensamt datum"}),o.jsx("input",{type:"text",placeholder:"-MM-DD",className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm focus:outline-none focus:border-blue-500",value:a,onChange:h=>i(h.target.value)}),o.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Lmna tomt fr att behlla befintliga datum."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase mb-1",children:"Lgg till taggar"}),o.jsx("input",{type:"text",placeholder:"T.ex. Sommar, Semester",className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm focus:outline-none focus:border-blue-500",value:d,onChange:h=>u(h.target.value)}),o.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Separera med kommatecken. Dessa lggs till p befintliga."})]})]}),o.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-900 flex justify-end gap-2",children:[o.jsx("button",{onClick:e,className:"text-sm text-slate-400 hover:text-white px-3 py-1.5",children:"Avbryt"}),o.jsx("button",{onClick:()=>t({date:a,tags:d}),className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-sm font-medium",children:"Uppdatera"})]})]})}):null},Kv=({lib:n,isActive:e,onClick:t,onDrop:l,onDelete:a})=>{const[i,d]=C.useState(!1),u=g=>{g.preventDefault(),d(!0)},h=()=>{d(!1)},p=g=>{g.preventDefault(),d(!1);const b=g.dataTransfer.getData("application/json");if(b)try{const{ids:y}=JSON.parse(b);y&&y.length>0&&l(n.id,y)}catch(y){console.error("Drop error",y)}};return o.jsxs("div",{className:`group flex items-center gap-1 rounded px-2 py-1 transition-colors relative 
                ${e?"bg-blue-600/20 text-blue-100":"text-slate-400 hover:bg-slate-800 hover:text-white"}
                ${i?"bg-blue-500/40 ring-2 ring-blue-500 scale-[1.02]":""}
            `,onDragOver:u,onDragLeave:h,onDrop:p,children:[o.jsxs("button",{onClick:t,className:"flex-1 flex items-center gap-3 text-sm truncate w-full text-left py-1.5",children:[o.jsx(n.icon,{size:16,className:i?"text-white animate-bounce":e?"text-blue-400":"text-slate-500 group-hover:text-blue-400"}),n.label]}),a&&o.jsx("button",{onClick:g=>a(n.id,g),className:"p-1.5 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Radera album",children:o.jsx(ol,{size:12})})]})};function e5({allPeople:n=[],onOpenEditModal:e=()=>{},mediaItems:t=[],onUpdateMedia:l=()=>{},setIsSourceDrawerOpen:a=()=>{},setIsPlaceDrawerOpen:i=()=>{}}){const{showUndoToast:d,showStatus:u}=Fs(),[h,p]=C.useState("grid"),[g,b]=C.useState("all"),[y,v]=C.useState(!1),[N,S]=C.useState(""),[j,E]=C.useState(!1),[D,_]=C.useState(!1),[H,L]=C.useState(!1),[V,G]=C.useState({x:0,y:0}),[X,$]=C.useState(null),[R,A]=C.useState(!1),[B,Y]=C.useState(null),[J,de]=C.useState(null),w=C.useRef(null),[T,I]=C.useState(t.length>0?t:Fv);C.useEffect(()=>{I(t.length>0?t:Fv)},[t]),T.flatMap(F=>F.connections.sources||[]).filter((F,ye,be)=>be.findIndex(qe=>qe.id===F.id)===ye),T.flatMap(F=>F.connections.places||[]).filter((F,ye,be)=>be.findIndex(qe=>qe.id===F.id)===ye);const Z=F=>{I(ye=>{const be=typeof F=="function"?F(ye):F;return l(be),be})},pe=(F,ye)=>{F.preventDefault(),F.stopPropagation(),$(ye),G({x:F.clientX,y:F.clientY}),L(!0)},O=F=>{if(!X)return;const ye=T.find(be=>be.id===X);if(ye){switch(F){case"tag":we(ye),Ue(!0);break;case"rotate":const be=T.find(qe=>qe.id===X);be&&(Y(be),A(!0));break;case"delete":confirm(`Radera "${ye.name}" permanent?`)&&Z(T.filter(qe=>qe.id!==ye.id));break}L(!1)}},te=(F,ye)=>{ye.stopPropagation(),Y(F),A(!0)},ke=(F,ye)=>{if(!B)return;const be=new FileReader;be.onloadend=()=>{const qe=be.result;if(ye){const jt=Date.now(),Bt={...B,id:jt,url:qe,name:`${B.name.replace(/\.[^/.]+$/,"")}_redigerad.jpg`};Z([...T,Bt])}else Z(T.map(jt=>jt.id===B.id?{...jt,url:qe}:jt));Y(null),A(!1)},be.readAsDataURL(F)},U=()=>{if(!B)return;if(J!==B.id){de(B.id),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>de(null),4e3),typeof u=="function"&&u('Klicka "Ta bort" igen fr att bekrfta.',"warn");return}w.current&&(clearTimeout(w.current),w.current=null),de(null);const F=B,ye=_t.findIndex(be=>be.id===F.id);Z(be=>be.filter(qe=>qe.id!==F.id)),A(!1),Y(null),we(be=>be&&be.id===F.id?null:be),typeof u=="function"&&u(`"${F.name}" har raderats.`,"success"),typeof d=="function"&&d(`"${F.name}" har raderats. ngra?`,()=>{Z(be=>{if(be.some(Bt=>Bt.id===F.id))return be;const qe=[...be],jt=ye>=0?Math.min(ye,qe.length):qe.length;return qe.splice(jt,0,F),qe}),we(F)})},[ge,Ee]=C.useState([{id:"album1",label:"Oknda soldater",icon:$h,type:"custom"}]),[ie,Ie]=C.useState(new Set),[P,we]=C.useState(null),[ue,Ue]=C.useState(!1),[Q,re]=C.useState(null),[Ce,Ye]=C.useState(!1),[Ve,ft]=C.useState(null),[dt,xt]=C.useState(!0),[lt,bt]=C.useState(!1),[ot,fe]=C.useState(null),[ze,Me]=C.useState(""),[He,et]=C.useState(!1),[st,rt]=C.useState(!1),[ht,St]=C.useState({x:0,y:0,scale:1,rotate:0}),[ee,oe]=C.useState(!1);C.useRef({x:0,y:0});const xe=C.useRef(null),$e=C.useRef(null),Xt=[...Cp,...ge],Ot=P?T.find(F=>F.id===P.id)||P:null,_t=T.filter(F=>{const ye=g==="all"||F.libraryId===g,be=N.toLowerCase(),qe=!be||F.name.toLowerCase().includes(be)||F.date.includes(be)||F.tags.some(Bt=>Bt.toLowerCase().includes(be))||F.connections.people.some(Bt=>Bt.name.toLowerCase().includes(be)||Bt.ref.toLowerCase().includes(be))||F.transcription&&F.transcription.toLowerCase().includes(be),jt=D?F.connections.people.length===0&&F.connections.places.length===0&&F.connections.sources.length===0:!0;return ye&&qe&&jt}),xn=B?_t.findIndex(F=>F.id===B.id):-1,bn=xn>0?_t[xn-1]:null,Cn=xn>=0&&xn<_t.length-1?_t[xn+1]:null,ss=()=>{bn&&(Y(bn),we(bn))},Gs=()=>{Cn&&(Y(Cn),we(Cn))};C.useEffect(()=>{if(!H)return;const F=be=>{L(!1)},ye=be=>{be.key==="Escape"&&L(!1)};return document.addEventListener("click",F),document.addEventListener("keydown",ye),()=>{document.removeEventListener("click",F),document.removeEventListener("keydown",ye)}},[H]),C.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const Re=()=>{const F=`lib_${Date.now()}`,ye={id:F,label:"Nytt Album",icon:$h,type:"custom"};Ee([...ge,ye]),fe(F),Me("Nytt Album"),setTimeout(()=>$e.current?.select(),50)},Le=()=>{ot&&ze.trim()&&Ee(F=>F.map(ye=>ye.id===ot?{...ye,label:ze}:ye)),fe(null)},Jt=F=>{F.key==="Enter"&&Le(),F.key==="Escape"&&fe(null)},Gt=(F,ye)=>{ye.stopPropagation(),confirm("Vill du radera detta album? Bilder inuti raderas inte utan hamnar i 'Alla bilder'.")&&(Ee(be=>be.filter(qe=>qe.id!==F)),Z(T.map(be=>be.libraryId===F?{...be,libraryId:"gallery"}:be)),g===F&&b("all"))},Yt=(F,ye)=>{console.log(" Image clicked:",{itemId:F.id,itemName:F.name,mediaItemsCount:T.length});let be=new Set(ie);if(ye.ctrlKey||ye.metaKey)be.has(F.id)?be.delete(F.id):be.add(F.id),re(F.id);else if(ye.shiftKey&&Q){const qe=_t.map(fl=>fl.id),jt=qe.indexOf(Q),Bt=qe.indexOf(F.id);if(jt!==-1&&Bt!==-1){const fl=Math.min(jt,Bt),Rs=Math.max(jt,Bt);qe.slice(fl,Rs+1).forEach(rs=>be.add(rs))}else be=new Set([F.id])}else be=new Set([F.id]),re(F.id);if(Ie(be),St({x:0,y:0,scale:1,rotate:0}),be.size===1){const qe=T.find(jt=>jt.id===Array.from(be)[0]);console.log(" Setting selectedImage:",{found:qe,findId:Array.from(be)[0]}),we(qe)}else console.log(" Multiple selected, setting to item or null:",be.has(F.id)),we(be.has(F.id)?F:null);v(be.size>0)},yn=()=>{ie.size===_t.length?(Ie(new Set),v(!1)):(Ie(new Set(_t.map(F=>F.id))),v(!0))},$n=F=>{const ye=new Set(ie);ye.has(F)?ye.delete(F):ye.add(F),Ie(ye)},Qt=()=>{confirm(`Radera ${ie.size} bilder permanent?`)&&(Z(T.filter(F=>!ie.has(F.id))),Ie(new Set),v(!1),we(null))},ws=F=>{Z(T.map(ye=>ie.has(ye.id)?{...ye,libraryId:F}:ye)),Ie(new Set),v(!1),et(!1)},En=(F,ye)=>{let be=[];ie.has(ye)?be=Array.from(ie):(be=[ye],Ie(new Set([ye])),we(T.find(qe=>qe.id===ye))),F.dataTransfer.setData("application/json",JSON.stringify({ids:be})),F.dataTransfer.effectAllowed="move"},Ys=(F,ye)=>{Z(T.map(be=>ye.includes(be.id)?{...be,libraryId:F}:be))},ls=({date:F,tags:ye})=>{const be=ye.split(",").map(qe=>qe.trim()).filter(qe=>qe);Z(T.map(qe=>ie.has(qe.id)?{...qe,date:F||qe.date,tags:[...new Set([...qe.tags,...be])]}:qe)),rt(!1),Ie(new Set),v(!1)},zt=async F=>{const ye=[];for(const be of Array.from(F)){let qe=be.name,jt=!1,Bt=null,fl=be.size,Rs={width:0,height:0};if(window.electronAPI)try{if(be.path&&window.electronAPI.copyFileToMedia){console.log("[MediaManager] Copying file from path:",be.path,"->",be.name);const Xe=await window.electronAPI.copyFileToMedia(be.path,be.name);Xe.success&&(qe=Xe.filePath,console.log("[MediaManager] File copied to media folder:",qe),jt=!0)}if(!jt&&window.electronAPI.saveFileBufferToMedia){console.log("[MediaManager] Reading file as buffer:",be.name);const Xe=await be.arrayBuffer(),as=new Uint8Array(Xe);console.log("[MediaManager] Saving buffer to media folder:",be.name,"Size:",as.length);const pn=await window.electronAPI.saveFileBufferToMedia(as,be.name);if(pn.success)qe=pn.filePath,console.log("[MediaManager] File buffer saved to media folder:",qe),jt=!0;else{console.error("[MediaManager] Failed to save buffer:",pn.error),alert(`Kunde inte spara fil ${be.name}: ${pn.error}`);continue}}}catch(Xe){console.error("[MediaManager] Error handling file:",Xe),alert(`Fel vid hantering av ${be.name}: ${Xe.message}`);continue}const Ss=qe?qe.split(/[/\\]/).pop():be.name,rs=jt?`media://${encodeURIComponent(Ss)}`:URL.createObjectURL(be);try{const Xe=new Image;await new Promise((as,pn)=>{Xe.onload=()=>{Rs={width:Xe.width,height:Xe.height};const Mt=document.createElement("canvas"),On=200;let is=Xe.width,vn=Xe.height;is>vn?is>On&&(vn*=On/is,is=On):vn>On&&(is*=On/vn,vn=On),Mt.width=is,Mt.height=vn,Mt.getContext("2d").drawImage(Xe,0,0,is,vn),Bt=Mt.toDataURL("image/jpeg",.8),!jt&&rs.startsWith("blob:")&&URL.revokeObjectURL(rs),as()},Xe.onerror=pn,Xe.src=rs})}catch(Xe){console.error("[MediaManager] Error generating thumbnail:",Xe)}const qn={id:Date.now()+Math.random(),url:rs,filePath:Ss,name:be.name,date:new Date().toISOString().split("T")[0],libraryId:g==="all"?"gallery":g,isProfile:!1,connections:{people:[],places:[],sources:[]},tags:["Ny uppladdning"],faces:[],transcription:"",description:"",thumbnail:Bt,fileSize:fl,dimensions:Rs};ye.push(qn),jt&&window.electronAPI&&window.electronAPI.readExif&&(console.log("[MediaManager] Reading EXIF for:",qe),window.electronAPI.readExif(Ss).then(Xe=>{if(console.log("[MediaManager] EXIF loaded for",qe,":",Xe),Xe.error){console.warn("[MediaManager] EXIF error:",Xe.error);return}Z(as=>as.map(pn=>{if(pn.filePath===qe){const Mt={...pn,connections:pn.connections||{people:[],places:[],sources:[]}};if(Xe.keywords&&Xe.keywords.length>0&&(Mt.tags=[...new Set([...pn.tags||[],...Xe.keywords])]),!Mt.description){const On=Xe.metadata||{};On.title?Mt.description=On.title:On.description&&(Mt.description=On.description)}if(Xe.gps&&!Mt.gps&&(Mt.gps=Xe.gps),Xe.camera&&!Mt.camera&&(Mt.camera=Xe.camera),Xe.metadata&&(Xe.metadata.datetime||Xe.metadata.date_taken)){const On=new Date().toISOString().split("T")[0];if(Mt.date===On){const is=Xe.metadata.datetime||Xe.metadata.date_taken;Mt.date=is.split(" ")[0].replace(/:/g,"-")}}return Mt}return pn}))}).catch(Xe=>{console.error("[MediaManager] Failed to read EXIF (kr Python API-servern?):",Xe)}))}ye.length>0&&Z([...ye,...T])};return C.useEffect(()=>{const F=ye=>{const be=ye.clipboardData.items,qe=[];for(let jt=0;jt<be.length;jt++)be[jt].type.indexOf("image")!==-1&&qe.push(be[jt].getAsFile());qe.length>0&&(ye.preventDefault(),zt(qe))};return window.addEventListener("paste",F),()=>window.removeEventListener("paste",F)},[g]),C.useEffect(()=>{if(!P){ft(null);return}bt(!0),ft(null),(async()=>{try{let ye=P.filePath||P.name;if((ye.startsWith("blob:")||ye.startsWith("http")||ye.startsWith("media://"))&&(ye=P.name),ye.includes("/")||ye.includes("\\")){const qe=ye.replace(/\\/g,"/").split("/");ye=qe[qe.length-1]}console.log("[MediaManager] Auto-loading EXIF for:",ye);let be;window.electronAPI&&window.electronAPI.readExif?be=await window.electronAPI.readExif(ye):be=await(await fetch("http://localhost:5005/exif/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_path:ye})})).json(),be.error||(console.log("[MediaManager] EXIF loaded:",be),ft(be),(be.keywords||be.face_tags||be.metadata)&&Z(qe=>qe.map(jt=>{if(jt.id!==P.id)return jt;const Bt={...jt};return be.keywords&&be.keywords.length&&(Bt.tags=[...new Set([...jt.tags||[],...be.keywords])]),be.face_tags&&be.face_tags.length&&(Bt.faces=be.face_tags),be.metadata&&(!Bt.date&&be.metadata.date_taken&&(Bt.date=be.metadata.date_taken),Bt.description||(be.metadata.title?Bt.description=be.metadata.title:be.metadata.description&&(Bt.description=be.metadata.description))),Bt})))}catch(ye){console.warn("[MediaManager] Auto EXIF load failed:",ye)}finally{bt(!1)}})()},[P]),C.useEffect(()=>{if(P&&P.id){const F=T.find(ye=>ye.id===P.id);F&&JSON.stringify(F)!==JSON.stringify(P)&&we(F)}},[T]),C.useEffect(()=>St({x:0,y:0,scale:1,rotate:0}),[P]),o.jsxs("div",{className:"flex flex-1 overflow-hidden w-full h-full bg-slate-900",children:[o.jsxs("div",{className:"w-64 bg-slate-800/50 border-r border-slate-700 flex flex-col shrink-0",children:[o.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[o.jsxs("div",{className:"p-2 space-y-1",children:[o.jsx("p",{className:"px-3 py-1 text-[10px] font-bold text-slate-500 uppercase",children:"Bibliotek"}),Cp.map(F=>o.jsx(Kv,{lib:F,isActive:g===F.id,onClick:()=>{b(F.id),we(null),v(!1),_(!1)},onDrop:Ys},F.id)),o.jsxs("button",{onClick:()=>{_(!D),b("all")},className:`flex items-center gap-3 w-full px-3 py-2 rounded text-sm transition-colors ${D?"bg-yellow-600/20 text-yellow-400 border border-yellow-600/50":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[o.jsx(vd,{size:16})," Okopplade (",T.filter(F=>F.connections.people.length===0&&F.connections.places.length===0&&F.connections.sources.length===0).length,")"]})]}),o.jsxs("div",{className:"p-2 space-y-1 border-t border-slate-700/50",children:[o.jsxs("div",{className:"flex justify-between items-center px-3 py-1",children:[o.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Mina Album"}),o.jsx("button",{onClick:Re,className:"text-slate-500 hover:text-white bg-slate-800 p-1 rounded hover:bg-slate-700 transition-colors",children:o.jsx(gl,{size:12})})]}),ge.map(F=>o.jsx("div",{children:ot===F.id?o.jsxs("div",{className:"flex items-center gap-2 w-full px-2 py-1",children:[o.jsx($h,{size:16,className:"text-blue-400 shrink-0"}),o.jsx("input",{ref:$e,type:"text",value:ze,onChange:ye=>Me(ye.target.value),onBlur:Le,onKeyDown:Jt,className:"w-full bg-slate-900 text-white text-sm px-1 py-0.5 rounded border border-blue-500 focus:outline-none"})]}):o.jsx(Kv,{lib:F,isActive:g===F.id,onClick:()=>{b(F.id),v(!1),_(!1)},onDelete:Gt,onDrop:Ys})},F.id))]})]}),o.jsxs("div",{className:"p-4 border-t border-slate-700",children:[o.jsx("input",{type:"file",ref:xe,className:"hidden",multiple:!0,accept:"image/*",onChange:F=>zt(F.target.files)}),o.jsxs("button",{onClick:async()=>{if(window.electronAPI&&window.electronAPI.importImages)try{const F=await window.electronAPI.importImages();if(!F.canceled&&F.success&&F.files){const ye=F.files.map(be=>({id:Date.now()+Math.random(),url:`media://${encodeURIComponent(be.fileName)}`,filePath:be.filePath,name:be.fileName,date:new Date().toISOString().split("T")[0],libraryId:g==="all"?"gallery":g,isProfile:!1,connections:{people:[],places:[],sources:[]},tags:["Ny uppladdning"],faces:[],transcription:"",description:""}));Z([...ye,...T])}}catch(F){console.error("[MediaManager] Import error:",F),alert(`Fel vid import: ${F.message}`)}else xe.current.click()},className:"flex items-center justify-center gap-2 w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded text-sm transition-colors font-medium",children:[o.jsx(Gb,{size:16})," Ladda upp"]})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col bg-slate-900 min-w-0 relative",children:[o.jsxs("div",{className:"h-14 border-b border-slate-700 flex items-center justify-between px-4 bg-slate-800/30",children:[o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsx("button",{onClick:()=>{v(!y),Ie(new Set),we(null)},className:`px-3 py-1.5 rounded text-sm border transition-colors ${y?"bg-blue-600 border-blue-500 text-white":"border-slate-600 text-slate-300 hover:border-slate-400 hover:text-white"}`,children:y?"Klar":"Vlj"}),o.jsx("button",{onClick:yn,className:"text-xs text-slate-400 hover:text-white px-2",children:ie.size===_t.length?"Avmarkera alla":"Markera alla"})]}),o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsxs("div",{className:"relative w-48",children:[o.jsx(Fr,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),o.jsx("input",{type:"text",placeholder:"Sk...",value:N,onChange:F=>S(F.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-full pl-9 pr-3 py-1.5 text-sm text-slate-200 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{className:"flex items-center bg-slate-950 rounded-lg p-1 border border-slate-700",children:[o.jsx("button",{onClick:()=>p("grid"),className:`p-1.5 rounded ${h==="grid"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:o.jsx(n1,{size:16})}),o.jsx("button",{onClick:()=>p("list"),className:`p-1.5 rounded ${h==="list"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:o.jsx(mm,{size:16})})]})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar relative",onDragOver:F=>{F.preventDefault(),E(!0)},onDragLeave:F=>{F.preventDefault(),E(!1)},onDrop:F=>{F.preventDefault(),E(!1),F.dataTransfer.files.length>0&&zt(F.dataTransfer.files)},children:[j&&o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-blue-900/20 backdrop-blur-sm border-2 border-blue-500 border-dashed m-4 rounded-xl pointer-events-none",children:o.jsxs("div",{className:"text-center text-blue-400",children:[o.jsx(Gb,{size:64,className:"mx-auto mb-2"}),o.jsx("h3",{className:"font-bold",children:"Slpp filerna hr"})]})}),_t.length===0&&o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[o.jsx(US,{size:48,className:"mb-2 opacity-20"}),o.jsx("p",{className:"text-sm",children:"Inga bilder hittades."})]}),h==="grid"?o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:_t.map(F=>o.jsxs("div",{onClick:ye=>Yt(F,ye),onDoubleClick:ye=>te(F,ye),onContextMenu:ye=>pe(ye,F.id),draggable:!0,onDragStart:ye=>En(ye,F.id),className:`group relative aspect-square rounded-lg border-2 overflow-hidden cursor-pointer transition-all ${ie.has(F.id)?"border-blue-500 ring-2 ring-blue-500/30":P?.id===F.id?"border-blue-500":"border-slate-700 hover:border-slate-500"}`,children:[o.jsx("img",{src:F.url,alt:F.name,className:"w-full h-full object-cover",onContextMenu:ye=>pe(ye,F.id)}),(y||ie.has(F.id))&&o.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:ye=>{ye.stopPropagation(),$n(F.id)},children:ie.has(F.id)?o.jsx("div",{className:"bg-blue-600 rounded text-white shadow-lg",children:o.jsx(Jb,{size:24,fill:"currentColor",className:"text-white"})}):o.jsx("div",{className:"bg-black/40 rounded hover:bg-black/70 shadow-lg",children:o.jsx(Qb,{size:24,className:"text-white"})})}),F.connections.people.length===0&&F.connections.places.length===0&&F.connections.sources.length===0&&o.jsx("div",{className:"absolute top-2 left-2 bg-yellow-600 text-white p-1 rounded-full shadow-md",title:"Okopplad",children:o.jsx(vd,{size:10})}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-2 pointer-events-none",children:o.jsx("p",{className:"text-white text-xs font-medium truncate",children:F.name})})]},F.id))}):o.jsx("div",{className:"flex flex-col gap-1",children:_t.map(F=>o.jsxs("div",{onClick:ye=>Yt(F,ye),onDoubleClick:ye=>te(F,ye),draggable:!0,onDragStart:ye=>En(ye,F.id),className:`flex items-center gap-4 p-2 rounded border cursor-pointer ${ie.has(F.id)?"bg-blue-900/30 border-blue-500":P?.id===F.id?"bg-slate-800 border-blue-500":"bg-slate-800/30 border-slate-700 hover:bg-slate-800"}`,children:[o.jsx("div",{className:"w-8 flex justify-center",children:(y||ie.has(F.id))&&(ie.has(F.id)?o.jsx(Jb,{size:18,className:"text-blue-500"}):o.jsx(Qb,{size:18,className:"text-slate-500"}))}),o.jsx("div",{className:"w-10 h-10 bg-slate-900 rounded overflow-hidden shrink-0 border border-slate-600",children:o.jsx("img",{src:F.url,className:"w-full h-full object-cover pointer-events-none"})}),o.jsx("span",{className:"text-sm text-slate-200 flex-1 truncate font-medium",children:F.name}),o.jsx("span",{className:"text-xs text-slate-500",children:F.date}),o.jsx("span",{className:"text-xs text-slate-400 bg-slate-800 px-2 py-0.5 rounded border border-slate-700",children:Xt.find(ye=>ye.id===F.libraryId)?.label||"Oknt"}),F.connections.people.length===0&&o.jsx(vd,{size:14,className:"text-yellow-500",title:"Okopplad"})]},F.id))})]}),ie.size>0&&o.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-800 border border-slate-600 text-white px-2 py-1.5 rounded-full shadow-2xl flex gap-2 items-center z-50",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-300 px-2 border-r border-slate-600",children:[ie.size," valda"]}),o.jsxs("button",{onClick:()=>rt(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs hover:bg-slate-700 rounded-full transition-colors",children:[o.jsx(gm,{size:14})," Redigera"]}),o.jsxs("button",{onClick:()=>et(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs hover:bg-slate-700 rounded-full transition-colors",children:[o.jsx(bj,{size:14})," Flytta"]}),o.jsxs("button",{onClick:Qt,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs hover:bg-red-900/50 text-red-400 hover:text-red-300 rounded-full transition-colors",children:[o.jsx(ol,{size:14})," Radera"]})]}),o.jsx(ZO,{isOpen:He,onClose:()=>et(!1),onMove:ws,libraries:Xt}),o.jsx(WO,{isOpen:st,onClose:()=>rt(!1),onSave:ls,count:ie.size})]}),Ot?o.jsxs("div",{className:"w-96 bg-slate-800 border-l border-slate-700 flex flex-col shrink-0 z-20 shadow-xl",children:[o.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between bg-slate-800",children:[o.jsx("h3",{className:"text-sm font-bold text-white truncate w-64",children:Ot.name}),o.jsx("button",{onClick:()=>we(null),className:"text-slate-400 hover:text-white",children:o.jsx(ys,{size:18})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar bg-slate-800",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 block mb-1",children:"Datering"}),o.jsxs("div",{className:"flex items-center bg-slate-900 border border-slate-600 rounded px-2 py-1.5",children:[o.jsx(e1,{size:14,className:"text-slate-500 mr-2"}),o.jsx("input",{type:"text",defaultValue:Ot.date,className:"bg-transparent text-sm text-white w-full focus:outline-none"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 block mb-1",children:"Bibliotek / Kategori"}),o.jsxs("select",{defaultValue:Ot.libraryId,className:"w-full bg-slate-900 border border-slate-600 rounded px-2 py-1.5 text-sm text-white focus:outline-none focus:border-blue-500",children:[Cp.filter(F=>F.id!=="all").map(F=>o.jsx("option",{value:F.id,children:F.label},F.id)),ge.map(F=>o.jsx("option",{value:F.id,children:F.label},F.id))]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-500 block mb-1",children:"Bildtext / Beskrivning"}),o.jsx("div",{className:"bg-slate-900 border border-slate-600 rounded p-2",children:o.jsx("textarea",{className:"w-full bg-transparent text-sm text-white focus:outline-none resize-y min-h-[60px]",placeholder:"Skriv en beskrivning...",defaultValue:Ot.description})})]}),Ot.libraryId==="sources"&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Transkribering"}),o.jsxs("button",{onClick:()=>Ye(!Ce),className:"text-xs flex items-center gap-1 text-blue-400 hover:text-white",children:[o.jsx(kj,{size:12})," ",Ce?"Dlj":"Visa / Redigera"]})]}),Ce&&o.jsx("textarea",{className:"w-full h-32 bg-slate-900 border border-slate-700 rounded p-2 text-sm text-slate-300 focus:outline-none focus:border-blue-500",placeholder:"Skriv av texten hr...",defaultValue:Ot.transcription})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("h4",{className:"text-[10px] font-bold text-slate-500 uppercase border-b border-slate-700 pb-1",children:"Kopplingar"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"Personer"})}),Ot.connections.people.map(F=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-700 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-200 font-medium block",children:F.name}),o.jsx("span",{className:"text-[10px] text-slate-500",children:F.dates})]}),o.jsx("button",{className:"text-slate-500 hover:text-red-400",children:o.jsx(ys,{size:12})})]},F.id)),o.jsxs("button",{className:"w-full py-1.5 border border-dashed border-slate-600 text-slate-400 text-xs rounded hover:text-white hover:border-slate-500 hover:bg-slate-700 transition-colors flex items-center justify-center gap-1",children:[o.jsx(gl,{size:12})," Koppla person"]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"Kllor"})}),Ot.connections.sources.map((F,ye)=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-700 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-200 font-medium block",children:F.name||F.title||"Ingen titel"}),o.jsx("span",{className:"text-[10px] text-slate-500",children:F.ref||F.reference||"Ingen ref"})]}),o.jsx("button",{className:"text-slate-500 hover:text-red-400",children:o.jsx(ys,{size:12})})]},F.id||ye)),o.jsxs("button",{onClick:()=>a(Ot),className:"w-full py-1.5 border border-dashed border-slate-600 text-slate-400 text-xs rounded hover:text-white hover:border-slate-500 hover:bg-slate-700 transition-colors flex items-center justify-center gap-1",children:[o.jsx(Po,{size:12})," Koppla klla"]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"Platser"})}),Ot.connections.places.map(F=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-700 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-200 font-medium block",children:F.name}),o.jsx("span",{className:"text-[10px] text-slate-500",children:F.type})]}),o.jsx("button",{onClick:()=>{Z(ye=>ye.map(be=>be.id!==Ot.id?be:{...be,connections:{...be.connections,places:be.connections.places.filter(qe=>qe.id!==F.id)}}))},className:"text-slate-500 hover:text-red-400",children:o.jsx(ys,{size:12})})]},F.id)),o.jsxs("button",{onClick:()=>i(Ot),className:"w-full py-1.5 border border-dashed border-slate-600 text-slate-400 text-xs rounded hover:text-white hover:border-slate-500 hover:bg-slate-700 transition-colors flex items-center justify-center gap-1",children:[o.jsx(Ni,{size:12})," Koppla plats"]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Taggar"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.tags.map(F=>o.jsxs("span",{className:"bg-slate-700 text-slate-300 text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[F," ",o.jsx("button",{className:"hover:text-white",children:o.jsx(ys,{size:10})})]},F)),o.jsx("button",{className:"text-xs text-slate-400 bg-slate-900 border border-slate-700 px-2 py-0.5 rounded-full hover:text-white hover:border-slate-500",children:"+ Tagg"})]})]}),o.jsxs("div",{className:"space-y-3 border-t border-slate-700 pt-4",children:[o.jsxs("h4",{className:"text-[10px] font-bold text-slate-500 uppercase flex items-center gap-2",children:[o.jsx(Mp,{size:12})," EXIF & Metadata"]}),Ve?o.jsxs("div",{className:"space-y-3",children:[Ve.face_tags&&Ve.face_tags.length>0?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1",children:[o.jsx(Tp,{size:12})," Face Tags"]}),Ve.face_tags.map((F,ye)=>o.jsxs("div",{className:"flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-700 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-200 font-medium block",children:F.name}),o.jsx("span",{className:"text-[10px] text-slate-500",children:F.source})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{className:"text-green-400 hover:text-green-300 p-1",title:"Lnka till person",children:o.jsx(Po,{size:12})}),o.jsx("button",{className:"text-slate-500 hover:text-red-400 p-1",children:o.jsx(ys,{size:12})})]})]},ye))]}):o.jsx("p",{className:"text-[11px] text-slate-500",children:"Inga face tags hittades i EXIF."}),!T.find(F=>F.id===P?.id)?.tags?.length&&Ve.keywords&&Ve.keywords.length>0?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1",children:[o.jsx(i1,{size:12})," Keywords (EXIF)"]}),o.jsx("div",{className:"flex flex-wrap gap-1",children:Ve.keywords.map((F,ye)=>o.jsxs("span",{className:"bg-blue-900/30 border border-blue-700/50 text-blue-300 text-xs px-2 py-0.5 rounded flex items-center gap-1",children:[F,o.jsx("button",{className:"hover:text-white",children:o.jsx(ys,{size:10})})]},ye))})]}):o.jsx("p",{className:"text-[11px] text-slate-500",children:"Inga keywords hittades i EXIF."}),Ve.metadata&&Object.keys(Ve.metadata).length>0&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("label",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1",children:[o.jsx(oj,{size:12})," Metadata"]}),o.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded p-2 text-xs space-y-1",children:[Ve.metadata.date_taken&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-500",children:"Datum:"})," ",o.jsx("span",{className:"text-slate-300",children:Ve.metadata.date_taken})]}),Ve.metadata.title&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-500",children:"Titel:"})," ",o.jsx("span",{className:"text-slate-300",children:Ve.metadata.title})]}),Ve.metadata.description&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-500",children:"Beskrivning:"})," ",o.jsx("span",{className:"text-slate-300",children:Ve.metadata.description})]}),Ve.metadata.artist&&o.jsxs("div",{children:[o.jsx("span",{className:"text-slate-500",children:"Artist:"})," ",o.jsx("span",{className:"text-slate-300",children:Ve.metadata.artist})]})]})]}),Ve.gps&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("label",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1",children:[o.jsx(Ni,{size:12})," GPS-koordinater"]}),o.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded p-2 text-xs",children:[o.jsxs("div",{className:"text-slate-300 font-mono",children:[Ve.gps.latitude.toFixed(6),", ",Ve.gps.longitude.toFixed(6)]}),Ve.gps.altitude&&o.jsxs("div",{className:"text-slate-400 text-[10px] mt-1",children:["Hjd: ",Ve.gps.altitude.toFixed(0),"m"]})]})]})]}):o.jsx("div",{className:"text-center py-4 text-slate-500 text-xs",children:"Laddar EXIF-data automatiskt..."})]})]}),o.jsxs("div",{className:"p-4 border-t border-slate-700 bg-slate-900 flex justify-between items-center",children:[o.jsxs("button",{onClick:()=>{P&&confirm(`r du sker p att du vill ta bort "${P.name}"?`)&&(Z(F=>F.filter(ye=>ye.id!==P.id)),we(null))},className:"px-3 py-1.5 bg-red-900/30 border border-red-700/50 text-red-300 text-xs rounded hover:bg-red-900/50 hover:border-red-600 transition-colors flex items-center gap-1 font-medium",children:[o.jsx(ol,{size:14})," Ta bort fil"]}),o.jsxs("button",{onClick:()=>{if(P){const F=document.querySelector('input[type="text"][value*="'+(P.date||"")+'"]')?.value||P.date,ye=document.querySelector('textarea[placeholder="Skriv en beskrivning..."]')?.value||P.description;Z(be=>be.map(qe=>qe.id!==P.id?qe:{...qe,date:F,description:ye})),console.log("[MediaManager] Sparade:",{name:P.name,date:F,description:ye,tags:P.tags,faces:P.faces}),alert("Bilden sparad!")}},className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-xs font-bold flex items-center gap-1 shadow-lg shadow-blue-900/20 transition-all hover:scale-[1.02]",children:[o.jsx(a1,{size:14})," Spara"]})]})]}):o.jsx("div",{className:"w-96 bg-slate-800 border-l border-slate-700 flex flex-col shrink-0 z-20 shadow-xl p-4",children:o.jsx("p",{className:"text-slate-400 text-sm",children:"Vlj en bild"})}),o.jsx(l0,{isOpen:ue,onClose:()=>Ue(!1),imageSrc:P?.url,imageTitle:P?.name,regions:P?.faces||[],onSaveRegions:F=>{P&&(Z(T.map(ye=>ye.id===P.id?{...ye,faces:F}:ye)),we({...P,faces:F}))},people:n,onOpenEditModal:e}),o.jsx(QO,{isOpen:R,onClose:()=>{A(!1),Y(null),de(null)},imageUrl:B?.url,imageName:B?.name,onSave:ke,onPrev:ss,onNext:Gs,hasPrev:!!bn,hasNext:!!Cn,onDelete:U,isConfirmingDelete:J===B?.id}),H&&o.jsxs("div",{className:"fixed bg-slate-800 border border-slate-600 rounded-lg shadow-2xl py-1 z-[10000]",style:{left:`${V.x}px`,top:`${V.y}px`},children:[o.jsxs("button",{onClick:()=>O("tag"),className:"w-full px-4 py-2 text-left text-sm text-white hover:bg-slate-700 flex items-center gap-2",children:[o.jsx(Tp,{size:16}),"Tagga"]}),o.jsxs("button",{onClick:()=>O("rotate"),className:"w-full px-4 py-2 text-left text-sm text-white hover:bg-slate-700 flex items-center gap-2",children:[o.jsx(Ap,{size:16}),"Rotera"]}),o.jsxs("button",{onClick:()=>O("delete"),className:"w-full px-4 py-2 text-left text-sm text-white hover:bg-slate-700 flex items-center gap-2",children:[o.jsx(ol,{size:16}),"Radera"]})]})]})}function t5({onClose:n,onImportSources:e}){const[t,l]=C.useState(""),[a,i]=C.useState(null),[d,u]=C.useState([]),[h,p]=C.useState(!1),[g,b]=C.useState(!1),[y,v]=C.useState({current:0,total:0}),[N,S]=C.useState(null),[j,E]=C.useState({all:!0,births:!1,weddings:!1,deaths:!1,households:!1,mantalslengd:!1,court:!1}),D=async()=>{if(t.trim()){S(null),p(!0);try{const $=new URLSearchParams({verb:"ListSets",metadataPrefix:"oai_ape_ead"}),R=await fetch(`http://localhost:5006/oai-pmh?${$}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!R.ok)throw new Error(`HTTP ${R.status}`);const A=await R.json();if(A.error)throw new Error(A.error);const B=(A.sets||[]).filter(Y=>Y.setName.toLowerCase().includes(t.toLowerCase()));B.length===0&&S(`Inga arkiv hittade fr "${t}"`),u(B)}catch($){console.error("Skning misslyckades:",$),S(`Skning misslyckades: ${$.message}`),u([])}finally{p(!1)}}},_=async()=>{if(a){S(null),b(!0),v({current:0,total:0});try{const $=new URLSearchParams({verb:"ListIdentifiers",metadataPrefix:"oai_ape_ead",set:a.setSpec}),R=await fetch(`http://localhost:5006/oai-pmh?${$}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!R.ok)throw new Error(`HTTP ${R.status}`);const A=await R.json();if(A.error)throw new Error(A.error);const B=A.records||[];if(B.length===0){S("Inga dokument hittades i detta arkiv"),b(!1);return}const Y=B.filter(T=>{const I=(T.identifier||"").toLowerCase(),Z=t.toLowerCase();return I.includes(Z)?j.all?!0:j.births&&(I.includes("fdelsebok")||I.includes("dopbok"))||j.weddings&&(I.includes("vigselbok")||I.includes("lysning"))||j.deaths&&(I.includes("ddbok")||I.includes("begrav"))||j.households&&(I.includes("husfrhrslngd")||I.includes("katekes"))||j.mantalslengd&&I.includes("mantalslngd")||j.court&&(I.includes("dombok")||I.includes("tingbok")):!1});if(Y.length===0){S("Inga dokument hittades som matchar din skning och filter"),b(!1);return}const J=Y.reduce((T,I)=>T+(I.pages?.length||1),0);v({current:0,total:J});const de=[];let w=0;Y.forEach(T=>{const I=H(T)||a.setName,Z=L(T),pe=V(T);(T.pages||[T.bildid||""]).forEach(te=>{w++,v(U=>({...U,current:w}));const ke=G(te);de.push({id:`oai_${T.identifier.replace(/[^a-zA-Z0-9]/g,"_")}_${ke}`,title:I,archiveTop:"Riksarkivet",archive:a.setName,volume:Z,date:pe||T.datestamp||"",bildid:te,note:"",dateAdded:new Date().toISOString(),trust:4,images:[],page:"",imagePage:ke,sourceString:"",otherInfo:"",nad:T.setSpec||""})})}),e&&e(de)}catch($){console.error("Skrding misslyckades:",$),S(`Skrding misslyckades: ${$.message}`)}finally{b(!1)}}},H=$=>{const A=($.identifier||"").match(/^([^,]+)/);return A?A[1].trim():""},L=$=>{const A=($.identifier||"").match(/([A-Z]+\s+[IVX]+\/?\d*)/);return A?A[1]:""},V=$=>{const A=($.identifier||"").match(/\((\d{4}[\-]\d{4})\)/);return A?A[1]:""},G=$=>{if(!$)return"";const R=$.match(/_(\d+)$/);return R?R[1]:""},X=$=>{E(R=>{if($==="all")return{all:!0,births:!1,weddings:!1,deaths:!1,households:!1,mantalslengd:!1,court:!1};const A={...R,all:!1,[$]:!R[$]};return A.births||A.weddings||A.deaths||A.households||A.mantalslengd||A.court?A:{all:!0,births:!1,weddings:!1,deaths:!1,households:!1,mantalslengd:!1,court:!1}})};return o.jsx(Vs,{title:"OAI-PMH arkivharvester",onClose:n,icon:HS,initialWidth:900,initialHeight:700,children:o.jsxs("div",{className:"flex flex-col h-full bg-slate-900",children:[o.jsxs("div",{className:"px-4 py-3 border-b border-slate-700 bg-slate-800/50",children:[o.jsx("h3",{className:"text-slate-200 font-semibold mb-2",children:"Sk arkiv frn Riksarkivet"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx(Fr,{className:"absolute left-3 top-2.5 text-slate-500",size:18}),o.jsx("input",{type:"text",placeholder:"T.ex. Svenstorp, Stockholm...",className:"w-full bg-slate-900 border border-slate-600 text-white pl-10 pr-4 py-2 rounded focus:ring-1 focus:ring-blue-500 outline-none text-sm placeholder-slate-500",value:t,onChange:$=>l($.target.value),onKeyDown:$=>$.key==="Enter"&&D()})]}),o.jsx(mt,{variant:"primary",onClick:D,disabled:h||!t.trim(),children:h?"Sker...":"Sk"})]})]}),N&&o.jsxs("div",{className:"px-4 py-2 bg-red-900/30 border-b border-red-700 text-red-300 text-sm flex items-center gap-2",children:[o.jsx(vd,{size:16}),N]}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:d.length===0&&!h?o.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500 gap-2 p-4",children:[o.jsx(Fr,{size:32,className:"opacity-20"}),o.jsx("span",{children:"Inga arkiv hittade. Sk fr att komma igng."})]}):o.jsx("div",{className:"space-y-2 p-3",children:d.map($=>o.jsxs("div",{onClick:()=>i($),className:`p-3 rounded border-2 cursor-pointer transition-colors ${a?.setSpec===$.setSpec?"bg-blue-900/30 border-blue-500":"bg-slate-800 border-slate-700 hover:bg-slate-700"}`,children:[o.jsx("div",{className:"font-medium text-slate-200",children:$.setName}),o.jsx("div",{className:"text-xs text-slate-500 mt-1",children:$.setSpec})]},$.setSpec))})}),a&&o.jsxs("div",{className:"px-4 py-3 border-t border-slate-700 bg-slate-800/50",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(JS,{size:16,className:"text-slate-500"}),o.jsx("span",{className:"text-slate-400 text-sm font-medium",children:"Filtrera dokumenttyper"})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"Alla"},{key:"births",label:"Fdelsebcker"},{key:"weddings",label:"Vigselbcker"},{key:"deaths",label:"Ddbcker"},{key:"households",label:"Husfrhrslngder"},{key:"mantalslengd",label:"Mantalslngder"},{key:"court",label:"Dombcker"}].map(({key:$,label:R})=>o.jsx("button",{onClick:()=>X($),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${j[$]?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:R},$))})]}),o.jsxs("div",{className:"px-4 py-3 border-t border-slate-700 bg-slate-800/50 flex items-center justify-between",children:[g&&o.jsxs("div",{className:"text-xs text-slate-400",children:["Skrdar: ",y.current," / ",y.total]}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(mt,{variant:"secondary",onClick:n,disabled:g,children:"Avbryt"}),o.jsx(mt,{variant:"primary",onClick:_,disabled:!a||g,children:g?"Skrdar...":"Parsa & Importera"})]})]})]})})}function n5(){const n=()=>window.confirm("Vill du verkligen skapa en ny databas? Osparad data kommer att g frlorad."),e=()=>{h(""),g(""),setEditingPerson(null),setActiveTab("people"),ls(null),ye(!1),qe(!1),Bt(!1),Rs(null),rs(!1),Xe(!0),pn(!1),On(!1),vn(!1),rr({isOpen:!1,preSelectedPersonId:null}),Zr(!1),Js(""),cs(null),Ol(!1),D({}),H({}),V(null),setSourcingEventInfo(null),yn(!1),setIsPlaceDrawerOpen(!1),$n("people"),setBookmarks([]),setFocusPair(null),setUndoState(null),setStatusToast(null),setBulkWarningsModal(!1),setHistoryState({past:[],future:[]}),yt({visible:!1,x:0,y:0,targetPersonId:null}),rn(null),Gt({}),setIsRelationshipDrawerOpen(!1)},{dbData:t,setDbData:l,fileHandle:a,isDirty:i,setIsDirty:d,newFirstName:u,setNewFirstName:h,newLastName:p,setNewLastName:g,showSettings:b,setShowSettings:y,editingPerson:v,activeTab:N,focusPair:S,bookmarks:j,sourceCatalogState:E,setSourceCatalogState:D,placeCatalogState:_,setPlaceCatalogState:H,familyTreeFocusPersonId:L,setFamilyTreeFocusPersonId:V,sourcingEventInfo:G,isSourceDrawerOpen:X,isPlaceDrawerOpen:$,isCreatingSource:R,sourceState:A,undoState:B,statusToast:Y,showStatus:J,bulkWarningsModal:de,closeBulkWarningsModal:w,historyState:T,isHistoryOpen:I,handleBack:Z,handleForward:pe,handleShowHistory:O,handleNewFile:te,handleOpenFile:ke,handleSaveFile:U,handleSaveFileAs:ge,handleAddPerson:Ee,handleDeletePerson:ie,handleOpenEditModal:Ie,handleCloseEditModal:P,handleSavePersonDetails:we,handleEditFormChange:ue,handleTabChange:Ue,handleDeleteEvent:Q,handleViewInFamilyTree:re,handleSaveRelations:Ce,handleToggleSourceDrawer:Ye,handleLinkSourceFromDrawer:Ve,handleUnlinkSourceFromDrawer:ft,handleLinkSourceToMedia:dt,handleLinkPlaceToMedia:xt,linkingMediaInfo:lt,openSourceDrawerForSelection:bt,handleCreateAndEditPerson:ot,handleOpenSourceModal:fe,handleCloseSourceModal:ze,handleSourceFormChange:Me,handleParseSource:He,handleSaveSource:et,handleSaveEditedSource:st,handleUndo:rt,handleDeleteSource:ht,addRelation:St,getPersonRelations:ee,handleSetFocusPair:oe,handleToggleBookmark:xe,handleAddNewPlace:$e,handleSavePlace:Xt,isAttachingSource:Ot,handleAttachSources:_t,handleSwitchToCreateSource:xn,handleNavigateToPlace:bn,handleTogglePlaceDrawer:Cn,openPlaceDrawerForSelection:ss,applyHistoryEntry:Gs,setAuditBackupDir:Re,isRelationshipDrawerOpen:Le,relationshipCatalogState:Jt,setRelationshipCatalogState:Gt,handleToggleRelationshipDrawer:Yt,setIsSourceDrawerOpen:yn,setCurrentView:$n}=Fs();if(!t){if(window.dbInitError)return o.jsxs("div",{style:{padding:40,textAlign:"center",color:"red"},children:["Kunde inte skapa ny databas:",o.jsx("br",{}),o.jsx("pre",{children:window.dbInitError.message})]});const ve=!!(window&&window.electronAPI&&typeof window.electronAPI.createNewDatabase=="function");return o.jsxs("div",{style:{padding:40,textAlign:"center"},children:[!ve&&o.jsxs("div",{style:{color:"red",fontWeight:"bold",fontSize:"2rem",marginBottom:24},children:[o.jsx("div",{children:"VARNING: Electron-API saknas!"}),o.jsx("div",{children:"Stng alla webblsarfnster och anvnd endast Electron-fnstret."}),o.jsx("div",{children:"Om felet kvarstr, bygg appen fr produktion."})]}),"Laddar databas..."]})}const Qt=()=>{P()},ws=!!(window&&window.electronAPI&&typeof window.electronAPI.saveFileAs=="function"),En=C.useRef(!1);ps.useEffect(()=>{if(ws&&window.electronAPI&&window.electronAPI.on){const ve=(Be,Fe)=>{Fe==="new-database"?n()&&Promise.resolve(te()).then(()=>{e()}):Fe==="open-database"?En.current||(En.current=!0,Promise.resolve(ke()).finally(()=>{En.current=!1})):Fe==="save-database"?U():Fe==="save-as-database"&&ge("menu")};return window.electronAPI.on("menu-action",ve),()=>{window.electronAPI.off("menu-action",ve)}}else if(window&&window.addEventListener){const ve=Be=>{!Be||!Be.detail||(Be.detail==="new-database"?n()&&Promise.resolve(te()).then(()=>{e()}):Be.detail==="save-database"?U():Be.detail==="save-as-database"&&ge("menu"))};return window.addEventListener("menu-action",ve),()=>{window.removeEventListener("menu-action",ve)}}},[U,ge,ws]);const[Ys,ls]=C.useState(null),zt=(t&&t.people?t.people:[]).find(ve=>ve.id===Ys)||null,[F,ye]=C.useState(!1),[be,qe]=C.useState(!1),[jt,Bt]=C.useState(!1),[fl,Rs]=C.useState(null),[Ss,rs]=C.useState(!1),[qn,Xe]=C.useState(!0),[as,pn]=C.useState(!1),[Mt,On]=C.useState(!1),[is,vn]=C.useState(!1),[Xs,rr]=C.useState({isOpen:!1,preSelectedPersonId:null}),[Dl,Zr]=C.useState(!1),[za,Js]=C.useState(t?.meta&&t.meta.auditBackupDir||""),[vl,cs]=C.useState(null),[ds,Ol]=C.useState(!1);C.useEffect(()=>{Js(t?.meta&&t.meta.auditBackupDir||"")},[t?.meta?.auditBackupDir]);const xs=ps.useMemo(()=>(t.people||[]).filter(ve=>Dl?!0:!ve._archived),[t.people,Dl]);C.useEffect(()=>{if(vl){const ve=t.people.find(Be=>Be.id===vl);ve&&(Ie(ve.id),cs(null))}},[vl,t.people]);const Wr=ps.useMemo(()=>{if(!G||!v)return[];const ve=v.events?.find(Be=>Be.id===G.eventId);return!ve||!ve.sources?[]:ve.sources.map(Be=>typeof Be=="object"?Be.sourceId:Be)},[G,v]),ar=()=>{G?(Ye(),setTimeout(()=>{typeof yn=="function"?yn(!1):Ye()},10)):typeof yn=="function"?yn(!1):Ye()},Rl=(ve=null)=>{rr({isOpen:!0,preSelectedPersonId:ve})},tc=(ve,Be)=>{const Fe=E.selectedSourceId;if(Fe){if(Be==="__create_new_event__"){Ie(ve);return}l(Ke=>{const vt=[...Ke.people],$t=vt.findIndex(Nn=>Nn.id===ve);if($t===-1)return Ke;const Ge={...vt[$t]},At=Ge.events.findIndex(Nn=>Nn.id===Be);if(At===-1)return Ke;const tn={...Ge.events[At]};return tn.sources||(tn.sources=[]),tn.sources.includes(Fe)?Ke:(tn.sources.push(Fe),Ge.events[At]=tn,vt[$t]=Ge,J("Klla kopplad till "+Ge.firstName),{...Ke,people:vt})}),d(!0),rr({isOpen:!1,preSelectedPersonId:null})}},us=(ve,Be,Fe)=>{l(Ke=>{const vt=[...Ke.people],$t=vt.findIndex(fn=>fn.id===ve);if($t===-1)return Ke;const Ge={...vt[$t]},At=Ge.events.findIndex(fn=>fn.id===Be);if(At===-1)return Ke;const tn={...Ge.events[At]};let Nn={...Ke},Mn=!1;tn.sources&&tn.sources.includes(Fe)&&(tn.sources=tn.sources.filter(fn=>fn!==Fe),Ge.events[At]=tn,vt[$t]=Ge,Nn.people=vt,Mn=!0);const Ft=(Ke.sources||[]).find(fn=>fn.id===Fe);if(Ft&&tn.type==="Bild"&&Array.isArray(Ft.images)){const fn=Ft.images.map(js=>Array.isArray(js.regions)?{...js,regions:js.regions.filter(Iu=>Iu.personId!==ve)}:js);Nn.sources=(Ke.sources||[]).map(js=>js.id===Fe?{...js,images:fn}:js),Mn=!0}return Mn?(J("Koppling borttagen."),Nn):Ke}),d(!0)},z=()=>{const ve=`src_${Date.now()}`,Be={id:ve,title:"Ny klla",archiveTop:"vrigt",archive:"",volume:"",page:"",note:"",aid:"",nad:"",bildid:"",imagePage:"",date:"",tags:"",dateAdded:new Date().toISOString(),trust:0};l(Fe=>({...Fe,sources:[...Fe.sources||[],Be]})),D(Fe=>({...Fe,selectedSourceId:ve,searchTerm:"",expanded:{...Fe.expanded,vrigt:!0}})),d(!0),J("Ny klla skapad.")},q=ve=>{const Be=t.sources.find(Fe=>Fe.id===ve);Be&&(D(Fe=>({...Fe,selectedSourceId:ve,searchTerm:Be.title||Be.id,expanded:{}})),v?X||(typeof yn=="function"?yn(!0):Ye()):Ue("sources"))},ne=(ve,Be)=>{const Fe=ve&&typeof ve=="object"?ve.id:ve;if(ls(Fe||null),Be&&Be.edit){rn({id:Fe,relation:Be.relation||null,targetId:Be.targetId||null});try{Fe&&!me.current[Fe]&&(me.current[Fe]={dbData:t,prevFocus:L,isEditSnapshot:!0})}catch{}}},se=()=>ls(null),me=C.useRef({}),Se=ve=>{const Be=t.people.find(Ke=>Ke.id===ve);if(!Be){se();return}const Fe=me.current[ve];if(Fe){l(Fe.dbData);try{V(Fe.prevFocus||null)}catch{}const Ke=Fe.prevFocus||null;delete me.current[ve],rn(null),ls(Ke||null),d(!0),J("ndringar avbrts.");return}if(Be._isPlaceholder){l(Ke=>({...Ke,people:(Ke.people||[]).filter(vt=>vt.id!==ve)})),rn(null),ls(null),d(!0),J("Skapandet av avbrts.");return}qn||se()},Oe=(ve,Be)=>{const Fe=Be._placeholderRelation,Ke=Be._placeholderTargetId;if(!Fe||!Ke)return ve;const vt=ve.findIndex(Nn=>Nn.id===Be.id),$t=ve.findIndex(Nn=>Nn.id===Ke);if(vt===-1||$t===-1)return ve;const Ge={...ve[vt]},At={...ve[$t]};Ge.relations=Ge.relations||{parents:[],children:[],spouseId:null},At.relations=At.relations||{parents:[],children:[],spouseId:null},Fe==="parent"?(At.relations.parents.includes(Ge.id)||At.relations.parents.push(Ge.id),Ge.relations.children.includes(At.id)||Ge.relations.children.push(At.id)):Fe==="child"?(At.relations.children.includes(Ge.id)||At.relations.children.push(Ge.id),Ge.relations.parents.includes(At.id)||Ge.relations.parents.push(At.id)):(Fe==="spouse"||Fe==="partner")&&(At.relations.spouseId=Ge.id,Ge.relations.spouseId=At.id);const tn=[...ve];return tn[vt]=Ge,tn[$t]=At,tn},Je=()=>{zt&&zt._isPlaceholder&&l(ve=>{let Be=(ve.people||[]).map(Fe=>({...Fe}));return Be=Oe(Be,zt),Be=Be.map(Fe=>Fe.id===zt.id?{...Fe,_isPlaceholder:!1,_placeholderRelation:void 0,_placeholderTargetId:void 0,_hideUntilEdit:!1}:Fe),{...ve,people:Be}}),zt&&me.current[zt.id]&&delete me.current[zt.id],rn(null),d(!1),J("Person sparad.")},Qe=ve=>{l(Be=>{let Fe=(Be.people||[]).map(Ke=>Ke.id===ve.id?{...ve}:{...Ke});return Fe=Oe(Fe,ve),{...Be,people:Fe}}),d(!0),J("Person sparad."),Qt()};C.useEffect(()=>{const ve=Be=>{if(Be.key==="Escape"){if(X){Be.preventDefault(),Be.stopPropagation(),ar();return}if($&&!Mt){Be.preventDefault(),Be.stopPropagation(),Cn(_.selectedPlaceId);return}zt&&!qn&&se()}};return window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve)},[X,$,zt,qn]),C.useEffect(()=>{const ve=Be=>{if(Be.button!==0||Be.target.closest(".modal-content")||Be.target.closest('[role="dialog"]')||!zt)return;const Fe=document.querySelector(".drawer-inner");if(Fe&&Fe.contains(Be.target))return;const Ke=document.querySelector('[data-family-tree="1"]');Ke&&Ke.contains(Be.target)||Se(zt.id)};return window.addEventListener("mousedown",ve,!0),()=>window.removeEventListener("mousedown",ve,!0)},[zt]);const[Te,yt]=C.useState({visible:!1,x:0,y:0,targetPersonId:null}),qt=(ve,Be,Fe)=>{const Ke=ve&&typeof ve=="object"?ve.id:ve;yt({visible:!0,x:Be,y:Fe,targetPersonId:Ke})},pt=()=>yt({visible:!1,x:0,y:0,targetPersonId:null}),[Pt,rn]=C.useState(null),ir=(ve,Be)=>{const Fe=t.people.reduce((vt,$t)=>$t.refNumber>vt?$t.refNumber:vt,0),Ke={id:`p_${Date.now()}`,refNumber:Fe+1,firstName:"",lastName:"",gender:"",events:[],notes:"",links:{},relations:{parents:[],children:[],spouseId:null}};Ke.firstName="",Ke._hideUntilEdit=!0,Ke._isPlaceholder=!0,Ke._placeholderRelation=Be,Be==="spouse"||Be==="partner"?Ke._placeholderSide="left":Be==="sibling"?Ke._placeholderSide="right":Be==="parent"?Ke._placeholderSide="above":Be==="child"&&(Ke._placeholderSide="below"),Ke._placeholderTargetId=ve,l(vt=>{me.current[Ke.id]={dbData:vt,prevFocus:L};let Ge=(vt.people||[]).some(Ft=>Ft.id===Ke.id)?[...vt.people]:[...vt.people||[],Ke];const At=Ge.findIndex(Ft=>Ft.id===ve),tn=Ge.findIndex(Ft=>Ft.id===Ke.id);if(At!==-1&&tn!==-1){const Ft={...Ge[At]},fn={...Ge[tn]};Ft.relations=Ft.relations||{parents:[],children:[],spouseId:null},fn.relations=fn.relations||{parents:[],children:[],spouseId:null},Be==="parent"?(Ft.relations.parents.includes(Ke.id)||(Ft.relations.parents=[...Ft.relations.parents,Ke.id]),fn.relations.children.includes(ve)||(fn.relations.children=[...fn.relations.children,ve])):Be==="child"?(Ft.relations.children.includes(Ke.id)||Ft.relations.children.push(Ke.id),fn.relations.parents.includes(ve)||fn.relations.parents.push(ve)):Be==="spouse"&&(Ft.relations.spouseId=Ke.id,fn.relations.spouseId=ve),Ge[At]=Ft,Ge[tn]=fn}J(`Ny person (REF ${Ke.refNumber}) skapad. ppnar fr redigering...`);const Nn=[],Mn=new Set;return(Ge||[]).forEach(Ft=>{Mn.has(Ft.id)||(Mn.add(Ft.id),Nn.push(Ft))}),{...vt,people:Nn}}),d(!0),pt(),cs(Ke.id),V(ve)},Nl=(T?.past?.length||0)>0,Ht=(T?.future?.length||0)>0,Rn=(ve,Be=null,Fe=null)=>{Ye(Be,Fe)},nc=ve=>{Ue(ve),ve!=="familyTree"&&(zt&&(ls(null),Xe(!1)),X&&ar(),$&&Cn(_?.selectedPlaceId))};C.useEffect(()=>{const ve=Be=>{const Fe=Be&&Be.detail||{},{placeId:Ke,eventId:vt}=Fe;if(!Ke||!vt||window.__WFT_lastUnlink&&window.__WFT_lastUnlink.placeId===Ke&&window.__WFT_lastUnlink.eventId===vt&&Date.now()-window.__WFT_lastUnlink.ts<1e3)return;let $t=null;l(Ge=>{const At={...Ge,people:(Ge.people||[]).map(tn=>({...tn,events:(tn.events||[]).map(Nn=>Nn.id===vt&&Nn.placeId===Ke?{...Nn,placeId:null,place:""}:Nn)}))};return $t=At,At}),d(!0),J("Koppling borttagen."),window.__WFT_lastUnlink={placeId:Ke,eventId:vt,ts:Date.now()};try{if($t){if(v&&v.id){const Ge=$t.people.find(At=>At.id===v.id);Ge&&ue(Ge)}if(zt&&zt.id){const Ge=$t.people.find(At=>At.id===zt.id);Ge&&ue(Ge)}}}catch{}};return window.addEventListener("WFT:unlinkPlaceFromEvent",ve),()=>window.removeEventListener("WFT:unlinkPlaceFromEvent",ve)},[]);const Ti=async()=>{try{window.electronAPI?J("Export pbrjad... (inte implementerad i denna build)"):J("Export ej tillgnglig i webblsarlge.")}catch{J("Export misslyckades.")}},sc=async()=>{try{J("Import inte implementerad i denna version.")}catch{J("Import misslyckades.")}},ea=async()=>{try{const ve=!!window.electronAPI&&typeof window.electronAPI.openFileDialog=="function",Be=!!window.electron&&typeof window.electron.openFileDialog=="function";if(!ve&&!Be){J("Fil-dialog inte tillgnglig.");return}const Fe=ve?await window.electronAPI.openFileDialog({properties:["openDirectory"]}):await window.electron.openFileDialog({properties:["openDirectory"]});if(!Fe)return;const Ke=Array.isArray(Fe)?Fe:Fe.filePaths||[];if(Fe.canceled||!Ke||Ke.length===0)return;const vt=Ke[0];Js(vt),J(`Vald backup-mapp: ${vt}`)}catch{J("Fel vid val av mapp.")}};return o.jsxs("div",{className:"h-screen flex flex-col",style:{overflow:"hidden"},children:[o.jsxs("div",{className:"menubar shadow-md shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("h1",{className:"text-lg font-bold tracking-wide mr-2",children:["WestFamilyTree",a&&a.name?`  [${a.name}]`:""]}),o.jsx(mt,{onClick:Z,disabled:!Nl,variant:"secondary",size:"sm",className:Nl?"":"opacity-50",children:""}),o.jsx(mt,{onClick:pe,disabled:!Ht,variant:"secondary",size:"sm",className:Ht?"":"opacity-50",children:""}),o.jsx(mt,{onClick:()=>Promise.resolve(te()).then(e),variant:"secondary",size:"sm",children:"Ny"}),o.jsx(mt,{onClick:ke,variant:"secondary",size:"sm",children:"ppna fil..."}),o.jsx(mt,{onClick:()=>window.close(),variant:"primary",size:"sm",children:"Stng"}),o.jsx(mt,{onClick:()=>window.close(),variant:"secondary",size:"sm",children:"Stng"}),o.jsx(mt,{onClick:()=>y(!0),variant:"secondary",size:"sm",children:"Instllningar"}),o.jsx(mt,{onClick:()=>ye(!0),variant:"secondary",size:"sm",children:"Sl ihop"}),o.jsx(mt,{onClick:()=>qe(!0),variant:"secondary",size:"sm",children:"Merges"}),o.jsx(mt,{onClick:()=>vn(!0),variant:"secondary",size:"sm",children:"GEDCOM import"})]}),o.jsx("div",{className:"text-xs text-slate-400",children:o.jsx("span",{children:a?`ppen fil: ${a.name}`:"Ny namnls databas"})})]}),b&&o.jsx("div",{className:"modal",style:{display:"block"},children:o.jsxs("div",{className:"modal-content card bg-slate-800 border border-slate-700 p-8 max-w-2xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-slate-200",children:"Instllningar"}),o.jsx("button",{onClick:()=>y(!1),className:"text-slate-400 hover:text-slate-300 text-2xl",children:""})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"text-slate-400 mb-4",children:[o.jsx("div",{className:"mb-2",children:"Audit-backup-mapp (valfritt):"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"text",value:za,onChange:ve=>Js(ve.target.value),placeholder:"Skvg till mapp eller lmna tomt fr standard",className:"flex-1 border rounded px-2 py-1"}),o.jsx(mt,{onClick:ea,variant:"secondary",size:"sm",children:"Vlj..."}),o.jsx(mt,{onClick:()=>Js(""),variant:"danger",size:"sm",children:"Rensa"})]})]}),o.jsxs("div",{className:"flex flex-col gap-2 mt-8",children:[o.jsxs("div",{className:"flex gap-2 justify-end",children:[o.jsx(mt,{onClick:Ti,variant:"primary",size:"sm",children:"Exportera allt som zip"}),o.jsx(mt,{onClick:sc,variant:"secondary",size:"sm",children:"Importera zip-backup"}),o.jsx(mt,{onClick:()=>rs(!0),variant:"secondary",size:"sm",children:"Relationsinstllningar"}),o.jsx(mt,{onClick:()=>{Re(za),y(!1),J("Instllningar sparade.")},variant:"success",size:"sm",children:"Stng"})]}),Ss&&o.jsx("div",{className:"mt-4 p-4 border border-slate-700 rounded bg-slate-900",children:o.jsx(qO,{inline:!0,onClose:()=>rs(!1)})}),(zt&&zt._isPlaceholder||Pt&&zt&&Pt.id===zt.id)&&o.jsxs("div",{className:"p-3 border-t border-slate-700 bg-slate-800 flex justify-end gap-2",children:[o.jsx(mt,{onClick:()=>Se(zt.id),variant:"danger",size:"sm",children:"Avbryt"}),o.jsx(mt,{onClick:Je,variant:"success",size:"sm",children:"Stng ndringar"})]})]})]})]})}),F&&o.jsx(CO,{isOpen:F,onClose:ve=>{ye(!1),ve&&J(`Merge klart (${ve})`)}}),be&&o.jsx(EO,{isOpen:be,onClose:()=>qe(!1)}),jt&&o.jsx($O,{allPeople:t.people||[],initialPair:fl,onClose:()=>{Bt(!1),Rs(null)}}),o.jsx(Y2,{isOpen:Xs.isOpen,onClose:()=>rr({isOpen:!1,preSelectedPersonId:null}),people:xs,onLink:tc,initialPersonId:Xs.preSelectedPersonId,zIndex:X?10100:5100}),I&&o.jsx("div",{className:"modal",style:{display:"block"},onClick:O,children:o.jsxs("div",{className:"modal-content card bg-slate-800 border border-slate-700 p-4 max-w-md",onClick:ve=>ve.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200",children:"Historik"}),o.jsx("button",{onClick:O,className:"text-slate-400 hover:text-slate-300 text-2xl",children:""})]}),o.jsx("div",{className:"text-sm text-slate-300 max-h-64 overflow-y-auto",children:o.jsx("ul",{className:"space-y-2",children:T.past.map((ve,Be)=>o.jsx("li",{onClick:()=>Gs(ve),className:"p-2 border border-slate-700 rounded hover:bg-slate-700 cursor-pointer",children:o.jsxs("div",{className:"font-semibold",children:["Flik: ",o.jsx("b",{children:ve.tab})]})},Be))})})]})}),o.jsxs("div",{className:"status-bar shrink-0",children:[o.jsx("span",{children:i?"Redo med osparade ndringar":"Redo"}),i&&o.jsx("span",{className:"text-amber-600 font-bold",children:" Osparade ndringar"})]}),o.jsxs("div",{id:"app",className:"flex-grow p-6 flex flex-col bg-slate-900 overflow-hidden min-h-0",children:[o.jsx("div",{className:"w-full mb-4 border-b border-slate-700 bg-slate-900 shrink-0",children:o.jsx("nav",{className:"-mb-px flex space-x-2 md:space-x-4 lg:space-x-8",children:[{label:"Personregister",value:"people",icon:o.jsx("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m9-7a4 4 0 11-8 0 4 4 0 018 0z"})})},{label:"Kllkatalog",value:"sources",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 20h9"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m0 0H3m9 0h9"})]})},{label:"Platsregister",value:"places",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 11c-4 0-7 2.239-7 5v3h14v-3c0-2.761-3-5-7-5z"})]})},{label:"Slkttrd",value:"familyTree",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 21V9a6 6 0 1112 0v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 21h12"})]})},{label:"Verktyg",value:"tools",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{label:"Grdsarkivet",value:"farmArchive",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 21v-2a4 4 0 014-4h10a4 4 0 014 4v2"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 3.13a4 4 0 010 7.75"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 3.13a4 4 0 010 7.75"})]})},{label:"Orphan-arkivet",value:"orphanArchive",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3"})]})},{label:"Audit",value:"audit",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 2v4M8 2v4M3 10h18"})]}),badge:null},{label:"Media",value:"media",icon:o.jsxs("svg",{className:"w-5 h-5 mr-1 inline-block align-text-bottom",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 15l-5-5L5 21"})]})}].map(ve=>o.jsxs("button",{onClick:()=>nc(ve.value),className:`whitespace-nowrap py-2 px-2 md:px-3 border-b-2 font-medium text-sm tab-btn flex items-center gap-1 relative transition-colors duration-150
                  ${N===ve.value?"border-blue-500 text-white bg-slate-700 rounded-t":"border-transparent text-white hover:bg-slate-800"}`,style:{minWidth:0},children:[ve.icon,o.jsx("span",{children:ve.label}),ve.badge?o.jsx("span",{className:"ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-500 text-white",children:ve.badge}):null,N===ve.value&&o.jsx("span",{className:"absolute left-0 right-0 -bottom-1 h-1 bg-blue-200 rounded-b",style:{zIndex:1}})]},ve.value))})}),o.jsxs("div",{className:`flex-grow min-h-0 ${v?"flex gap-4":""}`,children:[(!N||N==="people")&&o.jsx("div",{className:"tab-content max-w-6xl mx-auto w-full",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx(bS,{newFirstName:u,setNewFirstName:h,newLastName:p,setNewLastName:g,onAddPerson:Ee}),o.jsxs("div",{className:"flex items-center justify-between w-full mb-2",children:[o.jsx("div",{}),o.jsx("div",{className:"flex items-center gap-3",children:o.jsxs("label",{className:"text-sm text-slate-400 flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:Dl,onChange:ve=>Zr(ve.target.checked)}),o.jsx("span",{className:"select-none",children:"Visa arkiverade"})]})})]}),o.jsx(vS,{people:xs,onOpenEditModal:Ie,onOpenRelationModal:re,onDeletePerson:ie,focusPair:S,onSetFocusPair:oe,bookmarks:j}),o.jsx("div",{className:"lg:col-span-1",children:o.jsx(zO,{allPeople:xs,onOpenPair:ve=>{Rs(ve),Bt(!0)}})})]})}),N==="orphanArchive"&&o.jsx(SO,{people:t.people||[],allSources:t.sources||[],onOpenPerson:Ie,onViewInFamilyTree:re}),N==="audit"&&o.jsx(jO,{}),N==="media"&&o.jsx(e5,{allPeople:xs,onOpenEditModal:Ie,mediaItems:t.media||[],onUpdateMedia:ve=>{l(Be=>({...Be,media:ve})),d(!0)},setIsSourceDrawerOpen:bt,setIsPlaceDrawerOpen:ss}),N==="tools"&&o.jsx("div",{className:"tab-content flex items-center justify-center h-full",children:o.jsxs(mt,{variant:"primary",size:"lg",onClick:()=>Ol(!0),className:"flex items-center gap-3 px-8 py-4 text-lg",children:[o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"OAI-PMH arkivharvester"]})}),N==="sources"&&o.jsx(_v,{sources:t.sources||[],people:xs,places:t.places||[],onDeleteSource:ht,onEditSource:st,catalogState:E,setCatalogState:D,onCreateNewPerson:ot,onOpenEditModal:Ie,onNavigateToPlace:bn,onAddSource:z,onOpenLinkPersonModal:Rl,onUnlinkSourceFromEvent:us}),N==="places"&&o.jsx(cm,{places:t.places||[],allPeople:xs,catalogState:_,setCatalogState:H,onOpenEditModal:Ie,onSavePlace:Xt,onAddNewPlace:$e,onNavigateToSource:q,onAttachSource:fe,onUnlinkPlaceFromEvent:(ve,Be)=>{const Fe=(t.people||[]).map(vt=>({...vt,events:(vt.events||[]).map($t=>$t.id===Be&&$t.placeId===ve?{...$t,placeId:null,place:""}:$t)})),Ke={...t,people:Fe};l(Ke),d(!0),J("Koppling borttagen.")}}),N==="familyTree"&&o.jsx(gO,{allPeople:xs,focusPersonId:L,onSetFocus:ve=>V(ve),onOpenEditModal:Ie,onOpenPersonDrawer:ne,onSave:Ce,onCreatePersonAndLink:ir,onOpenContextMenu:qt,onDeletePerson:ie,highlightPlaceholderId:Pt?.id||(zt&&zt._isPlaceholder?zt.id:null),onRequestOpenDuplicateMerge:()=>Bt(!0)}),N==="farmArchive"&&o.jsx(wO,{places:t.places||[],people:xs,allSources:t.sources||[],onSavePlace:Xt,onOpenPerson:Ie,onViewInFamilyTree:re,onNavigateToSource:q,onOpenSourceDrawer:Ye,onNavigateToPlace:bn,onOpenPlaceDrawer:Cn,onOpenSourceInDrawer:Rn}),v&&o.jsx(Vs,{title:`Redigera ${v.firstName||""} ${v.lastName||""}`,onClose:Qt,initialWidth:1200,initialHeight:800,children:o.jsx(eO,{person:v,onClose:Qt,onSave:Qe,onChange:ue,allSources:t.sources,allPlaces:t.places||[],allPeople:xs,onDeleteEvent:Q,onOpenSourceDrawer:Ye,onNavigateToSource:q,onNavigateToPlace:bn,onTogglePlaceDrawer:Cn,onViewInFamilyTree:re,focusPair:S,onSetFocusPair:oe,activeSourcingEventId:G?.eventId})})]})]}),X&&o.jsx(Vs,{title:"Kllkatalog",onClose:ar,initialWidth:1100,initialHeight:700,zIndex:9999,children:o.jsx(_v,{sources:t.sources||[],people:xs,places:t.places||[],onDeleteSource:ht,onEditSource:st,catalogState:E,setCatalogState:D,onCreateNewPerson:ot,onOpenEditModal:Ie,isDrawerMode:!0,onLinkSource:lt?dt:Ve,onUnlinkSource:ft,sourcingEventInfo:G,alreadyLinkedIds:Wr,onAddSource:z,onOpenLinkPersonModal:Rl,onUnlinkSourceFromEvent:us})}),$&&o.jsx(Vs,{title:"Platsregister",onClose:()=>Cn(_?.selectedPlaceId),initialWidth:1100,initialHeight:700,zIndex:9998,children:o.jsx(cm,{catalogState:_,setCatalogState:H,isDrawerMode:!!lt,onLinkPlace:xt})}),o.jsx(rO,{isVisible:B.isVisible,message:B.message,onUndo:rt,duration:1e4}),o.jsx(aO,{isVisible:Y.isVisible,message:Y.message,severity:Y.severity}),o.jsx(iO,{isOpen:de?.isOpen,warnings:de?.warnings||[],onClose:()=>{try{w()}catch{}}}),Ot&&o.jsx(lO,{allSources:t.sources||[],allPeople:xs,onAttach:_t,onCreateNew:xn,onClose:ze,onEditSource:ve=>q(ve)}),ds&&o.jsx(t5,{onClose:()=>Ol(!1),onImportSources:ve=>{l(Be=>({...Be,sources:[...Be.sources||[],...ve]})),Ol(!1),d(!0),J(`${ve.length} kilder importerade frn OAI-PMH`),ve.length>0&&(D(Be=>({...Be,selectedSourceId:ve[0].id,searchTerm:"",expanded:{...Be.expanded,vrigt:!0}})),Ye(),a&&U())}}),is&&o.jsx("div",{className:"modal",style:{display:"block",zIndex:3e3},children:o.jsxs("div",{className:"modal-content card bg-slate-800 border border-slate-700 shadow-2xl rounded-xl max-w-5xl",children:[o.jsxs("div",{className:"flex justify-between items-center border-b border-slate-700 p-4 bg-slate-700 rounded-t-xl",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-200",children:"Importera GEDCOM (NY)"}),o.jsx("button",{onClick:()=>vn(!1),className:"text-slate-400 hover:text-slate-300 text-2xl\\",children:""})]}),o.jsx("div",{className:"p-6",children:o.jsx(KO,{onImport:ve=>{l(Be=>{const Fe=new Map((Be.people||[]).map(Ge=>[Ge.id,Ge]));for(const Ge of ve.individuals)Fe.has(Ge.id)||Fe.set(Ge.id,Ge);const Ke=new Map((Be.sources||[]).map(Ge=>[Ge.id,Ge]));for(const Ge of ve.sources)Ke.has(Ge.id)||Ke.set(Ge.id,Ge);const vt=new Map((Be.places||[]).map(Ge=>[Ge.id,Ge]));if(ve.places)for(const Ge of ve.places)vt.has(Ge.id)||vt.set(Ge.id,Ge);const $t=Array.from(Fe.values()).map(Ge=>Ge.relations?{...Ge,relations:{parents:Array.isArray(Ge.relations.parents)?Ge.relations.parents:[],children:Array.isArray(Ge.relations.children)?Ge.relations.children:[],spouseId:typeof Ge.relations.spouseId<"u"?Ge.relations.spouseId:null}}:{...Ge,relations:{parents:[],children:[],spouseId:null}});return{...Be,people:$t,sources:Array.from(Ke.values()),places:Array.from(vt.values())}}),vn(!1),J("Import klar!")}})})]})})]})}const s5=C.createContext();let Gv=5e3;function l5({children:n}){const[e,t]=C.useState([]),[l,a]=C.useState(null),i=C.useCallback(h=>{const{id:p=`window-${Date.now()}`,title:g,icon:b,children:y,initialWidth:v=1e3,initialHeight:N=700,onClose:S}=h;Gv+=100;const j=Gv;return t(E=>[...E,{id:p,title:g,icon:b,children:y,initialWidth:v,initialHeight:N,onClose:S,zIndex:j}]),a(p),p},[]),d=C.useCallback(h=>{t(p=>p.filter(g=>g.id!==h))},[]),u=C.useCallback(()=>{t([])},[]);return o.jsxs(s5.Provider,{value:{openWindow:i,closeWindow:d,closeAll:u,activeWindowId:l,setActiveWindowId:a},children:[n,e.map(h=>o.jsx(Vs,{windowId:h.id,title:h.title,icon:h.icon,initialWidth:h.initialWidth,initialHeight:h.initialHeight,zIndex:h.zIndex,isActive:h.id===l,onActivate:()=>a(h.id),onClose:()=>{h.onClose&&h.onClose(),d(h.id)},children:h.children},h.id))]})}cS.createRoot(document.getElementById("root")).render(o.jsx(xS,{children:o.jsx(l5,{children:o.jsx(n5,{})})}));
